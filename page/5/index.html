<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="my blog">
<meta property="og:type" content="website">
<meta property="og:title" content="zsy&#39;s blog">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="my blog">
<meta property="og:locale">
<meta property="article:author" content="张思宇">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/5/"/>





  <title>zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/06/RSTP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/06/RSTP/" itemprop="url">RSTP原理与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-06T17:10:54+08:00">
                2021-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•以太网交换网络中为了进行链路备份，提高网络可靠性，通常会使用冗余链路，但是这也带来了网络环路的问题。网络环路会引发广播风暴和MAC地址表震荡等问题，导致用户通信质量差，甚至通信中断。为了解决交换网络中的环路问题，IEEE提出了基于802.1D标准的STP（Spanning Tree Protocol，生成树协议）。</p>
<p>•随着局域网规模的不断增长，STP拓扑收敛速度慢的问题逐渐凸显，因此，IEEE在2001年发布了802.1W标准，定义了RSTP（Rapid Spanning Tree Protocol，快速生成树协议），RSTP在STP的基础上进行了改进，可实现网络拓扑的快速收敛。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><ul>
<li><p>描述STP技术的缺陷</p>
</li>
<li><p>描述RSTP对STP技术的改进</p>
</li>
<li><p>描述RSTP的基本工作原理</p>
</li>
<li><p>完成RSTP的基本配置</p>
</li>
</ul>
<h1 id="STP回顾与STP不足"><a href="#STP回顾与STP不足" class="headerlink" title="STP回顾与STP不足"></a><strong>STP回顾与STP不足</strong></h1><h2 id="回顾：STP的工作原理"><a href="#回顾：STP的工作原理" class="headerlink" title="回顾：STP的工作原理"></a><strong>回顾：STP的工作原理</strong></h2><p>•STP通过在交换机之间传递配置BPDU来选举根交换机 (或根桥)，以及确定每个交换机端口的角色和状态。</p>
<p>​    ▫在初始化过程中，每个交换机都主动发送配置BPDU。</p>
<p>​    ▫在网络拓扑稳定以后，只有根桥周期性发送配置BPDU，其他交    换机在收到上游传来的配置BPDU后，才会发送自己的配BPDU。</p>
<p>•配置BPDU包含了桥ID、路径开销和端口ID等参数。</p>
<p><img src="/2021/05/06/RSTP/1.png"></p>
<blockquote>
<p>•配置BPDU泛洪：</p>
<ul>
<li><p>在初始形成STP树的过程中，所有STP交换机会周期性地（Hello Time，缺省为2s）主动产生并发送配置BPDU，大家都认为自己是根桥。</p>
</li>
<li><p>随着BPDU的泛洪和收集，各交换机根据BPDU包含的信息进行比较，并选举出根桥。</p>
</li>
<li><p>在此之后（即STP树形成后的稳定期），只有根桥会周期性地（缺省为2s）主动产生并发送配置BPDU。相应的，非根桥交换机会从自己的根端口周期性地接收到配置BPDU，并立即触发产生自己的配置BPDU，然后从自己的指定端口发出。——这一过程看起来就像是，根桥发出的配置BPDU逐跳地“经过”了其他的交换机。也可以理解为：从根桥倒一盆水下来，水顺着这棵无环的树从上往下不断地往下流。因此如图所示，可以理解为SW1与SW2间的链路是SW2的上游链路，SW2与SW3间的链路是SW2的下游链路。</p>
</li>
</ul>
<p>•报文格式：</p>
<ul>
<li><p>配置BPDU携带的参数可以分为3类：</p>
</li>
<li><p>第一类，BPDU对自身的标识，包括：协议标识、协议版本号、BPDU类型和标志。</p>
<ul>
<li>协议标识（Protocol ID，PID），2 Byte，总是0x000。</li>
<li>协议版本号（Protocol Version ID，PVI），1 Byte，总是0x00。</li>
<li>BPDU类型（BPDU Type），1 Byte，配置BPDU的类型值为0x00。</li>
<li>标志（Flag），1 Byte，网络拓扑变化标志，仅使用了最低位和最高位。</li>
</ul>
</li>
<li><p>第二类，用于进行STP计算的参数，包括：当前根桥的BID、根路径开销、发送该BPDU的交换机的BID和发送该BPDU的端口的PID。</p>
<ul>
<li>根桥ID（Root ID），8 Byte，当前根桥的BID。</li>
<li>根路径开销（Root Path Cost，RPC），4 Byte，发送该BPDU的端口累计到根桥的开销。</li>
<li>网桥ID（Bridge ID，BID），8 Byte，发送该BPDU的交换机的BID。</li>
<li>接口ID（Port ID，PDID），2 Byte，发送该BPDU的端口ID。</li>
</ul>
</li>
<li><p>第三类，时间参数，包括：消息寿命、最大寿命、Hello时间和转发延迟。</p>
<ul>
<li>消息寿命（Message Age），2 Byte，该BPDU消息的年龄。从根桥发出的配置BPDU，Message Age为0。在实际的实现中，配置BPDU每“经过”一个桥，Message Age增加1。</li>
<li>最大寿命（Max Age），2 Byte，BPDU的最大生命周期，缺省为20s。</li>
<li>Hello时间（Hello Time），2 Byte，根桥发送配置BPDU的周期，缺省为2s。</li>
<li>转发延迟（Forward Delay），2 Byte，端口在侦听和学习状态（后续会讲）所停留的时间间隔，缺省为15s。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="回顾：STP树的生成过程"><a href="#回顾：STP树的生成过程" class="headerlink" title="回顾：STP树的生成过程"></a><strong>回顾：STP树的生成过程</strong></h2><p><img src="/2021/05/06/RSTP/2.png"></p>
<blockquote>
<p>•STP基本原理：</p>
<ul>
<li>在一个具有物理环路的交换网络中，交换机通过运行STP，自动生成一个没有环路的工作拓扑，也被称为STP树。树节点为某些特定的交换机，树枝为某些特定的链路。</li>
</ul>
<p>•STP采用四个步骤来解决二层环路问题（生成一棵STP树）：</p>
<ul>
<li>在一个交换网络中选举一个根桥；在每个非根桥上选举一个根端口；为每个网段选举一个指定端口；阻塞交换机上所有剩余的非根、非指定端口（备用端口）。</li>
</ul>
<p>•如何生成STP树？</p>
<ul>
<li>主要通过比较4个参数：根桥ID、根路径开销、网桥ID和端口ID，值越小，越优先。而这些参数，都是报文BPDU中的字段。<ul>
<li>根桥选举：比较根桥ID，最小胜出。</li>
<li>根端口选举：依次比较RPC、对端BID、对端PID和本端PID，最小胜出。</li>
<li>指定端口选举：依次比较RPC、本端BID和本端PID，最小胜出。</li>
<li>在确定了根端口和指定端口之后，交换机上所有剩余的非根端口和非指定端口被阻塞。</li>
</ul>
</li>
</ul>
<p>•在华为产品的实现中，被阻塞的非指定端口表现为Alternate Port。</p>
</blockquote>
<h2 id="回顾：STP的端口状态迁移"><a href="#回顾：STP的端口状态迁移" class="headerlink" title="回顾：STP的端口状态迁移"></a><strong>回顾：STP的端口状态迁移</strong></h2><p><img src="/2021/05/06/RSTP/3.png"></p>
<blockquote>
<p>•根据端口是否接收和发送STP协议帧，以及端口是否能转发用户数据帧，STP定义了五种端口状态：Disabled、Blocking、Listening、Learning和Forwarding。</p>
<ul>
<li>Disabled状态：端口无法接收和发出任何帧（即：端口不仅不处理BPDU报文，也不转发用户流量），端口处于关闭（down）状态。</li>
<li>Blocking状态：端口只能接收并处理BPDU，不能发送BPDU，也不能转发用户数据帧（用户流量），是阻塞端口的最终状态。</li>
<li>Listening状态：端口可以接收并发送BPDU，但不进行MAC地址学习，也不能转发用户数据帧。这是过渡状态，用于确定端口角色，将选举出根桥、根端口和指定端口，同时用于防止临时环路。</li>
<li>Learning状态：端口可以接收并发送BPDU，也可以进行MAC地址学习，根据收到的用户流量构建MAC地址表，但不能转发用户数据帧（用户流量）。这也是过渡状态，用于防止MAC地址表未建立，网络中出现大量数据帧泛洪。</li>
<li>Forwarding状态：端口可以接收并发送BPDU，也可以进行MAC地址学习，同时能够转发用户数据帧（用户流量）。只有根端口或指定端口才能进入Forwarding状态。</li>
</ul>
<p>•端口状态迁移：</p>
<ol>
<li><p>STP交换机的端口在初始启动时，会从Disabled状态进入到Blocking状态。在Blocking状态，端口只接收和分析BPDU，但不发送。</p>
</li>
<li><p>在整个过程中，端口一但被关闭或发生了链路故障，就会进入Disabled状态。</p>
</li>
<li><p>如果端口被选为根端口或指定端口，则会进入Listening状态，此时端口接收并发送BPDU，这种状态会持续一个Forward Delay的时间长度，缺省为15s，是为了防止临时环路：因为此时网络中可能还存在因STP树的计算过程不同步而产生的临时环路。</p>
</li>
<li><p>在端口状态迁移过程中，如果端口的角色被判定为非根端口或非指定端口，则其端口状态就会立即退回到Blocking状态。</p>
</li>
<li><p>如果没有因“意外情况”回到Disabled状态，那么端口会进入Learning状态，此时端口不但可以接收并发送BPDU，还会开始构建MAC地址表，为用户流量的转发做好准备。这个状态也会持续一个Forward Delay的时间长度，缺省为15s，是为了防止此时交换机的MAC地址表还未建立，导致大量的数据帧被泛洪<strong>。</strong></p>
</li>
<li><p>最后，端口进入Forwarding状态，开始转发用户流量。</p>
</li>
</ol>
</blockquote>
<h2 id="STP的不足"><a href="#STP的不足" class="headerlink" title="STP的不足"></a>STP的不足</h2><p>STP虽然能够解决环路问题，但是由于网络拓扑收敛慢，影响了用户通信质量。如果网络中的拓扑结构频繁变化，网络也会随之频繁失去连通性，从而导致用户通信频繁中断，这是用户无法忍受的。</p>
<p>STP的不足：</p>
<ul>
<li><p>STP没有细致区分端口状态和端口角色，不利于初学者学习及部署。</p>
<ul>
<li>从用户角度来讲，Listening、Learning和Blocking状态并没有区别，都同样不转发用户流量。</li>
<li>从使用和配置角度来讲，端口之间最本质的区别并不在于端口状态，而是在于端口扮演的角色。</li>
</ul>
</li>
<li><p>STP算法是被动的算法，依赖定时器等待的方式判断拓扑变化，收敛速度慢。</p>
</li>
<li><p>STP算法要求在稳定的拓扑中，根桥主动发出配置BPDU报文，而其他设备再进行处理，最终传遍整个STP网络。</p>
</li>
</ul>
<h2 id="STP对计时器的依赖"><a href="#STP对计时器的依赖" class="headerlink" title="STP对计时器的依赖"></a><strong>STP对计时器的依赖</strong></h2><p><img src="/2021/05/06/RSTP/4.png"></p>
<p><img src="/2021/05/06/RSTP/5.png"></p>
<h2 id="STP重收敛过程慢"><a href="#STP重收敛过程慢" class="headerlink" title="STP重收敛过程慢"></a><strong>STP重收敛过程慢</strong></h2><p><img src="/2021/05/06/RSTP/6.png"></p>
<p><img src="/2021/05/06/RSTP/7.png"></p>
<blockquote>
<p>•直连故障：</p>
<ul>
<li><p>两台交换机间有两条链路，其中一条是主用链路，另一条为备用链路。</p>
</li>
<li><p>当网络稳定时，交换机SW2检测到根端口的链路发生故障，则被阻塞的端口会开始端口状态迁移，最终进入用户流量转发状态。</p>
</li>
</ul>
<p>•非直连故障：</p>
<ul>
<li><p>当网络正常时，SW3的被阻塞端口会定期收到来自根桥的BPDU。</p>
</li>
<li><p>当SW1与SW2之间的链路发生故障时，SW2能够第一时间检测到故障发生，此时它认为自己成为新的根桥，于是向SW3发送自己的配置BPDU（根桥ID为自己的桥ID）。</p>
</li>
<li><p>SW3的被阻塞端口将收到上述配置BPDU，但该BPDU并不比当前端口所缓存的配置BPDU更优，因此SW3忽略该配置BPDU。</p>
</li>
<li><p>当Max Age计时器超时后，SW3端口上缓存的配置BPDU老化，SW3开始向SW2发送配置BPDU，该配置BPDU由根桥SW1发送的配置BPDU触发，其中的根桥ID字段值为SW1的桥ID。</p>
</li>
<li><p>SW2收到上述配置BPDU后，解析该报文并认定SW1为根桥，于是将其连接SW3的端口切换为根端口。</p>
</li>
</ul>
</blockquote>
<h2 id="STP拓扑变更机制"><a href="#STP拓扑变更机制" class="headerlink" title="STP拓扑变更机制"></a><strong>STP拓扑变更机制</strong></h2><p>STP的拓扑变更机制，需要先将拓扑变化信息传递给根桥，再由根桥向下游泛洪拓扑变化信息。</p>
<p><img src="/2021/05/06/RSTP/8.png"></p>
<blockquote>
<p>•拓扑变更，STP处理过程：</p>
<p>当交换机检测到拓扑更改时，会通知生成树的根桥，然后根桥将该拓扑更改信息泛洪到整个网络。</p>
<p>拓扑变化过程，如图：</p>
<ul>
<li>如果网络中新增一台交换机，导致工作拓扑发生了变化，则位于变化点的交换机可以通过端口状态直接感知到这种变化，但是其他的交换机是无法直接感知到的。</li>
<li>位于变化点的交换机会以Hello Time（缺省2s）为周期通过其根端口不断向上游发送TCN BPDU，直到接收到从上游交换机发来的、TCA位置1的配置BPDU。TCA位置1是为了通知下游设备停止发送TCN BPDU报文。</li>
<li>上游交换机收到TCN BPDU后，一方面会通过其指定端口回复TCA位置1的配置BPDU，另一方面会以Hello Time为周期通过其根端口不断向它的上游发送TCN BPDU。</li>
<li>这个过程一直重复，直到根桥收到TCN BPDU。</li>
<li>根桥收到TCN BPDU后，会发送TC位置1的配置BPDU，通告所有交换机网络拓扑发生了变化，通知下游设备直接删除桥MAC地址表项。</li>
</ul>
</blockquote>
<h1 id="RSTP概述"><a href="#RSTP概述" class="headerlink" title="RSTP概述"></a><strong>RSTP概述</strong></h1><h2 id="RSTP概述-1"><a href="#RSTP概述-1" class="headerlink" title="RSTP概述"></a><strong>RSTP概述</strong></h2><p>•IEEE 802.1W中定义的RSTP可以视为STP的改进版本，RSTP在许多方面对STP进行了优化，它的收敛速度更快，而且能够兼容STP。</p>
<p>•RSTP对STP的改进：</p>
<ul>
<li>通过端口角色的增补，简化了生成树协议的理解及部署；</li>
<li>端口状态的重新划分；</li>
<li>配置BPDU格式的改变，充分利用了STP协议报文中的Flag字段，明确了端口角色；</li>
<li>配置BPDU的处理发生变化；</li>
<li>快速收敛；</li>
<li>增加保护功能。</li>
</ul>
<blockquote>
<p>•RSTP可以兼容STP：RSTP可以和STP互操作，但是此时会丧失快速收敛等RSTP优势。</p>
<ul>
<li><p>当一个网段里既有运行STP的交换设备又有运行RSTP的交换设备，STP交换设备会忽略RSTP的BPDU。运行RSTP的交换设备在某端口上接收到运行STP的交换设备发出的配置BPDU，在两个Hello Time时间之后，便把自己的端口转换到STP工作模式，发送配置BPDU，从而实现了互操作。</p>
</li>
<li><p>在华为技术有限公司的数据通信设备上可以配置运行STP的交换设备被撤离网络后，运行RSTP的交换设备可迁移回到RSTP工作模式。</p>
</li>
</ul>
</blockquote>
<h2 id="RSTP在园区网络中的应用位置"><a href="#RSTP在园区网络中的应用位置" class="headerlink" title="RSTP在园区网络中的应用位置"></a><strong>RSTP在园区网络中的应用位置</strong></h2><p><img src="/2021/05/06/RSTP/9.png"></p>
<h1 id="RSTP对STP的改进"><a href="#RSTP对STP的改进" class="headerlink" title="RSTP对STP的改进"></a><strong>RSTP对STP的改进</strong></h1><h2 id="改进点1：端口角色"><a href="#改进点1：端口角色" class="headerlink" title="改进点1：端口角色"></a><strong>改进点1：端口角色</strong></h2><p>通过端口角色的增补，简化了生成树协议的理解与部署。</p>
<p><img src="/2021/05/06/RSTP/10.png"></p>
<p><img src="/2021/05/06/RSTP/11.png"></p>
<blockquote>
<p>•RSTP的端口角色共有4种：根端口、指定端口、Alternate端口和Backup端口。</p>
<p>•根端口和指定端口的作用同STP中定义，Alternate端口和Backup端口的描述如下：</p>
<ul>
<li><p>从配置BPDU报文发送角度来看：</p>
<ul>
<li>Alternate端口就是由于学习到其它网桥发送的配置BPDU报文而阻塞的端口。</li>
<li>Backup端口就是由于学习到自己发送的配置BPDU报文而阻塞的端口。</li>
</ul>
</li>
<li><p>从用户流量角度来看：</p>
<ul>
<li>Alternate端口提供了从指定桥到根的另一条可切换路径，作为根端口的备份端口。</li>
<li>Backup端口作为指定端口的备份，提供了另一条从根桥到相应网段的备份通路。</li>
</ul>
</li>
</ul>
<p>•给一个RSTP域内所有端口分配角色的过程就是整个拓扑收敛的过程。</p>
</blockquote>
<h2 id="改进点2：端口状态"><a href="#改进点2：端口状态" class="headerlink" title="改进点2：端口状态"></a><strong>改进点2：端口状态</strong></h2><p>RSTP的状态规范缩减为3种，根据端口是否转发用户流量和学习MAC地址来划分:</p>
<p>▫Discarding状态：不转发用户流量也不学习MAC地址；</p>
<p>▫Learning状态：不转发用户流量但是学习MAC地址；</p>
<p>▫Forwarding状：既转发用户流量又学习MAC地址。</p>
<table>
<thead>
<tr>
<th align="center">STP端口状态</th>
<th align="center"><strong>RSTP端口状态</strong></th>
<th align="center"><strong>端口在拓扑中的角色</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">Forwarding</td>
<td align="center">Forwarding</td>
<td align="center">包括根端口、指定端口</td>
</tr>
<tr>
<td align="center">Learning</td>
<td align="center">Learning</td>
<td align="center">包括根端口、指定端口</td>
</tr>
<tr>
<td align="center">Listening</td>
<td align="center">Discarding</td>
<td align="center">包括根端口、指定端口</td>
</tr>
<tr>
<td align="center">Blocking</td>
<td align="center">Discarding</td>
<td align="center">包括Alternate端口、Backup端口</td>
</tr>
<tr>
<td align="center">Disabled</td>
<td align="center">Discarding</td>
<td align="center">包括Disable端口</td>
</tr>
</tbody></table>
<h2 id="改进点3：配置BPDU-RST-BPDU"><a href="#改进点3：配置BPDU-RST-BPDU" class="headerlink" title="改进点3：配置BPDU - RST BPDU"></a><strong>改进点3：配置BPDU - RST BPDU</strong></h2><p>•RSTP的配置BPDU充分利用了STP报文中的Flag字段，明确了端口角色。</p>
<p>•除了保证和STP格式基本一致之外，RSTP作了如下变化：</p>
<ul>
<li><p>Type字段：配置BPDU类型不再是0而是2，所以运行STP的设备收到RSTP的配置BPDU时会丢弃。</p>
</li>
<li><p>Flag字段：使用了原来保留的中间6位，这样改变的配置BPDU叫做RST BPDU。</p>
</li>
</ul>
<p>•<strong>RST BPDU报文格式：</strong></p>
<p><img src="/2021/05/06/RSTP/12.png"></p>
<blockquote>
<p>•RST BPDU与STP配置BPDU报文格式不同点，包括：BPDU类型和Flag字段。</p>
<ul>
<li><p>BPDU类型，1 Byte，RST BPDU的类型值为0x02。</p>
</li>
<li><p>标志，1 Byte，包括：</p>
<p>▪bit 7：TCA，表示拓扑变化确认；</p>
<p>▪bit 6：Agreement，表示同意，用于P/A机制；</p>
<p>▪bit 5：Forwarding，表示转发状态；</p>
<p>▪bit 4：Learning，表示学习状态；</p>
<p>▪bit 3和bit 2：表示端口角色，00表示未知端口，01表示替代或备份端口，10表示根端口，11表示指定端口；</p>
<p>▪bit 1：Proposal，表示提议，用于P/A机制；</p>
<p>▪bit 0：TC，表示拓扑变化。</p>
</li>
</ul>
</blockquote>
<h2 id="改进点4：配置BPDU的处理-1"><a href="#改进点4：配置BPDU的处理-1" class="headerlink" title="改进点4：配置BPDU的处理 (1)"></a><strong>改进点4：配置BPDU的处理</strong> <strong>(1)</strong></h2><p><img src="/2021/05/06/RSTP/13.png"></p>
<h2 id="改进点4：配置BPDU的处理-2"><a href="#改进点4：配置BPDU的处理-2" class="headerlink" title="改进点4：配置BPDU的处理 (2)"></a><strong>改进点4：配置BPDU的处理</strong> <strong>(2)</strong></h2><p><img src="/2021/05/06/RSTP/14.png"></p>
<h2 id="改进点4：配置BPDU的处理-3"><a href="#改进点4：配置BPDU的处理-3" class="headerlink" title="改进点4：配置BPDU的处理 (3)"></a><strong>改进点4：配置BPDU的处理 (3)</strong></h2><p><img src="/2021/05/06/RSTP/15.png"></p>
<blockquote>
<p>•STP：</p>
<ul>
<li>STP只有指定端口会立即处理次优BPDU，其他端口会忽略次优BPDU，等到Max Age计时器超时后，缓存的次优BPDU才会老化，然后发送自身更优的BPDU，进行新一轮的拓扑收敛。</li>
</ul>
<p>•RSTP：</p>
<ul>
<li>RSTP处理次优BPDU报文不再依赖于任何定时器（即不再依赖于BPDU老化）解决拓扑收敛，同时RSTP的任何端口角色都会处理次优BPDU，从而加快了拓扑收敛。</li>
</ul>
</blockquote>
<h2 id="改进点5：快速收敛机制-1"><a href="#改进点5：快速收敛机制-1" class="headerlink" title="改进点5：快速收敛机制 (1)"></a><strong>改进点5：快速收敛机制 (1)</strong></h2><p><img src="/2021/05/06/RSTP/16.png"></p>
<p><img src="/2021/05/06/RSTP/17.png"></p>
<h2 id="改进点5：快速收敛机制-2"><a href="#改进点5：快速收敛机制-2" class="headerlink" title="改进点5：快速收敛机制 (2)"></a><strong>改进点5：快速收敛机制</strong> <strong>(2)</strong></h2><p><img src="/2021/05/06/RSTP/18.png"></p>
<blockquote>
<p>•边缘端口的UP和Down，不会引起网络拓扑的变动。</p>
</blockquote>
<h2 id="改进点5：快速收敛机制-3"><a href="#改进点5：快速收敛机制-3" class="headerlink" title="改进点5：快速收敛机制 (3)"></a>改进点5：快速收敛机制 (3)</h2><p><img src="/2021/05/06/RSTP/19.png"></p>
<blockquote>
<p>•事实上对于STP，指定端口的选择可以很快完成，主要的速度瓶颈在于：为了避免环路，必须等待足够长的时间，使全网的端口状态全部确定，也就是说必须要等待至少一个Forward Delay所有端口才能进行转发。</p>
<p>•而RSTP的主要目的就是消除这个瓶颈，通过阻塞自己的非根端口来保证不会出现环路。而使用P/A机制加快了上游端口进入Forwarding状态的速度。</p>
</blockquote>
<h3 id="P-A机制详解-1"><a href="#P-A机制详解-1" class="headerlink" title="P/A机制详解(1)"></a><strong>P/A机制详解(1)</strong></h3><p><img src="/2021/05/06/RSTP/20.png"></p>
<h3 id="P-A机制详解-2"><a href="#P-A机制详解-2" class="headerlink" title="P/A机制详解(2)"></a><strong>P/A机制详解(2)</strong></h3><p><img src="/2021/05/06/RSTP/21.png"></p>
<blockquote>
<p>•SW2的下游端口同步过程：替代端口，状态不变；边缘端口，不参与计算；阻塞非边缘指定端口。</p>
</blockquote>
<h3 id="P-A机制详解-3"><a href="#P-A机制详解-3" class="headerlink" title="P/A机制详解(3)"></a><strong>P/A机制详解(3)</strong></h3><p><img src="/2021/05/06/RSTP/22.png"></p>
<h2 id="改进点6：拓扑变更机制"><a href="#改进点6：拓扑变更机制" class="headerlink" title="改进点6：拓扑变更机制"></a><strong>改进点6：拓扑变更机制</strong></h2><p>在RSTP中检测拓扑是否发生变化只有一个标准：一个非边缘端口迁移到Forwarding状态。</p>
<p><img src="/2021/05/06/RSTP/23.png"></p>
<blockquote>
<p>•在STP中，如果拓扑发生了变化，需要先向根桥传递TCN BPDU，再由根桥来通知拓扑变更，泛洪TC置位的配置BPDU。</p>
<p>•在RSTP中，通过新的拓扑变更机制，TC置位的RST BPDU会快速的在网络中泛洪。</p>
<p>•如上图所示：</p>
<ul>
<li><p>SW3的根端口收不到从根桥发来的RST BPDU后，Alternate端口会快速切换为新的根端口，启动TC While Timer，并清空所有端口学习到的MAC地址。然后向外发出TC置位的RST BPDU。</p>
</li>
<li><p>SW2接收到RST BPDU后，会清空接收口以外所有端口学习到的MAC地址，同时开启计时器，并向外发送TC置位的RST BPDU。</p>
</li>
<li><p>最终，RST BPDU会在全网泛洪。</p>
</li>
</ul>
</blockquote>
<h2 id="改进点7：保护功能-1"><a href="#改进点7：保护功能-1" class="headerlink" title="改进点7：保护功能 (1)"></a><strong>改进点7：保护功能</strong> <strong>(1)</strong></h2><p><img src="/2021/05/06/RSTP/24.png"></p>
<blockquote>
<p>•在交换设备上，通常将直接与用户终端（如PC机）或文件服务器等非交换设备相连的端口配置为边缘端口。</p>
<p>•如上图所示：</p>
<ul>
<li><p>SW3与某主机互联，并设置该互联端口为边缘端口。</p>
</li>
<li><p>后来该主机被恶意用户侵占，并伪造RST BPDU攻击SW3，因此边缘端口会收到RST BPDU，失去边缘端口特性，并进行生成树计算。</p>
</li>
</ul>
</blockquote>
<h2 id="改进点7：保护功能-2"><a href="#改进点7：保护功能-2" class="headerlink" title="改进点7：保护功能 (2)"></a><strong>改进点7：保护功能</strong> <strong>(2)</strong></h2><p><img src="/2021/05/06/RSTP/25.png"></p>
<blockquote>
<p>•由于维护人员的错误配置或网络中的恶意攻击，根桥有可能会收到优先级更高的RST BPDU，使得根桥失去根地位，从而引起网络拓扑结构的错误变动。这种拓扑变化，会导致原来应该通过高速链路的流量被牵引到低速链路上，造成网络拥塞。</p>
<p>•如上图所示：</p>
<ul>
<li><p>网络稳定时，SW1为根桥，向下游设备发送最优RST BPDU。</p>
</li>
<li><p>如果SW2被恶意用户侵占，例如恶意修改SW2的桥优先级，使得SW2的桥优先级优于SW1，此时SW2会主动发送自己的RST BPDU。</p>
</li>
<li><p>当SW1的指定端口收到该RST BPDU后，会重新进行生成树计算，而SW1也会失去根桥的地位，引起拓扑变动。</p>
</li>
</ul>
</blockquote>
<h2 id="改进点7：保护功能-3"><a href="#改进点7：保护功能-3" class="headerlink" title="改进点7：保护功能 (3)"></a><strong>改进点7：保护功能</strong> <strong>(3)</strong></h2><p><img src="/2021/05/06/RSTP/26.png"></p>
<blockquote>
<p>•在运行RSTP的网络中，根端口状态是依靠不断接收来自上游交换设备的RST BPDU维持。当由于链路拥塞或者单向链路故障导致根端口收不到来自上游交换设备的RST BPDU时，此时交换设备会重新选择根端口。</p>
<p>•如图所示，当SW1和SW3之间的链路发生单向链路故障时，SW3由于根端口在超时时间内收不到来自上游设备的BPDU报文，Alternate端口切换成根端口，根端口切换成指定端口，从而形成了环路。</p>
</blockquote>
<h2 id="改进点7：保护功能-4"><a href="#改进点7：保护功能-4" class="headerlink" title="改进点7：保护功能 (4)"></a><strong>改进点7：保护功能</strong> <strong>(4)</strong></h2><p><img src="/2021/05/06/RSTP/27.png"></p>
<blockquote>
<p>•交换设备在接收到TC置位的RST BPDU报文后，会执行MAC地址表项的删除操作。如果有人伪造TC置位的RST BPDU报文恶意攻击交换设备时，交换设备短时间内会收到很多RST BPDU报文，频繁的删除操作会给设备造成很大的负担，给网络的稳定带来很大隐患。</p>
<p>•如上图所示：</p>
<ul>
<li>如果SW3被恶意用户侵占，伪造大量TC置位的RST BPDU并向外发送。SW2收到这些RST BPDU后，会频繁执行MAC地址表项的删除操作，形成巨大负担。</li>
</ul>
</blockquote>
<h1 id="RSTP的工作过程"><a href="#RSTP的工作过程" class="headerlink" title="RSTP的工作过程"></a><strong>RSTP的工作过程</strong></h1><h2 id="RSTP拓扑收敛过程-1"><a href="#RSTP拓扑收敛过程-1" class="headerlink" title="RSTP拓扑收敛过程(1)"></a><strong>RSTP拓扑收敛过程(1)</strong></h2><p><img src="/2021/05/06/RSTP/28.png"></p>
<blockquote>
<p>•RSTP收敛与STP收敛过程类似。</p>
<p>•网络初始化时，网络中所有的RSTP交换机都认为自己是“根桥”，并设置每个端口都为指定端口，发送RST BPDU。其中SW1的桥ID最优，最终会被选举为根桥。</p>
</blockquote>
<h2 id="RSTP拓扑收敛过程-2"><a href="#RSTP拓扑收敛过程-2" class="headerlink" title="RSTP拓扑收敛过程(2)"></a><strong>RSTP拓扑收敛过程(2)</strong></h2><p><img src="/2021/05/06/RSTP/29.png"></p>
<blockquote>
<p>•每个认为自己是“根桥”的交换机生成一个RST BPDU报文来协商指定网段的端口状态，此RST BPDU报文Flag字段里面的Proposal位需要置位。</p>
<p>•当一个端口收到RST BPDU报文时，此端口会比较收到的RST BPDU报文和本地的RST BPDU报文。如果本地的RST BPDU报文优于接收的RST BPDU报文，则端口会丢弃接收的RST BPDU报文，并发送Proposal置位的本地RST BPDU报文来回复对端设备。</p>
<p>•如图，RSTP上游链路的设备互联端口收敛过程，以SW1与SW2为例。</p>
</blockquote>
<h2 id="RSTP拓扑收敛过程-3"><a href="#RSTP拓扑收敛过程-3" class="headerlink" title="RSTP拓扑收敛过程(3)"></a><strong>RSTP拓扑收敛过程(3)</strong></h2><p><img src="/2021/05/06/RSTP/30.png"></p>
<blockquote>
<p>•如图，RSTP下游链路的设备互联端口会进入慢收敛过程，以SW2与SW3为例。</p>
</blockquote>
<h1 id="RSTP的基本配置"><a href="#RSTP的基本配置" class="headerlink" title="RSTP的基本配置"></a><strong>RSTP的基本配置</strong></h1><h2 id="RSTP的基础配置命令-1"><a href="#RSTP的基础配置命令-1" class="headerlink" title="RSTP的基础配置命令(1)"></a><strong>RSTP的基础配置命令(1)</strong></h2><p><img src="/2021/05/06/RSTP/31.png"></p>
<h2 id="RSTP的基础配置命令-2"><a href="#RSTP的基础配置命令-2" class="headerlink" title="RSTP的基础配置命令(2)"></a><strong>RSTP的基础配置命令(2)</strong></h2><p><img src="/2021/05/06/RSTP/32.png"></p>
<blockquote>
<p>•配置接口路径开销：</p>
<ul>
<li><p>dot1d-1998：指定路径开销值的计算方法是IEEE 802.1d-1998标准方法。使用IEEE 802.1d-1998标准方法时取值范围是1～65535。</p>
</li>
<li><p>dot1t：指定路径开销值的计算方法是IEEE 802.1t标准方法。使用IEEE 802.1t标准方法时取值范围是1～200,000,000。</p>
</li>
<li><p>legacy：指定路径开销值的计算方法是华为计算方法。使用华为计算方法时取值范围是1～200,000。</p>
</li>
</ul>
</blockquote>
<h2 id="RSTP的基础配置命令-3"><a href="#RSTP的基础配置命令-3" class="headerlink" title="RSTP的基础配置命令(3)"></a><strong>RSTP的基础配置命令(3)</strong></h2><p><img src="/2021/05/06/RSTP/33.png"></p>
<h2 id="RSTP的保护功能配置命令-1"><a href="#RSTP的保护功能配置命令-1" class="headerlink" title="RSTP的保护功能配置命令(1)"></a><strong>RSTP的保护功能配置命令(1)</strong></h2><p><img src="/2021/05/06/RSTP/34.png"></p>
<h2 id="RSTP的保护功能配置命令-2"><a href="#RSTP的保护功能配置命令-2" class="headerlink" title="RSTP的保护功能配置命令(2)"></a><strong>RSTP的保护功能配置命令(2)</strong></h2><p><img src="/2021/05/06/RSTP/35.png"></p>
<blockquote>
<p>•配置后，在<strong>stp</strong> <strong>tc-protection interval</strong>指定的时间内，设备只会处理<strong>stp</strong> <strong>tc-protection threshold</strong>指定数量的拓扑变化报文，对于其他的报文会延迟处理，所以可能会影响生成树的收敛速度。例如，时间设定为10秒，阈值设定为5，则设备收到拓扑变化报文后，在10秒内只会处理最开始收到的5个拓扑变化报文，对于后面收到的报文则会等10秒超时后再统一处理。</p>
</blockquote>
<h2 id="案例：RSTP的基础配置"><a href="#案例：RSTP的基础配置" class="headerlink" title="案例：RSTP的基础配置"></a><strong>案例：RSTP的基础配置</strong></h2><p><img src="/2021/05/06/RSTP/36.png"></p>
<p><img src="/2021/05/06/RSTP/37.png"></p>
<p><img src="/2021/05/06/RSTP/38.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（多选题）以下哪些是RSTP的端口状态？(   )</p>
<p>A.Idle</p>
<p><strong>B.Discarding</strong></p>
<p><strong>C.Forwarding</strong></p>
<p><strong>D.Learning</strong></p>
<p>2.（单选题）RSTP的根保护必须配置在设备的根端口上。(   )</p>
<p>A.对</p>
<p><strong>B.错</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•生成树是一个用于局域网中消除环路的协议。运行该协议的设备通过彼此交互信息而发现网络中的环路，并对某些接口进行阻塞以消除环路。由于局域网规模的不断增长，生成树协议已经成为重要的局域网协议之一。</p>
<p>•RSTP是生成树协议中的其中一个版本，它在STP的基础上，做了很多的改进，大大加快了网络收敛的速度。</p>
<p>•本章节，主要介绍了RSTP对STP的七个改进点，包括：端口角色、端口状态、配置BPDU格式、配置BPDU的处理方式、快速收敛机制、拓扑变更机制和4种保护特性。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/" itemprop="url">VLAN高级技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-06T12:20:26+08:00">
                2021-05-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF.png"></p>
<h1 id="VLAN聚合"><a href="#VLAN聚合" class="headerlink" title="VLAN聚合"></a><strong>VLAN聚合</strong></h1><h2 id="VLAN聚合产生的技术背景"><a href="#VLAN聚合产生的技术背景" class="headerlink" title="VLAN聚合产生的技术背景"></a><strong>VLAN聚合产生的技术背景</strong></h2><p>•在一般的三层交换机中，通常是采用一个VLAN对应一个VLANIF接口的方式实现广播域之间的互通，这在某些情况下导致了IP地址的浪费。</p>
<p>•因为一个VLAN对应的子网中，子网号、子网广播地址、子网网关地址不能用作VLAN内的主机IP地址，且子网中实际接入的主机可能少于可用IP地址数量，空闲的IP地址也会因不能再被其他VLAN使用而被浪费掉。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/1.png"></p>
<h2 id="VLAN聚合概述"><a href="#VLAN聚合概述" class="headerlink" title="VLAN聚合概述"></a><strong>VLAN聚合概述</strong></h2><p>•<strong>VLAN聚合</strong>（VLAN Aggregation，也称Super-VLAN）: 指在一个物理网络内，用多个VLAN（称为Sub-VLAN）隔离广播域，并将这些Sub-VLAN聚合成一个逻辑的VLAN（称为Super-VLAN），这些Sub-VLAN使用同一个IP子网和缺省网关，进而达到节约IP地址资源的目的。</p>
<p>•<strong>Sub-VLAN</strong>：只包含物理接口，不能建立三层VLANIF接口，用于隔离广播域。每个Sub-VLAN内的主机与外部的三层通信是靠Super-VLAN的三层VLANIF接口来实现的。</p>
<p>•<strong>Super-VLAN</strong>：只建立三层VLANIF接口，不包含物理接口，与子网网关对应。与普通VLAN不同，Super-VLAN的VLANIF接口状态取决于所包含Sub-VLAN的物理接口状态。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/2.png"></p>
<h2 id="VLAN聚合的原理"><a href="#VLAN聚合的原理" class="headerlink" title="VLAN聚合的原理"></a><strong>VLAN聚合的原理</strong></h2><p>每个Sub-VLAN对应一个广播域，多个Sub-VLAN和一个Super-VLAN关联，只给Super-VLAN分配一个IP子网，所有Sub-VLAN都使用Super-VLAN的IP子网和缺省网关进行三层通信。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/3.png"></p>
<blockquote>
<p>•多个Sub-VLAN共享一个网关地址，节约了子网网络地址、子网定向广播地址、子网缺省网关地址，且各Sub-VLAN间的界线也不再是从前的子网界线了，可以根据每个Sub-VLAN内所需的IP地址数量进行灵活的地址规划，从而既保证了各个Sub-VLAN作为一个独立广播域实现广播隔离，又节省了IP地址资源，提高了编址的灵活性。</p>
</blockquote>
<h2 id="VLAN聚合的应用"><a href="#VLAN聚合的应用" class="headerlink" title="VLAN聚合的应用"></a><strong>VLAN聚合的应用</strong></h2><p>传统VLAN方式每一个VLAN需要划分不同的IP地址网段，在本例中需要耗费4个IP网段和产生4条路由条目；Super-VLAN方式只需要分配一个IP地址网段，下属二层VLAN共用同一个IP地址网段，共用同一个三层网关，同时VLAN之间保持二层隔离。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/4.png"></p>
<h2 id="相同Sub-VLAN内部通信"><a href="#相同Sub-VLAN内部通信" class="headerlink" title="相同Sub-VLAN内部通信"></a><strong>相同Sub-VLAN内部通信</strong></h2><p>同一个Sub-VLAN之间属于同一个广播域，因此相同Sub-VLAN之间可以通过二层直接通信。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/5.png"></p>
<h2 id="不同Sub-VLAN之间通信举例"><a href="#不同Sub-VLAN之间通信举例" class="headerlink" title="不同Sub-VLAN之间通信举例"></a><strong>不同Sub-VLAN之间通信举例</strong></h2><p>Super-VLAN VLANIF100开启ARP代理之后PC1和PC2之间通信过程如下：</p>
<p>1.PC1发现PC2与自己在同一网段，且自己ARP表无PC2对应表项，则直接发送ARP广播请求PC2的MAC地址。</p>
<p>2.作为网关的Super-VLAN对应的VLANIF 100收到PC1的ARP请求，由于网关上使能Sub-VLAN间的ARP代理功能，则向Super-VLAN 100的所有Sub-VLAN接口发送一个ARP广播，请求PC2的MAC地址。</p>
<p>3.PC2收到网关发送的ARP广播后，对此请求进行ARP应答。</p>
<p>4.网关收到PC2的应答后，就把自己的MAC地址回应给PC1，PC1之后要发给PC2的报文都先发送给网关，由网关做三层转发。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/6.png"></p>
<blockquote>
<p>•不同Sub-VLAN之间进行通信，IP地址属于相同网段，因此主机会发送ARP请求，但是实际不同Sub-VLAN之间属于不同的广播域，因而ARP报文无法传递到其他Sub-VLAN，ARP请求得不到响应，设备无法学习到对端MAC地址，从而无法完成Sub-VLAN之间通信。</p>
<p>•要实现Sub-VLAN之间的通信，需要在Super-VLAN 的VLANIF中开启ARP代理功能。</p>
</blockquote>
<h2 id="Sub-VLAN与其他设备的二层通信"><a href="#Sub-VLAN与其他设备的二层通信" class="headerlink" title="Sub-VLAN与其他设备的二层通信"></a><strong>Sub-VLAN与其他设备的二层通信</strong></h2><p>•当Sub-VLAN与其他设备进行二层通信时，与普通的VLAN内二层通信无区别。</p>
<p>•由于Super-VLAN不属于任何物理接口，即不会处理任何携带Super-VLAN标签的报文。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/7.png"></p>
<blockquote>
<p>•Sub-VLAN二层通信过程举例：</p>
<p>▫从PC1进入SW1的报文会被打上VLAN10的Tag。在SW1中这个Tag不会因为VLAN10是VLAN100的Sub-VLAN而变为VLAN100的Tag。</p>
<p>▫当报文从SW1的GE0/0/0出去时，依然携带VLAN10的Tag。也就是说，SW1本身不会发出VLAN100的报文。就算其他设备有VLAN100的报文发送到该设备上，这些报文也会因为SW1上没有VLAN100应的物理接口而被丢弃。</p>
<p>▫对于其他设备而言，有效的VLAN只有Sub-VLAN10，20和30， 所有的报文都是在这些VLAN中交互的。因此，SW1上虽然配置了VLAN聚合，但与其他设备的二层通信，不会涉及到Super-VLAN，与正常的二层通信流程一样。</p>
<p>•当Sub-VLAN内的PC需要与其他网络进行三层通信时，首先将数据发往默认网关，即Super-VLAN对应的VLANIF，再进行路由。</p>
</blockquote>
<h2 id="VLAN聚合关键配置命令"><a href="#VLAN聚合关键配置命令" class="headerlink" title="VLAN聚合关键配置命令"></a><strong>VLAN聚合关键配置命令</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/8.png"></p>
<h2 id="VLAN聚合配置举例-1"><a href="#VLAN聚合配置举例-1" class="headerlink" title="VLAN聚合配置举例 (1)"></a><strong>VLAN聚合配置举例</strong> <strong>(1)</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/9.png"></p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/10.png"></p>
<h2 id="VLAN聚合配置举例-2"><a href="#VLAN聚合配置举例-2" class="headerlink" title="VLAN聚合配置举例(2)"></a><strong>VLAN聚合配置举例(2)</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/11.png"></p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/12.png"></p>
<h1 id="MUX-VLAN"><a href="#MUX-VLAN" class="headerlink" title="MUX VLAN"></a><strong>MUX VLAN</strong></h1><h2 id="MUX-VLAN产生背景"><a href="#MUX-VLAN产生背景" class="headerlink" title="MUX VLAN产生背景"></a><strong>MUX VLAN产生背景</strong></h2><p>在企业网络中，各个部门之间网络需要相互独立，通常用VLAN技术可以实现这一要求。如果企业规模很大，且拥有大量的合作伙伴，要求各个合作伙伴能够访问公司服务器，但是不能相互访问，这时如果使用传统的VLAN技术，不但需要耗费大量的VLAN ID，还增加了网络管理者的工作量同时也增加了维护量。</p>
<p>MUX VLAN（Multiplex VLAN）提供了一种通过VLAN进行网络资源控制的机制。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/13.png"></p>
<h2 id="MUX-VLAN的基本概念"><a href="#MUX-VLAN的基本概念" class="headerlink" title="MUX VLAN的基本概念"></a><strong>MUX VLAN的基本概念</strong></h2><p>MUX VLAN分为Principal VLAN（主VLAN）和Subordinate VLAN（从VLAN），Subordinate VLAN又分为Separate VLAN（隔离型从VLAN）和Group VLAN（互通型从VLAN）。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/14.png"></p>
<blockquote>
<p>•在使用MUX VLAN的过程中，无论是Separate VLAN还是Group VLAN都必须与一个Principle VLAN绑定。</p>
<p>•加入Principal VLAN（主VLAN）中的接口，可以与MUX VLAN内的所有接口进行通信。</p>
</blockquote>
<h2 id="MUX-VLAN的应用"><a href="#MUX-VLAN的应用" class="headerlink" title="MUX VLAN的应用"></a><strong>MUX VLAN的应用</strong></h2><p>在交换机上，通过把部门A和部门B所在的VLAN分别设置为互通型从VLAN，把访客区所属的VLAN设置为隔离型从VLAN，把服务器所连接口所属VLAN设置为Principal VLAN，即主VLAN。并且所有从VLAN都与主VLAN绑定。从而实现如下网络设计要求：</p>
<p>▫部门A内的用户之间能够实现二层互通。</p>
<p>▫部门B内的用户之间能够实现二层互通。</p>
<p>▫部门A与部门B的用户之间二层隔离。</p>
<p>▫部门A和部门B的员工都能够通过二层访问服务器。</p>
<p>▫访客区内的任意PC除了能访问服务器之外，不能访问其他任意设备，包括其他访客。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/15.png"></p>
<h2 id="MUX-VLAN配置命令"><a href="#MUX-VLAN配置命令" class="headerlink" title="MUX VLAN配置命令"></a><strong>MUX VLAN配置命令</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/16.png"></p>
<blockquote>
<p>•只有使能接口MUX VLAN功能后，才能实现Principal VLAN与Subordinate VLAN之间通信、Group VLAN内的接口可以相互通信及Separate VLAN接口间不能相互通信的目的。</p>
</blockquote>
<h2 id="MUX-VLAN配置举例"><a href="#MUX-VLAN配置举例" class="headerlink" title="MUX VLAN配置举例"></a><strong>MUX VLAN配置举例</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/17.png"></p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/18.png"></p>
<h2 id="MUX-VLAN配置验证"><a href="#MUX-VLAN配置验证" class="headerlink" title="MUX VLAN配置验证"></a><strong>MUX VLAN配置验证</strong></h2><p>查看VLAN配置结果，通过ping命令检测PC5（192.168.1.5/24）与PC6（192.168.1.6/24）之间的网络连通性。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/19.png"></p>
<h1 id="QinQ"><a href="#QinQ" class="headerlink" title="QinQ"></a><strong>QinQ</strong></h1><h2 id="QinQ概述"><a href="#QinQ概述" class="headerlink" title="QinQ概述"></a><strong>QinQ概述</strong></h2><p>•随着以太网技术在网络中的大量部署，利用VLAN对用户进行隔离和标识受到很大限制。因为IEEE802.1Q中定义的VLAN Tag域只有12个比特，仅能表示4096个VLAN，无法满足城域以太网中标识大量用户的需求，于是QinQ技术应运而生。</p>
<p>•QinQ（802.1Q in 802.1Q）技术是一项扩展VLAN空间的技术，通过在802.1Q标签报文的基础上再增加一层802.1Q的Tag来达到扩展VLAN空间的功能。</p>
<p>•如下图所示用户报文在公网上传递时携带了两层Tag，内层是私网Tag，外层是公网Tag。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/20.png"></p>
<h2 id="QinQ封装结构"><a href="#QinQ封装结构" class="headerlink" title="QinQ封装结构"></a><strong>QinQ封装结构</strong></h2><p>QinQ封装报文是在无标签的以太网数据帧的源MAC地址字段后面加上两个VLAN标签构成。</p>
<p>•TPID（Tag Protocol Identifier，标签协议标识）表示帧类型。取值为0x8100时表示802.1Q Tag帧。如果不支持802.1Q的设备收到这样的帧，会将其丢弃。</p>
<p>•对于内层的802.1Q Tag，该值设置为0x8100；对于外层的802.1Q Tag，不同厂商所使用的值可能不相同：</p>
<p>​    ▫0x8100：Huawei路由器使用</p>
<p>​    ▫0x88A8：802.1ad规定外层802.1Q Tag中的TPID为0x88a8</p>
<p>•在华为设备上，外层802.1Q Tag缺省情况下值为0x8100，可以通过命令行调整该值。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/21.png"></p>
<h2 id="QinQ工作原理"><a href="#QinQ工作原理" class="headerlink" title="QinQ工作原理"></a><strong>QinQ工作原理</strong></h2><p>在公网的传输过程中，设备只根据外层VLAN Tag转发报文，并根据报文的外层VLAN Tag进行MAC地址学习，而用户的私网VLAN Tag将被当作报文的数据部分进行传输。即使私网VLAN Tag相同，也能通过公网VLAN Tag区分不同用户。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/22.png"></p>
<blockquote>
<p>•企业A和企业B的私网VLAN分别为VLAN 1～10和VLAN 1～20。公网为企业A和企业B分配的公网VLAN分别为VLAN 3和VLAN 4。当企业A和企业B中带VLAN Tag的报文进入公网时，报文外面就会被分别封装上VLAN 3和VLAN 4的VLAN标签。这样，来自不同企业网络的报文在公网中传输时被完全分开，即使这些企业网络各自的VLAN范围存在重叠，在公网中传输时也不会产生冲突。当报文穿过公网，到达公网另一侧PE设备后，报文会被剥离公网为其添加的公网VLAN标签，然后再传送给用户网络的CE设备。</p>
</blockquote>
<h2 id="QinQ实现方式-基本QinQ"><a href="#QinQ实现方式-基本QinQ" class="headerlink" title="QinQ实现方式 - 基本QinQ"></a>QinQ实现方式 - 基本QinQ</h2><p>基本QinQ的报文处理过程:</p>
<p>1.SW1收到VLAN ID为10和20的报文，将该报文发给SW2。</p>
<p>2.SW2收到该报文后，在该报文原有Tag的外侧再添加一层VLAN ID 为100的外层Tag。</p>
<p>3.带着两层Tag的用户数据报文在网络中按照正常的二层转发流程转发。</p>
<p>4.SW3收到VLAN100的报文后，剥离报文的外层Tag（VLAN ID 为100）。将报文发送给SW4，此时报文只有一层Tag（VLAN ID 为10或20）。</p>
<p>5.SW4收到该报文，根据VLAN ID和目的MAC地址进行相应的转发。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/23.png"></p>
<blockquote>
<p>•基本QinQ是基于端口方式实现的。开启端口的基本QinQ功能后，当该端口接收到报文，设备会为该报文打上本端口缺省VLAN 的VLAN Tag。如果接收到的是已经带有VLAN Tag的报文，该报文就成为双Tag的报文；如果接收到的是不带VLAN Tag的报文，该报文就成为带有端口缺省VLAN Tag的报文。</p>
<p>•基于端口的QinQ的缺点是外层VLAN Tag封装方式固定，不能根据业务种类选择外层VLAN Tag封装的方式，从而很难有效支持多业务的灵活运营。</p>
</blockquote>
<h2 id="QinQ实现方式-灵活QinQ"><a href="#QinQ实现方式-灵活QinQ" class="headerlink" title="QinQ实现方式 - 灵活QinQ"></a>QinQ实现方式 - 灵活QinQ</h2><p>灵活QinQ的报文处理过程：</p>
<p>1.SW1收到VLAN ID为10和20的报文，将该报文转发给SW2。</p>
<p>2.SW2收到VLAN ID为10的报文后，添加一层VLAN ID 为100 的外层Tag；SW2收到VLAN ID为20的报文后，添加一层VLAN ID为200的外层Tag。</p>
<p>3.带着两层Tag的用户数据报文在网络中按照正常的二层转发流程转发。</p>
<p>4.SW3收到报文后，剥离报文的外层Tag（VLAN ID 为100或200）。将报文发送给SW4，此时报文只有一层Tag（VLAN ID 为10或20）。</p>
<p>5.SW4收到报文，根据VLAN ID和目的MAC地址进行相应的转发。</p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/24.png"></p>
<blockquote>
<p>•灵活QinQ（Selective QinQ）可根据流分类的结果选择是否打外层VLAN Tag，打上何种外层VLAN Tag。灵活QinQ可根据用户的VLAN标签、优先级、MAC地址、IP协议、IP源地址、IP目的地址、或应用程序的端口号进行流分类。</p>
<p>•基于VLAN ID的灵活QinQ：为具有不同内层VLAN ID的报文添加不同的外层VLAN Tag。</p>
<p>•基于802.1p优先级的灵活QinQ：根据报文的原有内层VLAN的802.1p优先级添加不同的外层VLAN Tag。</p>
<p>•基于流策略的灵活QinQ：根据QoS策略添加不同的外层VLAN Tag。基于流策略的灵活QinQ能够针对业务类型提供差别服务。</p>
<p>•灵活QinQ功能是对基本QinQ功能的扩展，它比基本QinQ的功能更灵活。二者之间的主要区别是：</p>
<p>​    ▫基本QinQ：对进入二层QinQ接口的所有帧都加上相同的外    层Tag。</p>
<p>​    ▫灵活QinQ：对进入二层QinQ接口的帧，可以根据不同的内    层Tag而加上不同的外层Tag，对于用户VLAN的划分更加细    致</p>
</blockquote>
<h2 id="QinQ在园区网络中的应用"><a href="#QinQ在园区网络中的应用" class="headerlink" title="QinQ在园区网络中的应用"></a><strong>QinQ在园区网络中的应用</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/25.png"></p>
<blockquote>
<p>•BRAS：Broadband Remote Access Server，宽带远程接入服务器。BRAS提供宽带接入服务、实现多种业务的汇聚与转发，能满足不同用户对传输容量和带宽利用率的要求，因此RRAS是宽带用户接入的核心设备。</p>
<p>•BUM：Broadcast、Unknown unicast、Multicast，广播，未知单播、组播。交换机以泛洪的方式处理以上类型的数据帧。</p>
</blockquote>
<h2 id="QinQ配置命令介绍"><a href="#QinQ配置命令介绍" class="headerlink" title="QinQ配置命令介绍"></a><strong>QinQ配置命令介绍</strong></h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/26.png"></p>
<blockquote>
<p>•配置灵活QinQ的当前接口类型建议为Hybrid，并且必须先通过命令qinq vlan-translation enable先使能VLAN转换功能。灵活QinQ功能只在当前接口的入方向生效。</p>
<p>•接口配置VLAN Stacking功能后在发送帧时，若需要剥掉外层Tag，该接口要以Untagged方式加入叠加后的stack-vlan；若不需要剥掉外层Tag，该接口要以Tagged方式加入叠加后的stack-vlan。</p>
</blockquote>
<h2 id="QinQ配置举例-基本QinQ"><a href="#QinQ配置举例-基本QinQ" class="headerlink" title="QinQ配置举例 - 基本QinQ"></a>QinQ配置举例 - 基本QinQ</h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/27.png"></p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/28.png"></p>
<h2 id="QinQ配置举例-灵活QinQ"><a href="#QinQ配置举例-灵活QinQ" class="headerlink" title="QinQ配置举例 - 灵活QinQ"></a>QinQ配置举例 - 灵活QinQ</h2><p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/29.png"></p>
<p><img src="/2021/05/06/VLAN%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/30.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）当Sub-VLAN与外部进行二层通信时，在出接口打上的VLAN标记为？</p>
<p><strong>A.Sub-VLAN</strong></p>
<p>B.Secondary VLAN</p>
<p>C.Super-VLAN</p>
<p>D.Isolate VLAN</p>
<p>2.（单选题）下面关于QinQ描述错误的是？</p>
<p>A.QinQ报文在公网中报文根据外层VLAN Tag转发。</p>
<p><strong>B.QinQ报文在公网中报文根据内层VLAN Tag转发。</strong></p>
<p>C.QinQ为用户提供了一种更为简单的二层VPN隧道。</p>
<p>D.QinQ不需要信令协议的支持，可以通过纯静态配置实现。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•VLAN聚合通过配置Super-VLAN和Sub-VLAN，不同Sub-VLAN之间进行通信，需要Super-VLAN开启ARP代理。VLAN聚合既避免了由于子网划分带来的网络地址规划复杂的问题，又能够实现通过VLAN隔离不同广播域的目的。</p>
<p>•MUX VLAN包括Principal VLAN和Subordinate VLAN，同时Subordinate VLAN又分为Separate VLAN和Group VLAN。Separate port只能和Principal port进行通信，和其他类型的接口实现完全隔离。Group port可以和Principal port进行通信，在同一组内的接口也可互相通信，但不能和其他组接口或Separate port通信。</p>
<p>•QinQ技术不仅扩展了标识VLAN的数量，而且可以实现用户报文携带私网VLAN标签在公网内的透传。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/" itemprop="url">以太网交换安全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-05T20:01:37+08:00">
                2021-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8.png"></p>
<h1 id="端口隔离"><a href="#端口隔离" class="headerlink" title="端口隔离"></a><strong>端口隔离</strong></h1><h2 id="端口隔离技术背景"><a href="#端口隔离技术背景" class="headerlink" title="端口隔离技术背景"></a><strong>端口隔离技术背景</strong></h2><p>•以太交换网络中为了实现报文之间的二层隔离，用户通常将不同的端口加入不同的VLAN，实现二层广播域的隔离。</p>
<p>•大型网络中，业务需求种类繁多，只通过VLAN实现报文二层隔离，会浪费有限的VLAN资源。</p>
<p>•如下图所示，由于某种业务需求，PC1与PC2虽然属于同一个VLAN ，但是要求它们在二层不能互通（但允许三层互通），PC1与PC3在任何情况下都不能互通，但是VLAN 3里的主机可以访问VLAN 2里的主机。 那么该如何解决这个问题呢？</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/1.png"></p>
<h2 id="端口隔离技术概述"><a href="#端口隔离技术概述" class="headerlink" title="端口隔离技术概述"></a><strong>端口隔离技术概述</strong></h2><p>采用端口隔离功能，可以实现同一VLAN内端口之间的隔离。用户只需要将端口加入到隔离组中，就可以实现隔离组内端口之间二层数据的隔离。端口隔离功能为用户提供了更安全、更灵活的组网方案。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/2.png"></p>
<h2 id="端口隔离技术原理"><a href="#端口隔离技术原理" class="headerlink" title="端口隔离技术原理"></a><strong>端口隔离技术原理</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/3.png"></p>
<blockquote>
<p>•采用二层隔离三层互通的隔离模式时，在VLANIF接口上使能VLAN内Proxy ARP功能，配置arp-proxy inner-sub-vlan-proxy enable，可以实现同一VLAN内主机通信。</p>
</blockquote>
<h2 id="端口隔离配置命令"><a href="#端口隔离配置命令" class="headerlink" title="端口隔离配置命令"></a><strong>端口隔离配置命令</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/4.png"></p>
<h2 id="端口隔离配置举例"><a href="#端口隔离配置举例" class="headerlink" title="端口隔离配置举例"></a><strong>端口隔离配置举例</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/5.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/6.png"></p>
<blockquote>
<p>•display port-isolate group { group-id | all }，查看端口隔离组的配置。</p>
<p>•clear configuration port-isolate命令一键式清除设备上所有的端口隔离配置。</p>
<p>•port-isolate exclude vlan命令配置端口隔离功能生效时排除的VLAN。</p>
</blockquote>
<h2 id="端口隔离配置验证"><a href="#端口隔离配置验证" class="headerlink" title="端口隔离配置验证"></a><strong>端口隔离配置验证</strong></h2><p>1.通过display port-isolate group <em>group-number</em>查看端口隔离组中的端口。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/7.png"></p>
<p>2.验证同一端口隔离组下主机网络不能互通。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/8.png"></p>
<h1 id="MAC地址表安全"><a href="#MAC地址表安全" class="headerlink" title="MAC地址表安全"></a>MAC地址表安全</h1><h2 id="MAC地址表项类型"><a href="#MAC地址表项类型" class="headerlink" title="MAC地址表项类型"></a>MAC地址表项类型</h2><p><strong>MAC地址表项类型包括:</strong></p>
<ul>
<li><strong>动态MAC地址表项</strong>:由接口通过报文中的源MAC地址学习获得，表项可老化。在系统复位、接口板热插拔或接口板复位后，动态表项会丢失。</li>
<li><strong>静态MAC地址表项</strong>:由用户手工配置并下发到各接口板，表项不老化。在系统复位、接口板热插拔或接口板复位后，保存的表项不会丢失。接口和MAC地址静态绑定后，其他接口收到源MAC是该MAC地址的报文将会被丢弃。</li>
<li><strong>黑洞MAC地址表项</strong>:由用户手工配置，并下发到各接口板，表项不可老化。配置黑洞MAC地址后，源MAC地址或目的MAC地址是该MAC的报文将会被丢弃。</li>
</ul>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/12.png"></p>
<blockquote>
<p>•MAC地址表记录了交换机学习到的MAC地址与接口的对应关系，以及接口所属VLAN等信息。</p>
<p>•设备在执行二层交换操作时，根据报文的目的MAC地址查询MAC地址表，如果MAC地址表中包含与报文目的MAC地址对应的表项，并且收到该报文的接口与对应的表项的接口不相同时，则直接通过该表项中的出接口转发该报文；如果相同，则丢弃该报文。</p>
<p>•如果MAC地址表中没有包含报文目的MAC地址对应的表项时，设备将采取广播方式在所属VLAN内除接收接口外的所有接口转发该报文。</p>
</blockquote>
<h2 id="MAC地址表安全功能"><a href="#MAC地址表安全功能" class="headerlink" title="MAC地址表安全功能"></a><strong>MAC地址表安全功能</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/13.png"></p>
<p>•为了防止一些关键设备（如各种服务器或上行设备）被非法用户恶意修改其MAC地址表项，可将这些设备的MAC地址配置为静态MAC地址表项，因为静态MAC地址表项优先于动态MAC地址表项，不易被非法修改。</p>
<p>•为了防止无用MAC地址表项占用MAC地址表，同时为了防止黑客通过MAC地址攻击用户设备或网络，可将那些有着恶意历史的非信任MAC地址配置为黑洞MAC地址，使设备在收到目的MAC或源MAC地址为这些黑洞MAC地址的报文时，直接予以丢弃，不修改原有的MAC地址表项，也不增加新的MAC地址表项。</p>
<p>•为了减轻手工配置静态MAC地址表项，华为S系列交换机缺省已使能了动态MAC地址表项学习功能。但为了避免MAC地址表项爆炸式增长，可合理配置动态MAC表项的老化时间，以便及时删除MAC地址表中的废弃MAC地址表项。</p>
<p>•为了提高网络的安全性，防止设备学习到非法的MAC地址，错误地修改MAC地址表中的原MAC地址表项，可以选择关闭设备上指定接口或指定VLAN中所有接口的MAC地址学习功能，这样设备将不再从这些接口上学习新的MAC地址。</p>
<p>•配置限制MAC地址学习数，当超过限制数时不再学习MAC地址，同时可以配置当MAC地址数达到限制后对报文采取的动作，从而防止MAC地址表资源耗尽，提高网络安全性。</p>
<h2 id="MAC地址表项配置"><a href="#MAC地址表项配置" class="headerlink" title="MAC地址表项配置"></a><strong>MAC地址表项配置</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/14.png"></p>
<h2 id="禁止MAC地址学习功能"><a href="#禁止MAC地址学习功能" class="headerlink" title="禁止MAC地址学习功能"></a><strong>禁止MAC地址学习功能</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/15.png"></p>
<h2 id="限制MAC地址学习数量"><a href="#限制MAC地址学习数量" class="headerlink" title="限制MAC地址学习数量"></a><strong>限制MAC地址学习数量</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/16.png"></p>
<h2 id="MAC地址表安全配置举例"><a href="#MAC地址表安全配置举例" class="headerlink" title="MAC地址表安全配置举例"></a>MAC地址表安全配置举例</h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/17.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/18.png"></p>
<h2 id="配置验证"><a href="#配置验证" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>执行display mac-limit命令，查看MAC地址学习限制规则是否配置成功。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/19.png"></p>
<h1 id="端口安全"><a href="#端口安全" class="headerlink" title="端口安全"></a><strong>端口安全</strong></h1><h2 id="端口安全技术背景"><a href="#端口安全技术背景" class="headerlink" title="端口安全技术背景"></a><strong>端口安全技术背景</strong></h2><p>•企业要求接入层交换机上每个连接终端设备的接口均只允许一台PC接入网络（限制MAC地址接入数量）。如果有员工试图在某个接口下级联一台小交换机或集线器从而扩展上网接口，那么这种行为应该被发现或被禁止，如左图所示。</p>
<p>•另一些企业还可能会要求只有MAC地址为可信任的终端发送的数据帧才允许被交换机转发到上层网络，员工不能私自更换位置（变更交换机的接入端口），如右图所示。</p>
<p>•通过交换机的端口安全（port security）特性可以解决这些问题。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/20.png"></p>
<h2 id="端口安全概述"><a href="#端口安全概述" class="headerlink" title="端口安全概述"></a><strong>端口安全概述</strong></h2><p>•通过在交换机的特定接口上部署端口安全，可以限制接口的MAC地址学习数量，并且配置出现越限时的惩罚措施。</p>
<p>•端口安全通过将接口学习到的动态MAC地址转换为安全MAC地址（包括安全动态MAC，安全静态MAC和Sticky MAC），阻止非法用户通过本接口和交换机通信，从而增强设备的安全性。</p>
<h2 id="端口安全技术原理"><a href="#端口安全技术原理" class="headerlink" title="端口安全技术原理"></a><strong>端口安全技术原理</strong></h2><p>安全MAC地址分为以下类型：</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/21.png"></p>
<p>安全MAC地址通常与安全保护动作结合使用，常见的安全保护动作有：</p>
<ul>
<li><p>Restrict：丢弃源MAC地址不存在的报文并上报告警。</p>
</li>
<li><p>Protect：只丢弃源MAC地址不存在的报文，不上报告警。</p>
</li>
<li><p>Shutdown：接口状态被置为error-down，并上报告警。</p>
</li>
</ul>
<blockquote>
<p>•安全动态MAC地址的老化类型分为：绝对时间老化和相对时间老化。</p>
<ul>
<li><p>如设置绝对老化时间为5分钟：系统每隔1分钟计算一次每个MAC的存在时间，若大于等于5分钟，则立即将该安全动态MAC地址老化。否则，等待下1分钟再检测计算。</p>
</li>
<li><p>如设置相对老化时间为5分钟：系统每隔1分钟检测一次是否有该MAC的流量。若没有流量，则经过5分钟后将该安全动态MAC地址老化。</p>
</li>
</ul>
<p>•默认情况下，接口关闭（error-down）后不会自动恢复，只能由网络管理人员在接口视图下使用restart命令重启接口进行恢复。</p>
<p>•如果用户希望被关闭的接口可以自动恢复，则可在接口error-down前通过在系统视图下执行error-down auto-recovery cause port-security interval interval-value命令使能接口状态自动恢复为Up的功能，并设置接口自动恢复为Up的延时时间，使被关闭的接口经过延时时间后能够自动恢复。</p>
<p>•当端口安全功能或者Sticky MAC功能使能/去使能时，接口上的MAC地址变化如下：</p>
<ul>
<li><p>端口安全功能</p>
<ul>
<li><p>使能之后，接口上之前学习到的动态MAC地址表项将被删除，之后学习到的MAC地址将变为安全动态MAC地址。</p>
</li>
<li><p>去使能之后，接口上的安全动态MAC地址将被删除，重新学习动态MAC地址。</p>
</li>
</ul>
</li>
<li><p>Sticky MAC功能</p>
<ul>
<li><p>使能之后，接口上的安全动态MAC地址表项将转化为Sticky MAC地址，之后学习到的MAC地址也变为Sticky MAC地址。</p>
</li>
<li><p>去使能之后，接口上的Sticky MAC地址，会转换为安全动态MAC地址。</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="端口安全配置命令"><a href="#端口安全配置命令" class="headerlink" title="端口安全配置命令"></a><strong>端口安全配置命令</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/22.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/23.png"></p>
<blockquote>
<p>port-security protect-action命令用来配置端口安全功能中接口学习到的MAC地址数超过限制或出现静态MAC地址漂移时<br>的保护动作。</p>
<ul>
<li><p>protect</p>
<ul>
<li><p>当学习到的MAC地址数超过接口限制数时，接口将丢弃源地址在MAC表以外的报文。</p>
</li>
<li><p>当出现静态MAC地址漂移时，接口将丢弃带有该MAC地址的报文。</p>
</li>
</ul>
</li>
<li><p>restrict</p>
<ul>
<li><p>当学习到的MAC地址数超过接口限制数时，接口将丢弃源地址在MAC表以外的报文，同时发出告警。</p>
</li>
<li><p>当出现静态MAC地址漂移时，接口将丢弃带有该MAC地址的报文，同时发出告警。</p>
</li>
</ul>
</li>
<li><p>shutdown</p>
<ul>
<li><p>当学习到的MAC地址数超过接口限制数时，接口将执行error down操作，同时发出告警。</p>
</li>
<li><p>当出现静态MAC地址漂移时，接口将执行error down操作，同时发出告警。</p>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="端口安全配置举例-安全动态MAC"><a href="#端口安全配置举例-安全动态MAC" class="headerlink" title="端口安全配置举例 - 安全动态MAC"></a><strong>端口安全配置举例</strong> <strong>-</strong> <strong>安全动态MAC</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/24.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/25.png"></p>
<h2 id="配置验证-1"><a href="#配置验证-1" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>执行命令display mac-address security ，查看动态安全MAC表项。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/26.png"></p>
<blockquote>
<p>查看安全MAC地址：</p>
<ul>
<li><p>执行命令display mac-address security [ vlan vlan-id | interface-type interface-number ] * [ verbose ]，查看安全动态MAC表项。</p>
</li>
<li><p>执行命令display mac-address sec-config [ vlan vlan-id | interface-type interface-number ] * [ verbose ]，查看配置的安全静态MAC表项。</p>
</li>
<li><p>执行命令display mac-address sticky [ vlan vlan-id | interface-type interface-number ] * [ verbose ]，查看Sticky MAC表项。</p>
</li>
</ul>
</blockquote>
<h2 id="端口安全配置举例-Sticky-MAC"><a href="#端口安全配置举例-Sticky-MAC" class="headerlink" title="端口安全配置举例 - Sticky MAC"></a><strong>端口安全配置举例</strong> <strong>-</strong> <strong>Sticky MAC</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/27.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/28.png"></p>
<h2 id="配置验证-2"><a href="#配置验证-2" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>执行命令display mac-address sticky，查看Sticky MAC表项。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/29.png"></p>
<h1 id="MAC地址漂移防止与检测"><a href="#MAC地址漂移防止与检测" class="headerlink" title="MAC地址漂移防止与检测"></a><strong>MAC地址漂移防止与检测</strong></h1><h2 id="MAC地址漂移概述"><a href="#MAC地址漂移概述" class="headerlink" title="MAC地址漂移概述"></a><strong>MAC地址漂移概述</strong></h2><p>•MAC地址漂移是指交换机上一个VLAN内有两个端口学习到同一个MAC地址，后学习到的MAC地址表项覆盖原MAC地址表项的现象。</p>
<p>•当一个MAC地址在两个端口之间频繁发生迁移时，即会产生MAC地址漂移现象。</p>
<p>•正常情况下，网络中不会在短时间内出现大量MAC地址漂移的情况。出现这种现象一般都意味着网络中存在环路，或者存在网络攻击行为。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/30.png"></p>
<h2 id="防止MAC地址漂移"><a href="#防止MAC地址漂移" class="headerlink" title="防止MAC地址漂移"></a><strong>防止</strong>MAC地址漂移</h2><p>如果是环路引发MAC地址漂移，治本的方法是部署防环技术，例如STP，消除二层环路。如果由于网络攻击等其他原因引起，则可使用如下MAC地址防漂移特性：</p>
<p><strong>配置接口MAC地址学习优先级</strong></p>
<p>当MAC地址在交换机的两个接口之间发生漂移时，可以将其中一个接口的MAC地址学习优先级提高。高优先级的接口学习到的MAC地址表项将覆盖低优先级接口学习到的MAC地址表项。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/31.png"></p>
<p><strong>配置不允许相同优先级接口MAC地址漂移</strong></p>
<p>当伪造网络设备所连接口的MAC地址优先级与安全的网络设备相同时，后学习到的伪造网络设备MAC地址表项不会覆盖之前正确的表项。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/32.png"></p>
<blockquote>
<p>•缺省时接口MAC地址学习的优先级均为0，数值越大优先级越高。当同一个MAC地址被两个个接口学习到后，接口MAC地址学习优先级高的会被保留，MAC地址学习优先级低的被覆盖。</p>
<p>•在配置不允许相同优先级接口MAC地址漂移时，如果安全网络设备下电，则交换机仍会学习到伪造网络设备的MAC地址，当网络设备再次上电时将无法学习到正确的MAC地址。因此该特性需谨慎使用，如果交换机的接口连接的网络设备是服务器，当服务器下电后，另外的接口学习到与服务器相同的MAC地址，当服务器再次上电后就不能学习到正确的MAC地址。</p>
</blockquote>
<h2 id="MAC地址漂移检测"><a href="#MAC地址漂移检测" class="headerlink" title="MAC地址漂移检测"></a><strong>MAC地址漂移检测</strong></h2><p>交换机支持MAC地址漂移检测机制，分为以下两种方式：</p>
<p>基于VLAN的MAC地址漂移检测</p>
<ul>
<li><p>配置VLAN的MAC地址漂移检测功能可以检测指定VLAN下的所有的MAC地址是否发生漂移。</p>
</li>
<li><p>当MAC地址发生漂移后，可以配置指定的动作，例如告警、阻断接口或阻断MAC地址。</p>
</li>
</ul>
<p>全局MAC地址漂移检测</p>
<ul>
<li><p>该功能可以检测设备上的所有的MAC地址是否发生了漂移。</p>
</li>
<li><p>若发生漂移，设备会上报告警到网管系统。</p>
</li>
<li><p>用户也可以指定发生漂移后的处理动作，例如将接口关闭或退出VLAN。</p>
</li>
</ul>
<blockquote>
<p>华为交换机是否全部支持MAC地址漂移检测机制以具体型号产品为准。</p>
</blockquote>
<h3 id="基于VLAN的MAC地址漂移检测"><a href="#基于VLAN的MAC地址漂移检测" class="headerlink" title="基于VLAN的MAC地址漂移检测"></a><strong>基于VLAN的MAC地址漂移检测</strong></h3><p>在配置基于VLAN的MAC地址漂移检测功能后，如果MAC地址发生漂移时，则可根据需求配置接口做出的动作有以下三种：</p>
<p>1.发送告警，当检测到MAC地址发生漂移时只给网管发送告警。</p>
<p>2.接口阻断，当检测到MAC地址发生漂移时，根据设置的阻塞时间对接口进行阻塞，并关闭接口收发报文的能力。</p>
<p>3.MAC地址阻断，当检测到MAC地址发生漂移时，只阻塞当前MAC地址，而不对物理接口进行阻塞，当前接口下的其他MAC的通信不受影响。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/33.png"></p>
<blockquote>
<ul>
<li><p>MAC地址发生漂移后的三种动作在上图中分别表示为：1.产生并上报告警；2.阻断SW1上的GE0/0/2接口的收发报文的能力；3.阻断SW1上的GE0/0/2接口上针对指定MAC地址报文的收发能力。</p>
</li>
<li><p>当配置接口阻塞时：</p>
<ul>
<li>检测到VLAN2内产生MAC地址漂移时，将产生漂移后的接口直接阻塞。</li>
<li>接口将被阻塞10秒（该时长使用block-time关键字指定），接口被阻塞时是无法正常收发数据的。</li>
<li>10秒之后接口会被放开并重新进行检测，此时该接口可以正常收发数据，如果20秒内没有再检测到MAC地址漂移，则接口的阻塞将被彻底解除；而如果20秒内再次检测到MAC地址漂移，则再次将该接口阻塞，如此重复2次（该次数使用retry-times关键字指定），如果交换机依然能检测到该接口发生MAC地址漂移，则永久阻塞该接口。</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="全局MAC地址漂移检测"><a href="#全局MAC地址漂移检测" class="headerlink" title="全局MAC地址漂移检测"></a><strong>全局MAC地址漂移检测</strong></h3><p>当交换机检测到MAC地址漂移，在缺省情况下，它只是简单地上报告警，并不会采取其他动作。在实际网络部署中，可以根据网络需求，对检测到MAC地址漂移之后定义以下动作：</p>
<ul>
<li><p>error-down</p>
<p>当配置了MAC地址漂移检测的端口检测到有MAC地址漂移时，将对应接口状态置为error-down，不再转发数据。</p>
</li>
<li><p>quit-vlan</p>
<p>当配置了MAC地址漂移检测的端口检测到有MAC地址漂移时，将退出当前接口所属的VLAN。</p>
</li>
</ul>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/34.png"></p>
<blockquote>
<ul>
<li><p>华为交换机默认开启全局MAC地址漂移检测功能，因此缺省时交换机便会对设备上的所有VLAN进行MAC地址漂移检测。</p>
</li>
<li><p>在某些场景下，需要对某些VLAN不进行MAC地址漂移检测，可以通过配置MAC地址漂移检测的VLAN白名单来实现。</p>
</li>
<li><p>如果接口由于发生了MAC地址漂移从而被设置为Error-Down，默认情况下是不会自动恢复的。</p>
</li>
<li><p>如果希望Error-Down的接口能够自动恢复，在系统视图下配置如下命令：<br> error-down auto-recovery cause mac-address-flapping interval <em>time-value</em></p>
</li>
<li><p>如果接口由于发生了MAC地址漂移，被设置为离开VLAN，如要实现接口自动恢复，可以在系统视图下配置如下命令：</p>
<p>mac-address flapping quit-vlan recover-time time-       value</p>
</li>
</ul>
</blockquote>
<h2 id="MAC地址漂移配置命令介绍"><a href="#MAC地址漂移配置命令介绍" class="headerlink" title="MAC地址漂移配置命令介绍"></a><strong>MAC</strong>地址漂移配置命令介绍</h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/35.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/36.png"></p>
<blockquote>
<p>一些安全性较差的网络容易受到黑客的MAC地址攻击，由于MAC地址表的容量是有限的，当黑客伪造大量源MAC地址不同的报文并发送给交换机后，交换机的MAC表项资源就可能被耗尽。当MAC表被填满后，即使它再收到正常的报文，也无法学习到报文中的源MAC地址。</p>
<p>配置限制MAC地址学习数，当超过限制数时不再学习MAC地址，同时可以配置当MAC地址数达到限制后对报文采取的动作，从而防止MAC地址表资源耗尽，提高网络安全性。</p>
</blockquote>
<h2 id="MAC地址漂移配置举例"><a href="#MAC地址漂移配置举例" class="headerlink" title="MAC地址漂移配置举例"></a><strong>MAC地址漂移配置举例</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/37.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/38.png"></p>
<blockquote>
<ul>
<li><p>当Switch3与Switch4之间误连接之后，Switch2的接口GE0/0/1的MAC地址漂移到接口GE0/0/2后，触发接口error-down，接口GE0/0/2关闭。</p>
</li>
<li><p>使用display mac-address flapping record可查看到漂移记录。</p>
</li>
</ul>
</blockquote>
<h2 id="配置验证-3"><a href="#配置验证-3" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>配置完成后，当Switch2的接口GE0/0/1的MAC地址漂移到接口GE0/0/2后，接口GE0/0/2关闭；使用display mac-address flapping record可查看到漂移记录。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/39.png"></p>
<h1 id="MACsec"><a href="#MACsec" class="headerlink" title="MACsec"></a><strong>MACsec</strong></h1><h2 id="MACsec，提供二层数据安全传输"><a href="#MACsec，提供二层数据安全传输" class="headerlink" title="MACsec，提供二层数据安全传输"></a>MACsec，提供二层数据安全传输</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>绝大部分数据在局域网链路中都是以明文形式传输的，在某些安全性要求较高的场景下存在安全隐患。</p>
<h3 id="MACsec概述"><a href="#MACsec概述" class="headerlink" title="MACsec概述"></a>MACsec概述</h3><p>MACsec定义了基于以太网的数据安全通信的方法，通过逐跳设备之间数据加密，保证数据传输安全性，对应的标准为802.1AE。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/41.png"></p>
<h3 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h3><ul>
<li><p>在交换机之间部署MACsec保护数据安全，例如在接入交换机与上联的汇聚或核心交换机之间部署 。</p>
</li>
<li><p>当交换机之间存在传输设备时可部署MACsec保护数据安全。</p>
</li>
</ul>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/42.png"></p>
<h2 id="MACsec工作机制"><a href="#MACsec工作机制" class="headerlink" title="MACsec工作机制"></a><strong>MACsec工作机制</strong></h2><p>在设备运行点到点MACsec时，网络管理员在两台设备上通过命令行预配置相同的CAK，两台设备会通过MKA协议选举出一个Key Server，Key Server决定加密方案，Key Server会根据CAK等参数使用某种加密算法生成SAK数据密钥，由Key Server将SAK分发给对端设备，这样两台设备拥有相同的SAK数据密钥，可以进行后续MACsec数据报文加解密收发。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/40.png"></p>
<h1 id="交换机流量控制"><a href="#交换机流量控制" class="headerlink" title="交换机流量控制"></a>交换机流量控制</h1><h2 id="流量抑制概述"><a href="#流量抑制概述" class="headerlink" title="流量抑制概述"></a><strong>流量抑制概述</strong></h2><p>•<strong>网络中存在的问题：</strong></p>
<p>​    ▫正常情况下，当设备某个二层以太接口收到广播、未知组播或未知单播报文时，会向同一VLAN内的其他二层以太接口转发这些报文，从而导致流量泛洪，降低设备转发性能。</p>
<p>​    ▫当设备某个以太接口收到已知组播或已知单播报文时，如果某种报文流量过大则可能会对设备造成冲击，影响其他业务的正常处理。</p>
<p>•<strong>可用的解决方案：</strong></p>
<p>​    ▫流量抑制可以通过配置阈值来限制广播、未知组播、未知单播、已知组播和已知单播报文的速率，防止广播、未知组播报文和未知单播报文产生流量泛洪，阻止已知组播报文和已知单播报文的大流量冲击。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/43.png"></p>
<h2 id="流量抑制工作原理-1"><a href="#流量抑制工作原理-1" class="headerlink" title="流量抑制工作原理 (1)"></a><strong>流量抑制工作原理</strong> <strong>(1)</strong></h2><p>在接口入方向上，设备支持对广播、未知组播、未知单播、已知组播和已知单播报文按百分比、包速率和比特速率进行流量抑制。设备监控接口下的各类报文速率并和配置的阈值相比较，当入口流量超过配置的阈值时，设备会丢弃超额的流量。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/44.png"></p>
<blockquote>
<p>•在接口出方向上，设备支持对广播、未知组播和未知单播报文的阻塞（Block）。</p>
</blockquote>
<h2 id="流量抑制工作原理-2"><a href="#流量抑制工作原理-2" class="headerlink" title="流量抑制工作原理 (2)"></a><strong>流量抑制工作原理</strong> <strong>(2)</strong></h2><p>在VLAN视图下，设备支持对广播报文按比特速率进行流量抑制。设备监控同一VLAN内广播报文的速率并和配置的阈值相比较，当VLAN内流量超过配置的阈值时，设备会丢弃超额的流量。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/45.png"></p>
<blockquote>
<p>•流量抑制还可以通过配置阈值的方式对ICMP报文进行限速，防止大量ICMP报文上送CPU处理，导致其他业务功能异常。</p>
</blockquote>
<h2 id="流量抑制的应用"><a href="#流量抑制的应用" class="headerlink" title="流量抑制的应用"></a><strong>流量抑制的应用</strong></h2><p>流量抑制通过对不同类型的报文采取不同的限制措施，达到限制报文发送速率的目的。具体实施可分为以下三种情况：</p>
<p>1.在交换机接口的入方向，例如下图中SW1的GE0/0/1入方向，通过流量抑制功能可以限制任意报文的发送速率。</p>
<p>2.在交换机接口出方向，例如下图中SW1的GE0/0/1出方向，通过流量抑制功能可以阻塞广播，未知组播和未知单播报文。</p>
<p>3.在交换机的VLAN视图下，通过配置VLAN 内流量抑制限制VLAN内广播报文。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/46.png"></p>
<blockquote>
<p>•流量抑制中，可以为接口入方向的报文流量配置阈值，当流量超过阈值时，系统将丢弃多余的流量，阈值范围内的报文可以正常通过，从而将流量限制在合理的范围内。</p>
<p>•此外，流量抑制还支持对接口出方向的流量进行阻塞。</p>
<p>•风暴控制中，只可以为接口入方向的报文流量配置阈值。当流量超过阈值时，系统会阻塞该接口收到的该类型报文流量或者直接将该接口关闭。</p>
</blockquote>
<h2 id="流量抑制配置命令介绍"><a href="#流量抑制配置命令介绍" class="headerlink" title="流量抑制配置命令介绍"></a><strong>流量抑制配置命令介绍</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/47.png"></p>
<blockquote>
<p>•display flow-suppression interface interface-type interface-number查看流量抑制配置信息。</p>
<p>•当在接口视图下的入方向和VLAN视图下同时配置流量抑制功能时，接口视图的配置优先于VLAN视图下的配置。</p>
</blockquote>
<h2 id="流量抑制配置举例"><a href="#流量抑制配置举例" class="headerlink" title="流量抑制配置举例"></a><strong>流量抑制配置举例</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/48.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/49.png"></p>
<h2 id="配置验证-4"><a href="#配置验证-4" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>使用命令display flow-suppression interface 查看流量抑制配置信息。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/50.png"></p>
<h2 id="风暴控制概述"><a href="#风暴控制概述" class="headerlink" title="风暴控制概述"></a><strong>风暴控制概述</strong></h2><p>•<strong>网络中存在的问题：</strong></p>
<p>​    ▫正常情况下，当设备某个二层以太接口收到广播、未知组播或未知单播报文时，会向同一VLAN内的其他二层以太接口转发这些报文，如果网络存在环路，则会导致广播风暴，严重降低设备转发性能。</p>
<p>•<strong>可用的解决方案：</strong></p>
<p>​    ▫风暴控制可以通过阻塞报文或关闭端口来阻断广播、未知组播和未知单播报文的流量。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/51.png"></p>
<h2 id="风暴控制工作原理"><a href="#风暴控制工作原理" class="headerlink" title="风暴控制工作原理"></a><strong>风暴控制工作原理</strong></h2><p>风暴控制可以用来防止广播、未知组播以及未知单播报文产生广播风暴。在风暴控制检测时间间隔内，设备监控接口下接收的三类报文的包平均速率与配置的最大阈值相比较。当报文速率大于配置的最大阈值时，风暴控制将根据配置的动作来对接口进行阻塞报文或关闭接口的处理。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/52.png"></p>
<blockquote>
<p>•流量抑制与风暴控制的主要区别是：风暴控制功能可以对端口下发惩罚动作（block和shutdown)，而流量抑制功能只是对端口流量进行限制。</p>
</blockquote>
<h2 id="风暴控制的应用"><a href="#风暴控制的应用" class="headerlink" title="风暴控制的应用"></a><strong>风暴控制的应用</strong></h2><p>•风暴控制与流量抑制相比的优势是可以同时监控接口下的广播报文、未知组播报文和未知单播报文各自的包平均速率，并根据阈值对接口采取阻塞相关报文或者关闭物理接口的惩罚动作。</p>
<p>•本例中，Switch作为二层网络到路由器的衔接点，当需要限制二层网络转发过来的用户广播、未知组播和未知单播报文时，可以通过在Switch的GE0/0/1上配置风暴控制功能来实现。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/53.png"></p>
<blockquote>
<p>•流量抑制中，可以为接口入方向的报文流量配置阈值。当流量超过阈值时，系统将丢弃多余的流量，阈值范围内的报文可以正常通过，从而将流量限制在合理的范围内。此外，流量抑制还支持对接口出方向的流量进行阻塞。</p>
<p>•风暴控制中，只可以为接口入方向的报文流量配置阈值。当流量超过阈值时，系统会阻塞该接口收到的该类型报文流量或者直接将该接口关闭。</p>
</blockquote>
<h2 id="风暴控制配置命令介绍"><a href="#风暴控制配置命令介绍" class="headerlink" title="风暴控制配置命令介绍"></a><strong>风暴控制配置命令介绍</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/54.png"></p>
<blockquote>
<p>•display storm-control [ interface interface-type interface-number ]，查看接口的风暴控制信息。</p>
<p>•<strong>min-rate</strong> <em>min-rate-value</em></p>
<p>​    ▫指定包模式低阈值。如果指定了<em>min-rate-value</em>参数（单位pps），在风暴控制检测时间间隔内，当接口接收报文的平均速率小于该值时，则将该接口的报文恢复到正常转发状态。</p>
<p>•<strong>min-rate</strong> <strong>cir</strong> <em>min-rate-value-cir</em></p>
<p>​    ▫指定字节模式低阈值。如果指定了<em>min-rate-value-cir</em>参数（单位kbps），在风暴控制检测时间间隔内，当接口接收报文的平均速率小于该值时，则将该接口的报文恢复到正常转发状态。</p>
<p>•<strong>min-rate</strong> <strong>percent</strong> <em>min-rate-value-percent</em></p>
<p>​    ▫指定百分比模式低阈值。如果指定了<em>min-rate-value-percent</em>参数（百分比），在风暴控制检测时间间隔内，当接口接收报文的平均速率小于该值时，则将该接口的报文恢复到正常转发状态。</p>
<p>•<strong>max-rate</strong> <em>max-rate-value</em></p>
<p>​    ▫指定包模式高阈值。如果指定了<em>max-rate-value</em>参数（单位pps），在风暴控制检测时间间隔内，当接口接收报文的平均速率大于该值时，则对该接口进行风暴控制。</p>
<p>•<strong>max-rate</strong> <strong>cir</strong> <em>max-rate-value-cir</em></p>
<p>​    ▫指定字节模式高阈值。如果指定了<em>max-rate-value-cir</em>参数（单位kbps），在风暴控制检测时间间隔内，当接口接收报文的平均速率大于该值时，则对该接口进行风暴控制。</p>
<p>•<strong>max-rate</strong> <strong>percent</strong> <em>max-rate-value-percent</em></p>
<p>​    ▫指定百分比模式高阈值。如果指定了<em>max-rate-value-percent</em>参数，在风暴控制检测时间间隔内，当接口接收报文的平均速率大于该值时，则对该接口进行风暴控制。</p>
</blockquote>
<h2 id="风暴控制配置举例"><a href="#风暴控制配置举例" class="headerlink" title="风暴控制配置举例"></a><strong>风暴控制配置举例</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/55.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/56.png"></p>
<h2 id="配置验证-5"><a href="#配置验证-5" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>执行命令display storm-control interface查看GE0/0/1接口下的风暴控制配置情况。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/57.png"></p>
<h1 id="DHCP-Snooping"><a href="#DHCP-Snooping" class="headerlink" title="DHCP Snooping"></a><strong>DHCP Snooping</strong></h1><h2 id="DHCP工作原理概述"><a href="#DHCP工作原理概述" class="headerlink" title="DHCP工作原理概述"></a><strong>DHCP工作原理概述</strong></h2><p>•DHCP无中继工作原理：</p>
<p>1.发现阶段，DHCP客户端发送DHCP DISCOVER报文（广播）来发现DHCP服务器。DHCP DISCOVER报文中携带了客户端的MAC地址（DHCP DISCOVER报文中的chaddr字段）、需要请求的参数列表选项（Option55）、广播标志位（DHCP DISCOVER报文中的flags字段，表示客户端请求服务器以单播或广播形式发送响应报文）等信息。</p>
<p>2.提供阶段，服务器接收到DHCP DISCOVER报文后，选择跟接收DHCP DISCOVER报文接口的IP地址处于同一网段的地址池，并且从中选择一个可用的IP地址，然后通过DHCP OFFER报文发送给DHCP客户端。</p>
<p>3.请求阶段，如果有多个DHCP服务器向DHCP客户端回应DHCP OFFER报文，则DHCP客户端一般只接收第一个收到的DHCP OFFER报文，然后以广播方式发送DHCP REQUEST报文，该报文中包含客户端想选择的DHCP服务器标识符（即Option54）和客户端IP地址（即Option50，填充了接收的DHCP OFFER报文中yiaddr字段的IP地址）。以广播方式发送DHCP REQUEST报文，是为了通知所有的DHCP服务器，它将选择某个DHCP服务器提供的IP地址，其他DHCP服务器可以重新将曾经分配给客户端的IP地址分配给其他客户端。</p>
<p>4.确认阶段，DHCP客户端收到DHCP ACK报文，会广播发送免费ARP报文，探测本网段是否有其他终端使用服务器分配的IP地址。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/58.png"></p>
<p>•DHCP有中继工作原理：</p>
<p>​    ▫DHCP中继接收到DHCP客户端广播发送的DHCP DISCOVER报文后，主要动作含：检查DHCP报文中的giaddr字段。DHCP报文中的giaddr字段标识客户端网关的IP地址。如果服务器和客户端不在同一个网段且中间存在多个DHCP中继，当客户端发出DHCP请求时，第一个DHCP中继会把自己的IP地址填入此字段，后面的DHCP中继不修改此字段内容。DHCP服务器会根据此字段来判断出客户端所在的网段地址，从而为客户端分配该网段的IP地址。</p>
<p>​    ▫将DHCP报文的目的IP地址改为DHCP服务器或下一跳中继的IP地址，源地址改为中继连接客户端的接口地址，通过路由转发将DHCP报文单播发送到DHCP服务器或下一跳中继。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/59.png"></p>
<h2 id="DHCP-Snooping概述"><a href="#DHCP-Snooping概述" class="headerlink" title="DHCP Snooping概述"></a><strong>DHCP Snooping概述</strong></h2><p>•为了保证网络通信业务的安全性，引入了DHCP Snooping技术，在DHCP Client和DHCP Server之间建立一道防火墙，以抵御网络中针对DHCP的各种攻击。</p>
<p>•DHCP Snooping是DHCP的一种安全特性，用于保证DHCP客户端从合法的DHCP服务器获取IP地址。DHCP 服务器记录DHCP客户端IP地址与MAC地址等参数的对应关系，防止网络上针对DHCP攻击。</p>
<p>•目前DHCP协议在应用的过程中遇到很多安全方面的问题，网络中存在一些针对DHCP的攻击，如DHCP Server仿冒者攻击、DHCP Server的拒绝服务攻击、仿冒DHCP报文攻击等。</p>
<p>•DHCP Snooping主要是通过DHCP Snooping信任功能和DHCP Snooping绑定表实现DHCP网络安全。</p>
<h2 id="DHCP-Snooping信任功能"><a href="#DHCP-Snooping信任功能" class="headerlink" title="DHCP Snooping信任功能"></a><strong>DHCP Snooping信任功能</strong></h2><p>•DHCP Snooping的信任功能，能够保证DHCP客户端从合法的DHCP服务器获取IP地址。</p>
<p>•DHCP Snooping信任功能将接口分为信任接口和非信任接口：</p>
<p>​    ▫信任接口正常接收DHCP服务器响应的DHCP ACK、DHCP NAK和DHCP Offer报文。</p>
<p>​    ▫设备只将DHCP客户端的DHCP请求报文通过信任接口发送给合法的DHCP服务器，不会向非信任接口转发。</p>
<p>​    ▫非信任接口收到的DHCP Server发送的DHCP OFFER、DHCP ACK、DHCP NAK报文会被直接丢弃。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/60.png"></p>
<blockquote>
<p>•配置dhcp snooping enable命令的接口，收到DHCP请求报文后，转发给所有的信任接口；收到DHCP响应报文后丢弃。</p>
<p>•配置dhcp snooping trusted命令的接口，收到DHCP请求报文后，转发给所有的信任接口，如果没有其他信任接口，则丢弃该DHCP请求报文；收到DHCP响应报文后，只转发给连接对应客户端的并且配置命令dhcp snooping enable的接口，如果查不到上述接口，则丢弃该DHCP响应报文。</p>
</blockquote>
<h2 id="DHCP-Snooping绑定表"><a href="#DHCP-Snooping绑定表" class="headerlink" title="DHCP Snooping绑定表"></a><strong>DHCP Snooping绑定表</strong></h2><p>•二层接入设备使能了DHCP Snooping功能后，从收到DHCP ACK报文中提取关键信息（包括PC的MAC地址以及获取到的IP地址、地址租期），并获取与PC连接的使能了DHCP Snooping功能的接口信息（包括接口编号及该接口所属的VLAN），根据这些信息生成DHCP Snooping绑定表。</p>
<p>•由于DHCP Snooping绑定表记录了DHCP客户端IP地址与MAC地址等参数的对应关系，故通过对报文与DHCP Snooping绑定表进行匹配检查，能够有效防范非法用户的攻击。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/61.png"></p>
<blockquote>
<p>•DHCP Snooping绑定表根据DHCP租期进行老化或根据用户释放IP地址时发出的DHCP Release报文自动删除对应表项。</p>
</blockquote>
<h2 id="DHCP饿死攻击"><a href="#DHCP饿死攻击" class="headerlink" title="DHCP饿死攻击"></a><strong>DHCP饿死攻击</strong></h2><p>•攻击原理：攻击者持续大量地向DHCP Server申请IP地址，直到耗尽DHCP Server地址池中的IP地址，导致DHCP Server不能给正常的用户进行分配。</p>
<p>•漏洞分析：DHCP Server向申请者分配IP地址时，无法区分正常的申请者与恶意的申请者。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/62.png"></p>
<h2 id="DHCP-Snooping防饿死攻击"><a href="#DHCP-Snooping防饿死攻击" class="headerlink" title="DHCP Snooping防饿死攻击"></a><strong>DHCP Snooping防饿死攻击</strong></h2><p>解决方法：对于饿死攻击，可以通过DHCP Snooping的MAC地址限制功能来防止。该功能通过限制交换机接口上允许学习到的最多MAC地址数目，防止通过变换MAC地址，大量发送DHCP请求。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/63.png"></p>
<h2 id="改变CHADDR值的DoS攻击"><a href="#改变CHADDR值的DoS攻击" class="headerlink" title="改变CHADDR值的DoS攻击"></a>改变CHADDR值的DoS攻击</h2><p>•攻击原理：攻击者持续大量地向DHCP Server申请IP地址，直到耗尽DHCP Server地址池中的IP地址，导致DHCP Server不能给正常的用户进行分配。</p>
<p>•漏洞分析：DHCP Server向申请者分配IP地址时，无法区分正常的申请者与恶意的申请者。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/64.png"></p>
<h2 id="DHCP-Snooping防改变CHADDR值的DoS攻击"><a href="#DHCP-Snooping防改变CHADDR值的DoS攻击" class="headerlink" title="DHCP Snooping防改变CHADDR值的DoS攻击"></a><strong>DHCP Snooping防改变CHADDR值的DoS攻击</strong></h2><p>解决方法：为了避免受到攻击者改变CHADDR值的攻击，可以在设备上配置DHCP Snooping功能，检查DHCP Request报文中CHADDR字段。如果该字段跟数据帧头部的源MAC相匹配，转发报文；否则，丢弃报文。从而保证合法用户可以正常使用网络服务。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/65.png"></p>
<blockquote>
<p>•DHCP饿死攻击是攻击者通过持续大量地向DHCP Server申请IP地址来实现的，其目的是耗尽DHCP Server地址池中的IP地址，导致DHCP Server没有IP地址分配给正常的用户。DHCP消息中有一个名叫CHADDR（Client Hardware Address）的字段，该字段是由DHCP客户端填写的，表示的是客户端的硬件地址（也就是客户端的MAC地址）。DHCP Server是针对CHADDR来分配IP地址的，对于不同的CHADDR，DHCP Server会分配不同的IP地址；DHCP Server无法区分什么样的CHADDR是合法的，什么样的CHADDR是非法的。利用这个漏洞，攻击者每申请一个IP地址时，就在DHCP消息的CHADDR字段中填写一个不同的值，以此来冒充是不同的用户在申请IP地址。</p>
<p>•为了弥补上述漏洞，从而阻止饿死攻击，DHCP Snooping技术支持在端口下对DHCP Request报文的源MAC地址与CHADDR进行一致性检查：如果二者相同，则转发报文；如果二者不相同，则丢弃。如果要在某端口下实施源MAC地址与CHADDR的一致性检查，可以在该端口下使用命令dhcp snooping check dhcp-chaddr enable。</p>
<p>•还可能存在这样一种饿死攻击，就是攻击者不断同时变换MAC地址和CHADDR，并且每一次变换时，都让CHADDR与MAC地址相同，如此一来，便可以躲过上述源MAC地址与CHADDR的一致性检查！</p>
</blockquote>
<h2 id="DHCP中间人攻击"><a href="#DHCP中间人攻击" class="headerlink" title="DHCP中间人攻击"></a><strong>DHCP中间人攻击</strong></h2><p>•攻击原理：攻击者利用ARP机制，让Client学习到DHCP Server IP与Attacker MAC的映射关系，又让Server学习到Client IP与Attacker Mac的映射关系。如此一来，Client与Server之间交互的IP报文都会经过攻击者中转。</p>
<p>•漏洞分析：从本质上讲，中间人攻击是一种Spoofing IP/MAC攻击，中间人利用了虚假的IP地址与MAC地址之间的映射关系来同时欺骗DHCP的客户端和服务器。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/66.png"></p>
<blockquote>
<p>•如图所示，攻击者利用ARP机制，让PC1学习到IP-S与MAC2的映射关系，又让Server学习到IP1与MAC2的映射关系。当PC1向DHCP Server发送IP报文时，目的IP地址为IP-S，源IP地址为IP1，而封装这个IP报文的帧的目的MAC地址为MAC2，源MAC地址为MAC1，所以这个帧会首先到达攻击者PC2。攻击者收到这个帧后，将这个帧的目的MAC地址更换为MAC-S，源MAC地址更换为MAC2，然后将这个帧发往Server。如此“偷梁换柱”，Server是看不出任何破绽的。另一方面，当DHCP Server向PC1发送IP报文时，目的IP地址为IP1，源IP地址为IP-S，而封装这个IP报文的帧的目的MAC地址为MAC2，源MAC地址为MAC-S，所以这个帧也会首先到达攻击者PC2。攻击者收到这个帧后，将这个帧的目的MAC地址更换为MAC1，源MAC地址更换为MAC2，然后将这个帧发往PC1。同样，PC1也是看不出任何破绽的。</p>
<p>•由于往来于PC1与DHCP Server之间的IP报文都会经过攻击者（中间人）进行中转，攻击者便很容易窃取这些IP报文中的某些信息，并利用这些信息来进行其他的破坏行为。攻击者也可以很容易对往来于PC1与DHCP Server之间的DHCP消息（这些消息是封装在UDP报文中的，而UDP报文又是封装在IP报文中的）进行篡改，达到直接攻击DHCP的目的。</p>
</blockquote>
<h2 id="DHCP-Snooping防DHCP中间人攻击"><a href="#DHCP-Snooping防DHCP中间人攻击" class="headerlink" title="DHCP Snooping防DHCP中间人攻击"></a><strong>DHCP Snooping防DHCP中间人攻击</strong></h2><p>解决方法：为防御中间人攻击与IP/MAC Spoofing攻击，可使用DHCP Snooping的绑定表工作模式，当接口接收到ARP或者IP报文，使用ARP或者IP报文中的“源IP+源MAC”匹配DHCP Snooping绑定表。如果匹配就进行转发，如果不匹配就丢弃。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/67.png"></p>
<blockquote>
<p>•DHCP中间人攻击本质上是一种Spoofing IP/MAC攻击。要想防止DHCP中间人攻击，其实就是要防止Spoofing IP/MAC攻击。</p>
<p>•运行了DHCP Snooping的交换机会“侦听（Snooping）”往来于用户与DHCP Server之间的DHCP消息，并从中收集用户的MAC地址（这里的MAC地址是指DHCP消息中CHADDR字段的值）、用户的IP地址（这里的IP地址是指DHCP Server分配给相应CHADDR的IP地址）等信息，这些信息会集中存放在一个数据库中，该数据库也被称为DHCP Snooping绑定表。运行了DHCP Snooping的交换机会建立并动态维护DHCP Snooping绑定表，绑定表中除了包含了用户的MAC地址、用户的IP地址外，还包括IP地址租用期、VLAN ID等等信息。</p>
<p>•如图所示，假设DHCP Server给PC1分配了IP地址IP1，给PC2分配了IP地址IP2，那么IP1与MAC1就形成了绑定关系，IP2与MAC2也形成了绑定关系，这种绑定关系都存放于DHCP Snooping绑定表中。攻击者为了让Server学习到IP1与MAC2的映射关系，会发送ARP请求报文（将ARP报文中的源IP地址填为IP1，源MAC地址填为MAC2）。交换机接收到ARP请求报文后，会检查该ARP请求报文中的源IP地址和源MAC地址，发现该IP/MAC（IP1/MAC2）映射关系不能匹配DHCP Snooping绑定表中的条目，于是会丢弃该ARP请求报文，这样就有效地防止了Spoofing IP/MAC攻击。</p>
<p>•如果需要使用上面所描述的防止Spoofing IP/MAC攻击（进而防止中间人）的方法，就必须在交换机的系统视图下执行配置命令arp dhcp-snooping-detect enable。</p>
</blockquote>
<h2 id="DHCP-Snooping配置命令介绍"><a href="#DHCP-Snooping配置命令介绍" class="headerlink" title="DHCP Snooping配置命令介绍"></a><strong>DHCP Snooping配置命令介绍</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/68.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/69.png"></p>
<h2 id="DHCP-Snooping配置举例"><a href="#DHCP-Snooping配置举例" class="headerlink" title="DHCP Snooping配置举例"></a>DHCP Snooping配置举例</h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/70.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/71.png"></p>
<h2 id="配置验证-6"><a href="#配置验证-6" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>执行命令display dhcp snooping interface，查看接口下的DHCP Snooping运行信息。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/72.png"></p>
<h1 id="IP-Source-Guard"><a href="#IP-Source-Guard" class="headerlink" title="IP Source Guard"></a>IP Source Guard</h1><h2 id="IPSG技术概述"><a href="#IPSG技术概述" class="headerlink" title="IPSG技术概述"></a><strong>IPSG技术概述</strong></h2><p>•IP地址欺骗攻击中，攻击者通过伪造合法用户的IP地址获取网络访问权限，非法访问网络，甚至造成合法用户无法访问网络，或者信息泄露。IPSG针对IP地址欺骗攻击提供了一种防御机制，可以有效阻止此类网络攻击行为。</p>
<p>•IP源防攻击（IPSG，IP Source Guard）是一种基于二层接口的源IP地址过滤技术。它能够防止恶意主机伪造合法主机的IP地址来仿冒合法主机，还能确保非授权主机不能通过自己指定IP地址的方式来访问网络或攻击网络。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/73.png"></p>
<blockquote>
<p>•非法主机伪造合法主机的IP地址获取上网权限时，通过在Switch的接入用户侧的接口或VLAN上部署IPSG功能，Switch可以对进入接口的IP报文进行检查，丢弃非法主机的报文，从而阻止此类攻击。</p>
<p>•IPSG一般应用在与用户直连的接入设备上，可以基于接口或者基于VLAN应用。</p>
</blockquote>
<h2 id="IPSG工作原理"><a href="#IPSG工作原理" class="headerlink" title="IPSG工作原理"></a><strong>IPSG</strong>工作原理</h2><p>IPSG利用绑定表（源IP地址、源MAC地址、所属VLAN、入接口的绑定关系）去匹配检查二层接口上收到的IP报文，只有匹配绑定表的报文才允许通过，其他报文将被丢弃。常见的绑定表有静态绑定表和DHCP Snooping动态绑定表。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/74.png"></p>
<blockquote>
<p>•绑定表生成后，IPSG基于绑定表向指定的接口或者指定的VLAN下发ACL，由该ACL来匹配检查所有IP报文。主机发送的报文，只有匹配绑定表才会允许通过，不匹配绑定表的报文都将被丢弃。当绑定表信息变化时，设备会重新下发ACL。</p>
<p>•缺省情况下，如果在没有绑定表的情况下使能了IPSG，设备将拒绝除DHCP请求报文外的所有IP报文。</p>
<p>•静态绑定表项包含：MAC地址、IP地址、VLAN ID、入接口。静态绑定表项中指定的信息均用于IPSG过滤接口收到的报文。</p>
<p>•动态绑定表项包含：MAC地址、IP地址、VLAN ID、入接口。IPSG依据该表项中的哪些信息过滤接口收到的报文，由用户设置的检查项决定，缺省是四项都进行匹配检查。常用的检查项有基于源IP地址过滤,基于源MAC地址过滤,基于源IP地址+源MAC地址过滤,基于源IP地址+源MAC地址+接口过滤,基于源IP地址+源MAC地址+接口+VLAN过滤等。</p>
</blockquote>
<h2 id="IPSG应用场景"><a href="#IPSG应用场景" class="headerlink" title="IPSG应用场景"></a><strong>IPSG应用场景</strong></h2><p>•通过IPSG防止PC私自更改IP地址。</p>
<p>​    ▫PC只能使用DHCP Server分配的IP地址或者管理员配置的静态地址，随意更改IP地址后无法访问网络，防止PC非法取得上网权限。</p>
<p>•小型网络IP地址是静态分配时，通过IPSG限制非法PC接入。</p>
<p>​    ▫外来人员自带电脑不能随意接入内网，防止内网资源泄露。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/75.png"></p>
<h2 id="IPSG配置命令介绍"><a href="#IPSG配置命令介绍" class="headerlink" title="IPSG配置命令介绍"></a><strong>IPSG配置命令介绍</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/76.png"></p>
<h2 id="IPSG配置举例"><a href="#IPSG配置举例" class="headerlink" title="IPSG配置举例"></a><strong>IPSG配置举例</strong></h2><p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/77.png"></p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/78.png"></p>
<h2 id="配置验证-7"><a href="#配置验证-7" class="headerlink" title="配置验证"></a><strong>配置验证</strong></h2><p>•在Switch上执行display dhcp static user-bind all命令，可以查看静态绑定表信息。</p>
<p>•PC1和PC2使用管理员分配的固定IP地址可以正常访问网络，更改IP地址后无法访问网络。</p>
<p><img src="/2021/05/05/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%AE%89%E5%85%A8/79.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（多选题）DHCP Snooping是一种DHCP安全特性，可以用于防御多种攻击，其中包括 (   ) </p>
<p><strong>A.防御改变CHADDR值的饿死攻击</strong></p>
<p><strong>B.防御DHCP仿冒者攻击</strong></p>
<p>C.防御TCP flag攻击</p>
<p><strong>D.防御中间人攻击和IP/MAC Spoofing攻击</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•端口隔离实现同一VLAN内端口之间的隔离。端口隔离模式分别为二层隔离三层互通、二层三层都隔离。</p>
<p>•交换机MAC地址表可以分为静态MAC地址表、黑洞MAC地址表、动态MAC地址表。</p>
<p>•端口安全通过将接口学习到的动态MAC地址转换为安全MAC地址，安全MAC地址通常与安全保护动作结合使用。</p>
<p>•交换机开启MAC地址漂移检测有助于工程师快速处理交换机环路故障。</p>
<p>•MACsec定义了基于以太网的数据安全通信的方法，通过逐跳设备之间数据加密，保证数据传输安全性。</p>
<p>•流量抑制与风暴控制主要区别在于流量控制仅仅是对各种报文进行限速处理，超过阈值之后就丢弃，而风暴控制能够根据报文速率的大小采取不同的惩罚动作，包括关闭端口或者阻塞报文。</p>
<p>•DHCP Snooping技术对于防御以太网中关于终端设备自动获取IP的网络攻击有很大的作用，通过配置DHCP Snooping信任端口功能和DHCP Snooping绑定表，可以很好的防范针对DHCP的网络攻击。</p>
<p>•IPSG通过查看交换机绑定表，阻止IP地址欺骗攻击，杜绝非法用户盗用合法IP地址对网络发起攻击。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/" itemprop="url">认识网络设备</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-05T20:01:18+08:00">
                2021-05-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="网络设备框架介绍"><a href="#网络设备框架介绍" class="headerlink" title="网络设备框架介绍"></a>网络设备框架介绍</h1><h2 id="网络设备"><a href="#网络设备" class="headerlink" title="网络设备"></a>网络设备</h2><ul>
<li><p>网络基础设施由交换机、路由器、防火墙等构成，这些设备日复一日地接收、发送数据，从一个接口收到的数据如何经过设备内部转发到另外一个接口？</p>
</li>
<li><p>设备有哪些组件构成？这些组件如何协同工作？。</p>
</li>
</ul>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/1.png"></p>
<h2 id="框式设备硬件模块"><a href="#框式设备硬件模块" class="headerlink" title="框式设备硬件模块"></a>框式设备硬件模块</h2><p>为方便理解网络设备内部的各个功能模块，以S12700E-8为例讲解典型网络设备的构架：</p>
<p>▫主控板(MPU，Main Processing Unit)：负责整个系统的控制平面。</p>
<p>▫交换网板(SFU，Switch Fabric Unit)：负责整个系统的数据平面。数据平面提供高速无阻塞数据通道，实现各个业务模块之间的业务交换功能。</p>
<p>▫接口板(LPU，Line Processing Unit)：线路处理单元是物理设备上用于提供数据转发功能的模块，提供不同速率的光口、电口。</p>
<p>▫交换网板、接口板上都有自己的管理芯片，与主控板共同组成整个设备的控制管理平面。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/2.png"></p>
<h3 id="主控板"><a href="#主控板" class="headerlink" title="主控板"></a><strong>主控板</strong></h3><p>主控板提供了整个系统的控制平面和管理平面。</p>
<p>▫ 控制平面完成系统的协议处理、业务处理、路由运算、转发控制、业务调度、流量统计、系统安全等功能。</p>
<p>▫ 管理平面完成系统的运行状态监控、环境监控、日志和告警信息处理、系统加载、系统升级等功能。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/3.png"></p>
<h3 id="交换网板"><a href="#交换网板" class="headerlink" title="交换网板"></a><strong>交换网板</strong></h3><p>交换网板提供整个系统的数据平面。接口板、主控板之间通过交换网板完成通信。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/4.png"></p>
<h3 id="接口板"><a href="#接口板" class="headerlink" title="接口板"></a><strong>接口板</strong></h3><p>接口板提供了不同类型（光口、电口），不同速率的接入接口，通过分布式数据平面对数据进行转发。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/5.png"></p>
<h2 id="盒式设备"><a href="#盒式设备" class="headerlink" title="盒式设备"></a><strong>盒式设备</strong></h2><p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/6.png"></p>
<p>不同于框式设备，盒式设备的各个业务模块并不是独立的硬件模块，而是集成在一个框内。</p>
<h2 id="模块连接逻辑图"><a href="#模块连接逻辑图" class="headerlink" title="模块连接逻辑图"></a>模块连接逻辑图</h2><p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/7.png"></p>
<p>•框式设备各个模块分为不同的单板，单板之间通过框式设备内部的连接进行通信。</p>
<p>•盒式设备内部集成了这些模块，各个模块之间同样也是通过内部连接进行通信。</p>
<p>•接口板和接口板之间通过交换网板连接了起来，接口板之间的通信统一经由交换网板进行转发。</p>
<h2 id="网络设备逻辑构架"><a href="#网络设备逻辑构架" class="headerlink" title="网络设备逻辑构架"></a><strong>网络设备逻辑构架</strong></h2><p>网络设备从逻辑上可以分为以下三个平面：数据平面、控制管理平面和监控平面。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/8.png"> </p>
<p>以交换机为例，设备可以分为以下的三个平面（参考RFC7426中对网络设备平面划分）：</p>
<ul>
<li><p>交换机转发平面：转发平面提供高速无阻塞数据通道，实现各个业务模块之间的业务交换功能。交换机的基本任务是处理和转发交换机各不同端口上各种类型的数据。L2/L3/ACL/QoS/组播/安全防护等各种具体的数据处理转发过程，都属于交换机转发平面的任务范畴。</p>
</li>
<li><p>交换机控制平面：控制平面完成系统的协议处理、业务处理、路由运算、转发控制、业务调度、流量统计、系统安全等功能。交换机的控制平面用于控制和管理所有网络协议的运行。控制平面提供了数据平面数据处理转发前所必须的各种网络信息和转发查询表项。</p>
</li>
<li><p>交换机管理平面：管理平面完成系统的运行状态监控、环境监控、日志和告警信息处理、系统加载、系统升级等功能。交换机的管理平面是提供给网络管理人员使用TELNET、WEB、SSH、SNMP、RMON等方式来管理设备，并支持、理解和执行管理人员对于网络设备各种网络协议的设置命令。管理平面必须预先设置好控制平面中各种协议的相关参数，并支持在必要时刻对控制平面的运行进行干预。</p>
</li>
</ul>
<p>在华为产品具体的实现上，部分系列产品将功能组合区分为数据平面、管理平面和监控平面。</p>
<h3 id="控制平面"><a href="#控制平面" class="headerlink" title="控制平面"></a><strong>控制平面</strong></h3><p>•设备的控制平面由主控板以及接口板的管理单元组成。</p>
<p>•控制管理平面完成系统的控制管理功能，是整个系统的中枢神经系统。控制平面完成系统的协议处理、业务处理、路由运算、转发控制、业务调度、流量统计、系统安全等功能。交换机的控制平面用于控制和管理所有网络协议的运行。控制平面提供了数据平面数据处理转发前所必须的各种网络信息和转发查询表项。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/9.png"></p>
<h3 id="转发平面"><a href="#转发平面" class="headerlink" title="转发平面"></a><strong>转发平面</strong></h3><p>•设备的转发平面由交换网板以及接口板组成。</p>
<p>•LPU上存在FPE（转发引擎），其本质也是一个交换芯片，完成本接口板端口之间的交换。</p>
<p>•数据平面完成数据报文的高速处理和内部无阻塞交换。包括报文的封装与解封装、IPv4/IPv6/MPLS转发处理、QoS与调度处理、内部高速交换以及各种统计。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/10.png"></p>
<h3 id="监控平面"><a href="#监控平面" class="headerlink" title="监控平面"></a><strong>监控平面</strong></h3><p>•监控平面由主控板、接口板的监控单元构成，部分框式设备还会存在单独的集中监控板(CMU)。</p>
<p>•监控平面独立完成系统的环境监控，包括电压检测、系统上下电控制、温度监测与风扇控制等，以保证系统的安全稳定运行，在出现单元故障的情况下及时隔离故障，保障系统其它部分的正常运行。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/11.png"></p>
<h1 id="网络设备对报文的处理流程"><a href="#网络设备对报文的处理流程" class="headerlink" title="网络设备对报文的处理流程"></a><strong>网络设备对报文的处理流程</strong></h1><h2 id="报文转发上行、下行"><a href="#报文转发上行、下行" class="headerlink" title="报文转发上行、下行"></a><strong>报文转发上行、下行</strong></h2><p>以交换网板为中心，可将报文在设备的行程一分为二，前半程称为“上行”，下半程称为“下行”。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/12.png"></p>
<blockquote>
<p>•设备处理报文分类：一种是业务报文、一种是协议报文。</p>
<p>•对于业务报文设备只会进行转发，从一个接口进入之后依据转发表项从另外一个接口发送出去。</p>
<p>•协议报文（如ARP、OSPF、BGP等协议的报文）设备在收到之后会交由控制层面进行处理，如ARP报文交由控制层面处理、判断之后决定是否回应，是否学习ARP报文中的源MAC、源IP。</p>
</blockquote>
<h2 id="业务报文转发处理流程"><a href="#业务报文转发处理流程" class="headerlink" title="业务报文转发处理流程"></a><strong>业务报文转发处理流程</strong></h2><p>业务报文从接口进入上行接口板处理之后，通过框式交换机内部总线交由交换网板，交换网板交由下行接口板处理之后从接口发出去。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/13.png"></p>
<blockquote>
<p>•PFE（Packet Forwarding Engine）：包转发引擎。</p>
<p>•业务报文：服务、应用在交互过程中涉及的报文。</p>
<p>•切片：把报文送往交换网板之前，进行切片处理，也就是把报文按一定粒度进行切片，切成固定长度。</p>
<p>•重组：将交换网板发送过来的已经切片的报文进行重新组合。</p>
</blockquote>
<h3 id="确定报文出口-1"><a href="#确定报文出口-1" class="headerlink" title="确定报文出口 (1)"></a><strong>确定报文出口</strong> <strong>(1)</strong></h3><p>•当报文从接口板进入时，设备需要依据转发表项（IP路由表、MAC地址表等）确定报文的出接口（对于框式设备需要确定下行接口板）。</p>
<p>•报文到达交换网板时已经明确了出接口、下行接口板，因此表项查询需要在上行接口板的处理过程中完成。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/14.png"></p>
<h3 id="确定报文出口-2"><a href="#确定报文出口-2" class="headerlink" title="确定报文出口 (2)"></a><strong>确定报文出口</strong> <strong>(2)</strong></h3><p>•转发表项存放在主控板上，报文进入接口板之后，接口板从主控板处查询表项。</p>
<p>•每次转发都需要与主控板进行通信，转发效率低，报文时延增加，对高速率接口板而言转发速率严重下跌。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/15.png"></p>
<h3 id="确定报文出口-3"><a href="#确定报文出口-3" class="headerlink" title="确定报文出口 (3)"></a><strong>确定报文出口</strong> <strong>(3)</strong></h3><p>•转发表项存放在接口板上，报文进入接口板之后直接在接口板完成报文查询，报文转发效率高。</p>
<p>•所有接口板上都要存储转发表项，控制平面资源占用率高。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/16.png"></p>
<blockquote>
<p>二层转发查询MAC地址表，三层转发查询三层路由表。</p>
</blockquote>
<h3 id="转发信息"><a href="#转发信息" class="headerlink" title="转发信息"></a><strong>转发信息</strong></h3><p>•高端设备业务报文不经过主控板CPU处理，由接口板提供转发信息查询。</p>
<p>•接口板上存在的转发信息并非存在于主控板上的转发表项（IP路由表、MAC地址表…）。主控板生成转发表项之后，生成对应的转发信息下发在接口板。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/17.png"></p>
<h3 id="硬件转发"><a href="#硬件转发" class="headerlink" title="硬件转发"></a><strong>硬件转发</strong></h3><p>•接口板执行转发的部件为包转发引擎PFE（Packet Forwarding Engine），通常为NP或者ASIC芯片，报文直接由接口板独立完成转发，无需主控板参与。</p>
<p>•高端框式设备把转发层面和控制层面分配在不同的组件，控制层面组件（主控板）负责运行转发相关协议、维护转发表项，转发平面组件（接口板）依据控制层面下发的转发信息能够独立完成转发工作，互不影响，控制层面组件高负载时并不会影响转发平面的正常工作，这种工作机制被称为转控分离。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/18.png"></p>
<h2 id="协议报文转发处理流程"><a href="#协议报文转发处理流程" class="headerlink" title="协议报文转发处理流程"></a><strong>协议报文转发处理流程</strong></h2><p>设备收到的协议报文，如路由协议：OSPF、IS-IS、BGP报文，ARP报文，STP报文，对设备的ICMP请求报文等，需要交由设备的控制平面处理，即上送主控板由主控板的CPU进行处理。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/19.png"></p>
<blockquote>
<p>•主控板CPU收到协议报文之后进行相应的处理之后如果需要回应报文，则主控板会构造协议报文进行回应，如收到发往自身的ARP Request、ICMP Echo Request报文，主控板处理之后构造ARP Reply、ICMP Echo Reply进行回应。</p>
<p>•主控板CPU处理能力有限，如果过多的协议报文上送主控板CPU处理，会造成其繁忙，无法及时对协议报文进行响应，为此设备默认限制了各种类型的协议报文上送主控板CPU的速率。</p>
</blockquote>
<h3 id="设备自身发送协议报文处理流程"><a href="#设备自身发送协议报文处理流程" class="headerlink" title="设备自身发送协议报文处理流程"></a><strong>设备自身发送协议报文处理流程</strong></h3><p>设备自身发送的协议报文，如路由协议报文: OSPF、IS-IS、BGP报文，ARP报文，STP报文，ICMP报文等，由主控板CPU构造之后交由接口板对外发送。</p>
<p><img src="/2021/05/05/%E8%AE%A4%E8%AF%86%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/20.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）框式设备中负责运行路由协议，生成、维护路由表的模块是？</p>
<p>A.接口板</p>
<p>B.交换网板</p>
<p><strong>C.主控板</strong></p>
<p>D.SPU</p>
<p>2.（简答题）高端框式设备转发业务报文时是否会向主控板查询转发表项？</p>
<p><strong>不需要，高端框式设备将转发信息下发到接口板，接口板直接转发报文，无需向主控板查询转发表项。</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li><p>每台网络设备存在独立的控制平面、转发平面、监控平面，控制平面负责系统的协议处理、路由运算、业务调度等，而转发平面负责转发数据，实现各个业务模块之间的报文交互。监控平面负责系统的环境监控，以保证系统的安全稳定运行。</p>
</li>
<li><p>高端框式设备各个平面以不同的板卡形式存在，接口板、交换网板实现转发平面的功能，主控板实现控制平面的功能，监控板实现监控平面的功能。</p>
</li>
<li><p>高端框式设备采用“硬转发”，报文的转发由接口板直接完成，无需控制平面参与，报文转发效率极高。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/03/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/03/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/" itemprop="url">路由策略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-03T20:32:10+08:00">
                2021-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaoa000/article/details/55097156/">https://blog.csdn.net/kaoa000/article/details/55097156/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/WLAN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/WLAN/" itemprop="url">WLAN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T16:55:54+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="WLAN概述"><a href="#WLAN概述" class="headerlink" title="WLAN概述"></a>WLAN概述</h2><h3 id="什么是WLAN"><a href="#什么是WLAN" class="headerlink" title="什么是WLAN"></a>什么是WLAN</h3><p>WLAN即Wireless LAN(无线局域网），是指通过无线技术构建的无线局域网络。WLAN广义上是指以无线电波、激光、红外线等无线信号来代替有线局域网中的部分或全部传输介质所构成的网络。</p>
<p><img src="/2021/05/02/WLAN/1.png"></p>
<h3 id="IEEE-802-11、WLAN与Wi-Fi"><a href="#IEEE-802-11、WLAN与Wi-Fi" class="headerlink" title="IEEE 802.11、WLAN与Wi-Fi"></a>IEEE 802.11、WLAN与Wi-Fi</h3><p>IEEE 802.11标准与Wi-Fi的世代</p>
<p><img src="/2021/05/02/WLAN/2.png"></p>
<h3 id="Wi-Fi在办公场景的发展趋势"><a href="#Wi-Fi在办公场景的发展趋势" class="headerlink" title="Wi-Fi在办公场景的发展趋势"></a>Wi-Fi在办公场景的发展趋势</h3><p><img src="/2021/05/02/WLAN/3.png"></p>
<h2 id="WLAN的基本概念"><a href="#WLAN的基本概念" class="headerlink" title="WLAN的基本概念"></a>WLAN的基本概念</h2><h3 id="WLAN设备介绍"><a href="#WLAN设备介绍" class="headerlink" title="WLAN设备介绍"></a>WLAN设备介绍</h3><p><img src="/2021/05/02/WLAN/4.png"></p>
<h3 id="基本的WLAN组网架构"><a href="#基本的WLAN组网架构" class="headerlink" title="基本的WLAN组网架构"></a>基本的WLAN组网架构</h3><p><img src="/2021/05/02/WLAN/5.png"></p>
<h3 id="敏捷分布式AP架构"><a href="#敏捷分布式AP架构" class="headerlink" title="敏捷分布式AP架构"></a>敏捷分布式AP架构</h3><p>架构特点</p>
<ul>
<li>AP的一种特殊架构，将AP拆分为中心AP和敏分AP两部分，中心AP可管理多台敏分AP，在适用的场景下，成本低，覆盖好。敏捷分布式AP可以用于FAT AP、AC+FIT AP、云管理架构。</li>
<li>适用范围:房间分布密集的场景。</li>
</ul>
<p><img src="/2021/05/02/WLAN/6.png"></p>
<h3 id="有线侧组网概念-CAPWAP协议"><a href="#有线侧组网概念-CAPWAP协议" class="headerlink" title="有线侧组网概念:CAPWAP协议"></a>有线侧组网概念:CAPWAP协议</h3><h4 id="什么是CAPWAP隧道"><a href="#什么是CAPWAP隧道" class="headerlink" title="什么是CAPWAP隧道"></a>什么是CAPWAP隧道</h4><p>CAPWAP ( Control And Provisioning of WirelessAccess Points Protocol，无线接入点控制和配置协议）∶该协议定义了如何对AP进行管理、业务配置，即AC通过CAPWAP隧道来实现对AP的集中管理和控制。</p>
<h4 id="CAPWAP隧道的功能"><a href="#CAPWAP隧道的功能" class="headerlink" title="CAPWAP隧道的功能"></a>CAPWAP隧道的功能</h4><ul>
<li>AP与AC间的状态维护。</li>
<li>AC通过CAPWAP隧道对AP进行管理、业务配置下发。</li>
<li>当采用隧道转发模式时，AP将STA发出的数据通过CAPWAP隧道实现与AC之间的交互。</li>
</ul>
<p><img src="/2021/05/02/WLAN/7.png"></p>
<h3 id="有线侧组网概念-AP-AC组网方式"><a href="#有线侧组网概念-AP-AC组网方式" class="headerlink" title="有线侧组网概念:AP-AC组网方式"></a>有线侧组网概念:AP-AC组网方式</h3><p>AP和AC间的组网分为:二层组网和三层组网。</p>
<h4 id="二层组网"><a href="#二层组网" class="headerlink" title="二层组网"></a>二层组网</h4><ul>
<li>二层组网:AP与AC之间的网络为直连或者二层网络。</li>
<li>由于二层组网比较简单，适用于简单临时的组网，能够进行比较快速的组网配置,但不适用于大型组网架构。</li>
</ul>
<p><img src="/2021/05/02/WLAN/8.png"></p>
<h4 id="三层组网"><a href="#三层组网" class="headerlink" title="三层组网"></a>三层组网</h4><ul>
<li><p>AP与AC之间的网络为三层网络。</p>
</li>
<li><p>在实际组网中，一台AC可以连接几十甚至几百台AP，组网一般比较复杂，在大型组网中一般采用三层组网。</p>
</li>
</ul>
<p><img src="/2021/05/02/WLAN/9.png"></p>
<h3 id="有线侧组网概念-AC连接方式"><a href="#有线侧组网概念-AC连接方式" class="headerlink" title="有线侧组网概念:AC连接方式"></a>有线侧组网概念:AC连接方式</h3><p>AC的连接方式分为:直连式组网和旁挂式组网。</p>
<h4 id="直连式组网"><a href="#直连式组网" class="headerlink" title="直连式组网"></a>直连式组网</h4><ul>
<li>直连式组网可以认为AP、AC与上层网络串联在一起，所有数据必须通过AC到达上层网络。</li>
<li>直连式组网中AC同时扮演AC和汇聚交换机的功能,AP的数据业务和管理业务都由AC集中转发和处理。</li>
</ul>
<p><img src="/2021/05/02/WLAN/10.png"></p>
<h4 id="旁挂式组网"><a href="#旁挂式组网" class="headerlink" title="旁挂式组网"></a>旁挂式组网</h4><ul>
<li><p>旁挂式组网，AC旁挂在AP与上行网络的直连网络中，不再直接连接AP。</p>
</li>
<li><p>旁挂式组网，AC旁挂在AP与上行网络的直连网络上,AP的业务数据可以不经AC而直接到达上行网络。</p>
<p><img src="/2021/05/02/WLAN/11.png"></p>
</li>
</ul>
<h3 id="无线侧组网概念-无线通信系统"><a href="#无线侧组网概念-无线通信系统" class="headerlink" title="无线侧组网概念:无线通信系统"></a>无线侧组网概念:无线通信系统</h3><p>无线通信系统中，信息可以是图像、文字、声音等。信息需要先经过信源编码转换为方便于电路计算和处理的数字信号，再经过信道编码和调制，转换为无线电波发射出去。</p>
<p><img src="/2021/05/02/WLAN/12.png"></p>
<h3 id="无线侧组网概念-无线电磁波"><a href="#无线侧组网概念-无线电磁波" class="headerlink" title="无线侧组网概念:无线电磁波"></a>无线侧组网概念:无线电磁波</h3><p>无线电磁波是频率介于3赫兹和约300G赫兹之间的电磁波，也叫作射频电波，或简称射频、射电。无线电技术将声音讯号或其他信号经过转换，利用无线电磁波传播。</p>
<p><img src="/2021/05/02/WLAN/13.png"></p>
<h3 id="无线侧组网概念-无线信道"><a href="#无线侧组网概念-无线信道" class="headerlink" title="无线侧组网概念:无线信道"></a>无线侧组网概念:无线信道</h3><p>信道是传输信息的通道，无线信道就是空间中的无线电磁波。</p>
<h4 id="2-4GHz频段"><a href="#2-4GHz频段" class="headerlink" title="2.4GHz频段"></a>2.4GHz频段</h4><p><img src="/2021/05/02/WLAN/14.png"></p>
<p>2.4GHz频段被划分为14个有重叠的、频率宽度是20MHz的信道。其中包含重叠信道和非重叠信道。</p>
<ul>
<li>重叠信道:在一个空间内同时存在重叠信道，则会产生干扰问题。</li>
<li>非重叠信道:在一个空间内可以同时存在非重叠信道，不会产生干扰问题。</li>
</ul>
<h4 id="5GHz频段"><a href="#5GHz频段" class="headerlink" title="5GHz频段"></a>5GHz频段</h4><p><img src="/2021/05/02/WLAN/15.png"></p>
<p>对于5G频段，支持更宽频谱，频率资源更为丰富，AP不仅支持20MHz带宽的信道，还支持40MHz、80MHz及更大带宽的信道。</p>
<h3 id="无线侧组网概念-BSS-SSID-BSS"><a href="#无线侧组网概念-BSS-SSID-BSS" class="headerlink" title="无线侧组网概念:BSS/SSID/BSS"></a>无线侧组网概念:BSS/SSID/BSS</h3><h4 id="基本服务集BSS-Basic-Service-Set"><a href="#基本服务集BSS-Basic-Service-Set" class="headerlink" title="基本服务集BSS (Basic Service Set)"></a>基本服务集BSS (Basic Service Set)</h4><ul>
<li>一个AP所覆盖的范围。</li>
<li>在一个BSS的服务区域内，STA可以相互通信。</li>
</ul>
<h4 id="基本服务集标识符BSSID-Basic-Service-Setldentifier"><a href="#基本服务集标识符BSSID-Basic-Service-Setldentifier" class="headerlink" title="基本服务集标识符BSSID (Basic Service Setldentifier)"></a>基本服务集标识符BSSID (Basic Service Setldentifier)</h4><ul>
<li>是无线网络的一个身份标识，用AP的MAC地址表示。</li>
</ul>
<h4 id="服务集标识符SSID-Service-Set-ldentifier"><a href="#服务集标识符SSID-Service-Set-ldentifier" class="headerlink" title="服务集标识符SSID (Service Set ldentifier)"></a>服务集标识符SSID (Service Set ldentifier)</h4><ul>
<li>是无线网络的一个身份标识，用字符串表示。</li>
<li>为了便于用户辨识不同的无线网络，用SSID代替BSSID。</li>
</ul>
<p><img src="/2021/05/02/WLAN/16.png"></p>
<h3 id="无线侧组网概念-VAP"><a href="#无线侧组网概念-VAP" class="headerlink" title="无线侧组网概念:VAP"></a>无线侧组网概念:VAP</h3><p>早期的AP只支持1个BSS，如果要在同一空间内部署多个BSS，则需要安放多个AP，这不但增加了成本，还占用了信道资源。为了改善这种状况，现在的AP通常支持创建出多个虚拟AP (Virtual Access Point, VAP)。</p>
<p>虚拟接入点VAP:</p>
<ul>
<li>VAP就是在一个物理实体AP上虚拟出的多个AP。每一个被虚拟出的AP就是一个VAP。每个VAP提供和物理实体AP一样的功能。</li>
<li>每个VAP对应1个BSS。这样1个AP，就可以提供多个BSS,<br>可以再为这些BSS，设置不同的SSID。</li>
</ul>
<p><img src="/2021/05/02/WLAN/17.png"></p>
<h3 id="无线侧组网概念-ESS"><a href="#无线侧组网概念-ESS" class="headerlink" title="无线侧组网概念: ESS"></a>无线侧组网概念: ESS</h3><p>为了满足实际业务的需求，需要对BSS的覆盖范围进行扩展。同时用户从一个BSS移动到另一个BSS时，不能感知到SSID的变化，则可以通过扩展服务集ESS实现。</p>
<p>扩展服务集ESS (Extend Service Set):</p>
<ul>
<li>由多个使用相同SSID的BSS组成，是采用相同的SSID的多个BSS组成的更大规模的虚拟BSS。</li>
</ul>
<p><img src="/2021/05/02/WLAN/18.png"></p>
<h2 id="WLAN的工作原理"><a href="#WLAN的工作原理" class="headerlink" title="WLAN的工作原理"></a>WLAN的工作原理</h2><h3 id="WLAN工作流程概述"><a href="#WLAN工作流程概述" class="headerlink" title="WLAN工作流程概述"></a>WLAN工作流程概述</h3><p><img src="/2021/05/02/WLAN/19.png"></p>
<h3 id="步骤1-AP上线"><a href="#步骤1-AP上线" class="headerlink" title="步骤1-AP上线"></a>步骤1-AP上线</h3><p><img src="/2021/05/02/WLAN/20.png"></p>
<p>其中包含五步</p>
<h4 id="1-AP获取IP地址"><a href="#1-AP获取IP地址" class="headerlink" title="1.AP获取IP地址"></a>1.AP获取IP地址</h4><p>AP必须获得IP地址才能够与AC通信，WLAN网络才能够正常工作。</p>
<p>AP获取IP地址的方式包括以下:</p>
<ul>
<li>静态方式:登录到AP设备上手工配置IP地址。</li>
<li>DHCP方式:通过配置DHCP服务器，使AP作为DHCP客户端向DHCP服务器请求lIP地址。</li>
</ul>
<p>典型方案:</p>
<ul>
<li>部署专门的DHCP Server为AP分配IP地址。</li>
<li>使用AC的DHCP服务为AP分配IP地址。</li>
<li>使用网络中的设备，例如核心交换机为AP分配IP地址。</li>
</ul>
<h5 id="AP获取IP地址-DHCP方式"><a href="#AP获取IP地址-DHCP方式" class="headerlink" title="AP获取IP地址:DHCP方式"></a>AP获取IP地址:DHCP方式</h5><p><img src="/2021/05/02/WLAN/21.png"></p>
<h4 id="2-CAPWAP隧道建立"><a href="#2-CAPWAP隧道建立" class="headerlink" title="2.CAPWAP隧道建立"></a>2.CAPWAP隧道建立</h4><p>AC通过CAPWAP隧道来实现对AP的集中管理和控制。</p>
<p>Step 1: Discovery阶段（AP发现AC阶段)</p>
<ul>
<li>AP通过发送Discovery Request报文，找到可用的AC。</li>
<li>AP发现AC有两种方式:静态方式、动态方式</li>
</ul>
<p>Step 2:建立CAPWAP隧道阶段</p>
<ul>
<li>AP与AC关联，完成CAPWAP隧道建立。包括数据隧道和控制隧道:数据隧道、控制隧道</li>
</ul>
<p><img src="/2021/05/02/WLAN/22.png"></p>
<h5 id="Step1-AP动态发现AC"><a href="#Step1-AP动态发现AC" class="headerlink" title="Step1 : AP动态发现AC"></a>Step1 : AP动态发现AC</h5><p><img src="/2021/05/02/WLAN/23.png"></p>
<h5 id="Step2-建立CAPWAP隧道"><a href="#Step2-建立CAPWAP隧道" class="headerlink" title="Step2:建立CAPWAP隧道"></a>Step2:建立CAPWAP隧道</h5><p>AP与AC关联，完成CAPWAP隧道建立。包括数据隧道和控制隧道:</p>
<ul>
<li>数据隧道:AP接收的业务数据报文经过CAPWAP数据隧道集中到AC上转发。同时还可以选择对数据隧道进行数据传输层安全DTLS ( Datagram Transport Layer Security )加密，使能DTLS加密功能后，CAPWAP数据报文都会经过DTLS加解密。</li>
<li>控制隧道:通过CAPWAP控制隧道实现AP与AC之间的管理报文的交互。同时还可以选择对控制隧道进行数据传输层安全DTLS加密，使能DTLS加密功能后，CAPWAP控制报文都会经过DTLS加解密。</li>
</ul>
<p><img src="/2021/05/02/WLAN/24.png"></p>
<h4 id="3-AP接入控制"><a href="#3-AP接入控制" class="headerlink" title="3.AP接入控制"></a>3.AP接入控制</h4><p>AP接入控制</p>
<ul>
<li>AP发现AC后，会发送Join Request报文。AC收到后会判断是否允许该AP接入，并响应Join Response报文。</li>
<li>AC上支持三种对AP的认证方式:MAC认证、序列号(SN)认证和不认证。</li>
</ul>
<p><img src="/2021/05/02/WLAN/25.png"></p>
<h4 id="4-AP的版本升级（可选）"><a href="#4-AP的版本升级（可选）" class="headerlink" title="4.AP的版本升级（可选）"></a>4.AP的版本升级（可选）</h4><ul>
<li>AP根据收到的Join Response报文中的参数判断当前的系统软件版本是否与AC上指定的一致。如果不一致，则AP通过发送Image Data Request报文请求软件版本，然后进行版本升级，升级方式包括AC模式、FTP模式和SFTP模式。</li>
<li>AP在软件版本更新完成后重新启动，重复进行前面三个步骤。</li>
</ul>
<p><img src="/2021/05/02/WLAN/26.png"></p>
<h4 id="5-CAPWAP隧道维持"><a href="#5-CAPWAP隧道维持" class="headerlink" title="5.CAPWAP隧道维持"></a>5.CAPWAP隧道维持</h4><p>数据隧道维持:</p>
<ul>
<li>AP与AC之间交互Keepalive报文来检测数据隧道的连通状态</li>
</ul>
<p>控制隧道维持:</p>
<ul>
<li>AP与AC交互Echo报文来检测控制隧道的连通状态。</li>
</ul>
<p><img src="/2021/05/02/WLAN/27.png"></p>
<h4 id="AC预配置"><a href="#AC预配置" class="headerlink" title="AC预配置"></a>AC预配置</h4><p>为确保AP能够上线,AC需预先配置如下内容</p>
<p><img src="/2021/05/02/WLAN/28.png"></p>
<h3 id="步骤2-WLAN业务下发配置"><a href="#步骤2-WLAN业务下发配置" class="headerlink" title="步骤2-WLAN业务下发配置"></a>步骤2-WLAN业务下发配置</h3><p><img src="/2021/05/02/WLAN/30.png"></p>
<h4 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h4><p>为了方便用户配置和维护WLAN的各个功能，针对WLAN的不同功能和特性设计了各种类型的模板，这些模板统称为WLAN模板。</p>
<p><img src="/2021/05/02/WLAN/31.png"></p>
<h5 id="VAP模板"><a href="#VAP模板" class="headerlink" title="VAP模板"></a>VAP模板</h5><p><img src="/2021/05/02/WLAN/32.png"></p>
<h3 id="步骤3-STA接入"><a href="#步骤3-STA接入" class="headerlink" title="步骤3-STA接入"></a>步骤3-STA接入</h3><p><img src="/2021/05/02/WLAN/33.png"></p>
<p>步骤3中又包含七步。</p>
<h4 id="1-扫描"><a href="#1-扫描" class="headerlink" title="1.扫描"></a>1.扫描</h4><ul>
<li>STA可以通过主动扫描，定期搜索周围的无线网络，获取到周围的无线网络信息。</li>
<li>根据Probe Request帧（探测请求帧）是否携带SSID，可以将主动扫描分为两种:</li>
</ul>
<p><img src="/2021/05/02/WLAN/34.png"></p>
<h4 id="无线接入安全协议"><a href="#无线接入安全协议" class="headerlink" title="无线接入安全协议"></a>无线接入安全协议</h4><p>链路认证和接入认证常用的安全策略。</p>
<p><img src="/2021/05/02/WLAN/35.png"></p>
<h4 id="2-链路认证"><a href="#2-链路认证" class="headerlink" title="2.链路认证"></a>2.链路认证</h4><p>为了保证无线链路的安全，接入过程中AP需要完成对STA的认证，802.11链路定义了两种认证机制:开放系统认证和共享密钥认证。</p>
<p>开放系统认证(Open System Authentication)</p>
<p><img src="/2021/05/02/WLAN/36.png"></p>
<ul>
<li>开放系统认证:即不认证，任意STA都可以认证成功。</li>
</ul>
<p>共享密钥认证(Shared-key Authentication)</p>
<p><img src="/2021/05/02/WLAN/37.png"></p>
<ul>
<li>共享密钥认证:STA和AP预先配置相同的共享密钥，验证两边的密钥配置是否相同。如果一致，则认证成功;否则，认证失败。</li>
</ul>
<h4 id="3-关联"><a href="#3-关联" class="headerlink" title="3.关联"></a>3.关联</h4><ul>
<li>完成链路认证后，STA会继续发起链路服务协商，具体的协商通过Association报文实现。</li>
<li>终端关联过程实质上就是链路服务协商的过程，协商内容包括:支持的速率、信道等。</li>
</ul>
<p><img src="/2021/05/02/WLAN/38.png"></p>
<h4 id="4-接入认证"><a href="#4-接入认证" class="headerlink" title="4.接入认证"></a>4.接入认证</h4><ul>
<li>接入认证即对用户进行区分，并在用户访问网络之前限制其访问权限。相对于链路认证，接入认证安全性更高。</li>
<li>主要包含:PSK认证和802.1X认证。</li>
</ul>
<p><img src="/2021/05/02/WLAN/39.png"></p>
<h4 id="5-STA地址分配"><a href="#5-STA地址分配" class="headerlink" title="5.STA地址分配"></a>5.STA地址分配</h4><ul>
<li>STA获取到自身的IP地址，是STA正常上线的前提条件。</li>
<li>如果STA是通过DHCP方式获取IP地址，可以用AC设备或汇聚交换机作为DHCP服务器为STA分配IP地址。一般情况下使用汇聚交换机作为DHCP服务器。</li>
</ul>
<p><img src="/2021/05/02/WLAN/40.png"></p>
<h4 id="6-用户认证"><a href="#6-用户认证" class="headerlink" title="6.用户认证"></a>6.用户认证</h4><ul>
<li>用户认证是一种“端到端”的安全结构，包括:802.1X认证、MAC认证和Portal认证。</li>
</ul>
<p>Portal认证</p>
<ul>
<li>也称Web认证，一般将Portal认证网站称为门户网站。</li>
<li>用户上网时，必须在门户网站进行认证。只有认证通过后才可以使用网络资源。</li>
</ul>
<p><img src="/2021/05/02/WLAN/41.png"></p>
<h3 id="步骤4-WLAN业务数据转发"><a href="#步骤4-WLAN业务数据转发" class="headerlink" title="步骤4-WLAN业务数据转发"></a>步骤4-WLAN业务数据转发</h3><p><img src="/2021/05/02/WLAN/42.png"></p>
<h4 id="数据转发方式"><a href="#数据转发方式" class="headerlink" title="数据转发方式"></a>数据转发方式</h4><p><img src="/2021/05/02/WLAN/43.png"></p>
<h2 id="WLAN的基础配置命令"><a href="#WLAN的基础配置命令" class="headerlink" title="WLAN的基础配置命令"></a>WLAN的基础配置命令</h2><h3 id="配置AP上线"><a href="#配置AP上线" class="headerlink" title="配置AP上线"></a>配置AP上线</h3><p>1.配置AC作为DHCP服务器，配置Option 43字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-ip-pool-pool1] option code [ sub-option sub-code ] &#123; ascii asci-string l hex hex-string | cipher cipher-string lip-address ip-address</span><br></pre></td></tr></table></figure>
<p>配置DHCP服务器分配给DHCP客户端的自定义选项。</p>
<p>2.创建域管理模板，并配置国家码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC] wlan</span><br><span class="line">[AC-wlan-view]</span><br></pre></td></tr></table></figure>
<p>进入WLAN视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] regulatory-domain-profile name profile-name</span><br><span class="line">[AC-wlan-regulate-domain-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建域管理模板，并进入模板视图，若模板已存在则直接进入模板视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-regulate-domain-profile-name] country-code country-code</span><br></pre></td></tr></table></figure>
<p>配置设备的国家码标识。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name]</span><br></pre></td></tr></table></figure>
<p>创建AP组，并进入AP组视图，若AP组已存在则直接进入AP组视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-ap-group-group-name] regulatory-domain-profile profile-name</span><br></pre></td></tr></table></figure>
<p>将指定的域管理模板引用到AP或AP组。<br>3．配置源接口或源地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC] capwap source interface &#123; loopback loopback-number | vlanif </span><br><span class="line">vlan-id &#125;</span><br></pre></td></tr></table></figure>
<p>配置AC与AP建立CAPWAP隧道的源接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] capwap source ip-address ip-address</span><br></pre></td></tr></table></figure>
<p>配置AC的源IP地址。<br>4.添加AP设备–离线导入AP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap auth-mode &#123; mac-auth | sn-auth &#125;</span><br></pre></td></tr></table></figure>
<p>配置AP认证模式为MAC地址认证，或SN认证，缺省为MAC地址认证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-id ap-id [ [ type-id type-id | ap-type ap-type ] &#123; ap-mac ap-mac | ap-sn ap-sn | ap-mac ap-mac ap-sn ap-sn &#125; ]</span><br><span class="line">[AC-wlan-ap-ap-id] ap-name ap-name</span><br></pre></td></tr></table></figure>
<p>离线增加AP设备或进入AP视图，并配置单个AP的名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-id 0</span><br><span class="line">[AC-wlan-ap-0] ap-group ap-group</span><br></pre></td></tr></table></figure>
<p>配置AP所加入的组。<br>5．检查AP上线结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display ap &#123; all | ap-group ap-group &#125;</span><br></pre></td></tr></table></figure>
<p>查看AP信息。</p>
<h3 id="配置射频"><a href="#配置射频" class="headerlink" title="配置射频"></a>配置射频</h3><p>1.进入射频视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-id 0</span><br><span class="line">[AC-wlan-ap-0] radio radio-id</span><br><span class="line">[AC-wlan-radio-0]</span><br></pre></td></tr></table></figure>
<p>2.配置指定射频的工作带宽和信道</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] channel &#123; 20mhz | 40mhz-minus &#x2F; 40mhz-plus | 80mhz &#x2F; 160mhz &#125; channel</span><br><span class="line">lWarning: This action may cause service interruption.Continue?[Y&#x2F;N]y</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] channel 80+80mhz channel1 channel2</span><br><span class="line">Warning: This action may cause service interruption.Continue?[Y&#x2F;N]y</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的工作带宽和信道。<br>3.配置天线的增益</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] antenna-gain antenna-gain</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的天线增益。<br>4．配置射频的发射功率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] eirp eirp</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的发射功率。</p>
<p>5.配置射频覆盖距离参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] coverage distance distance</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的射频覆盖距离参数。</p>
<p>6.配置射频工作的频段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] frequency &#123; 2.4g | 5g &#125;</span><br></pre></td></tr></table></figure>
<p>7．创建射频模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] radio-2g-profile name profile-name</span><br></pre></td></tr></table></figure>
<p>创建2G射频模板，并进入模板视图，若模板已存在则直接进入模板视图。<br>8.引用射频模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name] radio-2g-profile profile-name radio &#123; radio-id | all &#125;</span><br></pre></td></tr></table></figure>
<p>在AP组中，将指定的2G射频模板引用到2G射频。</p>
<h3 id="配置VAP"><a href="#配置VAP" class="headerlink" title="配置VAP"></a>配置VAP</h3><p>1．创建VAP模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建VAP模板，并进入模板视图，若模板已存在则直接进入模板视图。</p>
<p>2.配置数据转发方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-vap-prof-profile-name] forward-mode &#123; direct-forward | tunnel &#125;</span><br></pre></td></tr></table></figure>
<p>配置VAP模板下的数据转发方式，可以是直接转发或隧道转发。<br>3.配置业务VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-vap-prof-profile-name] service-vlan &#123; vlan-id vlan-id | vlan-pool pool-name &#125;</span><br></pre></td></tr></table></figure>
<p>配置VAP的业务VLAN。</p>
<p>4.配置安全模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] security-profile name profile-name</span><br><span class="line">[AC-wlan-sec-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建安全模板或者进入安全模板视图。<br>缺省情况下，系统已经创建名称为default、default-wds和default-mesh的安全模板。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name] security-profile profile-name</span><br></pre></td></tr></table></figure>
<p>在指定VAP模板中引用安全模板。</p>
<p>5.配置SSID模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ssid-profile name profile-name</span><br><span class="line">[AC-wlan-ssid-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建SSID模板，并进入模板视图，若模板已存在则直接进入模板视图。<br>缺省情况下，系统上存在名为default的SSID模板。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-ssid-prof-profile-name] ssid ssid</span><br></pre></td></tr></table></figure>
<p>配置当前SSID模板中的服务组合识别码SSID ( Service Set ldentifier ) 。缺省情况下，SSID模板中的SSID为HUAWEI-WLAN。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name] ssid-profile profile-name</span><br></pre></td></tr></table></figure>
<p>在指定VAP模板中引用SSID模板。</p>
<p>6.引用VAP模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name] vap-profile profile-name wlan wlan-id radio &#123; radio-id | all &#125; [service-vlan&#123; vlan-id vlan-id \ vlan-pool pool-name &#125; ]</span><br></pre></td></tr></table></figure>
<p>在AP组中，将指定的VAP模板引用到射频。<br>7．查看VAP信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display vap &#123; ap-group ap-group-name |&#123;  	 ap-name ap-name | ap-id ap-id &#125; [ radio radio-id ] &#125; [ ssid ssid ]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display vap &#123; all | ssid ssid &#125;</span><br></pre></td></tr></table></figure>
<p>查看业务型VAP的相关信息。</p>
<h3 id="案例-旁挂二层组网隧道转发"><a href="#案例-旁挂二层组网隧道转发" class="headerlink" title="案例:旁挂二层组网隧道转发"></a>案例:旁挂二层组网隧道转发</h3><p><img src="/2021/05/02/WLAN/44.png"> </p>
<p><img src="/2021/05/02/WLAN/45.png"></p>
<h4 id="配置网络互通"><a href="#配置网络互通" class="headerlink" title="配置网络互通"></a>配置网络互通</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/46.png"></p>
<h4 id="配置AP上线-1"><a href="#配置AP上线-1" class="headerlink" title="配置AP上线"></a>配置AP上线</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/47.png"></p>
<p><img src="/2021/05/02/WLAN/48.png"></p>
<h4 id="查看AP上线"><a href="#查看AP上线" class="headerlink" title="查看AP上线"></a>查看AP上线</h4><p>将AP上电后，当执行命令display ap all查看到AP的“State”字段为“nor”时，表示AP正常上线。</p>
<p><img src="/2021/05/02/WLAN/49.png"></p>
<h4 id="配置WLAN业务参数"><a href="#配置WLAN业务参数" class="headerlink" title="配置WLAN业务参数"></a>配置WLAN业务参数</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/50.png"></p>
<p><img src="/2021/05/02/WLAN/51.png"></p>
<h4 id="查看VAP模板信息"><a href="#查看VAP模板信息" class="headerlink" title="查看VAP模板信息"></a>查看VAP模板信息</h4><p>WLAN业务配置会自动下发给AP，配置完成后，通过执行命令display vap ssid wlan-net查看如下信息，当“Status”项显示为“ON”时，表示AP对应的射频上的VAP已创建成功。</p>
<p><img src="/2021/05/02/WLAN/52.png"></p>
<h2 id="新一代WLAN解决方案"><a href="#新一代WLAN解决方案" class="headerlink" title="新一代WLAN解决方案"></a>新一代WLAN解决方案</h2><h3 id="华为WLAN方案满足未来无线建网需求"><a href="#华为WLAN方案满足未来无线建网需求" class="headerlink" title="华为WLAN方案满足未来无线建网需求"></a>华为WLAN方案满足未来无线建网需求</h3><p><img src="/2021/05/02/WLAN/54.png"></p>
<h3 id="双轮驱动-技术与应用发展助推Wi-Fi-6时代到来"><a href="#双轮驱动-技术与应用发展助推Wi-Fi-6时代到来" class="headerlink" title="双轮驱动:技术与应用发展助推Wi-Fi 6时代到来"></a>双轮驱动:技术与应用发展助推Wi-Fi 6时代到来</h3><p><img src="/2021/05/02/WLAN/55.png"></p>
<h3 id="Wi-Fi-6-Vs-Wi-Fi-5"><a href="#Wi-Fi-6-Vs-Wi-Fi-5" class="headerlink" title="Wi-Fi 6 Vs Wi-Fi 5"></a>Wi-Fi 6 Vs Wi-Fi 5</h3><p><img src="/2021/05/02/WLAN/56.png"></p>
<h3 id="下—代园区网络-智简园区（中小型园区网络"><a href="#下—代园区网络-智简园区（中小型园区网络" class="headerlink" title="下—代园区网络:智简园区（中小型园区网络)"></a>下—代园区网络:智简园区（中小型园区网络)</h3><p>基本概念</p>
<ul>
<li>通过云管理平台，可以实现任意地点对设备进行集中的管理和维护，大大降低网络部署运维成本。</li>
<li>适用范围:中小型企业。</li>
</ul>
<p>优势(对比AC+FIT AP架构)</p>
<ul>
<li>即插即用，自动开局，减少网络部署成本。</li>
<li>统一运维:所有云管理网元统一在云管理平台上进行监控和管理。</li>
<li>工具化:通常情况下，云解决方案会在云端提供各类工具，有效降低各类开支。</li>
</ul>
<p><img src="/2021/05/02/WLAN/57.png"></p>
<h3 id="下一代园区网络-智简园区-大中型园区网络"><a href="#下一代园区网络-智简园区-大中型园区网络" class="headerlink" title="下一代园区网络:智简园区(大中型园区网络)"></a>下一代园区网络:智简园区(大中型园区网络)</h3><p>架构特点</p>
<ul>
<li>AP需要配合iMaster NCE使用，由iMaster NCE统一管理和配置，功能丰富，进一步和有线网络融合，结合大数据和Al技术实现园区网络的极简、智慧和安全。</li>
<li>适用范围:大中型企业。</li>
</ul>
<p><img src="/2021/05/02/WLAN/58.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/" itemprop="url">广域网技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T16:55:45+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="广域网技术概述"><a href="#广域网技术概述" class="headerlink" title="广域网技术概述"></a>广域网技术概述</h2><h3 id="什么是广域网"><a href="#什么是广域网" class="headerlink" title="什么是广域网"></a>什么是广域网</h3><p>广域网 （WAN）是连接不同地区局域网的网络，通常所覆盖的范围从几十公里到几千公里。它能连接多个地区、城市和国家，或横跨几个洲提供远距离通信，形成国际性的远程网络。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/1.png"></p>
<h3 id="广域网与局域网区别"><a href="#广域网与局域网区别" class="headerlink" title="广域网与局域网区别"></a>广域网与局域网区别</h3><ul>
<li>局域网是一种覆盖地理区域比较小的计算机网络。</li>
<li>广域网是一种通过租用ISP网络或者自建专用网络来构建的覆盖地理区域比较广的计算机网络。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/2.png"></p>
<h3 id="早期广域网技术介绍"><a href="#早期广域网技术介绍" class="headerlink" title="早期广域网技术介绍"></a>早期广域网技术介绍</h3><p>早期广域网与局域网的区别在于数据链路层和物理层的差异性，在TCP/IP参考模型中，其他各层无差异。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/3.png"></p>
<h3 id="广域网络设备角色介绍"><a href="#广域网络设备角色介绍" class="headerlink" title="广域网络设备角色介绍"></a>广域网络设备角色介绍</h3><p>广域网络设备基本角色有三种，CE ( Customer Edge，用户边缘设备）、PE ( Provider Edge，服务提供商边缘设备）和P ( Provider ，服务提供商设备)。具体定义是:</p>
<ul>
<li>CE:用户端连接服务提供商的边缘设备。CE连接一个或多PE，实现用户接入。</li>
<li>PE:服务提供商连接CE的边缘设备。PE同时连接CE和P设备，是重要的网络节点。</li>
<li>P︰服务提供商不连接任何CE的设备。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/4.png"></p>
<h3 id="早期广域网技术的应用"><a href="#早期广域网技术的应用" class="headerlink" title="早期广域网技术的应用"></a>早期广域网技术的应用</h3><p>早期的广域网技术王要定针刈个可日1份在ED笔里干解决用户接入广域网的长距离传输问题。仕ISP之间常用的广域网封装协议有PPP/HDLC/FR等，用于解决用内部常用的广域网协议主要是ATM，它用于解决骨干网高速转发的问题。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/5.png"></p>
<h2 id="PPP协议原理与配置"><a href="#PPP协议原理与配置" class="headerlink" title="PPP协议原理与配置"></a>PPP协议原理与配置</h2><h3 id="PPP协议概述"><a href="#PPP协议概述" class="headerlink" title="PPP协议概述"></a>PPP协议概述</h3><ul>
<li><p>PPP ( Point-to-Point Protocol，点到点协议）是一种常见的广域网数据链路层协议，主要用于在全双工的链路上进行点到点的数据传输封装。</p>
</li>
<li><p>PPP提供了安全认证协议族PAP ( Password Authentication Protocol，密码验证协议）和CHAP (Challenge Handshake Authentication Protocol，挑战握手认证协议）。</p>
</li>
<li><p>PPP协议具有良好的扩展性，例如，当需要在以太网链路上承载PPP协议时，PPP可以扩展为PPPoE。</p>
</li>
<li><p>PPP协议提供LCP(Link Control Protocol，链路控制协议)，用于各种链路层参数的协商，例如最大接收单元，认证模式等。</p>
</li>
<li><p>PPP协议提供各种NCP (Network Control protocol，网络控制协议），如IPCP ( IP Control Protocol ，IP控制协议)，用于各网络层参数的协商，更好地支持了网络层协议。</p>
</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/6.png"></p>
<h3 id="PPP链路建立流程"><a href="#PPP链路建立流程" class="headerlink" title="PPP链路建立流程"></a>PPP链路建立流程</h3><p>PPP链路的建立有三个阶段的协商过程，链路层协商、认证协商（可选）和网络层协商。</p>
<ul>
<li>链路层协商（LCP）:通过LCP报文进行链路参数协商，建立链路层连接。</li>
<li>认证协商（可选)︰通过链路建立阶段协商的认证方式进行链路认证。</li>
<li>网络层协商（NCP）∶通过NCP协商来选择和配置一个网络层协议并进行网络层参数协商。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/7.png"></p>
<h3 id="PPP链路接口状态机"><a href="#PPP链路接口状态机" class="headerlink" title="PPP链路接口状态机"></a>PPP链路接口状态机</h3><p>PPP协商由链路两端的接口完成。接口的状态表示了协议的协商阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/8.png"></p>
<h3 id="LCP报文格式"><a href="#LCP报文格式" class="headerlink" title="LCP报文格式"></a>LCP报文格式</h3><p>PPP报文可由Protocol字段标识不同类型的PPP报文。例如，当Protocol字段为OxC021时，代表是LCP报文。此时又由Code字段标识不同类型LCP报文，如下表所示。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/9.png"></p>
<h3 id="LCP协商过程"><a href="#LCP协商过程" class="headerlink" title="LCP协商过程"></a>LCP协商过程</h3><h4 id="LCP协商过程-正常协商"><a href="#LCP协商过程-正常协商" class="headerlink" title="LCP协商过程-正常协商"></a>LCP协商过程-正常协商</h4><p>LCP协商由不同的LCP报文交互完成。协商由任意一方发送Configure-Request报文发起。如果对端接收此报文且参数匹配，则通过回复Configure-Ack响应协商成功。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/10.png"></p>
<h4 id="LCP协商过程-参数不匹配"><a href="#LCP协商过程-参数不匹配" class="headerlink" title="LCP协商过程-参数不匹配"></a>LCP协商过程-参数不匹配</h4><p>在LCP报文交互中出现LCP参数不匹配时，接收方回复Configure-Nak响应告知对端修改参数然后重新协商。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/11.png"></p>
<h4 id="LCP协商过程-参数不识别"><a href="#LCP协商过程-参数不识别" class="headerlink" title="LCP协商过程-参数不识别"></a>LCP协商过程-参数不识别</h4><p>在LCP报文交互中出现LCP参数不识别时，接收方回复Configure-Reject响应告知对端删除不识别的参数然后重新协商。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/12.png"></p>
<h3 id="PPP认证过程"><a href="#PPP认证过程" class="headerlink" title="PPP认证过程"></a>PPP认证过程</h3><p>链路协商成功后，进行认证协商（此过程可选）。认证协商有两种模式，PAP和CHAP。</p>
<h4 id="PPP认证模式-PAP"><a href="#PPP认证模式-PAP" class="headerlink" title="PPP认证模式- PAP"></a>PPP认证模式- PAP</h4><p>PAP认证双方有两次握手。协商报文以明文的形式在链路上传输。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/13.png"></p>
<h4 id="PPP认证模式-CHAP"><a href="#PPP认证模式-CHAP" class="headerlink" title="PPP认证模式- CHAP"></a>PPP认证模式- CHAP</h4><p>CHAP认证双方有三次握手。协商报文被加密后再在链路上传输。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/14.png"></p>
<h5 id="认证方不携带用户名，被认证方接口有密码"><a href="#认证方不携带用户名，被认证方接口有密码" class="headerlink" title="认证方不携带用户名，被认证方接口有密码"></a>认证方不携带用户名，被认证方接口有密码</h5><p>认证方不带用户名时，被认证方首先使用<strong>自己的接口密码</strong>+random+id生成MD5发送给认证方。</p>
<p>认证方收到回复帧后，到自己的AAA库中找与<strong>被认证方</strong>接口用户名相对应的密码，生成一个MD5值。</p>
<p>最后如果被认证方发送的MD5值和认证方生成的MD5值相同的话，则认证通过，显示Success，若不通过则显示Failure.</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9%E4%B8%8D%E5%B8%A6%E7%94%A8%E6%88%B7%E5%90%8D.png"></p>
<h5 id="认证方（双方）携带用户名，被认证方接口无密码"><a href="#认证方（双方）携带用户名，被认证方接口无密码" class="headerlink" title="认证方（双方）携带用户名，被认证方接口无密码"></a>认证方（双方）携带用户名，被认证方接口无密码</h5><p>认证方携带用户名时，被认证方接受到挑战帧后，首先进入自己AAA库中找到与<strong>认证方</strong>发送过来用户名相对应的密码+random+id生成MD5发送给认证方。</p>
<p>认证方接受到被认证方发送过来的MD5值后，首先也同样进入AAA库中找到与<strong>被认证方</strong>发送过来的用户名相对应的密码+random+id生成自己的MD5值。</p>
<p>最后如果被认证方发送的MD5值和认证方生成的MD5值相同的话，则认证通过，显示Success，若不通过则显示Failure.</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9%E5%B8%A6%E7%94%A8%E6%88%B7%E5%90%8D.png"></p>
<blockquote>
<p>第三次握手中，如果是Success，MESSAGE =”welcome to XXX”。 XXX是认证方接口用户名。</p>
</blockquote>
<h5 id="认证方（双方）携带用户名，被认证方接口有密码"><a href="#认证方（双方）携带用户名，被认证方接口有密码" class="headerlink" title="认证方（双方）携带用户名，被认证方接口有密码"></a>认证方（双方）携带用户名，被认证方接口有密码</h5><p>认证方携带用户名时，被认证方接受到挑战帧，此使被认证方<strong>使用自己的接口密码</strong>生成MD5值，<strong>不再使用AAA库中与认证方用户名相对应的密码</strong>生成MD5值了。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%A2%AB%E8%AE%A4%E8%AF%81%E6%96%B9%E6%8E%A5%E5%8F%A3%E6%9C%89%E5%AF%86%E7%A0%81.png"></p>
<h5 id="双方携带用户名，认证方AAA库中无密码"><a href="#双方携带用户名，认证方AAA库中无密码" class="headerlink" title="双方携带用户名，认证方AAA库中无密码"></a>双方携带用户名，认证方AAA库中无密码</h5><p>此时因为被认证方发送过来的MD5与认证方生成MD5比较失败无法通过认证。</p>
<blockquote>
<p>比较失败的原因是认证方AAA库中没有对应的密码。</p>
</blockquote>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9aaa%E5%BA%93%E4%B8%AD%E6%97%A0%E5%AF%B9%E5%BA%94%E5%AF%86%E7%A0%81.png"></p>
<h3 id="NCP协商"><a href="#NCP协商" class="headerlink" title="NCP协商"></a>NCP协商</h3><p>PPP认证协商后，双方进入NCP协商阶段，协商在数据链路上所传输的数据包的格式与类型。以常见的IPCP协议为例，它分为静态IP地址协商和动态IP地址协商。</p>
<h4 id="NCP协商-静态IР地址协商"><a href="#NCP协商-静态IР地址协商" class="headerlink" title="NCP协商-静态IР地址协商"></a>NCP协商-静态IР地址协商</h4><p>静态IP地址协商需要手动在链路两端配置IP地址。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/15.png"></p>
<h4 id="NCP协商-动态IP地址协商"><a href="#NCP协商-动态IP地址协商" class="headerlink" title="NCP协商-动态IP地址协商"></a>NCP协商-动态IP地址协商</h4><p>动态IP地址协商支持PPP链路─端为对端配置IP地址。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/16.png"></p>
<h3 id="PPP协议配置"><a href="#PPP协议配置" class="headerlink" title="PPP协议配置"></a>PPP协议配置</h3><h4 id="PPP基础配置命令"><a href="#PPP基础配置命令" class="headerlink" title="PPP基础配置命令"></a>PPP基础配置命令</h4><p>1.配置接口封装PPP协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0]link-protocol ppp</span><br></pre></td></tr></table></figure>
<p>在接口视图下，将接口封装协议改为ppp，华为串行接口默认封装协议为ppp。<br>2.配置协商超时时间间隔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp timer negotiate seconds</span><br></pre></td></tr></table></figure>
<p>在PPPLCP协商过程中，本端设备会向对端设备发送LCP协商报文，如果在指定协商时间间隔内没有收到对端的应答报文，则重新发送。</p>
<h4 id="PAP认证配置命令"><a href="#PAP认证配置命令" class="headerlink" title="PAP认证配置命令"></a>PAP认证配置命令</h4><p>1.配置验证方以PAP方式认证对端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name password &#123; cipher | irreversible-cipher &#125; password</span><br><span class="line">[Huawei-aaa] local-user user-name service-type ppp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp authentication-mode pap</span><br></pre></td></tr></table></figure>
<p>配置验证方以PAP方式认证对端，首先需要通过AAA将被验证方的用户名和密码加入本地用户列表，然后选择认证模式。<br>2.配置被验证方以PAP方式被对端认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp pap local-user user-name password &#123; cipher simple &#125; password</span><br></pre></td></tr></table></figure>
<p>配置本地被对端以PAP方式验证时，本地发送PAP用户名和口令。</p>
<h4 id="CHAP认证配置命令"><a href="#CHAP认证配置命令" class="headerlink" title="CHAP认证配置命令"></a>CHAP认证配置命令</h4><p>1.配置验证方以CHAP方式认证对端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name password &#123; cipher | irreversible-cipher &#125; password</span><br><span class="line">[Huawei-aaa] local-user user-name service-type ppp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp authentication-mode chap</span><br></pre></td></tr></table></figure>
<p>2.配置被验证方以CHAP方式被对端认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp chap user user-name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp chap password &#123; cipher | simple &#125; password</span><br></pre></td></tr></table></figure>
<p>配置本地用户名，配置本地被对端以CHAP方式验证时的口令。</p>
<h3 id="配置举例"><a href="#配置举例" class="headerlink" title="配置举例"></a>配置举例</h3><h4 id="配置举例-PAP认证"><a href="#配置举例-PAP认证" class="headerlink" title="配置举例- PAP认证"></a>配置举例- PAP认证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/17.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/18.png"></p>
<h4 id="配置举例-CHAP认证"><a href="#配置举例-CHAP认证" class="headerlink" title="配置举例-CHAP认证"></a>配置举例-CHAP认证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/19.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/20.png"></p>
<h2 id="PPPoE原理与配置"><a href="#PPPoE原理与配置" class="headerlink" title="PPPoE原理与配置"></a>PPPoE原理与配置</h2><h3 id="什么是PPPoE"><a href="#什么是PPPoE" class="headerlink" title="什么是PPPoE"></a>什么是PPPoE</h3><p>PPPoE ( PPP over Ethernet，以太网承载PPP协议)是一种把PPP帧封装到以太网帧中的链路层协议。PPPoE可以使以太网网络中的多台主机连接到远端的宽带接入服务器。</p>
<p>PPPoE集中了PPP和Ethernet两个技术的优点。既有以太网的组网灵活优势，又可以利用PPP协议实现认证、计费等功能。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/21.png"></p>
<h3 id="PPPoE应用场景"><a href="#PPPoE应用场景" class="headerlink" title="PPPoE应用场景"></a>PPPoE应用场景</h3><p>PPPoE实现了在以太网上提供点到点的连接。PPPoE客户端与PPPoE服务器端之间建立PPP会话，封装PPP数据报文，为以太网上的主机提供接入服务，实现用户控制和计费，在企业网络与运营商网络中应用广泛。</p>
<p>PPPoE的常见应用场景有家庭用户拨号上网、企业用户拨号上网等</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/22.png"></p>
<h3 id="PPPoE会话建立"><a href="#PPPoE会话建立" class="headerlink" title="PPPoE会话建立"></a>PPPoE会话建立</h3><p>PPPoE的会话建立有三个阶段，PPPoE发现阶段、PPPoE会话阶段和PPPoE终结阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/23.png"></p>
<h3 id="PPPoE报文"><a href="#PPPoE报文" class="headerlink" title="PPPoE报文"></a>PPPoE报文</h3><p>PPPoE会话的建立通过不同的PPPoE报文交互实现。PPPoE报文结构及常见的报文类型如下所示:</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/24.png"></p>
<h3 id="PPPoE发现阶段"><a href="#PPPoE发现阶段" class="headerlink" title="PPPoE发现阶段"></a>PPPoE发现阶段</h3><p>PPPoE协议发现有四个步骤:客户端发送请求、服务端响应请求、客户端确认响应和建立会话。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/25.png"></p>
<h3 id="PPPoE会话阶段"><a href="#PPPoE会话阶段" class="headerlink" title="PPPoE会话阶段"></a>PPPoE会话阶段</h3><p>PPPoE会话阶段会进行PPP协商，分为LCP协商、认证协商、NCP协商三个阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/26.png"></p>
<h3 id="PPPoE会话终结阶段"><a href="#PPPoE会话终结阶段" class="headerlink" title="PPPoE会话终结阶段"></a>PPPoE会话终结阶段</h3><p>当PPPoE客户端希望关闭连接时，会向PPPoE服务器端发送一个PADT报文，用于关闭连接。同样，如果PPPoE服务器端希望关闭连接时，也会向PPPoE客户端发送一个PADT报文。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/27.png"></p>
<h3 id="PPPoE基础配置"><a href="#PPPoE基础配置" class="headerlink" title="PPPoE基础配置"></a>PPPoE基础配置</h3><p>1.通过拨号规则来配置发起PPPoE会话的条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] dialer-rule</span><br></pre></td></tr></table></figure>
<p>2.配置拨号接口用户名，此用户名必须与对端服务器用户名相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer user username</span><br></pre></td></tr></table></figure>
<p>3.将接口置于一个拨号访问组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer-group group-number</span><br></pre></td></tr></table></figure>
<p>4.指定当前拨号接口使用的拨号绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer-bundle number</span><br></pre></td></tr></table></figure>
<p>5.将物理端口与dialer-bundle进行绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-EthernetO&#x2F;0&#x2F;0]pppoe-client dial-bundle-number number</span><br></pre></td></tr></table></figure>

<h3 id="配置实例"><a href="#配置实例" class="headerlink" title="配置实例"></a>配置实例</h3><h4 id="配置实例-PPPoE客户端"><a href="#配置实例-PPPoE客户端" class="headerlink" title="配置实例-PPPoE客户端"></a>配置实例-PPPoE客户端</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/28.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/29.png"></p>
<h4 id="配置实例-PPPoE服务器端"><a href="#配置实例-PPPoE服务器端" class="headerlink" title="配置实例-PPPoE服务器端"></a>配置实例-PPPoE服务器端</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/30.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/31.png"></p>
<h4 id="配置验证"><a href="#配置验证" class="headerlink" title="配置验证"></a>配置验证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/32.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/33.png"></p>
<h2 id="广域网技术的发展"><a href="#广域网技术的发展" class="headerlink" title="广域网技术的发展"></a>广域网技术的发展</h2><h3 id="传统IР路由转发"><a href="#传统IР路由转发" class="headerlink" title="传统IР路由转发"></a>传统IР路由转发</h3><p>传统的IP转发采用的是逐跳转发。数据报文经过每一台路由器，都要被解封装查看报又网络层信忌，然后依掂哈出取囚四乩原则查找路由表指导报文转发。各路由器重复进行解封装查找路由表和再封装的过程，所以转发性能低。</p>
<p>传统IP路由转发的特点:</p>
<ul>
<li>所有路由器需要知道全网的路由。</li>
<li>传统lP转发是面向无连接的，无法提供较好的端到端QoS保证。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/34.png"></p>
<h3 id="MPLS标签转发"><a href="#MPLS标签转发" class="headerlink" title="MPLS标签转发"></a>MPLS标签转发</h3><ul>
<li>MPLS是一种IP骨干网技术。</li>
<li>MPLS是种隧道技术，在IP路由和控制协议的基础上，向网络层提供面向连接的交换。能够提供较好的QoS保证。</li>
<li>MPLS标签指导报文转发的过程中，使用本地标签查找替代传统IP转发的路由查找，大大提高转发效率。</li>
<li>MPLS转发过程中使用的标签，既可以通过手工静态配置，又可以通过动态标签分发协议分配。</li>
</ul>
<p>MPLS的标签分发有静态和动态两种方式，均面临着不同的问题</p>
<ul>
<li>静态标签分发为手工配置。</li>
<li>动态标签分发的问题。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/35.png"></p>
<h3 id="Segment-Routing简介"><a href="#Segment-Routing简介" class="headerlink" title="Segment Routing简介"></a>Segment Routing简介</h3><p>为解决传统IP转发和MPLS转发的问题，业界提出了SR ( Segment Routing，分段路由）。SR的转发机制有很大改进，主要体现在以下几个方面:</p>
<p>1.基于现有协议进行扩展:</p>
<ul>
<li>扩展后的IGP/BGP具有标签分发能力，因此网络中无需其他任何标签分发协议，实现协议简化。</li>
</ul>
<p>2.引入源路由机制:</p>
<ul>
<li>基于源路由机制，支持通过控制器进行集中算路。</li>
</ul>
<p>3.由业务来定义网络:</p>
<ul>
<li>业务驱动网络，由应用提出需求（时延、带宽、丢包率等），控制器收集网络拓扑、带宽利用率、时延等信息，根据业务需求计算显式路径。</li>
</ul>
<h3 id="Segment-Routing转发原理"><a href="#Segment-Routing转发原理" class="headerlink" title="Segment Routing转发原理"></a>Segment Routing转发原理</h3><p>SR将网络路径分成一个个的段( Segment )，并且为这些段分配SID ( Segment ID ) 。</p>
<p>SID的分配对象有两种，转发节点或者邻接链路。本例中转发节点SID 1600X，X为路由器编号;邻接链路SID160xx，XX表示链路两端的节点编号。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/36.png"></p>
<p>邻接链路和网络节点的SID有序排列形成段序列( Segment List )，它代表一条转发路径。SR由源节点将段序列编码在数据包头部，随数据包传输。SR的本质是指令，指引报文去哪里和怎么去。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/37.png"></p>
<h3 id="SR的部署方式"><a href="#SR的部署方式" class="headerlink" title="SR的部署方式"></a>SR的部署方式</h3><p>SR部署分为有控制器部署和无控制器部署。控制器配合方式由控制<br>器收集信息，预留路径资源和计算路径，最后将结果下发到头结点，是更为推荐的部署方式。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/38.png"></p>
<h3 id="Seg-ment-Routing的应用"><a href="#Seg-ment-Routing的应用" class="headerlink" title="Seg ment Routing的应用"></a>Seg ment Routing的应用</h3><p>SR可以简易的指定的报文转发路径，在现网中可以为不同业务定义不同的路径。例如本例定义了数据下载、视频和语音三条显式路径，实现了业务驱动网络。设备由控制器纳管，支持路径实时快速发放。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/39.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/NFV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/NFV/" itemprop="url">NFV</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T12:03:39+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="NFV的背景-同样来自IT行业变革的启示"><a href="#NFV的背景-同样来自IT行业变革的启示" class="headerlink" title="NFV的背景:同样来自IT行业变革的启示"></a>NFV的背景:同样来自IT行业变革的启示</h2><p>来自IT界的启示，给网络产业带来了网络架构和设备架构两个层面的思考。网络架构层面引入对SDN控制器的思考，设备架构层面引入对设备部署形态的思考。</p>
<h3 id="IT产业的变革"><a href="#IT产业的变革" class="headerlink" title="IT产业的变革"></a>IT产业的变革</h3><p>近年虚拟化和云计算等IT技术蓬勃发展，传统部署于硬件的应用逐渐云化。应用以软件的方式部署于私有云、公有云或者混合云上。</p>
<p><img src="/2021/05/02/NFV/1.png"></p>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ul>
<li>网络产业思考:能否以软件化的方式部署网络应用呢?</li>
<li>这些思考引发了NFV ( Network Functions Virtualization，网络功能虚拟化）。</li>
</ul>
<h2 id="NFV的起源"><a href="#NFV的起源" class="headerlink" title="NFV的起源"></a>NFV的起源</h2><ul>
<li>2012年10月，13家Top运营商(AT&amp;T、Verizon、VDF、DT、T-Mobile、BT、Telefonica等）在SDN和Open Flow世界大会上发布NFV ( Network Functions Virtualization )第一版白皮书，同时成立了ISG ( Industry Specification Group )来推动网络虚拟化的需求定义和系统架构制定。</li>
<li>2013年，ETSI下NFV ISG(行业规范工作组)进行第一阶段研究，已完成相关标准制定。主要定义网络功能虚拟化的需求和架构，并梳理不同接口的标准化进程。</li>
</ul>
<p><img src="/2021/05/02/NFV/2.png"></p>
<h2 id="NFV的价值"><a href="#NFV的价值" class="headerlink" title="NFV的价值"></a>NFV的价值</h2><p>NFV ( Network Functions Virtualization )是运营商为了解决电信网络硬件繁多、部署运维复杂、业务创新困难等问题而提出的。NFV在重构电信网络的同时，给运营商带来的价值如下:</p>
<ul>
<li>缩短业务上线时间</li>
<li>降低建网成本</li>
<li>提升网络运维效率</li>
<li>构建开放的生态系统</li>
</ul>
<h2 id="NFV关键技术-虚拟化"><a href="#NFV关键技术-虚拟化" class="headerlink" title="NFV关键技术:虚拟化"></a>NFV关键技术:虚拟化</h2><ul>
<li>在NFV的道路上，虚拟化是基础，云化是关键。</li>
<li>传统电信网络中，各个网元都是由专用硬件实现，成本高、运维难。虚拟化具有分区、隔离、封装和相对于硬件独立的特征，能够很好匹配NFV的需求。运营商引入此模式，将网元软件化，运行在通用基础设施上。</li>
</ul>
<p><img src="/2021/05/02/NFV/3.png"></p>
<h2 id="NFV关键技术-云化"><a href="#NFV关键技术-云化" class="headerlink" title="NFV关键技术:云化"></a>NFV关键技术:云化</h2><ul>
<li>美国国家标准与技术研究院（NIST）定义︰云计算是一种模型，它可以实现随时随地，便捷地，随需应变地从可配置计算资源共享池中获取所需的资源（例如，网络、服务器、存储、应用、及服务），资源能够快速供应并释放，使管理资源的工作量和与服务提供商的交互减小到最低限度。</li>
<li>云计算拥有诸多好处。运营商网络中网络功能的云化更多的是利用了资源池化和快速弹性伸缩两个特征。</li>
</ul>
<p><img src="/2021/05/02/NFV/4.png"></p>
<h2 id="NFV架构间介"><a href="#NFV架构间介" class="headerlink" title="NFV架构间介"></a>NFV架构间介</h2><p>NFV架构分NFVI ( Network Functions Virtualization Infrastructure，基础设施层)、VNF ( Virtualized Network Function，虚拟化网络功能层）和MANO ( Management and Orchestration，管理编排域)，同还要支持现有的BSS/OSS ( Business support system/ Operation support system )。</p>
<p><img src="/2021/05/02/NFV/5.png"></p>
<h2 id="NFV的标准架构"><a href="#NFV的标准架构" class="headerlink" title="NFV的标准架构"></a>NFV的标准架构</h2><p>ETSI定义了NFV标准架构，由NFVI、VNF以及MANO主要组件组成。NFVI包括通用的硬件设施及其虚书化，VNF使用软件实现虚拟化网络功能，MANO实现NFV架构的管理和编排。</p>
<p><img src="/2021/05/02/NFV/6.png"></p>
<h2 id="NFV架构功能模块"><a href="#NFV架构功能模块" class="headerlink" title="NFV架构功能模块"></a>NFV架构功能模块</h2><p>NFV标准架构定义的主要功能模块:</p>
<p>**OSS/BSS **</p>
<p>服务提供商的管理功能，不属于NFV框架内的功能组件，但MANO和网元需要提供对OSS/BSS 的接口支持。</p>
<p><strong>MANO</strong></p>
<p>NFV管理和编排。包括VIM，VNFM及NFVO，提供对VNF及l层统一的管理和编排功能。</p>
<ul>
<li>VIM: Virtualized Infrastructure Managers，NFVI官理候坎，应市1于APP1oor0 I/ANIE笞理塔快功能包括:资源的发现、虚拟资源的管理分配、故障处理等。VNFM: VNF Managers , VNF管理模块，主要对VNF的生命周期（实例化、配置、关闭等）进行控制。</li>
<li>NFVO: NFV Orchestration，实现对整个NFV基础架构、软件资源、网络服务的编排和管理。</li>
</ul>
<p><strong>VNF</strong></p>
<p>指虚拟机及部署在虚拟机上的业务网元、网络功能软件等。</p>
<p><strong>NFVI</strong></p>
<p>NFV基础设施,包括所需的硬件及软件。为VNF提供运行环境. </p>
<ul>
<li>Hardware:硬件层，包括提供计算、网络、存储资源能力的硬件设备。</li>
<li>Virtualization Layer:虚拟化层，主要完成对硬件资源的抽象，形成虚拟资源，如虚拟计算资源、虚拟存储资源、虚拟网络资源。其虚拟化功能由Hypervisor实现。</li>
</ul>
<h2 id="NFV架构接口"><a href="#NFV架构接口" class="headerlink" title="NFV架构接口"></a>NFV架构接口</h2><p>NFV标准架构的主要接口:</p>
<p><img src="/2021/05/02/NFV/8.png"></p>
<h2 id="华为NFV解决方案"><a href="#华为NFV解决方案" class="headerlink" title="华为NFV解决方案"></a>华为NFV解决方案</h2><ul>
<li>华为NFV架构中，虚拟化层及VIM的功能由华为云Stack NFVI平台实现。华为云Stack可以实现计算资源、存储资源和网络资源的全面虚拟化，并能够对物理硬件虚拟化资源进行统一的管理、监控和优化。</li>
<li>华为提供运营商无线网、承载网、传输网、接入网、核心网等全面云化的解决方案。</li>
</ul>
<p><img src="/2021/05/02/NFV/7.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/SDN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/SDN/" itemprop="url">SDN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T12:03:32+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="传统网络的缺点"><a href="#传统网络的缺点" class="headerlink" title="传统网络的缺点"></a>传统网络的缺点</h2><h3 id="计算机时代的演进"><a href="#计算机时代的演进" class="headerlink" title="计算机时代的演进"></a>计算机时代的演进</h3><p><img src="/2021/05/02/SDN/1.png"></p>
<h3 id="网络产业发展-来自IT行业的启示"><a href="#网络产业发展-来自IT行业的启示" class="headerlink" title="网络产业发展:来自IT行业的启示"></a>网络产业发展:来自IT行业的启示</h3><ul>
<li>IT产业的变革引发了网络产业的思考。业界开始提出SDN (Software Defined Networking )的概念，并不断在其商用化进程上作出尝试。目的是希望网络变得更开放、灵活和简单。</li>
</ul>
<p><img src="/2021/05/02/SDN/2.png"></p>
<h3 id="网络界的现状-经典IP网络–分布式网络"><a href="#网络界的现状-经典IP网络–分布式网络" class="headerlink" title="网络界的现状:经典IP网络–分布式网络"></a>网络界的现状:经典IP网络–分布式网络</h3><ul>
<li>经典的IP网络是一个分布式的、对等控制的网络。每台网络设备存在独立的数据平台、控制平面和管理平面.设备的控制平面对等的交互路由协议，然后独立的生成数据平面指导报文转发。</li>
<li>经典IP网络的优势在于设备与协议解耦，厂家之间兼容性较好且故障场景下协议保证网络收敛。</li>
</ul>
<p><img src="/2021/05/02/SDN/3.png"></p>
<h3 id="网络界的思考-经典网络面临的问题"><a href="#网络界的思考-经典网络面临的问题" class="headerlink" title="网络界的思考:经典网络面临的问题"></a>网络界的思考:经典网络面临的问题</h3><h4 id="网络易拥塞"><a href="#网络易拥塞" class="headerlink" title="网络易拥塞"></a>网络易拥塞</h4><p><img src="/2021/05/02/SDN/4.png"></p>
<h4 id="网络技术太复杂"><a href="#网络技术太复杂" class="headerlink" title="网络技术太复杂"></a>网络技术太复杂</h4><p>网络协议多︰如果您准备成为一名网络技术专家，您需要阅读网络设备相关RFC 2500篇。如果一天阅读一篇，需要长达6年时间，而这只是整个RFC的 1/3，其数量还在持续增加。</p>
<p>网络配置难:如果您准备成为某个设备商设备的百事通，您需要掌握的命令行超过10000条，而其数量还在增加。</p>
<p><img src="/2021/05/02/SDN/5.png"></p>
<h4 id="网络故障定位、诊断困难"><a href="#网络故障定位、诊断困难" class="headerlink" title="网络故障定位、诊断困难"></a>网络故障定位、诊断困难</h4><p><img src="/2021/05/02/SDN/6.png"></p>
<h4 id="网络业务的部署速度太慢"><a href="#网络业务的部署速度太慢" class="headerlink" title="网络业务的部署速度太慢"></a>网络业务的部署速度太慢</h4><p><img src="/2021/05/02/SDN/7.png"></p>
<h2 id="SDN定义"><a href="#SDN定义" class="headerlink" title="SDN定义"></a>SDN定义</h2><h3 id="SDN的起源"><a href="#SDN的起源" class="headerlink" title="SDN的起源"></a>SDN的起源</h3><ul>
<li>SDN ( Software Defined Networking )即软件定义网络。是由斯坦福大学Clean Slate研究组提出的一种新型网络创新架构。其核心理念通过将网络设备控制平面与数据平面分离，从而实现了网络控制平面的集中控制，为网络应用的创新提供了良好的支撑。</li>
<li>SDN起源提出了三个特征，“转控分离”、“集中控制”和“开放可编程接口”。</li>
</ul>
<p><img src="/2021/05/02/SDN/8.png"></p>
<h3 id="OpenFlow基本概念"><a href="#OpenFlow基本概念" class="headerlink" title="OpenFlow基本概念"></a>OpenFlow基本概念</h3><p>OpenFlow是控制器与交换机之间的一种南向接口协议。它定义了三种类型的消息，Controller-to-Switch、Asynchronous和Symmetric。每一种消息又包含了更多的子类型。</p>
<p><strong>Controller-to-Switch</strong><br>该消息由Controller发送。用于管理Switch和查询Switch的相关信息。<br><strong>Asynchronous</strong><br>该消息由Switch发起。当Switch状态发生改变时，发送该消息告诉Controller状态变化。<br><strong>Symmetric</strong><br>该消息没有固定发起方，可由Switch或者Controller发起。例如Hello、Echo、Error等。</p>
<p><img src="/2021/05/02/SDN/9.png"></p>
<h3 id="Flow-Table简介"><a href="#Flow-Table简介" class="headerlink" title="Flow Table简介"></a>Flow Table简介</h3><ul>
<li>OpenFlow交换机基于流表(Flow Table )转发报文。</li>
<li>每个流表项由匹配字段、优先级、计数器、指令、超时、Cookie、Flags这七部分组成。其中关于转发的关键的两个内容是匹配字段和指令。<ul>
<li>匹配字段是匹配规则，支持自定义。</li>
<li>指令是用来描述匹配后的处理方式。</li>
</ul>
</li>
</ul>
<p><img src="/2021/05/02/SDN/10.png"></p>
<h3 id="转发方式对比"><a href="#转发方式对比" class="headerlink" title="转发方式对比"></a>转发方式对比</h3><h4 id="经典路由协议基于路由表转发"><a href="#经典路由协议基于路由表转发" class="headerlink" title="经典路由协议基于路由表转发"></a>经典路由协议基于路由表转发</h4><ul>
<li>经典的网络转发方式是网络设备通过查询路由表指导流量转发。</li>
<li>路由表的条目由网络设备之间运行路由协议而计算生成。</li>
<li>路由表是定长的。路由表通过最长匹配原则执行报文转发。一台网络设备只有一张路由表。</li>
</ul>
<h4 id="OpenFlow基于流表转发"><a href="#OpenFlow基于流表转发" class="headerlink" title="OpenFlow基于流表转发"></a>OpenFlow基于流表转发</h4><p><img src="/2021/05/02/SDN/12.png"></p>
<ul>
<li>OpenFlow是一个网络协议。运行OpenFlow的交换机通过查询流表指导流量转发。</li>
<li>流表一般是由OF控制器统一计算，然后下发到交换机。流表是</li>
<li>变长的，拥有丰富的匹配规则和转发规则。一台网络设备有多张流表。</li>
</ul>
<h3 id="SDN的本质诉求"><a href="#SDN的本质诉求" class="headerlink" title="SDN的本质诉求"></a>SDN的本质诉求</h3><ul>
<li>SDN的本质诉求是让网络更加开放、灵活和简单。它的实现方式是为网络构建一个集中的大脑，通过全局视图集中控制，实现或业务快速部署、或流量调优、或网络业务开放等目标</li>
</ul>
<p>SDN的价值是:</p>
<ul>
<li><p>集中管理，简化网络管理与运维;</p>
</li>
<li><p>屏蔽技术细节，降低网络复杂度，降低运维成本;。自动化调优，提高网络利用率;</p>
</li>
<li><p>快速业务部署，缩短业务上线时间;</p>
</li>
<li><p>网络开放，支撑开放可编程的第三方应用。</p>
</li>
</ul>
<blockquote>
<p>SDN带来了网络架构的变革。</p>
</blockquote>
<h3 id="SDN网络架构"><a href="#SDN网络架构" class="headerlink" title="SDN网络架构"></a>SDN网络架构</h3><p>SDN网络架构分为协同应用层、控制器层和设备层。不同层次之间通过开放接口连接。以控制器层为主要视角，区分面向设备层的南向接口和面向协同应用层的北向接口。OpenFlow属于南向接口协议的一种。</p>
<p><img src="/2021/05/02/SDN/13.png"></p>
<h3 id="华为SDN网络架构"><a href="#华为SDN网络架构" class="headerlink" title="华为SDN网络架构"></a>华为SDN网络架构</h3><p>华为SDN网络架构支持丰富的南北向接口，包括OpenFlow、OVSDB、NETCONF、PCEP、RESTful .SNMP、BGP、JsonRPC、RESTCONF等。</p>
<p><img src="/2021/05/02/SDN/14.png"></p>
<h3 id="华为SDN解决方案-管、控、析构建智简网络"><a href="#华为SDN解决方案-管、控、析构建智简网络" class="headerlink" title="华为SDN解决方案-管、控、析构建智简网络"></a>华为SDN解决方案-管、控、析构建智简网络</h3><p><img src="/2021/05/02/SDN/15.png"></p>
<h2 id="iMaster-NCE解决方案"><a href="#iMaster-NCE解决方案" class="headerlink" title="iMaster NCE解决方案"></a>iMaster NCE解决方案</h2><h3 id="什么是iMaster-NCE"><a href="#什么是iMaster-NCE" class="headerlink" title="什么是iMaster NCE ?"></a>什么是iMaster NCE ?</h3><p>iMaster NCE，自动驾驶网络管理与控制系统，是华为集管理、控制、分析和Al智能功能于一体的网络自动化与智能化平台。</p>
<p><img src="/2021/05/02/SDN/16.png"></p>
<h3 id="iMaster-NCE种类"><a href="#iMaster-NCE种类" class="headerlink" title="iMaster NCE种类"></a>iMaster NCE种类</h3><p><img src="/2021/05/02/SDN/17.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/" itemprop="url">网络编程与自动化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T10:50:27+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络编程与自动化"><a href="#网络编程与自动化" class="headerlink" title="网络编程与自动化"></a>网络编程与自动化</h2><h3 id="背景-传统网络运维困境"><a href="#背景-传统网络运维困境" class="headerlink" title="背景:传统网络运维困境"></a>背景:传统网络运维困境</h3><p>传统的网络运维工作需要网络工程师手动登录网络设备，人工查看和执行配置命令，肉眼筛选配置结果。这种严重依赖“人”的工作方式操作流程长，效率低下，而且操作过程不易审计。</p>
<p>经典运维场景</p>
<ol>
<li>设备升级∶现网有数千台网络设备，你需要周期性、批量<br>性地对设备进行升级。</li>
<li>配置审计:企业年度需要对设备进行配置审计。例如要求<br>所有设备开启Telnet功能，以太网交换机配置生成树安全功能。你需要快速地找出不符合要求的设备。</li>
<li>配置变更:因为网络安全要求，需要每三个月修改设备账<br>号和密码。你需要在数干台网络设备上删除原有账号并新建账号。</li>
</ol>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/1.png"></p>
<h3 id="网络自动化"><a href="#网络自动化" class="headerlink" title="网络自动化"></a>网络自动化</h3><ul>
<li>网络自动化，通过工具实现网络自动化地部署、运行和运维，逐步减少对“人”的依赖。这能够很好地解决传统网络运维的问题。</li>
<li>业界有很多实现网络自动化的开源工具，例如Ansible、SaltStack、Puppet、Chef等。从网络工程能力构建的角度考虑，更推荐工程师具备代码编程能力。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/2.png"></p>
<h3 id="基于编程实现的网络自动化"><a href="#基于编程实现的网络自动化" class="headerlink" title="基于编程实现的网络自动化"></a>基于编程实现的网络自动化</h3><ul>
<li>近几年随着网络自动化技术的兴起，以Python为主的编程能力成为了网络工程师的新技能要求。</li>
<li>Python编写的自动化脚本能够很好的执行重复、耗时、有规则的操作。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/3.png"></p>
<h2 id="编程语言概述"><a href="#编程语言概述" class="headerlink" title="编程语言概述"></a>编程语言概述</h2><h3 id="编程语言"><a href="#编程语言" class="headerlink" title="编程语言"></a>编程语言</h3><ul>
<li>编程语言（Programming Language )，是一种用于编写计算机程序的语言，用于控制计算机的行为。</li>
<li>按照语言在执行之前是否需要编译区分，可以将编程语言分为需要编译的编译型语言(Compiled Language)，不需要编译的解释型语言( Interpreted Language )。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/4.png"></p>
<h3 id="计算技术栈与程序执行过程"><a href="#计算技术栈与程序执行过程" class="headerlink" title="计算技术栈与程序执行过程"></a>计算技术栈与程序执行过程</h3><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/5.png"></p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/6.png"></p>
<h3 id="高级编程语言–编译型语言"><a href="#高级编程语言–编译型语言" class="headerlink" title="高级编程语言–编译型语言"></a>高级编程语言–编译型语言</h3><ul>
<li>编译型语言︰编译型语言的程序在执行之前有一个编译过程，把程序编译成为机器语言的文件。运行时不需要重新翻译，直接使用编译的结果。典型的如C/C++/Go语言，都属于编译型语言。</li>
<li>从源码到程序的过程:源码需要由编译器、汇编器翻译成机器指令，再通过链接器链接库函数生成机器语言程序。机器语言必须与CPU的指令集匹配，在运行时通过加载器加载到内存，由CPU执行指令。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/7.png"></p>
<h3 id="高级编程语言–解释型语言"><a href="#高级编程语言–解释型语言" class="headerlink" title="高级编程语言–解释型语言"></a>高级编程语言–解释型语言</h3><ul>
<li>解释型语言∶解释型语言的程序不需要在运行前编译，在运行程序的时候才逐行翻译。典型的如Java/Python语言，都属于解释型语言。</li>
<li>从源码到程序的过程:解释型语言的源代码由编译器生成字节码，然后再由虚拟机（JVM/PVM）解释执行。虚拟机将不<br>同CPU指令集的差异屏蔽，因此解释型语言的可移植性相对较好。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/8.png"></p>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>.Python是一门完全开源的高级编程语言。它的作者是Guido Van Rossum。</p>
<h3 id="Python的优缺点"><a href="#Python的优缺点" class="headerlink" title="Python的优缺点"></a>Python的优缺点</h3><p>优点：</p>
<ul>
<li>Python拥有优雅的语法、动态类型具有解释性质。能够让学习者从语法细节的学习中抽离，专注于程序逻辑。</li>
<li>Python同时支持面向过程和面向对象的编程。</li>
<li>Python拥有丰富的第三方库。</li>
<li> Python可以调用其他语言所写的代码，又被称为胶水语言。</li>
</ul>
<p>缺点：</p>
<ul>
<li>运行速度慢。Python是解释型语言,不需要编译即可运行。代码在运行时会逐行地翻译成CPU能理解的机器码这个翻译过程非常耗时。</li>
</ul>
<p>由于Python具有非常丰富的第三方库，加上Python语言本身的优点，所以Python可以在非常多的领域内使用:人工智能、数据科学、APP、自动化运维脚本等。</p>
<h3 id="Python代码执行过程"><a href="#Python代码执行过程" class="headerlink" title="Python代码执行过程"></a>Python代码执行过程</h3><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/9.png"></p>
<h3 id="Python运行方式"><a href="#Python运行方式" class="headerlink" title="Python运行方式"></a>Python运行方式</h3><p>Python有两种运行方式，交互式运行和脚本式运行。</p>
<h4 id="交互式运行"><a href="#交互式运行" class="headerlink" title="交互式运行"></a>交互式运行</h4><p>交互式编程不需要创建脚本文件，是通过Python解释器的交互模式编写代码。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/10.png"></p>
<h4 id="脚本式运行"><a href="#脚本式运行" class="headerlink" title="脚本式运行"></a>脚本式运行</h4><p>脚本模式里的代码可以在各种Python编译器或者集成开发环境上运行。例如Python自带的IDLE、Atom、Visual Studio、Pycharm和Anaconda等。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/11.png"></p>
<h3 id="Python编码规范"><a href="#Python编码规范" class="headerlink" title="Python编码规范"></a>Python编码规范</h3><ul>
<li>编码规范是使用Python编写代码时应遵守的命名规则、代码缩进、代码和语句分割方式等。良好的编码规范<br>有助于提高代码的可读性，便于代码的维护和修改。</li>
<li>例如分号、圆括号、空行和空格的使用规范建议如下:</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/12.png"></p>
<h4 id="Python编码规范-标识符命名"><a href="#Python编码规范-标识符命名" class="headerlink" title="Python编码规范-标识符命名"></a>Python编码规范-标识符命名</h4><ul>
<li>Python标识符用于表示常量、变量、函数以及其他对象的名称。</li>
<li>标识符通常由字母、数字和下划线组成，但不能以数字开头。标识符大小写敏感，不允许重名。如果标识符不符合规则，编译器运行代码时会输出SyntaxError语法错误。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/13.png"></p>
<h4 id="Python编码规范-代码缩进"><a href="#Python编码规范-代码缩进" class="headerlink" title="Python编码规范-代码缩进"></a>Python编码规范-代码缩进</h4><ul>
<li>在Python程序中，代码缩进代表代码块的作用域。如果一个代码块包含两个或更多的语句，则这些语句必须具有相同的缩进量。对于Python而言代码缩进是一种语法规则，它使用代码缩进和冒号来区分代码之间的层次。</li>
<li>编写代码时候，建议使用4个空格来生成缩进。如果程序代码中使用了错误的缩进，则会在运行中发出IndentationError错误信息。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/14.png"></p>
<h4 id="Python编码规范-使用注释"><a href="#Python编码规范-使用注释" class="headerlink" title="Python编码规范-使用注释"></a>Python编码规范-使用注释</h4><ul>
<li>注释就是在程序中添加解释说明，能够增强程序的可读性。在Python程序中，注释分为单行注释和多行注释。</li>
<li>单行注释以#字符开始直到行尾结束。</li>
<li>多行注释内容可以包含多行，这些内容包含在一对三引号内(“…””或者”””…”””)。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/15.png"></p>
<h4 id="Python编码规范–源码文件结构"><a href="#Python编码规范–源码文件结构" class="headerlink" title="Python编码规范–源码文件结构"></a>Python编码规范–源码文件结构</h4><ul>
<li>一个完整的Python源码文件一般包含几个组成部分︰解释器和编码格式声明、文档字符串、模块导入和运行代码。</li>
<li>如果会在程序中调用标准库或其他第三方库的类时，需要先使用import或from…. import语句导入相关的模块。导入语句始终在文件的顶部。在模块注释或文档字符串(docstring)之后。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/16.png"></p>
<h3 id="Python的函数与模块"><a href="#Python的函数与模块" class="headerlink" title="Python的函数与模块"></a>Python的函数与模块</h3><ul>
<li>函数(Function)是组织好的、可重复使用的一段代码。它能够提高程序的模块化程度和代码利用率。函数使用关键字def定义。</li>
<li>模块(Module)是一个保存好的Python文件。模块可以由函数或者类组成。模块和常规Python程序之间的唯一区别是用途不同:模块用于被其他程序调用。因此，模块通常没有main函数。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/17.png"></p>
<h3 id="Python的类与方法"><a href="#Python的类与方法" class="headerlink" title="Python的类与方法"></a>Python的类与方法</h3><ul>
<li>类(Class)是用来描述具有一类相同的属性和方法的集合。类的定义使用关键字class。</li>
<li>被实例化的类的”函数”被称作方法(Method)。类定义方法时候必须携带 self 关键字，它表示类的实例本身。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/18.png"></p>
<h3 id="telnetlib介绍"><a href="#telnetlib介绍" class="headerlink" title="telnetlib介绍"></a>telnetlib介绍</h3><p>telnetlib是Python标准库中的模块。它提供了实现Telnet功能的类telnetlib.Telnet。这里通过调用telnetlib.Telnet类里的不同方法实现不同功能。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/19.png"></p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/20.png"></p>
<h3 id="案例-使用telnetlib登陆设备"><a href="#案例-使用telnetlib登陆设备" class="headerlink" title="案例:使用telnetlib登陆设备"></a>案例:使用telnetlib登陆设备</h3><h4 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h4><ul>
<li>现有一台网络设备作为Telnet服务器，需要实现使用Python telnetlib作为Telnet客户端登录此设备。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/21.png"></p>
<p>实现过程分为四个步骤:</p>
<ul>
<li><p>配置设备Telnet服务。</p>
</li>
<li><p>手动验证和查看Telnet登录步骤，作为代码实现的参考。</p>
</li>
<li><p>编写和运行Python代码。</p>
</li>
<li><p>验证结果。</p>
</li>
</ul>
<h4 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h4><h5 id="配置设备Telnet"><a href="#配置设备Telnet" class="headerlink" title="配置设备Telnet"></a>配置设备Telnet</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/22.png"></p>
<h5 id="查看Telent登录步骤"><a href="#查看Telent登录步骤" class="headerlink" title="查看Telent登录步骤"></a>查看Telent登录步骤</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/23.png"></p>
<h5 id="编写Python代码"><a href="#编写Python代码" class="headerlink" title="编写Python代码"></a>编写Python代码</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/24.png"></p>
<h5 id="运行结果对比"><a href="#运行结果对比" class="headerlink" title="运行结果对比"></a>运行结果对比</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/25.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">65</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">67</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
