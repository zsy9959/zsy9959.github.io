<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="my blog">
<meta property="og:type" content="website">
<meta property="og:title" content="zsy&#39;s blog">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="my blog">
<meta property="og:locale">
<meta property="article:author" content="张思宇">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/page/3/"/>





  <title>zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/" itemprop="url">IP-企业数通解决方案概述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-18T21:17:38+08:00">
                2021-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•1946年，第一台电子计算机的发明，为人类打开的信息化时代的大门，也为信息通信技术的发展奠定了基础。</p>
<p>•日新月异的信息通信技术，不断地改变着人们的生活方式，在过去的几年，以物联网、大数据、云计算、人工智能为代表的新一代ICT技术逐渐成为驱动社会和经济转型升级的重要引擎，渗透到各行各业中。</p>
<p>•数通网络是实现数据交互的基础设施，是打造数字世界的基石，新的ICT技术导致数据流量以及存储爆发式的增长，也为数通网络带来了更大的挑战，为应对挑战，各大厂商不断优化网络解决方案，以匹配数字化转型诉求。</p>
<p>•企业网络从应用领域可分为园区、WLAN、数据中心、广域等多个领域，本课程将从解决方案角度分别介绍数通网络在各领域的分类、架构、典型应用场景、趋势挑战以及华为在该领域的解决方案。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述数通网络在在数字世界中的功能及作用。</p>
<p>▫描述数通网络解决方案的场景分类以及基本概念。</p>
<p>▫描述华为园区网络、WLAN、数据中心网络以及广域网络解决方案。</p>
<h1 id="1-企业数通网络全景概览"><a href="#1-企业数通网络全景概览" class="headerlink" title="1.企业数通网络全景概览"></a>1.企业数通网络全景概览</h1><h2 id="万物互联，构造数字化世界"><a href="#万物互联，构造数字化世界" class="headerlink" title="万物互联，构造数字化世界"></a>万物互联，构造数字化世界</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/1.png"></p>
<h2 id="数通网络是“万物”-联结的管道"><a href="#数通网络是“万物”-联结的管道" class="headerlink" title="数通网络是“万物” 联结的管道"></a>数通网络是“万物” 联结的管道</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/2.png"></p>
<h2 id="数通网络如“河湖江海”，打造智能世界数字基石"><a href="#数通网络如“河湖江海”，打造智能世界数字基石" class="headerlink" title="数通网络如“河湖江海”，打造智能世界数字基石"></a>数通网络如“河湖江海”，打造智能世界数字基石</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/3.png"></p>
<blockquote>
<p>•数通网络如“河湖江海”，数通产业便是打造智能世界的数字基石。很多数通初学者对于数通的了解可能并不全面，通过与现实世界中的“河湖江海”类比，可以感受数通产业之光，责任之重。 </p>
<ul>
<li><p>数通是联结领域真正成网的产业，部署在网络的各个层级，犹如江河湖海；</p>
</li>
<li><p>5G接入和家宽接入犹如支流，园区网络好比池塘；</p>
</li>
<li><p>城域网好比长江的大型支流，如金沙江；骨干网好比长江；</p>
</li>
<li><p>核心数据中心是太平洋，区域数据中心是大型湖泊，如鄱阳湖，接入数据中心是水库；</p>
</li>
<li><p>华为在园区网络、广域及分支网络、数据中心网络及网络安全都在为客户提供优质服务，华为数通4大引擎，AirEngine是园区网络解决方案，NetEngine是城域和骨干网络解决方案，CloudEngine是DCN解决方案，HisecEngine是安全解决方案。</p>
</li>
</ul>
</blockquote>
<h2 id="河流分支：园区网络"><a href="#河流分支：园区网络" class="headerlink" title="河流分支：园区网络"></a>河流分支：园区网络</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/4.png"></p>
<h2 id="河流分支2：WLAN网络"><a href="#河流分支2：WLAN网络" class="headerlink" title="河流分支2：WLAN网络"></a>河流分支2：WLAN网络</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/5.png"></p>
<h2 id="湖海：数据中心网络"><a href="#湖海：数据中心网络" class="headerlink" title="湖海：数据中心网络"></a>湖海：数据中心网络</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/6.png"></p>
<h2 id="江流主干：广域网络"><a href="#江流主干：广域网络" class="headerlink" title="江流主干：广域网络"></a>江流主干：广域网络</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/7.png"></p>
<h2 id="华为四大引擎构建数通网络"><a href="#华为四大引擎构建数通网络" class="headerlink" title="华为四大引擎构建数通网络"></a>华为四大引擎构建数通网络</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/8.png"></p>
<h2 id="华为企业数通解决方案概览"><a href="#华为企业数通解决方案概览" class="headerlink" title="华为企业数通解决方案概览"></a>华为企业数通解决方案概览</h2><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/9.png"></p>
<h1 id="2-企业数通网络解决方案"><a href="#2-企业数通网络解决方案" class="headerlink" title="2.企业数通网络解决方案"></a>2.企业数通网络解决方案</h1><h2 id="园区网"><a href="#园区网" class="headerlink" title="园区网"></a>园区网</h2><h3 id="园区网络分类"><a href="#园区网络分类" class="headerlink" title="园区网络分类"></a>园区网络分类</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/10.png"></p>
<h3 id="典型园区网络应用：高教园区网"><a href="#典型园区网络应用：高教园区网" class="headerlink" title="典型园区网络应用：高教园区网"></a>典型园区网络应用：高教园区网</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/11.png"></p>
<blockquote>
<p>•<strong>Cernet</strong>一般指中国教育和科研计算机网。中国教育和科研计算机网（China Education and Research Network）简称CERNET，是由国家投资建设，教育部负责管理，清华大学等高等学校承担建设和管理运行的全国性学术计算机互联网络。</p>
</blockquote>
<h3 id="数字化时代，园区网络的特征"><a href="#数字化时代，园区网络的特征" class="headerlink" title="数字化时代，园区网络的特征"></a>数字化时代，园区网络的特征</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/12.png"></p>
<h3 id="园区网络运维面临的挑战"><a href="#园区网络运维面临的挑战" class="headerlink" title="园区网络运维面临的挑战"></a>园区网络运维面临的挑战</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/13.png"></p>
<h3 id="华为园区网络一站式自动驾驶解决方案"><a href="#华为园区网络一站式自动驾驶解决方案" class="headerlink" title="华为园区网络一站式自动驾驶解决方案"></a>华为园区网络一站式自动驾驶解决方案</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/14.png"></p>
<blockquote>
<p>•华为智简园区（CloudCampus）致力于为企业构建一张超宽、智慧、极简、安全、开放的基于业务意图的园区网络，时刻洞察并快速响应网络及业务需求，赋予企业捕捉转瞬即逝的商机能力。</p>
<p>•CloudCampus解决方案是园区网络一站式自动驾驶解决方案。</p>
</blockquote>
<h3 id="解决方案组件1：智简园区网络硬件产品全景"><a href="#解决方案组件1：智简园区网络硬件产品全景" class="headerlink" title="解决方案组件1：智简园区网络硬件产品全景"></a>解决方案组件1：智简园区网络硬件产品全景</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/15.png"> </p>
<h3 id="解决方案组件2：iMaster-NCE-Campus"><a href="#解决方案组件2：iMaster-NCE-Campus" class="headerlink" title="解决方案组件2：iMaster NCE-Campus"></a>解决方案组件2：iMaster NCE-Campus</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/16.png"></p>
<h3 id="解决方案组件3：iMaster-NCE-CampusInsight"><a href="#解决方案组件3：iMaster-NCE-CampusInsight" class="headerlink" title="解决方案组件3：iMaster NCE-CampusInsight"></a>解决方案组件3：iMaster NCE-CampusInsight</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/17.png"></p>
<h2 id="WLAN"><a href="#WLAN" class="headerlink" title="WLAN"></a>WLAN</h2><h3 id="WLAN场景分类"><a href="#WLAN场景分类" class="headerlink" title="WLAN场景分类"></a>WLAN场景分类</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/18.png"></p>
<h3 id="典型WLAN组网场景：大型园区（独立WAC）"><a href="#典型WLAN组网场景：大型园区（独立WAC）" class="headerlink" title="典型WLAN组网场景：大型园区（独立WAC）"></a>典型WLAN组网场景：大型园区（独立WAC）</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/19.png"></p>
<h3 id="典型WLAN组网场景：大型园区（有线无线融合）"><a href="#典型WLAN组网场景：大型园区（有线无线融合）" class="headerlink" title="典型WLAN组网场景：大型园区（有线无线融合）"></a>典型WLAN组网场景：大型园区（有线无线融合）</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/20.png"></p>
<h3 id="典型WLAN组网场景：连锁商超"><a href="#典型WLAN组网场景：连锁商超" class="headerlink" title="典型WLAN组网场景：连锁商超"></a>典型WLAN组网场景：连锁商超</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/21.png"></p>
<h3 id="双轮驱动：技术与应用发展助推Wi-Fi-6时代到来"><a href="#双轮驱动：技术与应用发展助推Wi-Fi-6时代到来" class="headerlink" title="双轮驱动：技术与应用发展助推Wi-Fi 6时代到来"></a>双轮驱动：技术与应用发展助推Wi-Fi 6时代到来</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/22.png"></p>
<h3 id="Wi-Fi-6带来更高性能"><a href="#Wi-Fi-6带来更高性能" class="headerlink" title="Wi-Fi 6带来更高性能"></a>Wi-Fi 6带来更高性能</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/23.png"></p>
<h3 id="WLAN运维挑战-三“难”"><a href="#WLAN运维挑战-三“难”" class="headerlink" title="WLAN运维挑战 三“难”"></a>WLAN运维挑战 三“难”</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/24.png"></p>
<h3 id="解决方案组件1-AirEngine-Wi-Fi-6多元化新产品"><a href="#解决方案组件1-AirEngine-Wi-Fi-6多元化新产品" class="headerlink" title="解决方案组件1: AirEngine Wi-Fi 6多元化新产品"></a>解决方案组件1: AirEngine Wi-Fi 6多元化新产品</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/25.png"></p>
<h3 id="解决方案组件2-iMaster-NCE-CampusInsight"><a href="#解决方案组件2-iMaster-NCE-CampusInsight" class="headerlink" title="解决方案组件2: iMaster NCE CampusInsight"></a>解决方案组件2: iMaster NCE CampusInsight</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/26.png"></p>
<h2 id="数据中心网络"><a href="#数据中心网络" class="headerlink" title="数据中心网络"></a>数据中心网络</h2><h3 id="什么是数据中心？"><a href="#什么是数据中心？" class="headerlink" title="什么是数据中心？"></a>什么是数据中心？</h3><p>•数据中心(Data Center)：是一整套包括机房在内复杂的设施。它不仅包括计算机系统和其它与之配套的设备（例如通信和存储系统），还包含冗余的数据通信连接、环境控制设备、监控设备以及各种安全装置。</p>
<p>•数据中心的使用分层架构。一般L1特指数据中心基础设施，L2指数据中心的ICT设备。</p>
<p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/27.png"></p>
<h3 id="数据中心有什么？"><a href="#数据中心有什么？" class="headerlink" title="数据中心有什么？"></a>数据中心有什么？</h3><p>数据中心设备简单分为三类：计算设备、存储设备和网络设备（不包括数据中心基础设施）。</p>
<p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/28.png"></p>
<h3 id="一个典型的数据中心组网"><a href="#一个典型的数据中心组网" class="headerlink" title="一个典型的数据中心组网"></a>一个典型的数据中心组网</h3><p>一个典型的数据中心组网包括，数据中心网络、存储区域网络（Storage Area Network，SAN）、服务器。</p>
<p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/29.png"></p>
<blockquote>
<p>•数据中心网络：提供数据中心内部计算单元之间互联、数据中心内部计算单元和外部出口之间互联的网络。</p>
<p>•存储区域网络：一般是由存储阵列和光纤交换机组成的存储网络，用于提供块存储（Block Storage）。存储网络使用FC协议的叫做FC SAN，使用IP协议的叫做IP SAN。</p>
<p>•分布式存储：分布式存储的部署形态和阵列不同。它将数据分散存储在多台独立的服务器（存储节点）上。一般也用作云存储。</p>
<p>•服务器（计算节点）：用于提供计算服务的服务器。</p>
</blockquote>
<h3 id="数据中心网络-1"><a href="#数据中心网络-1" class="headerlink" title="数据中心网络"></a>数据中心网络</h3><p>DCN是提供数据中心内部互联，和数据中心内部和外部出口互联的网络。</p>
<p>DCN通常由一系列网络设备组成，根据业务功能分为不同区域。</p>
<p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/30.png"></p>
<blockquote>
<p>•数据中心网络没有固定的区域划分，不同行业不同企业划分方式。例如有某金融数据中心，将数据中心根据功能划分为生产区1区、生产2区、测试区1区、测试2区、大数据区、运营管理区…</p>
<p>•本例中：</p>
<p>​    ▫互联网接入区：用于接入来自用户Internet访问的流量。</p>
<p>​    ▫园区网接入区：用于接入企业园区用户访问的流量。</p>
<p>​    ▫广域网接入区：用于连接企业自建广域网，远端有例如其他城市的数据中心和园区等。</p>
<p>​    ▫生产环境区：用于联通生产环境的网络。</p>
<p>​    ▫测试环境区：用于联通测试环境的网络。</p>
</blockquote>
<h3 id="数据中心网络，SDN和AI应用创新，带来3代演进"><a href="#数据中心网络，SDN和AI应用创新，带来3代演进" class="headerlink" title="数据中心网络，SDN和AI应用创新，带来3代演进"></a>数据中心网络，SDN和AI应用创新，带来3代演进</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/31.png"></p>
<blockquote>
<p>•AI时代的典型特征是关注数据，挖掘数据价值并提升AI运行效率，因此AI对数据中心网络的核心诉求是要快，即低时延。</p>
</blockquote>
<h3 id="新业务特征对数据中心网络提出新挑战"><a href="#新业务特征对数据中心网络提出新挑战" class="headerlink" title="新业务特征对数据中心网络提出新挑战"></a>新业务特征对数据中心网络提出新挑战</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/32.png"></p>
<h3 id="华为CloudFabric数据中心网络解决方案"><a href="#华为CloudFabric数据中心网络解决方案" class="headerlink" title="华为CloudFabric数据中心网络解决方案"></a>华为CloudFabric数据中心网络解决方案</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/33.png"></p>
<h3 id="华为智能无损数据中心网络"><a href="#华为智能无损数据中心网络" class="headerlink" title="华为智能无损数据中心网络"></a>华为智能无损数据中心网络</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/34.png"></p>
<blockquote>
<p>•RDMA是Remote Direct Memory Access的缩写，通俗的说可以看成是远程的DMA技术，为了解决网络传输中服务器端数据处理的延迟而产生的。RDMA允许用户态的应用程序直接读取或写入远程内存，而无内核干预和内存拷贝发生。起初，只应用在高性能计算领域，最近，由于在大规模分布式系统和数据中心中网络瓶颈越来越突出，逐渐走进越来越多人的视野。</p>
<p>•InfiniBand：一种交换结构I/O（Input/Output）技术，其设计思路是通过一套中心机构(中心InfiniBand交换机)在远程存贮器、网络以及服务器等设备之间建立一个单一的连接链路，并由中心InfiniBand交换机来指挥流量，它的结构设计得非常紧密，大大提高了系统的性能、可靠性和有效性，能缓解各硬件设备之间的数据流量拥塞。</p>
<p>•RoCE：Remote Direct Memory Access over Converged Ethernet。 RoCE是一种网络协议，允许通过以太网使用远程直接内存访问（RDMA）。目前存在两个RoCE版本，分别是RoCE v1和v2。RoCE v1是数据链路层协议，允许在同一个以太网广播域内的任意两台主机之间通信。RoCE v2是网络层协议，其报文可以被路由。</p>
</blockquote>
<h3 id="解决方案组件1：华为数据中心交换机"><a href="#解决方案组件1：华为数据中心交换机" class="headerlink" title="解决方案组件1：华为数据中心交换机"></a>解决方案组件1：华为数据中心交换机</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/35.png"></p>
<h3 id="解决方案组件2：iMaster-NCE-Fabric"><a href="#解决方案组件2：iMaster-NCE-Fabric" class="headerlink" title="解决方案组件2：iMaster NCE-Fabric"></a>解决方案组件2：iMaster NCE-Fabric</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/36.png"></p>
<h3 id="解决方案组件3：FabricInsight"><a href="#解决方案组件3：FabricInsight" class="headerlink" title="解决方案组件3：FabricInsight"></a>解决方案组件3：FabricInsight</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/37.png"></p>
<h2 id="SDN-WAN"><a href="#SDN-WAN" class="headerlink" title="SDN-WAN"></a>SDN-WAN</h2><h3 id="从智慧城市通信网络看广域网络"><a href="#从智慧城市通信网络看广域网络" class="headerlink" title="从智慧城市通信网络看广域网络"></a>从智慧城市通信网络看广域网络</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/38.png"></p>
<h3 id="广域IP承载网络与企业WAN"><a href="#广域IP承载网络与企业WAN" class="headerlink" title="广域IP承载网络与企业WAN"></a>广域IP承载网络与企业WAN</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/39.png"></p>
<h3 id="传统IP广域承载网络"><a href="#传统IP广域承载网络" class="headerlink" title="传统IP广域承载网络"></a>传统IP广域承载网络</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/40.png"></p>
<p>•WAN（Wide Area Network）即广域网络，是连接不同地区局域网或城域网计算机通信的远距离通信网。</p>
<p>•从空间上来讲，广域网络大多数情况下是跨区域的，其承载网络建设难度大，成本高，周期长。</p>
<p>•业务部署效率、网络拥塞，时延等，是广域承载网络需要考虑的重要因素。</p>
<h3 id="传统IP广域承载网络面临的挑战"><a href="#传统IP广域承载网络面临的挑战" class="headerlink" title="传统IP广域承载网络面临的挑战"></a>传统IP广域承载网络面临的挑战</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/41.png"></p>
<h3 id="华为IP广域承载网络解决方案"><a href="#华为IP广域承载网络解决方案" class="headerlink" title="华为IP广域承载网络解决方案"></a>华为IP广域承载网络解决方案</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/42.png"></p>
<h3 id="SDN-WAN方案典型应用场景：金融"><a href="#SDN-WAN方案典型应用场景：金融" class="headerlink" title="SDN-WAN方案典型应用场景：金融"></a>SDN-WAN方案典型应用场景：金融</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/43.png"></p>
<h3 id="SDN-WAN方案典型应用场景：电子政务"><a href="#SDN-WAN方案典型应用场景：电子政务" class="headerlink" title="SDN-WAN方案典型应用场景：电子政务"></a>SDN-WAN方案典型应用场景：电子政务</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/44.png"></p>
<h3 id="解决方案组件1：NetEngine-8000"><a href="#解决方案组件1：NetEngine-8000" class="headerlink" title="解决方案组件1：NetEngine 8000"></a>解决方案组件1：NetEngine 8000</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/45.png"></p>
<h3 id="解决方案组件2：iMaster-NCE-IP"><a href="#解决方案组件2：iMaster-NCE-IP" class="headerlink" title="解决方案组件2：iMaster NCE-IP"></a>解决方案组件2：iMaster NCE-IP</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/46.png"></p>
<h2 id="SD-WAN"><a href="#SD-WAN" class="headerlink" title="SD-WAN"></a>SD-WAN</h2><h3 id="传统企业WAN简介"><a href="#传统企业WAN简介" class="headerlink" title="传统企业WAN简介"></a>传统企业WAN简介</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/47.png"></p>
<blockquote>
<p>•WAN（Wide Area Network）即广域网络，一般由运营商提供，是连接不同地区局域网或城域网计算机通信的远距离通信网。WAN所覆盖的范围从几十千米到几万千米，能连接多个不同的地区、城市和国家，提供远距离通信。正是因为通过WAN，企业可以将全球范围内的分支机构连接起来建立互联网络，进而互联互通开展企业的各项日常业务。</p>
<p>•传统企业WAN一般有两种互联方式：</p>
<p>​    ▫企业可以自己铺设或租用运营商光纤线路搭建互联网络。</p>
<p>​    ▫企业可以通过租用运营商的传输或数据网络来实现互联网络。</p>
<p>•一般来说，只有那些财力雄厚、实力超强的企业才使用第一种方式，绝大多数企业都会采用第二种方式，即租用运营商提供的线路或网络来搭建自己的WAN。另外，随着Internet的高速发展，通过Internet实现分支互联也成为一种可能。但是考虑到Internet的不可靠性并缺少端到端的质量保证，一般情况下大型企业不会完全依赖Internet来构建WAN，实现多地分支的互联。Internet更多的时候会作为出差员工远程接入的方式，或者作为分支互联的备份方案，只承担一些非关键业务。</p>
<p>•企业WAN借助运营商提供的WAN网络，将企业分布在跨地域的多个分支、总部和数据中心实现互联。传统企业的关键应用和信息数据一般都存储在企业内部，WAN带宽需求较小、业务变化不频繁；WAN网络的运营和维护也一般依靠本地化的运维团队。这种传统企业WAN技术架构在相当长的时间，为企业的分支互联互通发挥了重要的作用，比较好地满足了企业用户的业务需要。</p>
</blockquote>
<h3 id="传统企业WAN面临挑战"><a href="#传统企业WAN面临挑战" class="headerlink" title="传统企业WAN面临挑战"></a>传统企业WAN面临挑战</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/48.png"></p>
<h3 id="企业WAN相关技术的发展趋势"><a href="#企业WAN相关技术的发展趋势" class="headerlink" title="企业WAN相关技术的发展趋势"></a>企业WAN相关技术的发展趋势</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/49.png"></p>
<h3 id="华为智简SD-WAN，加速企业业务云化转型"><a href="#华为智简SD-WAN，加速企业业务云化转型" class="headerlink" title="华为智简SD-WAN，加速企业业务云化转型"></a>华为智简SD-WAN，加速企业业务云化转型</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/50.png"></p>
<h3 id="SD-WAN方案总体架构"><a href="#SD-WAN方案总体架构" class="headerlink" title="SD-WAN方案总体架构"></a>SD-WAN方案总体架构</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/51.png"></p>
<h3 id="基于SD-WAN思想的EVPN互联方案"><a href="#基于SD-WAN思想的EVPN互联方案" class="headerlink" title="基于SD-WAN思想的EVPN互联方案"></a>基于SD-WAN思想的EVPN互联方案</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/52.png"></p>
<h3 id="解决方案组件1：全系列NetEngine-AR"><a href="#解决方案组件1：全系列NetEngine-AR" class="headerlink" title="解决方案组件1：全系列NetEngine AR"></a>解决方案组件1：全系列NetEngine AR</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/53.png"></p>
<h3 id="解决方案组件2：iMaster-NCE-WAN"><a href="#解决方案组件2：iMaster-NCE-WAN" class="headerlink" title="解决方案组件2：iMaster NCE-WAN"></a>解决方案组件2：iMaster NCE-WAN</h3><p><img src="/2021/05/18/IP-%E4%BC%81%E4%B8%9A%E6%95%B0%E9%80%9A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0/54.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）以下哪个名称对应华为在WLAN领域的产品：</p>
<p><strong>A.AirEngine</strong></p>
<p>B.NetEngine</p>
<p>C.CloudEngine</p>
<p>D.HiSecEngine</p>
<p>2.（问答题）华为CloudCampus解决方案支持业务随行功能，该功能对于用户的价值是？</p>
<p><strong>业务随行：图形化策略配置，用户随时随地接入，漫游权限不变，体验不变。</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•本课程系统地向读者介绍了数字世界中的数据通信网络全景。</p>
<p>•通过本课程的学习，读者了解了园区网络、WLAN、数据中心网络及广域网络的概念及其重要意义。也了解了典型行业中，上述网络的基本架构及应用。</p>
<p>•通过本课程的学习，读者还系统地了解了华为企业数通解决方案，包括园区网络解决方案、WLAN解决方案、数据中心网络解决方案、广域IP承载网络解决方案和SD-WAN解决方案。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/" itemprop="url">IP-大型WLAN组网介绍与部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-18T20:37:03+08:00">
                2021-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•目前，大多数企业办公环境同时使用有线和无线网络来支撑业务。办公区在提供有线网口的同时，也采用全Wi-Fi覆盖，办公环境更为开放和智能。未来，企业云桌面办公、智真会议、4K视频等大带宽业务将从有线网络迁移至无线网络，而VR/AR、虚拟助手、自动化工厂等新技术将直接基于无线网络部署。新的应用场景对企业WLAN的设计与规划提出更高的要求。</p>
<p>•本课程介绍大型WLAN组网的典型应用、关键技术原理以及大型WLAN组网的配置。</p>
<blockquote>
<p>•云桌面又称桌面虚拟化、云电脑，是替代传统电脑的一种新模式；采用云桌面后，用户无需再购买电脑主机，用户安装客户端后通过特有的通信协议访问后端服务器上的虚拟机主机来实现交互式操作，达到与电脑一致的体验效果；同时，云桌面不仅支持用于替换传统电脑，还支持手机、平板等其他智能设备在互联网上访问，也是移动办公的最新解决方案。</p>
<p>•智真会议是通过高分辨率摄像头和语音设备，提供真人大小面对面、眼对眼的视频会议。</p>
<p>•VR：Virtual Reality，虚拟现实，指用计算机模拟三维环境，用户常常借助手套和眼镜就能直接交互操作。</p>
<p>•AR：Augmented Reality，增强现实，在虚拟现实的基础上发展起来的新技术，也被称为混合现实。是通过计算机系统提供的信息增加用户对现实世界感知的技术，将虚拟的信息应用到真实世界，并将计算机生成的虚拟物体、场景或系统提示信息叠加到真实场景中，从而实现对现实的增强。AR通常是以透过式头盔显示系统和注册（AR系统中用户观察点和计算机生成的虚拟物体的定位）系统相结合的形式来实现的。</p>
</blockquote>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫阐述大型WLAN典型组网架构与特点</p>
<p>▫阐述大型WLAN的关键技术</p>
<p>▫实现大型WLAN的组网配置</p>
<h1 id="1-大型WLAN组网概述"><a href="#1-大型WLAN组网概述" class="headerlink" title="1.大型WLAN组网概述"></a>1.大型WLAN组网概述</h1><h2 id="大型WLAN组网的应用"><a href="#大型WLAN组网的应用" class="headerlink" title="大型WLAN组网的应用"></a>大型WLAN组网的应用</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/1.png"></p>
<blockquote>
<p>•高新科技园区会使用大量的新兴技术，比如IoT、5G融合、自动驾驶等等技术。</p>
</blockquote>
<h2 id="大型WLAN组网特点"><a href="#大型WLAN组网特点" class="headerlink" title="大型WLAN组网特点"></a>大型WLAN组网特点</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/2.png"></p>
<h2 id="华为大型WLAN方案功能"><a href="#华为大型WLAN方案功能" class="headerlink" title="华为大型WLAN方案功能"></a>华为大型WLAN方案功能</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/3.png"></p>
<h2 id="WLAN网络解决方案"><a href="#WLAN网络解决方案" class="headerlink" title="WLAN网络解决方案"></a>WLAN网络解决方案</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/4.png"></p>
<h2 id="大型WLAN网络关键技术"><a href="#大型WLAN网络关键技术" class="headerlink" title="大型WLAN网络关键技术"></a>大型WLAN网络关键技术</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/5.png"></p>
<h1 id="2-VLAN-Pool"><a href="#2-VLAN-Pool" class="headerlink" title="2.VLAN Pool"></a>2.<strong>VLAN Pool</strong></h1><h2 id="VLAN-Pool-概念"><a href="#VLAN-Pool-概念" class="headerlink" title="VLAN Pool 概念"></a>VLAN Pool 概念</h2><p>•现有网络面临的挑战</p>
<ul>
<li><p>无线网络终端的移动性导致特定区域IP地址请求较多。</p>
</li>
<li><p>通过情况下，一个SSID只能对应一个业务VLAN，如果通过扩大子网增加IP地址则会导致广播域扩大，大量的广播报文造成网络拥塞。</p>
</li>
</ul>
<p>•VLAN Pool是一种把多个VLAN放在一个池中并提供分配算法的VLAN分配技术，又称为VLAN池。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/6.png"></p>
<blockquote>
<p>•通过VLAN Pool把接入的用户分配到不同的VLAN，可以减少广播域，减少网络中的广播报文，提升网络性能。</p>
<p>•由于无线终端的移动性，在无线网络中经常有大量用户从某个区域接入后，随着用的移动，再漫游到其他区域，导致该区域的用户接入多，对IP地址数目要求大。比如：场馆入口、酒店的大堂等。目前一个SSID只能对应一个VLAN，一个VLAN对应一个子网，如果大量用户从某一区域接入，只能扩大VLAN的子网，保证用户能够获取到IP地址。这样带来的问题就是广播域扩大，导致大量的广播报文（如：ARP、DHCP等）带来严重的网络拥塞。</p>
<p>•基于此问题考虑，一个SSID需要能够对应多个VLAN，把大量用户分散到不同的VLAN减少广播域。VLAN Pool提供多个VLAN的管理和分配算法，实现SSID对应多个VLAN的方案。</p>
</blockquote>
<h2 id="VLAN-Pool分配VLAN的算法"><a href="#VLAN-Pool分配VLAN的算法" class="headerlink" title="VLAN Pool分配VLAN的算法"></a>VLAN Pool分配VLAN的算法</h2><p>•顺序分配算法：把用户按上线顺序依次划分到不同的VLAN中。</p>
<p>•HASH分配算法：根据用户MAC地址HASH值分配VLAN。</p>
<p>•两种分配方式的比较：</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/7.png"></p>
<blockquote>
<p>•顺序分配算法：把用户按上线顺序依次划分到不同的VLAN中，用户上下线用户VLAN容易变化，IP地址变更。</p>
<p>•HASH分配算法：根据用户MAC地址HASH值分配VLAN，用户分配的VLAN固定，可能导致VLAN间用户划分不均匀，有的VLAN用户较多，有的较少。</p>
</blockquote>
<h2 id="分配VLAN流程"><a href="#分配VLAN流程" class="headerlink" title="分配VLAN流程"></a>分配VLAN流程</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/8.png"></p>
<p>1.用户终端从某个VAP接入，判断VAP是否有判断VLAN Pool。</p>
<p>2.如果该VAP对应的模板绑定了VLAN Pool，使用VLAN Pool的分配算法分配一个VLAN, VLAN Pool有顺序分配和hash分配两种分配算法。</p>
<p>3.给终端分配一个VLAN。</p>
<p>4.终端从VLAN Pool分配的VLAN上线。</p>
<blockquote>
<p>•虚拟接入点VAP（Virtual Access Point）：VAP就是在一个物理实体AP上虚拟出多个AP，每一个被虚拟出的AP就是一个VAP，每个VAP提供和物理实体AP一样的功能。用户可以在一个AP上创建不同的VAP来为不同的用户群体提供无线接入服务。</p>
</blockquote>
<h2 id="VLAN-Pool应用示例"><a href="#VLAN-Pool应用示例" class="headerlink" title="VLAN Pool应用示例"></a>VLAN Pool应用示例</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/9.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/10.png"></p>
<h2 id="配置介绍"><a href="#配置介绍" class="headerlink" title="配置介绍"></a>配置介绍</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/11.png"></p>
<blockquote>
<p>•VLAN pool中可以配置VLAN分配算法。assignment { even | hash }</p>
<ul>
<li><p>VLAN分配算法为even时，VLAN pool根据STA的上线顺序为STA分配业务VLAN，VLAN pool尽量保证所有VLAN分配给STA的IP地址数目相近。但同一个STA如果多次上线，每次获取的地址通常都不相同。</p>
</li>
<li><p>VLAN分配算法为hash时，VLAN pool根据STA的MAC地址进行哈希运算后的结果为STA分配业务VLAN，只要VLAN pool里面的VLAN不发生变化，通常STA都会获取到固定的业务VLAN，STA重新上线时也会被尽量优先分配到之前使用过的IP地址。</p>
</li>
</ul>
</blockquote>
<h2 id="配置案例"><a href="#配置案例" class="headerlink" title="配置案例"></a>配置案例</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/12.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/13.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/14.png"></p>
<h1 id="3-DHCP技术"><a href="#3-DHCP技术" class="headerlink" title="3.DHCP技术"></a>3.DHCP技术</h1><h2 id="DHCP中继"><a href="#DHCP中继" class="headerlink" title="DHCP中继"></a>DHCP中继</h2><p>•DHCP客户端使用IP广播来寻找同一网段上的DHCP服务器。当服务器和客户段处在不同网段，即被路由器分割开来时，路由器是不会转发这样的广播包。</p>
<p>•DHCP中继能够跨网段“透传”DHCP报文，使得一个DHCP服务器同时为多个网段服务成为可能。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/15.png"></p>
<blockquote>
<p>•随着网络规模的不断扩大，网络设备不断增多，企业内不同的用户可能分布在不同的网段，一台DHCP服务器在正常情况下无法满足多个网段的地址分配需求。企业内网各个网段通常都没有与DHCP Server在同一个二层广播域内，如果还需要通过DHCP服务器分配IP地址，则需要跨网段发送DHCP协议报文。</p>
</blockquote>
<h2 id="配置介绍-1"><a href="#配置介绍-1" class="headerlink" title="配置介绍"></a>配置介绍</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/16.png"></p>
<h2 id="配置案例-1"><a href="#配置案例-1" class="headerlink" title="配置案例 (1)"></a>配置案例 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/17.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/18.png"></p>
<h2 id="配置案例-2"><a href="#配置案例-2" class="headerlink" title="配置案例 (2)"></a>配置案例 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/19.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/20.png"></p>
<h2 id="配置案例-3"><a href="#配置案例-3" class="headerlink" title="配置案例 (3)"></a>配置案例 (3)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/21.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/22.png"></p>
<h2 id="配置案例-4"><a href="#配置案例-4" class="headerlink" title="配置案例 (4)"></a>配置案例 (4)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/23.png"></p>
<h2 id="WLAN三层组网AC发现机制"><a href="#WLAN三层组网AC发现机制" class="headerlink" title="WLAN三层组网AC发现机制"></a>WLAN三层组网AC发现机制</h2><p>当AC和AP间是三层组网时，AP通过发送广播请求报文的方式无法发现AC，这时需要通过DHCP服务器回应给AP的报文中携带的Option43字段（IPv4）或Option52（IPv6）来通告AC的IP地址。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/24.png"></p>
<blockquote>
<p>•在AC和AP间是二层组网的情况下，也可以配置Option43，AP会根据Option43的内容先向指定IP地址的AC发送单播请求报文，如果发送十次报文，AP都没有收到回应，则AP会继续以广播的方式来发现同一网段的AC。所以在二层组网的情况下Option 43不是必配的参数，但在三层组网的情况下则是必配的。</p>
<p>•Option 43即为Type值为43（0x2B）的Option字段，又称为厂商特定信息选项，DHCP服务器和DHCP客户端通过Option43交换厂商特定的信息。当DHCP服务器接收到请求Option43信息的DHCP请求报文后，将在回复报文中携带Option43，为DHCP客户端分配厂商指定的信息（本文中特指AC的IP地址）。</p>
</blockquote>
<h2 id="配置介绍-2"><a href="#配置介绍-2" class="headerlink" title="配置介绍"></a>配置介绍</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/25.png"></p>
<blockquote>
<p>•以AC或交换机配置DHCP服务器为例。大型组网中，通常都是使用独立的DHCP服务器，实际上AC或交换机也可以作为DHCP服务器。然后选择下面的一条命令配置Option43就可以了。</p>
<ul>
<li>option 43 sub-option 1 hex C0A80001C0A80002配置设备为AP指定AC的IP地址为192.168.0.1和192.168.0.2。其中，“C0A80001”表示IP地址192.168.0.1的十六进制格式，“C0A80002”表示IP地址192.168.0.2的十六进制格式。</li>
<li>option 43 sub-option 2 ip-address 192.168.0.1 192.168.0.2配置设备为AP指定AC的IP地址为192.168.0.1和192.168.0.2。</li>
<li>option 43 sub-option 3 ascii 192.168.0.1,192.168.0.2配置设备为AP指定AC的IP地址为192.168.0.1和192.168.0.2，选项使用ASCII字符串类型时，如果要配置多个IP地址，IP地址之间要使用“,”隔开。</li>
</ul>
</blockquote>
<h2 id="配置案例-1-1"><a href="#配置案例-1-1" class="headerlink" title="配置案例 (1)"></a>配置案例 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/26.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/27.png"></p>
<h2 id="配置案例-2-1"><a href="#配置案例-2-1" class="headerlink" title="配置案例 (2)"></a>配置案例 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/28.png"></p>
<h1 id="4-漫游技术"><a href="#4-漫游技术" class="headerlink" title="4.漫游技术"></a>4.漫游技术</h1><h2 id="WLAN漫游概述"><a href="#WLAN漫游概述" class="headerlink" title="WLAN漫游概述"></a>WLAN漫游概述</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/29.png"></p>
<p>•WLAN漫游是指STA在不同AP覆盖范围之间移动且保持用户业务不中断的行为。</p>
<p>•实现WLAN漫游的两个AP必须使用相同的SSID和安全模板（安全模板名称可以不同，但是安全模板下的配置必须相同），认证模板的认证方式和认证参数也要配置相同。</p>
<p>•WLAN漫游策略主要解决以下问题：</p>
<p>​    ▫避免漫游过程中的认证时间过长导致丢包甚至业务中断。</p>
<p>​    ▫保证用户授权信息不变。</p>
<p>​    ▫保证用户IP地址不变。</p>
<blockquote>
<p>•终端在移动过程中，终端在移动过程中， 如果逐渐远离接入AP，则链路的信号质量也会逐步下降。当终端感知到信号质量降低一定程度（漫游门限）时，终端会主动漫游到附近AP来提高信号质量。</p>
<p>•如图所示，漫游一般包括如下动作：</p>
<ul>
<li><p>终端已经与AP1建链，终端在各种信道中发送Probe Request。AP2在信道6（AP2使用的信道）中收到请求后，通过在信道6中发送应答来进行响应。终端收到应答后，对其进行评估，确定同哪个AP关联最合适。此时通过评估，终端与AP2关联最合适。</p>
</li>
<li><p>终端通过信道6向AP2发送关联请求，AP2使用关联响应做出应答，建立用户与AP2间的关联，至此，用户与AP1的关联一直保持。</p>
</li>
<li><p>删除用户与AP1现有的关联。终端通过信道1（AP1使用的信道）向AP1发送802.11解除关联信息，解除用户与AP1间的关联。</p>
</li>
</ul>
</blockquote>
<h2 id="WLAN漫游的相关术语"><a href="#WLAN漫游的相关术语" class="headerlink" title="WLAN漫游的相关术语"></a>WLAN漫游的相关术语</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/30.png"></p>
<blockquote>
<p>•AC内漫游：如果漫游过程中关联的是同一个AC，这次漫游就是AC内漫游。</p>
<p>•AC间漫游：如果漫游过程中关联的不是同一个AC，这次漫游就是AC间漫游。</p>
<p>•AC间隧道：为了支持AC间漫游，漫游组内的所有AC需要同步每个AC管理的STA和AP设备的信息，因此在AC间建立一条隧道作为数据同步和报文转发的通道。AC间隧道也是利用CAPWAP协议创建的。如图所示，AC1和AC2间建立AC间隧道进行数据同步和报文转发。</p>
<p>•漫游组服务器</p>
<ul>
<li><p>STA在AC间进行漫游，通过选定一个AC作为漫游组服务器，在该AC上维护漫游组的成员表，并下发到漫游组内的各AC，使漫游组内的各AC间相互识别并建立AC间隧道。</p>
</li>
<li><p>漫游组服务器既可以是漫游组外的AC，也可以是漫游组内选择的一个AC。</p>
</li>
<li><p>一个AC可以同时作为多个漫游组的漫游组服务器，但是自身只能加入一个漫游组。</p>
</li>
<li><p>漫游组服务器管理其他AC的同时不能被其他的漫游组服务器管理。也就是说如果一个AC是作为漫游组服务器角色负责向其他AC同步漫游配置的，则它无法再作为被管理者接受其他AC向其同步漫游配置（即配置了漫游组就不能再配置漫游组服务器）。</p>
</li>
<li><p>漫游组服务器作为一个集中配置点，不需要有特别强的数据转发能力，只需要能够和各个AC互通即可。</p>
</li>
</ul>
<p>•家乡代理</p>
<ul>
<li>能够和STA家乡网络的网关二层互通的一台设备。为了支持STA漫游后仍能正常访问家乡网络，需要将STA的业务报文通过隧道转发到家乡代理，再由家乡代理中转。STA的家乡代理由HAC或HAP兼任，如图所示，用户可以选取AC1或AP1作为STA的家乡代理。</li>
</ul>
</blockquote>
<h2 id="WLAN漫游类型"><a href="#WLAN漫游类型" class="headerlink" title="WLAN漫游类型"></a>WLAN漫游类型</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/31.png"></p>
<blockquote>
<p>•二层漫游：1个无线客户端在2个AP（或多个AP）之间来回切换连接无线，前提是这些AP都绑定的是同1个SSID并且业务VLAN都在同1个VLAN内（在同一个IP地址段），漫游切换的过程中，无线客户端的接入属性（比如无线客户端所属的业务VLAN、获取的IP地址等属性）不会有任何变化，直接平滑过渡，在漫游的过程中不会有丢包和断线重连的现象。</p>
<p>•三层漫游：漫游前后SSID的业务VLAN不同，AP所提供的业务网络为不同的三层网络，对应不同的网关。此时，为保持漫游用户IP地址不变的特性，需要将用户流量迂回到初始接入网段的AP，实现跨VLAN漫游。</p>
<p>•网络中有时候会出现以下情况：两个业务VLAN的VLAN ID相同，但是这两个子网又属于不同的子网。此时为了避免系统仅仅依据VLAN ID将用户在两个子网间的漫游误判为二层漫游，需要通过漫游域来确定设备是否在同一个子网内，只有当VLAN相同且漫游域也相同的时候才是二层漫游，否则是三层漫游。</p>
</blockquote>
<h2 id="WLAN漫游流量转发模型"><a href="#WLAN漫游流量转发模型" class="headerlink" title="WLAN漫游流量转发模型"></a>WLAN漫游流量转发模型</h2><p>根据WLAN数据转发类型以及跨三层与否，可将漫游流量转发模型划分为四种：</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/32.png"></p>
<h2 id="AC间二层漫游-直接转发"><a href="#AC间二层漫游-直接转发" class="headerlink" title="AC间二层漫游 - 直接转发"></a>AC间二层漫游 - 直接转发</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/33.png"></p>
<p>漫游前：</p>
<p>•STA发送业务报文给HAP。</p>
<p>•HAP接收到业务报文后经由网关（交换机）发送给上层网络。</p>
<p>漫游后：</p>
<p>•STA发送业务报文给FAP。</p>
<p>•FAP接收到业务报文后经由网关（交换机）发送给上层网络。</p>
<blockquote>
<p>•AC间二层漫游隧道转发与直接转发流量走向一致，不再赘述。</p>
</blockquote>
<h2 id="AC间三层漫游-隧道转发"><a href="#AC间三层漫游-隧道转发" class="headerlink" title="AC间三层漫游 - 隧道转发"></a>AC间三层漫游 - 隧道转发</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/34.png"></p>
<p>漫游前： </p>
<p>1.STA发送业务报文给HAP。</p>
<p>2.HAP接收到业务报文后通过CAPWAP隧道发送给HAC。</p>
<p>3.HAC直接将业务报文经过交换机发送给上层网络。</p>
<p>漫游后：</p>
<p>1.STA发送业务报文给FAP。</p>
<p>2.FAP接收到业务报文后通过CAPWAP隧道发送给FAC 。</p>
<p>3.FAC通过HAC和FAC之间的AC间隧道将业务报文转发给HAC。</p>
<p>4.HAC直接将业务报文经由交换机发送给上层网络。</p>
<blockquote>
<p>•三层漫游时，用户漫游前后不在同一个子网中，为了使用户漫游后仍能正常访问漫游前的网络，需要将用户流量通过隧道中转到原来的子网。</p>
<p>•隧道转发模式下，HAP和HAC之间的业务报文通过CAPWAP隧道封装，此时可以将HAP和HAC看作在同一个子网内，报文无需返回到HAP， 直接通过HAC进行中转到上层网络。</p>
</blockquote>
<h2 id="AC间三层漫游-直接转发（HAP为家乡代理）"><a href="#AC间三层漫游-直接转发（HAP为家乡代理）" class="headerlink" title="AC间三层漫游 - 直接转发（HAP为家乡代理）"></a>AC间三层漫游 - 直接转发（HAP为家乡代理）</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/35.png"></p>
<blockquote>
<p>漫游前： </p>
<p>1.STA发送业务报文给HAP。</p>
<p>2.HAP接收到业务报文后直接将业务报文经过交换机发送给上层网络。</p>
<p>漫游后：</p>
<p>1.STA发送业务报文给FAP。</p>
<p>2.FAP接收到STA发送的业务报文并通过CAPWAP隧道发送给FAC。</p>
<p>3.FAC通过HAC和FAC之间的AC间隧道将业务报文转发给HAC。</p>
<p>4.HAC通过CAPWAP隧道将业务报文发送给HAP。</p>
<p>5.HAP直接将业务报文发送给上层网络。</p>
</blockquote>
<blockquote>
<p>•直接转发模式下，HAP和HAC之间的业务报文不通过CAPWAP隧道封装，无法判定HAP和HAC是否在同一个子网内，此时设备默认报文需要返回到HAP进行中转。如果HAP和HAC在同一个子网时，可以将家乡代理设置为性能更强的HAC，减少HAP的负荷并提高转发效率。</p>
</blockquote>
<h2 id="AC间三层漫游-直接转发（HAC为家乡代理）"><a href="#AC间三层漫游-直接转发（HAC为家乡代理）" class="headerlink" title="AC间三层漫游 - 直接转发（HAC为家乡代理）"></a>AC间三层漫游 - 直接转发（HAC为家乡代理）</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/36.png"></p>
<p>漫游前： </p>
<p>1.STA发送业务报文给HAP。</p>
<p>2.HAP接收到业务报文后直接将业务报文经过交换机发送给上层网络。</p>
<p>漫游后：</p>
<p>1.STA发送业务报文给FAP。</p>
<p>2.FAP接收到STA发送的业务报文并通过CAPWAP隧道发送给FAC。</p>
<p>3.FAC通过HAC和FAC之间的AC间隧道将业务报文转发给HAC。</p>
<p>4.HAC直接将业务报文发送给上层网络。</p>
<blockquote>
<p>•直接转发模式下，HAP和HAC之间的业务报文不通过CAPWAP隧道封装，无法判定HAP和HAC是否在同一个子网内，此时设备默认报文需要返回到HAP进行中转。如果HAP和HAC在同一个子网时，可以将家乡代理设置为性能更强的HAC，减少HAP的负荷并提高转发效率。</p>
</blockquote>
<h2 id="AC间漫游配置介绍"><a href="#AC间漫游配置介绍" class="headerlink" title="AC间漫游配置介绍"></a>AC间漫游配置介绍</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/37.png"></p>
<blockquote>
<p>•配置漫游组。</p>
<ul>
<li>如果指定了漫游组服务器，则需要在漫游组服务器上配置漫游组。</li>
<li>如果没有指定漫游组服务器，则各成员AC均需配置漫游组。</li>
</ul>
</blockquote>
<h2 id="配置案例-1"><a href="#配置案例-1" class="headerlink" title="配置案例"></a>配置案例<img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/38.png"></h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/39.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/40.png"></p>
<h1 id="5-高可靠性技术"><a href="#5-高可靠性技术" class="headerlink" title="5.高可靠性技术"></a>5.高可靠性技术</h1><h2 id="AC高可靠性概述"><a href="#AC高可靠性概述" class="headerlink" title="AC高可靠性概述"></a>AC高可靠性概述</h2><p>•在WLAN组网中，为保证组网可靠性，常见的备份技术有：</p>
<p>​    ▫VRRP双机热备份（主备）</p>
<p>​    ▫双链路冷备份</p>
<p>​    ▫双链路热备份（主备&amp;负载分担）</p>
<p>​    ▫N+1备份</p>
<p>•为了保证WLAN业务的稳定运行，热备份（Hot-Standby Backup）机制可以保证在主设备故障时业务能够不中断的顺利切换到备份设备。</p>
<blockquote>
<p>•热备份是指，当两台设备在确定主用（Master）设备和备用（Backup）设备后，由主用设备进行业务的转发，而备用设备处于监控状态，同时主用设备实时向备用设备发送状态信息和需要备份的信息，当主用设备出现故障后，备用设备及时接替主用设备的业务运行。</p>
<p>•VRRP双机热备份</p>
<ul>
<li><p>主备AC两个独立的IP地址，通过VRRP对外虚拟为同一个IP地址，单个AP和虚拟IP建立一条CAPWAP链路。</p>
</li>
<li><p>主AC备份AP信息、STA信息和CAPWAP链路信息，并通过HSB主备服务将信息同步给备AC。主AC故障后，备AC直接接替工作。</p>
</li>
</ul>
<p>•双链路热备份</p>
<ul>
<li><p>单个AP分别和主备AC建立CAPWAP链路，一条主链路，一条备链路。</p>
</li>
<li><p>主AC仅备份STA信息，并通过HSB主备服务将信息同步给备AC。主AC故障后，AP切换到备链路上，备AC接替工作。</p>
</li>
</ul>
<p>•双链路冷备份</p>
<ul>
<li><p>单个AP分别和主备AC建立CAPWAP链路，一条主链路，一条备链路。</p>
</li>
<li><p>AC不备份同步信息。主AC故障后，AP切换到备链路上，备AC接替工作。</p>
</li>
</ul>
<p>•N+1备份</p>
<ul>
<li><p>单个AP只和一个AC建立CAPWAP链路。</p>
</li>
<li><p>AC不备份同步信息。主AC故障后，AP重新与备AC建链CAPWAP链路，备AC接替工作。</p>
</li>
</ul>
</blockquote>
<h2 id="VRRP双机热备"><a href="#VRRP双机热备" class="headerlink" title="VRRP双机热备"></a>VRRP双机热备</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/41.png"></p>
<p>•两台AC组成一个VRRP组，主、备AC对AP始终显示为同一个虚拟IP地址，主AC通过Hot Standby（HSB）主备通道同步业务信息到备AC上。</p>
<p>•两台AC通过VRRP协议产生一台“虚拟AC”，缺省情况下，主AC担任虚拟AC的具体工作，当主AC故障时，备AC接替其工作。所有AP与“虚拟AC”建立CAPWAP隧道。</p>
<p>•AP只看到一个AC的存在，AC间的切换由VRRP决定。</p>
<p>•这种方式一般将主备AC部署在同一地理位置，和其他备份方式比较，其业务切换速度非常快。</p>
<blockquote>
<p>•AC目前支持VRRP单实例整机热备，不支持负载均衡。整机热备具有以下特点:</p>
<ul>
<li><p>上行链路可以互为备份，主备VRRP可以track上行口状态，AC整机主备状态可能与各下行链路通断状态不一致。</p>
</li>
<li><p>下行多条链路(包括有线、无线) 采用MSTP破环，MSTP状态变更时会自动清除链路上的MAC/ARP表。 </p>
</li>
</ul>
</blockquote>
<h2 id="HSB相关概念"><a href="#HSB相关概念" class="headerlink" title="HSB相关概念"></a>HSB相关概念</h2><p>•HSB（Hot Standby，热备份）是华为主备公共机制。</p>
<p>•主备服务（HSB service）：建立和维护主备通道，为各个主备业务模块提供通道通断事件和报文发送/接收接口。</p>
<p>•主备备份组（HSB group）：HSB备份组内部绑定HSB service，为各个主备业务模块提供数据备份通道。HSB备份组与一个VRRP实例绑定，借用VRRP机制协商出主备实例。同时，HSB备份组还负责通知各个业务模块处理批量备份、实时备份、主备切换等事件。</p>
<blockquote>
<p>•基于VRRP 的双机热备，热备相关的业务都注册到同一个HSB备份组，HSB备份组内部绑定HSB服务，同时HSB备份组与一个VRRP实例绑定，从而业务通过HSB备份组获知当前用户的主备状态、以及主备切换等事件，并通过HSB组的接口进行备份数据的接收和发送。</p>
</blockquote>
<h2 id="HSB主备服务"><a href="#HSB主备服务" class="headerlink" title="HSB主备服务"></a>HSB主备服务</h2><p>•HSB主备服务负责在两个互为备份的设备间建立主备备份通道，维护主备通道的链路状态，为其他业务提供报文的收发服务，并在备份链路发生故障时通知主备业务备份组进行相应的处理。</p>
<p>•HSB主备服务主要包括两个方面：</p>
<p>​    ▫建立主备备份通道</p>
<p>​    ▫维护主备通道的链路状态</p>
<blockquote>
<p>•HSB主备服务主要包括两个方面： 建立主备备份通道：通过配置主备服务本端和对端的IP地址和端口号，从而建立主备机制报文发送的TCP通道，为其他业务提供报文的收发以及链路状态变化通知服务。</p>
<p>•维护主备通道的链路状态：通过发送主备服务报文和重传等机制来防止TCP较长时间中断但协议栈没有检测到该连接中断。如果在主备服务报文时间间隔与重传次数乘积的时间内还未收到对端发送的主备服务报文，设备则会收到异常通知，并且准备重建主备备份通道。</p>
</blockquote>
<h2 id="数据同步"><a href="#数据同步" class="headerlink" title="数据同步"></a>数据同步</h2><p>基于VRRP双机热备备份信息包括用户表项、CAPWAP链路信息以及AP表项等信息，备份的方式有实时备份，批量备份，定时备份。</p>
<ul>
<li><p>批量备份：主用设备会将已有的会话表项一次性同步到新加入的备份设备上，使主备AC信息对齐，这个过程称为批量备份。批量备份会在AC主备确立时进行触发。</p>
</li>
<li><p>实时备份：主用设备在产生新表项或表项变化后会及时备份到备份设备上。</p>
</li>
<li><p>定时同步：备用设备会每隔30分钟检查其已有的会话表项与主用设备是否一致，若不一致则将主用设备上的会话表项同步到备用设备。</p>
</li>
</ul>
<blockquote>
<p>•当主用设备出现故障，流量切换到备份设备时，要求主用设备和备份设备的会话表项完全一致，否则有可能导致会话中断。因此，需要一种机制在主用设备上会话建立或表项变化时将相关信息同步保存到备份设备上。HSB主备服务处理模块可以提供数据的备份功能，它负责在两个互为备份的设备间建立主备通道，并维护主备通道的链路状态，提供报文的收发服务。</p>
<p>•HSB业务实时备份：</p>
<p>​    ▫用户数据信息备份</p>
<p>​    ▫CAPWAP隧道信息备份</p>
<p>​    ▫AP表项备份</p>
<p>​    ▫DHCP地址信息备份</p>
<p>•HSB主备通道，可通过两台AC之间的直连物理链路承载，也可通过交换机承载，例如复用VRRP报文交互所处的物理通道。</p>
</blockquote>
<h2 id="VRRP双机热备配置流程"><a href="#VRRP双机热备配置流程" class="headerlink" title="VRRP双机热备配置流程"></a>VRRP双机热备配置流程</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/42.png"></p>
<h2 id="配置介绍-1"><a href="#配置介绍-1" class="headerlink" title="配置介绍 (1)"></a>配置介绍 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/43.png"></p>
<h2 id="配置介绍-2"><a href="#配置介绍-2" class="headerlink" title="配置介绍 (2)"></a>配置介绍 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/44.png"></p>
<h2 id="配置介绍-3"><a href="#配置介绍-3" class="headerlink" title="配置介绍 (3)"></a>配置介绍 (3)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/45.png"></p>
<h2 id="配置案例-1-2"><a href="#配置案例-1-2" class="headerlink" title="配置案例 (1)"></a>配置案例 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/46.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/47.png"></p>
<h2 id="配置案例-2-2"><a href="#配置案例-2-2" class="headerlink" title="配置案例 (2)"></a>配置案例 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/48.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/49.png"></p>
<h2 id="配置案例-3-1"><a href="#配置案例-3-1" class="headerlink" title="配置案例 (3)"></a>配置案例 (3)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/50.png"></p>
<h2 id="双链路双机热备"><a href="#双链路双机热备" class="headerlink" title="双链路双机热备"></a>双链路双机热备</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/51.png"></p>
<p>•双链路双机热备场景下，业务直接绑定HSB备份服务，这样HSB对业务仅提供备份数据收发的功能，用户的主备状态由双链路机制进行维护。</p>
<p>•AP同时与主备AC之间分别建立CAPWAP隧道，AC间的业务信息通过HSB主备通道同步。</p>
<p>•当AP和主AC间链路断开，AP会通知备AC切换成主AC。</p>
<blockquote>
<p>•该方案除了支持主备备份之外，还支持负载分担模式。负载分担模式下可以指定一部分AP的主AC为AC1，与其建立CAPWAP主链路，一部分AP的主AC为AC2，与其建立CAPWAP主链路。</p>
<p>•双链路双机热备的主备AC不受地理位置限制，部署灵活，可进行负载分担，有效利用资源，但业务切换速度较慢。</p>
<p>•图中，AC1 和 AC2 经过部署为双链路双机热备，只绑定HSB主备服务，提供双机热备份HSB隧道。AP需依次与两台AC建立CAPWAP隧道，通过AC下发的CAPWAP报文中的优先级判断主用AC与备用AC。</p>
</blockquote>
<h2 id="主备协商-amp-建立主链路"><a href="#主备协商-amp-建立主链路" class="headerlink" title="主备协商&amp;建立主链路"></a>主备协商&amp;建立主链路</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/52.png"></p>
<p>AP与AC建立主链路，在Discovery阶段要优选出主AC。</p>
<p>1.使能双链路备份功能后，AP开始发送Discovery Request报文。</p>
<p>2.AC收到Request报文后回应Discovery Response报文。</p>
<p>3.AP收集到主备AC回应的Discovery Response报文后，根据AC的优先级、设备的负载情况以及AC的IP地址来选择主AC。</p>
<p>4.AP开始与优选出的主AC建立CAPWAP主链路。</p>
<blockquote>
<p>•建立主链路时，除了Discovery阶段要优选出主AC，其他过程跟正常情况下的CAPWAP隧道建立过程一致。</p>
<p>•在Discovery阶段，使能双链路备份功能后，AP开始发送Discovery Request报文，分为单播方式和广播方式：</p>
<ul>
<li><p>如果预先通过静态方式、DHCP服务器方式或DNS方式指定了主备AC的IP地址，AP向AC发送单播Discovery Request报文请求与主备AC关联。</p>
</li>
<li><p>如果没有配置AC的静态IP地址或者单播没有回应时，AP将发送广播Discovery Request报文请求同网段内可关联的AC。</p>
</li>
</ul>
<p>•不管是单播发现还是广播发现，如果主备AC都正常，都会回应Discovery Response报文，并在该报文中携带双链路特性开关、优先级、负载情况以及IP地址。</p>
<p>•AP收集到主备AC回应的Discovery Response报文后，根据AC的优先级、设备的负载情况以及AC IP地址来选择主AC并开始与其建立CAPWAP主链路，优选顺序如下：</p>
<ul>
<li><p>比较AC的优先级，优先级值小的为主AC，默认优先级为0，最大值为7，优先级取值越小，优先级越高。；</p>
</li>
<li><p>优先级相同情况下，比较AC设备的负载情况，即AP个数和STA个数，负载轻的为主AC。优先选择当前可接入AP数大的AC为主AC，如果当前可接入AP数相同，则选择当前可接入STA数大的AC为主AC；</p>
</li>
<li><p>负载相同情况下，比较IP地址，IP地址小的为主AC。</p>
</li>
</ul>
<p>•说明：当前可接入AP数=可接入的最大AP数-当前已接入的AP数，当前可接入STA数=可接入的最大STA数-当前已接入的STA数。</p>
</blockquote>
<h2 id="建立备链路"><a href="#建立备链路" class="headerlink" title="建立备链路"></a>建立备链路</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/53.png"></p>
<p>AP与AC建立备链路，为了避免业务配置重复下发导致错误，在AP和 主AC建立主隧道并且配置下发完成后，才启动备CAPWAP链路的建立。</p>
<p>1.主AC下发配置到AP上；</p>
<p>2.AP开始建立备用隧道，向备AC发送单播CAPWAP Discovery Request报文；</p>
<p>3.备AC收到Request报文后，回应Response报文，在该报文中携带优选AC的IP地址、备选AC的IP地址、双链路特性开关、负载情况及其优先级。</p>
<p>4.AP收到备AC回应的Response报文后，获取到双链路特性开关为打开，并保存其优先级。</p>
<blockquote>
<p>•说明：如果该AC的优先级修改为比步骤1已经建立好CAPWAP链路的AC优先级高，也不进行主备倒换，待建立隧道完成后再进行倒换。</p>
<p>•AP发送的Join Request中，会携带一个自定义消息类型，告诉备AC配置已经下发过了，不需要再下发。AC收到Join Request，获取到该自定义消息时，在配置下发阶段，会跳过配置下发流程，避免对AP重复下发配置。</p>
<p>•备链路建立完成后，AP重新根据两个链路的优先级决策出主备AC。</p>
<p>•缺省情况下，CAPWAP心跳检测的间隔时间为25秒，心跳检测报文次数为6。如果开启了双链路备份功能，则CAPWAP心跳检测的间隔时间为25秒，心跳检测报文次数为3。</p>
<p>•说明： </p>
<ul>
<li><p>如果在配置双链路备份时需要使用WDS或Mesh，建议配置CAPWAP心跳检测的间隔时间为25秒，心跳检测报文次数至少为6次。否则由于双链路备份时缺省的心跳报文间隔时间为25秒，心跳检测报文次数为3次，会导致WDS或Mesh链路不稳定，无法保证用户正常接入。</p>
</li>
<li><p>配置CAPWAP心跳检测间隔时间和次数低于默认值会影响CAPWAP链路可靠性，请谨慎修改，建议使用默认值。</p>
</li>
</ul>
</blockquote>
<h2 id="配置介绍-1-1"><a href="#配置介绍-1-1" class="headerlink" title="配置介绍 (1)"></a>配置介绍 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/54.png"></p>
<h2 id="配置介绍-2-1"><a href="#配置介绍-2-1" class="headerlink" title="配置介绍 (2)"></a>配置介绍 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/55.png"></p>
<h2 id="配置案例-1-3"><a href="#配置案例-1-3" class="headerlink" title="配置案例 (1)"></a>配置案例 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/56.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/57.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/58.png"></p>
<h2 id="配置案例-2-3"><a href="#配置案例-2-3" class="headerlink" title="配置案例 (2)"></a>配置案例 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/59.png"></p>
<h2 id="AC可靠性：N-1"><a href="#AC可靠性：N-1" class="headerlink" title="AC可靠性：N+1"></a>AC可靠性：N+1</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/60.png"></p>
<p>•N+1备份是指在AC+FIT AP的网络架构中，使用一台AC作为备AC，为多台主AC提供备份服务的一种解决方案。</p>
<p>•网络正常情况下，AP只与各自所属的主AC建立CAPWAP链路。</p>
<p>•当主AC故障或主AC与AP间CAPWAP链路故障时，备AC替代主AC来管理AP，备AC与AP间建立CAPWAP链路，为AP提供业务服务。</p>
<p>•支持主备倒换，支持主备回切。</p>
<blockquote>
<p>•当AP与主用AC之间的CAPWAP隧道中断时，将触发AP与备用AC建立CAPWAP隧道，此时AP会重新与该AC建链、重启并获取配置，在该过程中，业务将会受影响。</p>
</blockquote>
<h2 id="N-1-备份—主备选择"><a href="#N-1-备份—主备选择" class="headerlink" title="N+1 备份—主备选择"></a>N+1 备份—主备选择</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/61.png"></p>
<p>•在Discovery阶段，AP发现AC后，要选择出最高优先级的AC作为主AC接入。</p>
<p>•AC上存在两种优先级：</p>
<p>•全局优先级：针对所有AP配置的AC优先级，默认为0，最大值为7，优先级取值越小，优先级越高。</p>
<p>•个性优先级：针对指定的单个AP或指定AP组中的AP配置的AC优先级，没有默认值。</p>
<p>•AC全局优先级&lt;AP在AC上优先级。</p>
<blockquote>
<p>•当AC收到AP发送的Discovery Request报文时，如果AC没有为该AP配置个性优先级，则在回应的Discovery Response报文中携带全局优先级；</p>
<p>•如果AC已为该AP配置了个性优先级，则在回应的Discovery Response报文中携带个性优先级。</p>
<p>•正确配置主AC和备AC的不同优先级，可以控制AP能够在指定的主AC或备AC上线</p>
<p>•优选顺序如下：</p>
<ul>
<li><p>AP查看优选AC，如果只有一个优选AC，则此AC作为主AC。如果存在多个优选AC，则选择负载最轻的AC作为主AC，如果负载相同选择IP地址最小的作为主AC；</p>
</li>
<li><p>负载的比较方式：比较AC设备的负载情况，即AP个数和STA个数，负载轻的为主AC。优先选择当前可接入AP数大的AC为主AC，如果当前可接入AP数相同，则选择当前可接入STA数大的AC为主AC；</p>
</li>
<li><p>如果没有优选AC，查看备选AC，如果只有一个备选AC，则此AC作为主AC，如果存在多个备选AC，则选择负载最轻的AC作为主AC，如果负载相同选择IP地址最小的作为主AC；</p>
</li>
<li><p>如果没有备选AC，比较AC的优先级，优先级最高的作为主AC。优先级取值越小，优先级越高。优先级的具体判断方式参考主备优先级；</p>
</li>
<li><p>优先级相同情况下，则选择负载最轻的AC作为主AC；</p>
</li>
<li><p>负载相同情况下，继续比较IP地址，IP地址小的为主AC。</p>
</li>
</ul>
</blockquote>
<h2 id="配置介绍-1-2"><a href="#配置介绍-1-2" class="headerlink" title="配置介绍 (1)"></a>配置介绍 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/62.png"></p>
<h2 id="配置介绍-2-2"><a href="#配置介绍-2-2" class="headerlink" title="配置介绍 (2)"></a>配置介绍 (2)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/63.png"></p>
<h2 id="配置案例-1-4"><a href="#配置案例-1-4" class="headerlink" title="配置案例 (1)"></a>配置案例 (1)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/64.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/65.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/66.png"></p>
<h2 id="配置案例-2）"><a href="#配置案例-2）" class="headerlink" title="配置案例 (2）"></a>配置案例 (2）</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/67.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/68.png"></p>
<blockquote>
<p>•缺省情况下，全局回切功能处于使能状态，执行命令undo ac protect restore disable会提示Info。</p>
<p>•缺省情况下，N+1备份功能开启，执行命令undo ac protect enable会提示Info。需要在主AC上继续执行命令ap-reset all重启所有AP，AP重启后，N+1备份功能开始生效。</p>
</blockquote>
<h2 id="配置案例-3-2"><a href="#配置案例-3-2" class="headerlink" title="配置案例 (3)"></a>配置案例 (3)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/69.png"></p>
<h2 id="配置案例-4-1"><a href="#配置案例-4-1" class="headerlink" title="配置案例 (4)"></a>配置案例 (4)</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/70.png"></p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/71.png"></p>
<h2 id="AC可靠性：小结"><a href="#AC可靠性：小结" class="headerlink" title="AC可靠性：小结"></a>AC可靠性：小结</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/72.png"></p>
<h1 id="6-准入控制技术"><a href="#6-准入控制技术" class="headerlink" title="6.准入控制技术"></a>6.准入控制技术</h1><h2 id="NAC概述"><a href="#NAC概述" class="headerlink" title="NAC概述"></a>NAC概述</h2><p>NAC（Network Admission Control）称为网络接入控制，通过对接入网络的客户端和用户的认证保证网络的安全，是一种“端到端”的安全技术。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/73.png"></p>
<h2 id="RADIUS概述"><a href="#RADIUS概述" class="headerlink" title="RADIUS概述"></a>RADIUS概述</h2><p>•AAA可以通过多种协议来实现，在实际应用中，最常使用RADIUS协议。</p>
<p>•RADIUS是一种分布式的、客户端/服务器结构的信息交互协议，能保护网络不受未授权访问的干扰，常应用在既要求较高安全性、又允许远程用户访问的各种网络环境中。</p>
<p>•该协议定义了基于UDP（User Datagram Protocol）的RADIUS报文格式及其传输机制，并规定UDP端口1812、1813分别作为默认的认证、计费端口。</p>
<p>•RADIUS协议的主要特征如下：</p>
<p>​    ▫客户端/服务器模式</p>
<p>​    ▫安全的消息交互机制</p>
<p>​    ▫良好的扩展性</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/74.png"></p>
<h2 id="802-1X认证"><a href="#802-1X认证" class="headerlink" title="802.1X认证"></a>802.1X认证</h2><p>•802.1X是IEEE制定的关于用户接入网络的认证标准，主要解决以太网内认证和安全方面的问题。</p>
<p>•802.1X认证系统为典型的Client/Server结构，包括3个实体：请求方、认证方和认证服务器。</p>
<p>•认证服务器通常是RADIUS服务器，用于对申请者进行认证、授权和计费。</p>
<p>•对于大中型企业的员工，推荐使用802.1X认证。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/75.png"></p>
<blockquote>
<p>•802.1X认证系统使用可扩展认证协议（Extensible Authentication Protocol，EAP）来实现申请者、认证者和认证服务器之间的信息交互。常用的802.1X认证协议有防护扩展验证协议（Protected Extensible Authentication Protocol，PEAP）和传输层安全性协议（Transport Layer Security，TLS），其区别如下：</p>
<ul>
<li><p>PEAP：管理员给用户分配用户名、密码。用户在接入WLAN时输入用户名、密码进行认证。</p>
</li>
<li><p>TLS：用户使用证书进行认证，此认证方式一般结合企业App使用，如华为的EasyAccess。</p>
</li>
</ul>
<p>•对于大中型企业的员工，推荐使用802.1X认证。</p>
</blockquote>
<h2 id="MAC认证"><a href="#MAC认证" class="headerlink" title="MAC认证"></a>MAC认证</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/76.png"></p>
<p>•MAC认证是一种基于MAC地址对用户的网络访问权限进行控制的认证方法，它不需要用户安装任何客户端软件。</p>
<p>•接入设备在启动了MAC认证的接口上首次检测到用户的MAC地址后，即启动对该用户的认证操作。</p>
<p>•认证过程中，不需要用户手动输入用户名或者密码。</p>
<p>•MAC认证常用于哑终端（如打印机）的接入认证，或者结合认证服务器完成MAC优先的Portal认证，用户首次认证通过后，一定时间内免认证再次接入。</p>
<h2 id="Portal认证"><a href="#Portal认证" class="headerlink" title="Portal认证"></a>Portal认证</h2><p>•Portal认证通常也称为Web认证，将浏览器作为认证客户端，不需要安装单独的认证客户端。</p>
<p>•用户上网时，必须在Portal页面进行认证，只有认证通过后才可以使用网络资源，同时服务提供商可以在Portal页面上开展业务拓展，如展示商家广告等。</p>
<p>•对于大中型企业的访客、商业会展和公共场所，推荐使用Portal认证。</p>
<p>•常用的Portal认证方式如下：</p>
<ul>
<li><p>用户名和密码方式：由前台管理员给访客申请一个临时账号，访客使用临时账号认证。</p>
</li>
<li><p>短信认证：访客通过手机验证码方式认证。</p>
</li>
</ul>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/77.png"></p>
<blockquote>
<p>•定义</p>
<ul>
<li>Portal认证通常也称为Web认证，一般将Portal认证网站称为门户网站。用户上网时，必须在门户网站进行认证，如果未认证成功，仅可以访问特定的网络资源，认证成功后，才可以访问其他网络资源。</li>
</ul>
<p>•优点</p>
<ul>
<li><p>一般情况下，客户端不需要安装额外的软件，直接在Web页面上认证，简单方便。</p>
</li>
<li><p>便于运营，可以在Portal页面上进行业务拓展，如广告推送、企业宣传等。</p>
</li>
<li><p>技术成熟，被广泛应用于运营商、连锁快餐、酒店、学校等网络。</p>
</li>
<li><p>部署位置灵活，可以在接入层或关键数据的入口作访问控制。</p>
</li>
<li><p>用户管理灵活，可基于用户名与VLAN/IP地址/MAC地址的组合对用户进行认证。</p>
</li>
</ul>
</blockquote>
<h2 id="MAC优先的Portal认证"><a href="#MAC优先的Portal认证" class="headerlink" title="MAC优先的Portal认证"></a>MAC优先的Portal认证</h2><p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/78.png"></p>
<h2 id="三种认证方式比较"><a href="#三种认证方式比较" class="headerlink" title="三种认证方式比较"></a>三种认证方式比较</h2><p>NAC包括三种认证方式：802.1X认证、MAC认证和Portal认证。由于三种认证方式认证原理不同，各自适合的场景也有所差异，实际应用中，可以根据场景部署某一种合适的认证方式，也可以部署几种认证方式组成的混合认证，混合认证的组合方式以设备实际支持为准。</p>
<p><img src="/2021/05/18/IP-%E5%A4%A7%E5%9E%8BWLAN%E7%BB%84%E7%BD%91%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/79.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（简答题）在部署WLAN三层组网的时候，需要配置DHCP Option43，那么Option43的作用是什么？</p>
<p><strong>AP发送的DHCP广播请求报文是二层报文，不能在三层组网中传输，所以广播发现不了三层组网中AC，必须通过Option43来通告AC的IP地址，否则AP获取不到AC的IP地址，后续AP无法上线。</strong></p>
<p>2.（简答题）二层漫游和三层漫游的最大的区别是什么？</p>
<p><strong>二层漫游和三层漫游的最大的区别是什么？</strong></p>
<p>​    <strong>▫区别在于漫游前后关联的AP的服务集上的VLAN不同。</strong></p>
<p>​    <strong>▫二层漫游是指客户端在同一子网内漫游。</strong></p>
<p>​    <strong>▫三层漫游是指客户端在不同子网间漫游。</strong></p>
<p>3.（简答题）WLAN双机热备份数据同步的方式有几种，分别应用在什么场景下？</p>
<p><strong>数据同步的方式有批量备份、实时备份和定时同步：</strong></p>
<ul>
<li><p><strong>批量备份：在配置双机热备份功能后，先运行的主用设备会将已有的会话表项一次性同步到新加入的备份设备上。</strong></p>
</li>
<li><p><strong>实时备份：主用设备在产生新表项或表项变化后会及时备份到备份设备上。</strong></p>
</li>
<li><p><strong>定时同步：备用设备会每隔30分钟检查其已有的会话表项与主用设备是否一致，若不一致则将主用设备上的会话表项同步到备用设备。</strong></p>
</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•通过大型WLAN组网技术，用户可以更方便、更安全地接入到无线网络，并在无线网络覆盖区域内自由移动，彻底摆脱有线网络的束缚。</p>
<p>•本章主要介绍了企业大型WLAN组网技术，包括：WLAN大型组网架构、WLAN大型组网关键技术、漫游技术、高可靠性技术以及准入控制技术等。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/" itemprop="url">IP-网络管理协议介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T21:39:07+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•随着人工智能、大数据、云计算等新技术快速发展，未来各行业将面临数字化转型，企业业务随着数字化转型也变得丰富多样，使网络管理成为网络管理员面临的最具挑战的问题之一。我们无法仅依赖人手工来完成整个的网络管理的工作，迫切的需要一种自动化和智能化的工具协助我们管理网络中的设备和资源。</p>
<p>•本次课程，将简要介绍网络管理的发展历程及网络管理的相关概念，同时会着重介绍网络管理中使用到的不同的协议以及它们的使用场景。最后，简要介绍网络管理的典型应用案例。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫阐释网络管理的发展趋势及功能特征</p>
<p>▫阐释网络管理协议的功能</p>
<p>▫阐释不同网络管理协议的机制和应用场景的异同点</p>
<p>▫阐释网络管理协议的应用场景</p>
<h1 id="1-网络管理的发展历程"><a href="#1-网络管理的发展历程" class="headerlink" title="1.网络管理的发展历程"></a>1.网络管理的发展历程</h1><h2 id="网络发展的现状"><a href="#网络发展的现状" class="headerlink" title="网络发展的现状"></a>网络发展的现状</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/1.png"></p>
<blockquote>
<p>•随着互联网产业的飞速发展，网络面临巨大变革，多业务融合成为未来网络的主流趋势。网络的融合需要管理的融合，统一网管能实现多业务、多设备的统一集中管理。</p>
</blockquote>
<h2 id="传统网络管理面临的挑战"><a href="#传统网络管理面临的挑战" class="headerlink" title="传统网络管理面临的挑战"></a>传统网络管理面临的挑战</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/2.png"></p>
<blockquote>
<p>•人工智能、大数据、云计算等新技术正在快速发展，未来十年各行业将面临数字化转型，企业业务随着数字化转型也变得丰富多样。因此，数字化带来网络模型的变化，传统的网络管理模式已经不能适应数字化业务带来的新需求。传统网络的建设、管理和运维手段已无法满足数字化带来的新的网络需求。</p>
</blockquote>
<h2 id="网络管理的发展趋势"><a href="#网络管理的发展趋势" class="headerlink" title="网络管理的发展趋势"></a>网络管理的发展趋势</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/3.png"></p>
<blockquote>
<p>•OPEX（Operating Expense，运营支出）：指企业运行付出的各种支出成本，包括维护费用、营销费用、人工成本以及折旧。</p>
<p>•根据行业知名分析机构在2019年4月发布的关于AI和自动化提高网络可靠性的报告中指出，到2022年，将会有65%的企业在园区网络部署网络自动化技术，而今天这个比例只有17%。</p>
<p>•管理自动化：正如家用洗衣机一样，从手动到半自动，到今天的全自动甚至是智能洗衣，让人人都能操作一个复杂的机器完成复杂的任务。对于网络管理也是如此，从基于命名行的逐台设备的配置与管理，到基于图形化界面的管理控制系统，到今天基于业务语言对网络进行自动化配置。从网络管理的视角，企业网络管理将几乎1/3的时间花费在网络的规划、部署上。未来网络自动化有两个层面：</p>
<ul>
<li>全生命周期的自动化：包括自动化工具是否能从网络的规划、部署、策略发放、网络状态监测和维护以及管理的全生命周期，均实现自动化。</li>
<li>整网自动化：包括企业的LAN、WLAN、以及WAN网络是否能够进行集中式地管理和策略配置，是否能从全局视角定义基于用户身份和应用类型的业务策略。</li>
</ul>
<p>•运维智能化：智能化是网络管理运维的更高级别能力。以前，网络运维工作很简单，主要关注网络和设备的KPI指标，无法感知用户体验和业务质量。而今天，网络连接的质量直接影响到了业务的质量，从而影响了企业的运作效率。甚至在部分工业和生产场景，因不同业务的需要，网络质量有了差异化的要求，每终端的带宽、时延、丢包、无线漫游的切换时间仅依托以网元为中心的运维系统是无法完成如此复杂的工作。这就像医生为了检测病人，需要采用更为先进的机器。</p>
</blockquote>
<h1 id="2-网络管理的功能特征"><a href="#2-网络管理的功能特征" class="headerlink" title="2.网络管理的功能特征"></a>2.网络管理的功能特征</h1><h2 id="什么是网络管理？"><a href="#什么是网络管理？" class="headerlink" title="什么是网络管理？"></a>什么是网络管理？</h2><p>•网络管理，简单地说是对网络的管理，是一个网络的基本诉求。当前，用户能够通过各种协议、工具、应用或设备来实现对网络的管理，其管理对象包括网络中的硬件及软件。</p>
<p>•网络管理的目标是实现对网络软硬件的监控、测试、配置、分析、评价及控制等，确保网络运行正常。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/4.png"></p>
<h2 id="网络管理的典型架构"><a href="#网络管理的典型架构" class="headerlink" title="网络管理的典型架构"></a>网络管理的典型架构</h2><p>通常情况下，网络管理系统具有相同的基本体系结构。该体系结构包含两个关键元素：</p>
<p>​    ▫管理设备，也被称为网络管理站。</p>
<p>​    ▫被管理设备，也被称为代理设备。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/5.png"></p>
<h2 id="网络管理的四大模型"><a href="#网络管理的四大模型" class="headerlink" title="网络管理的四大模型"></a>网络管理的四大模型</h2><p>OSI网络管理模型由四个主要的模型组成:</p>
<ul>
<li><p>组织结构模型(Organization Model)：描述网络管理系统组件的功能和基础架构。</p>
</li>
<li><p>信息模型(Information Model)：描述被管理对象及其关系的信息库。</p>
</li>
<li><p>通信模型(Communication Model)：描述管理者与被管理者之间交换信息的方式。</p>
</li>
<li><p>功能模型(Functional Model)：包括配置管理、性能管理、故障管理、安全管理和计费管理五个功能区域。</p>
</li>
</ul>
<blockquote>
<p>•组织结构模型定义管理者，代理和被管理对象。 它描述了网络管理系统的组件，组件的功能和基础架构。</p>
<p>•信息模型与信息结构和存储有关。 它指定用于描述被管理对象及其关系的信息库。 管理信息结构（SMI）定义了存储在管理信息库（MIB）中的管理信息的语法和语义。 代理进程和管理器进程都使用MIB进行管理信息交换和存储。</p>
<p>•通信模型处理代理与管理者之间以及管理者之间交换信息的方式。 通信模型中包含三个关键元素：传输协议，应用程序协议和要传达的实际消息。</p>
<p>•功能模型包括网络管理的五个功能区域：配置管理、性能管理、故障管理、安全管理和计费管理。</p>
</blockquote>
<h2 id="网络管理的五大功能"><a href="#网络管理的五大功能" class="headerlink" title="网络管理的五大功能"></a>网络管理的五大功能</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/6.png"></p>
<p>在网络运维工作中，主要涉及到三个功能：</p>
<p>•配置：许多管理协议都包括对托管项目执行动作的能力。</p>
<p>•性能：这里的想法是获取有关平台行为的数据，该数据使我们可以推断其性能。</p>
<p>•故障：在这一领域中，其思想是拥有检测故障的程序和报告故障的方案。</p>
<blockquote>
<p>•OSI定义网络管理的五大功能模型。</p>
<p>•配置管理（Configuration Management）：</p>
<ul>
<li><p>配置管理涉及初始化网络，提供网络资源和服务以及监视和控制网络。 更具体地说，配置管理的职责包括在网络运行期间设置，维护，添加和更新组件之间的关系以及组件的状态。</p>
</li>
<li><p>配置管理包括设备配置和网络配置。设备配置可以在本地或远程执行。 自动化的网络配置，例如动态主机配置协议（DHCP）和域名服务（DNS）在网络管理中发挥关键作用。</p>
</li>
</ul>
<p>•性能管理（Performance Management）：</p>
<ul>
<li>性能管理与评估和报告被管理网络对象的行为和有效性有关。 网络监视系统可以测量和显示网络状态，例如收集有关流量，网络可用性，响应时间和吞吐量的统计信息。</li>
</ul>
<p>•故障管理（Fault Management）：</p>
<ul>
<li>故障管理涉及检测，隔离和纠正可能导致OSI网络故障的异常操作。 故障管理的主要目标是确保网络始终可用，并在发生故障时尽快将其修复。</li>
</ul>
<p>•安全管理（Security Management）：</p>
<ul>
<li>安全管理可以保护网络和系统免受未经授权的访问和安全攻击。 安全管理机制包括身份验证，加密和授权。 安全管理还涉及加密密钥以及其他与安全相关的信息的生成，分发和存储。 安全管理可以包括提供实时事件监视和事件日志的安全系统，例如防火墙和入侵检测系统。</li>
</ul>
<p>•计费管理（Accounting Management）：</p>
<ul>
<li>计费管理可以计量被管理对象的使用费用，并确定这种使用的成本。 该度量可能包括消耗的资源，用于收集会计数据的设施以及为客户使用的服务设置计费参数，维护用于计费目的的数据库，以及准备资源使用情况和计费报告。</li>
</ul>
</blockquote>
<h1 id="3-网络管理的协议分类"><a href="#3-网络管理的协议分类" class="headerlink" title="3.网络管理的协议分类"></a>3.网络管理的协议分类</h1><h2 id="网络管理概览"><a href="#网络管理概览" class="headerlink" title="网络管理概览"></a>网络管理概览</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/7.png"></p>
<blockquote>
<p>•CLI（Command-Line Interface，命令行界面）既可以支持网络配置管理，也可以支持网络监控管理。</p>
<p>•SNMP（Simple Network Management Protocol，简单网络管理协议）的Set功能可以支持网络配置管理，Trap功能可以支持网络监控管理。</p>
<p>•NETCONF（Network Configuration Protocol，网络配置协议）的Edit功能可以支持网路配置管理，Get功能可以支持网络监控管理。</p>
</blockquote>
<h2 id="CLI（Telnet-SSH）"><a href="#CLI（Telnet-SSH）" class="headerlink" title="CLI（Telnet/SSH）"></a>CLI（Telnet/SSH）</h2><p>CLI是在图形用户界面得到普及之前使用最为广泛的用户界面，它通常不支持鼠标，用户通过键盘输入指令，设备接收到指令后，予以执行。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/8.png"></p>
<blockquote>
<p>•网络管理员可以采用CLI对设备进行配置和网络监控，操作简单便捷，一旦进行大规模部署，就必须借助于自动化工具来进行批量配置。</p>
<p>•Telnet是电信（Telecommunications）和网络（Networks）的联合缩写。</p>
<ul>
<li><p>Telnet使用专用的TCP端口号23，它不是一种安全通信协议，通过网络/互联网传输明文格式的数据，包括密码。</p>
</li>
<li><p>Telnet中没有使用任何验证策略及数据加密方法。</p>
</li>
</ul>
<p>•SSH（Secure Shell，安全外壳）</p>
<ul>
<li><p>SSH使用专用的TCP端口号22，它是一种非常安全的协议，通过网络/互联网传输加密格式的数据，一旦经过加密就极难解压和读取该数据。</p>
</li>
<li><p>SSH还使用公钥用于对访问者的用户身份验证，这种方式提供了更高的安全性。</p>
</li>
</ul>
<p>•Telnet和SSH是两种远程管理设备的方式，其中SSH连接方式较Telnet更为安全，因此目前网络都会要求部署SSH。</p>
</blockquote>
<h2 id="SNMP"><a href="#SNMP" class="headerlink" title="SNMP"></a>SNMP</h2><p>SNMP是广泛用于TCP/IP网络的网络管理标准协议。SNMP提供了一种通过运行网络管理软件的中心计算机（即网络管理工作站NMS）来管理网元的方法。共有三个版本：SNMPv1、SNMPv2c和SNMPv3，用户可以根据实际情况选择配置一个或同时配置多个版本。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/9.png"></p>
<blockquote>
<p>•网络管理站（Network Management Station，NMS）<br> 向被管理设备发送各种查询报文，以及接收被管理设备发送的告警。</p>
<p>•被管理设备（Devices）<br> 也就是网络中的各种接受网管的设备。</p>
<p>•代理（Agent）<br> 驻留在被管理设备上的一个进程。Agent的作用如下：</p>
<ul>
<li><p>接收、解析来自网管站的查询报文。</p>
</li>
<li><p>根据报文类型对管理变量进行Read或Write操作，并生成响应报文，返回给网管站。</p>
</li>
<li><p>根据各协议模块对告警触发条件的定义，当发生某个事件（如端口UP/DOWN，STP拓扑变更、OSPF邻居关系DOWN掉等）的时候，主动触发一个告警，向网管站报告该事件。</p>
</li>
</ul>
<p>•MIB（Management Information Base ）是一个数据库，指明了被管理设备所维护的变量（即能够被Agent查询和设置的信息）。MIB在数据库中定义了被管理设备的一系列属性：对象的名称、对象的状态、对象的访问权限和对象的数据类型等。</p>
<p>•OID（Object IDentifier）：MIB是以树状结构进行存储的，树的节点表示管理对象Object，对象可以用从根Root开始的一条路径来唯一的识别，这就是OID也即对象标示符</p>
</blockquote>
<h2 id="SNMP的应用场景"><a href="#SNMP的应用场景" class="headerlink" title="SNMP的应用场景"></a>SNMP的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/10.png"></p>
<h2 id="NETCONF"><a href="#NETCONF" class="headerlink" title="NETCONF"></a>NETCONF</h2><p>NETCONF是一种基于XML的网络配置协议，它存在的目的在于用可编程的方式实现网络配置的自动化，从而简化、加速网络服务地部署。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/11.png"></p>
<blockquote>
<p>•NETCONF使用SSH实现安全传输，使用RPC(Remote Procedure Call)远程调用的机制实现客户端和服务端的通信。</p>
<p>•NETCONF消息以XML格式呈现。</p>
</blockquote>
<h2 id="NETCONF的应用场景"><a href="#NETCONF的应用场景" class="headerlink" title="NETCONF的应用场景"></a>NETCONF的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/12.png"></p>
<blockquote>
<p>•NETCONF提供一套管理网络设备的机制。用户可以使用这套机制增加、修改、删除、备份、恢复、锁定、解锁网络设备的配置，同时还具备事务和会话操作功能，从而来获取网络设备的配置和状态信息。</p>
</blockquote>
<h2 id="NetStream"><a href="#NetStream" class="headerlink" title="NetStream"></a>NetStream</h2><p>•NetStream技术是一种基于网络流信息的统计技术，可以对网络中的业务流量情况进行统计和分析。在网络的接入层、汇聚层、核心层上，都可以通过部署NetStream。</p>
<p>•NetStream支持IP报文（UDP、TCP、ICMP报文）和MPLS报文的统计。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/13.png"></p>
<blockquote>
<p>•一个典型的NetStream系统由网络流数据输出器（NetStream Data Exporter, NDE）、网络流数据收集器（NetStream Collector, NSC）和网络流数据分析器（NetStream Data Analyzer, NDA）三部分组成。</p>
<ul>
<li><p>NDE：负责对网络流进行分析处理，提取符合条件的流进行统计，并将统计信息输出给 NDA（NetStream Data Analyzer）设备。 输出前也可对数据进行一些处理， 比如聚合。 配置了NetStream功能的设备在 NetStream 系统中担当 NDE 角色。</p>
</li>
<li><p>NSC：通常为运行于 Unix 或者 Windows 上的一个应用程序，负责解析来自 NDE 的报文，把统计数据收集到数据库中，可供 NDA 进行解析。 NSC 可以采集多个 NDE 设备输出的数据，对数据进行进一步的过滤和聚合。</p>
</li>
<li><p>NDA：是一个网络流量分析工具，它从 NSC 中提取统计数据，进行进一步的加工处理，生成报表，为各种业务提供依据（比如流量计费、网络规划，攻击监测）。通常， NDA 具有图形化用户界面，使用户可以方便地获取、显示和分析收集到的数据。 </p>
</li>
</ul>
<p>•NetStream流输出方式：</p>
<ul>
<li><p>原始流输出方式：在流老化时间超时后，每条流的统计信息都要输出到NSC。原始流输出方式的优点是：NSC可以得到每条流的详细统计信息。</p>
</li>
<li><p>聚合流输出方式：聚合流输出方式是指设备对与聚合关键项完全相同的原始流统计信息进行汇总，从而得到对应的聚合流统计信息。通过对原始流进行聚合后输出，可以明显减少网络带宽。</p>
</li>
</ul>
</blockquote>
<h2 id="NetStream的应用场景"><a href="#NetStream的应用场景" class="headerlink" title="NetStream的应用场景"></a>NetStream的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/14.png"></p>
<blockquote>
<p>•在实际的应用中，NSC和NDA一般集成在一台NetStream服务器上。NDE通过NetStream采样获取GE0/0/1接口出方向流量信息，并按照一定条件建立NetStream流，当NetStream缓存区已满或者NetStream流达到老化时间，NDE会将统计的信息封装成NetStream报文发送到NetStream服务器。NetStream服务器对NetStream报文进行分析处理，并显示分析结果。</p>
<p>•传统的流量统计的实现方法和局限性：</p>
<ul>
<li><p>基于IP报文计数：统计的信息简单，无法针对多种信息进行统计。</p>
</li>
<li><p>使用ACL：要求ACL的容量很大，对于ACL规则以外的流没有办法统计。</p>
</li>
<li><p>SNMP协议：功能不强。要不断的通过轮询向网管查询，浪费CPU和网络资源。</p>
</li>
<li><p>端口镜像：成本高，同时消耗设备的一个接口，对于无法镜像的端口无能为力。</p>
</li>
<li><p>物理层复制：成本高，同时还需要购买专用的硬件设备。</p>
</li>
</ul>
</blockquote>
<h2 id="sFlow"><a href="#sFlow" class="headerlink" title="sFlow"></a>sFlow</h2><p>•采样流sFlow（Sampled Flow）是一种基于报文采样的网络流量监控技术，基于Flow采样可以截取原始报文的全部，也可以截取一部分报头。</p>
<p>•sFlow系统包含一个嵌入在设备中的sFlow Agent和远端的sFlow Collector。其中，sFlow Agent通过<strong>sFlow采样</strong>获取接口统计信息和数据信息，将信息封装成<strong>sFlow报文</strong>发送到指定的sFlow Collector。sFlow Collector对sFlow报文进行分析，并显示分析结果。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/15.png"></p>
<blockquote>
<p>•Flow采样是sFlow Agent设备在指定接口上按照特定的采样方向和采样比对报文进行采样分析，用于获取报文数据内容的相关信息。该采样方式主要是关注流量的细节，这样就可以监控和分析网络上的流行为。</p>
<ul>
<li>Flow采样可以截取原始报文的全部，也可以截取一部分报头。</li>
</ul>
<p>•Counter采样是sFlow Agent设备周期性的获取接口上的流量统计信息，Counter采样支持获取的采样信息。与Flow采样相比，Counter采样只关注接口上流量的数量，而不关注流量的详细信息。</p>
</blockquote>
<h2 id="sFlow的应用场景"><a href="#sFlow的应用场景" class="headerlink" title="sFlow的应用场景"></a>sFlow的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/16.png"></p>
<blockquote>
<p>•如图所示，只需要在支持sFlow Agent的设备上进行部署，远端连接一个sFlow Collector，就可以对流量进行基于接口的搜集和详细的分析。</p>
<p>•使用 NetStream 也可以对网络流量进行统计分析， 而 NetStream 是一种基于网络流信息的统计技术，网络设备自身需要对网络流进行初步的统计分析，并把统计信息储存在缓存区，当缓存区满或者流统计信息老化后输出统计信息。 与 NetStream 相比， sFlow不需要缓存区，网络设备仅进行报文的采样工作，网络流的统计分析工作由远端的采集器完成。 </p>
<p>•sFlow 与 NetStream 比较具有以下优势：</p>
<ul>
<li><p>节省资源、降低成本：由于不需要缓存区，对网络设备的资源占用少，实现成本低。</p>
</li>
<li><p> 采集器灵活、随需的部署：由于网络流的分析和统计工作由采集器完成，采集器可以灵活的配置网络流特征进行统计分析，实现灵活、随需的部署。</p>
</li>
</ul>
</blockquote>
<h2 id="Telemetry"><a href="#Telemetry" class="headerlink" title="Telemetry"></a>Telemetry</h2><p>•Telemetry，也称为Network Telemetry，即网络遥测技术。主要用于监控网络，包括报文检查和分析，安全侵入和攻击检测，智能收集数据，应用的性能管理等。</p>
<p>•Telemetry优势：</p>
<p>​    ▫支持多种实现方式，满足用户的不同需求。</p>
<p>​    ▫采集数据的精度高，且类型十分丰富，充分反映网络状况。</p>
<p>​    ▫一次订阅，持续上报。</p>
<p>​    ▫故障定位更快速、精准。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/17.png"></p>
<blockquote>
<p>•随着网络的普及和新技术的涌现，网络规模日益增大，部署的复杂度逐步提升，用户对业务的质量要求也不断提高。为了满足用户需求，网络运维务必更加精细化、智能化。当今网络的运维面临着如下挑战：</p>
<ul>
<li><p>超大规模：管理的设备数目众多，监控的信息数量非常庞大。</p>
</li>
<li><p>快速定位：在复杂的网络中，能够快速地定位故障，达到秒级、甚至亚秒级的故障定位速。</p>
</li>
<li><p>精细监控：监控的数据类型更多，且监控粒度更细，以便完整、准确地反应网络状况，据此预估可能发生的故障，并为网络优化提供有力的数据依据。网络运维不仅需要监控接口上的流量统计信息、每条流上的丢包情况、 CPU 和内存占用情况，还需要监控每条流的时延抖动、每个报文在传输路径上的时延、每台设备上的缓冲区占用情况等。</p>
</li>
</ul>
<p>•采集器、分析器和控制器都位于网管侧。</p>
<ul>
<li><p>采集器用于接收和存储网络设备上报的监控数据。</p>
</li>
<li><p>分析器用于分析采集器接收到的监控数据，并对数据进行处理，例如以图形化界面的形式展现给用户。</p>
</li>
<li><p>控制器通过 NETCONF 等方式向设备下发配置，实现对网络设备的管理。控制器可以根据分析器提供的分析数据，为网络设备下发配置，对网络设备的转发行为进行调整；也可以控制网络设备对哪些数据进行采样和上报 。 </p>
</li>
</ul>
</blockquote>
<h2 id="Telemetry的应用场景"><a href="#Telemetry的应用场景" class="headerlink" title="Telemetry的应用场景"></a>Telemetry的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/18.png"></p>
<blockquote>
<p>•gRPC（Google Remote Procedure Call， Google 远程过程调用） 是 Google 发布的基于 HTTP 2.0传输层协议承载的高性能开源软件框架，提供了支持多种编程语言的、 对网络设备进行配置和管理的方法。</p>
<p>•传统的网络监控手段（SNMP、CLI、日志）已无法满足网络需要：</p>
<p>•SNMP 和 CLI 主要采用“拉模式”获取数据，即发送请求来获取设备上的数据，限制了可以监控的网络设备数量，且无法快速获取数据。</p>
<p>•SNMP Trap 和日志虽然采用“推模式”获取数据，即设备主动将数据上报给监控设备，但仅上报事件和告警，监控的数据内容极其有限，无法准确地反映网络状况。 </p>
<p>•Telemetry 是一项监控设备性能和故障的远程数据采集技术。它采用“推模式”及时获取丰富的监控数据，可以实现网络故障的快速定位，从而解决上述网络运维问题。</p>
</blockquote>
<h2 id="Syslog"><a href="#Syslog" class="headerlink" title="Syslog"></a>Syslog</h2><p>•Syslog是一种工业标准的协议，可用来记录设备的日志。在UNIX系统，路由器、交换机等网络设备中，系统日志（System Log）记录系统中任何时间发生的大小事件。管理者可以通过查看系统记录，随时掌握系统状况。</p>
<p>•Syslog协议提供了一种通过IP网络传送事件消息的机制，它允许主机将事件消息通过IP网络传输到接收消息的主机上，这些主机通常称为syslog server。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/19.png"></p>
<blockquote>
<p>•该协议从最初的加州大学伯克利分校软件中心整理，后来由于其操作管理的实用性迅速成为很多网络设备操作管理协议的一部分。现在已经有相应的RFC3164,RFC3195进行通用的定义。前者定义的是使用UDP形式传输，后者定义的是使用TCP形式传输。</p>
<p>•几乎所有的网络设备都可以通过syslog protocol将日志信息以UDP方式传送到远端服务器，远端接收日志服务器必须通过syslogd来监听UDP Port 514，并且根据syslog.conf中的配置来处理本机和接收访问系统的日志信息，把指定的事件写入特定档案中，供后台数据库管理和响应之用。</p>
<p>•角色分类</p>
<ul>
<li><p>发送者 sender：产生syslog message的网元；</p>
</li>
<li><p>中继 relay：能接收到后进行转发syslog message的网元或其他设备；</p>
</li>
<li><p>收集者 collector：接收了不再转发syslog message的syslog server；</p>
</li>
</ul>
</blockquote>
<h2 id="其他-LLDP"><a href="#其他-LLDP" class="headerlink" title="其他 - LLDP"></a>其他 - LLDP</h2><p>LLDP（Link Layer Discovery Protocol）是IEEE 802.1ab中定义的链路层发现协议，可以将本端设备的管理地址、设备标识、接口标识等信息组织起来，并发布给自己的邻居设备，邻居设备收到这些信息后将其以标准的管理信息库MIB（Management Information Base）的形式保存起来，以供网络管理系统查询及判断链路的通信状况。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/20.png"></p>
<blockquote>
<p>•LLDP是一种邻近发现协议。它为以太网网络设备，如交换机、路由器和无线局域网接入点定义了一种标准的方法，使其可以向网络中其他节点公告自身的存在，并保存各个邻近设备的发现信息。例如设备配置和设备识别等详细信息都可以用该协议进行公告。</p>
<p>•LLDP信息是定期传输的，并且只在一定的期限内保留。IEEE已经定义了一个建议的传输频率，即每30秒传输一次。LLDP设备在收到邻近网络设备发出的LLDP信息后，将把LLDP信息存储在一个IEEE定义的简单网络管理协议（SNMP）管理信息库（MIB）中，并且在一定的时限内保持有效。定义该时限的LLDP“生存时间”（TTL）值就包含在所收到的数据包内。</p>
<p>•该协议使网络管理系统能够精确地发现和模拟物理网络拓扑结构。由于LLDP设备发送和接收公告，这些设备将会把自己发现的邻近设备信息存储下来。公告数据，如邻近设备的管理地址、设备类型和端口号，都有助于确定邻近设备到底属于什么类型，以及它们通过哪些端口实现互联。</p>
<p>•单邻居组网模式：</p>
<ul>
<li>单邻居组网模式是指交换机设备的接口之间直接相连，而且接口只有一个邻居设备的情况。</li>
</ul>
<p>•链路聚合组网模式：</p>
<ul>
<li>链路聚合组网模式是指交换机设备的接口之间存在链路聚合，接口之间是直接相连，链路聚合之间的每个接口只有一个邻居设备。</li>
</ul>
</blockquote>
<h2 id="LLDP的应用场景"><a href="#LLDP的应用场景" class="headerlink" title="LLDP的应用场景"></a>LLDP的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/21.png"></p>
<blockquote>
<p>•Eth-Trunk以太网链路聚合，简称链路聚合，它通过将多条以太网物理链路捆绑在一起成为一条逻辑链路，从而实现增加链路带宽的目的。</p>
</blockquote>
<h2 id="其他-–-镜像"><a href="#其他-–-镜像" class="headerlink" title="其他 – 镜像"></a>其他 – 镜像</h2><p>镜像是指将镜像端口（源端口）的报文复制到观察端口（目的端口）。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/22.png"></p>
<blockquote>
<p>•在网络维护的过程中会遇到需要对报文进行获取和分析的情况，比如怀疑有攻击报文，此时需要在不影响报文转发的情况下，对报文进行获取和分析。镜像可以在不影响报文正常处理流程的情况下，将镜像端口的报文复制一份到观察端口，用户利用数据监控设备来分析复制到观察端口的报文，进行网络监控和故障排除。</p>
<p>•基本概念：</p>
<ul>
<li><p>镜像端口是被监控的端口，从镜像端口流经的所有报文或匹配流分类规则的报文将被复制到观察端口。</p>
</li>
<li><p>观察端口是连接监控设备的端口，用于输出从镜像端口复制过来的报文。</p>
</li>
<li><p>观察端口组是连接多个监控设备的一组端口。观察端口组中的多个成员端口分别连接多个监控设备，当使用观察端口组镜像报文时，镜像到观察端口组的报文将被复制到所有的成员端口。</p>
</li>
</ul>
<p>•端口镜像：是指设备复制一份从镜像端口流经的报文，并将此报文传送到指定的观察端口进行分析和监控</p>
<p>•流镜像：是将镜像端口上特定业务流的报文复制到观察端口进行分析和监控。在流镜像中，镜像端口应用了包含流镜像行为的流策略。如果从镜像端口流经的报文匹配流分类规则，则将被复制到观察端口。</p>
</blockquote>
<h2 id="镜像的应用场景"><a href="#镜像的应用场景" class="headerlink" title="镜像的应用场景"></a>镜像的应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/23.png"></p>
<blockquote>
<p>•在某些场景中，我们可能需要监控交换机特定端口的入站或出站报文，或者需要针对特定的流量进行分析，例如上图中，GE0/0/2口上承载了许多流量，基于某种需求，我需要对接口的收发报文进行分析从而进行网络的故障定位。那么我可以在交换机的GE0/0/3口接一个PC，在PC上安装协议分析软件，然后部署端口镜像，将GE0/0/2的入、出站流量镜像到GE0/0/3口上来，接下来我只要在PC上通过协议分析软件查看报文即可。</p>
<p>•注意到，如果没有端口镜像技术，除非数据包的目的地是监控PC（所连接的端口），否则报文是不会发向该端口的。因此事实上端口镜像就是将某个特定端口的流量拷贝到某个监控端口。</p>
</blockquote>
<h1 id="4-网络管理的应用场景"><a href="#4-网络管理的应用场景" class="headerlink" title="4.网络管理的应用场景"></a>4.网络管理的应用场景</h1><h2 id="网络管理典型应用场景"><a href="#网络管理典型应用场景" class="headerlink" title="网络管理典型应用场景"></a>网络管理典型应用场景</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/24.png"></p>
<blockquote>
<p>•随着网络的快速发展，数字化转型日益凸显，网络管理逐步从面向网元管理的方式转到面向场景的自动化。</p>
<p>•网络管控系统是自治网络的演进方向，包含了控制器、分析器和管理器。</p>
<p>•SNMP和NETCONF一般用于配置下发，Telemetry、Netstream和sFlow一般用于数据上报。</p>
</blockquote>
<h2 id="什么是iMaster-NCE？"><a href="#什么是iMaster-NCE？" class="headerlink" title="什么是iMaster NCE？"></a>什么是iMaster NCE？</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/25.png"></p>
<h2 id="iMaster-NCE产品架构和客户价值"><a href="#iMaster-NCE产品架构和客户价值" class="headerlink" title="iMaster NCE产品架构和客户价值"></a>iMaster NCE产品架构和客户价值</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D/26.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（多选题）网络管理体系结构包含的两个关键元素是什么（ ）</p>
<p><strong>A. 管理设备</strong></p>
<p><strong>B. 被管理设备</strong></p>
<p>C. 代理     </p>
<p>D. 网管协议</p>
<p>2.（多选题）网络管理的基本功能，以下描述正确的是（  ）</p>
<p><strong>A. 配置管理</strong></p>
<p><strong>B. 性能管理</strong>  </p>
<p><strong>C. 故障管理</strong>  </p>
<p><strong>D. 安全管理</strong></p>
<p><strong>E. 计费管理</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•随着数字化技术的快速发展，大数据、AI、云等技术与业务的发展交织在一起，促进了网络管理的变革。网络管理将逐渐向管理自动化和运维智能化方向发展。</p>
<p>•网络管理主要由四个主要模型组成，包括组织结构模型、信息模型、通信模型和功能模型。</p>
<p>•本章节主要从网络管理的配置、性能和故障三大功能来介绍相应的网络管理协议。各个不同协议的讲解主要从角色、数据组织和典型管理方式，三个维度展开。</p>
<h1 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h1><p>•RFC 6241 - Network Configuration Protocol</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6241">https://tools.ietf.org/html/rfc6241</a></li>
</ul>
<p>•Network Telemetry Framework - IETF Tools</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://tools.ietf.org/id/draft-song-opsawg-ntf-02.html">https://tools.ietf.org/id/draft-song-opsawg-ntf-02.html</a></li>
</ul>
<p>•学习推荐</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://e.huawei.com/cn/talent/#/home">https://e.huawei.com/cn/talent/#/home</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/" itemprop="url">IP-DHCP原理与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T21:07:42+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/DHCP.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•随着网络规模的不断扩大，网络复杂度不断提升，网络中的终端设备例如主机、手机、平板等，位置经常变化。终端设备访问网络时需要配置IP地址、网关地址、DNS服务器地址等。采用手工方式为终端配置这些参数非常低效且不够灵活。</p>
<p>•IETF于1993年发布了DHCP（Dynamic Host Configuration Protocol，动态主机配置协议）。DHCP实现了网络参数配置的自动化，降低客户端的配置和维护成本。</p>
<p>•本课程介绍DHCP工作原理、应用场景和简单配置。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述DHCP工作原理</p>
<p>▫描述DHCP地址分配规则</p>
<p>▫区分DHCP与DHCP Relay的应用场景</p>
<p>▫实现DHCP的基本配置</p>
<h1 id="1-DHCP产生背景"><a href="#1-DHCP产生背景" class="headerlink" title="1.DHCP产生背景"></a>1.DHCP产生背景</h1><h2 id="手工配置网络参数存在的问题"><a href="#手工配置网络参数存在的问题" class="headerlink" title="手工配置网络参数存在的问题"></a>手工配置网络参数存在的问题</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/1.png"></p>
<blockquote>
<p>•手工配置主机IP地址、网络掩码、网关地址、DNS服务器地址等网络参数时，需要经过地址规划、地址分配、地址配置、地址维护等复杂的操作流程。这使地址分配灵活性差，IP地址资源利用低，同时较大的工作量导致配置容易出错，对人员素质要求较高。</p>
</blockquote>
<h2 id="DHCP的基本概念"><a href="#DHCP的基本概念" class="headerlink" title="DHCP的基本概念"></a>DHCP的基本概念</h2><p>•DHCP是一种用于集中对用户IP地址进行动态管理和配置的协议。</p>
<p>•DHCP采用C/S(Client/Server，客户端/服务器)通信模式，协议报文基于UDP的方式进行交互，采用67（DHCP服务器）和68（DHCP客户端）两个端口号：</p>
<p>​    ▫正常工作时由客户端向服务器提出配置申请。</p>
<p>​    ▫服务器返回为客户端分配的IP地址等相应的配置信息。</p>
<p>•DHCP相对于手工配置有如下优点：</p>
<p>​    ▫效率高</p>
<p>​    ▫灵活性强</p>
<p>​    易于管理</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/2.png"></p>
<blockquote>
<p>•网络终端设备，例如主机、打印机、笔记本电脑、手机和AP，作为DHCP客户端，向DHCP服务器请求分配相关网络参数。DHCP服务器响应DHCP客户端请求进行动态分配。</p>
</blockquote>
<h1 id="2-DHCP工作原理与配置"><a href="#2-DHCP工作原理与配置" class="headerlink" title="2.DHCP工作原理与配置"></a>2.DHCP工作原理与配置</h1><h2 id="DHCP客户端首次接入网络的工作原理"><a href="#DHCP客户端首次接入网络的工作原理" class="headerlink" title="DHCP客户端首次接入网络的工作原理"></a>DHCP客户端首次接入网络的工作原理</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/3.png"></p>
<ol>
<li>发现阶段，即DHCP客户端发现DHCP服务器的阶段。</li>
</ol>
<ul>
<li>DHCP客户端发送DHCP DISCOVER报文来发现DHCP服务器。DHCP DISCOVER报文中携带了客户端的MAC地址、需要请求的参数列表选项、广播标志位等信息。</li>
</ul>
<ol start="2">
<li>提供阶段，即DHCP服务器提供网络配置信息的阶段。</li>
</ol>
<ul>
<li>服务器接收到DHCP DISCOVER报文后，选择跟接收DHCP DISCOVER报文接口的IP地址处于同一网段的地址池，并且从中选择一个可用的IP地址，然后通过DHCP OFFER报文发送给DHCP客户端。</li>
</ul>
<ol start="3">
<li>选择阶段，即DHCP客户端选择IP地址的阶段。</li>
</ol>
<ul>
<li><p>如果有多个DHCP服务器向DHCP客户端回应DHCP OFFER报文，则DHCP客户端一般只接收第一个收到的DHCP OFFER报文，然后以广播方式发送DHCP REQUEST报文，该报文中包含客户端想选择的DHCP服务器标识符和客户端IP地址。</p>
<p>4.确认阶段，即DHCP服务器确认所分配IP地址的阶段。</p>
</li>
<li><p>DHCP客户端收到DHCP ACK报文，会广播发送免费ARP报文，探测本网段是否有其他终端使用服务器分配的IP地址。</p>
</li>
</ul>
<blockquote>
<p>•在确认阶段，两种情况可能出现IP地址的冲突：</p>
<ul>
<li><p>DHCP服务器收到DHCP DISCOVER报文时，给客户端分配IP地址前会发送Ping探测，如果能Ping通则标识该地址不可用，并选择其他IP地址分配给客户端。</p>
</li>
<li><p>DHCP客户端获取IP地址成功后，会立即发送免费ARP报文，如果收到响应，则发送DHCP DECLINE报文通知DHCP服务器该IP地址冲突，DHCP服务器标识该地址不可用，客户端发送DHCP DISCOVER报文重新申请IP地址。</p>
</li>
</ul>
</blockquote>
<h2 id="DHCP报文格式"><a href="#DHCP报文格式" class="headerlink" title="DHCP报文格式"></a>DHCP报文格式</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/4.png"></p>
<blockquote>
<p>•Htype （hardware type）: 表示硬件地址的类型。</p>
<p>•Hlen（hardware length）: 表示硬件地址的长度。</p>
<p>•Hops（hops）: 表示当前DHCP报文经过的DHCP Relay数目。该字段由客户端设置为0，每经过一个DHCP Relay时，该字段加1。此字段的作用是限制DHCP报文所经过的DHCP Relay数目。</p>
<p>•Xid：表示DHCP客户端选取的随机数，使DHCP服务器的回复与DHCP客户端的报文相关联。</p>
<p>•Sname（server host name）: 表示客户端获取配置信息的服务器名字。此字段由DHCP服务器填写，是可选的。如果填写，必须是一个以0结尾的字符串。</p>
<p>•File（file name）: 表示客户端启动DHCP相关配置的文件名。此字段由DHCP服务器填写，随着DHCP地址分配的同时下发至客户端。本字段是可选的，如果填写，必须是一个以0结尾的字符串。</p>
</blockquote>
<h2 id="Options预定义选项字段介绍"><a href="#Options预定义选项字段介绍" class="headerlink" title="Options预定义选项字段介绍"></a>Options预定义选项字段介绍</h2><p>•DHCP报文中Options字段为可变长度字段，最多为312Byte，此字段包含了DHCP报文类型，服务器分配给终端的配置信息，如网关IP地址，DNS服务器的IP地址，客户端可以使用IP地址的有效租期等信息。</p>
<p>•Options字段由Type、Length和Value三部分组成。其中Type字段取值范围1~255。常见的Options如下表所示：</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/5.png"></p>
<h2 id="DHCP的消息类型"><a href="#DHCP的消息类型" class="headerlink" title="DHCP的消息类型"></a>DHCP的消息类型</h2><p>DHCP报文通过Options选项中的Type=53来表示DHCP的报文类型。如下图所示，当Type=53，Length=1，Value取值从01到08分别表示不同的DHCP报文类型。</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/6.png"></p>
<blockquote>
<p>•1-DHCP DISCOVER：DHCP客户端首次登录网络时进行DHCP交互过程发送的第一个消息，用来寻找DHCP服务器。</p>
<p>•2-DHCP OFFER：DHCP服务器用来响应DHCP DISCOVER消息，此消息携带了各种配置信息。 </p>
<p>•3-DHCP REQUEST：DHCP客户端广播请求回应DHCP服务器OFFER消息；DHCP客户端重启广播确认之前的IP地址等配置信息；续租。</p>
<p>•4-DHCP DECLINE：当客户端发现服务器分配给它的IP地址发生冲突时会通过发送此消息来通知服务器。</p>
<p>•5-DHCP ACK：DHCP服务器对客户端的DHCP REQUEST消息的确认响应消息。</p>
<p>•6-DHCP NAK：服务器对客户端的DHCP REQUEST消息的拒绝响应消息。</p>
<p>•7-DHCP RELEASE：客户端可通过发送此消息主动释放服务器分配给它的IP地址。</p>
<p>•8-DHCP INFORM：DHCP客户端获取IP地址后，如果需要向DHCP服务器获取更为详细的配置信息（网关地址、DNS服务器地址），则向DHCP服务器发送DHCP INFORM请求消息。</p>
</blockquote>
<h2 id="Options自定义选项字段介绍"><a href="#Options自定义选项字段介绍" class="headerlink" title="Options自定义选项字段介绍"></a>Options自定义选项字段介绍</h2><p>除了标准协议中规定的字段选项外，还有部分选项内容没有统一规定，统称为用户自定义选项，例如Option 82和Option 43。</p>
<ul>
<li>Option 82称为中继代理信息选项。<ul>
<li>Option 82中可以包含最多255个Sub-Option，若定义了Option 82，至少要定义一个Sub-Option。</li>
<li>DHCP中继或DHCP Snooping设备接收到DHCP客户端发送给DHCP服务器的请求报文后，在该报文中添加Option 82，并转发给DHCP服务器。管理员可以从Option 82中获得DHCP客户端的信息，例如DHCP客户端所连接交换机端口的VLAN ID、二层端口号、中继设备的MAC地址等。</li>
</ul>
</li>
</ul>
<p>▫Option 43称为厂商特定信息选项。</p>
<ul>
<li>DHCP服务器和DHCP客户端通过Option 43交换厂商特定的信息。当DHCP服务器接收到请求Option 43信息的DHCP请求报文（Option 55中带有Option 43参数）后，将在回复报文中携带Option 43，为DHCP客户端分配厂商指定的信息。</li>
<li>在WLAN组网中，AP作为DHCP客户端，DHCP服务器可以为AP指定AC的IP地址，以方便AP与AC建立连接。</li>
</ul>
<blockquote>
<p>目前option 82中常用的Sub-Option如下：</p>
<p>▫Sub-Option 1：为代理电路id（即circuit id）子项。子选项通常在DHCP中继设备上配置，定义了在传输报文的时候要携带DHCP客户端所连接交换机端口的vlan-id及二层端口号。通常Sub-Option 1与Sub-Option 2子选项要共同使用来标识DHCP源端的信息。</p>
<p>▫Sub-Option 2：代理远程id（即remote id）子项。该子选项也通常在DHCP中继设备上配置，定义了在传输报文的时候要携带中继设备的mac地址信息。</p>
<p>▫和Sub-Option 5：为链路选择（link selection）子项，该选项中包含了DHCP中继添加的ip地址。这样DHCP server在分配ip地址给DHCP客户端的时候就可以分配与该地址同网段的ip地址。</p>
</blockquote>
<h2 id="Option-43应用举例"><a href="#Option-43应用举例" class="headerlink" title="Option 43应用举例"></a>Option 43应用举例</h2><p>•在WLAN三层组网中，当AP上线时，需要获取AC的IP地址，并与AC之间建立CAPWAP隧道。</p>
<p>•AP的IP地址通过DHCP服务器分配，当AC的IP地址与AP不在同一个广播域，AP无法通过广播的方式获取AC的IP地址，则CAPWAP隧道无法建立成功。</p>
<p>•AP通过DHCP报文中的Option 43选项字段获取AC的IP地址，当AP获取AC的IP地址后，可以进一步完成CAPWAP隧道的建立，从而实现AP上线。</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/7.png"></p>
<h2 id="DHCP地址续租"><a href="#DHCP地址续租" class="headerlink" title="DHCP地址续租"></a>DHCP地址续租</h2><p>DHCP客户端根据IP地址的剩余租期的不同而产生不同形式的续租请求。</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/8.png"></p>
<p>•当租期达到50%（T1）时，DHCP客户端会自动以单播的方式向DHCP服务器发送DHCP REQUEST报文，请求更新IP地址租期。如果收到DHCP服务器回应的DHCP ACK报文，则租期更新成功。</p>
<p>•当租期达到87.5%（T2）时，如果仍未收到DHCP服务器的应答，DHCP客户端会自动以广播的方式向DHCP服务器发送DHCP REQUEST报文，请求更新IP地址租期。如果收到DHCP服务器回应的DHCP ACK报文，则租期更新成功。</p>
<p>•如果租期时间到时都没有收到服务器的回应，客户端停止使用此IP地址，重新发送DHCP DISCOVER报文请求新的IP地址。</p>
<blockquote>
<p>•DHCP服务器给每个分配给客户端的IP地址定义一个使用期限，该使用期限被称为租期。在租期到期前，DHCP客户端如果仍需要使用该IP地址，可以请求延长租期；如果不需要，可以主动释放该IP地址。在没有其他空闲地址可用的情况下，DHCP服务器会把客户端主动释放的IP地址分配给其他客户端。</p>
<p>•DHCP客户端无论在T1还是T2时刻发送DHCP REQUEST报文后，如果收到DHCP NAK报文，则重新发送DHCP DISCOVER报文请求新的IP地址。</p>
<p>•客户端在租期时间到之前，如果用户不想使用分配的IP地址（例如客户端网络位置需要变更），会触发DHCP客户端向DHCP服务器发送DHCP RELEASE报文，通知DHCP服务器释放IP地址的租期。DHCP服务器会保留这个DHCP客户端的配置信息，将IP地址列为曾经分配过的IP地址中，以便后续重新分配给该客户端或其他客户端。客户端可以通过发送DHCP INFORM报文向服务器请求更新配置信息。</p>
</blockquote>
<h2 id="DHCP客户端重用曾经使用过的地址"><a href="#DHCP客户端重用曾经使用过的地址" class="headerlink" title="DHCP客户端重用曾经使用过的地址"></a>DHCP客户端重用曾经使用过的地址</h2><p>DHCP客户端非首次接入网络时，可以重用曾经使用过的地址。例如，网络中的主机作为DHCP客户端，在关机再开机的过程中，需要重新获取相关网络参数，则可以请求分配曾经使用过的IP地址。</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/9.png"></p>
<p>1.选择阶段</p>
<ul>
<li>客户端广播发送包含前一次分配的IP地址的DHCP REQUEST报文，报文中的Option 50（请求的IP地址选项）字段填入曾经使用过的IP地址。</li>
</ul>
<p>2.确认阶段</p>
<ul>
<li>DHCP服务器收到DHCP REQUEST报文后，根据DHCP REQUEST报文中携带的MAC地址来查找有没有相应的租约记录。如果有则返回DHCP ACK报文，通知DHCP客户端可以继续使用这个IP地址，如果没有租约记录，则不响应。</li>
</ul>
<blockquote>
<p>•是否支持重用曾经使用过的IP地址，因不同客户端而异。</p>
</blockquote>
<h2 id="DHCP分配IP地址顺序"><a href="#DHCP分配IP地址顺序" class="headerlink" title="DHCP分配IP地址顺序"></a>DHCP分配IP地址顺序</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/10.png"></p>
<h2 id="DHCP配置命令介绍-1"><a href="#DHCP配置命令介绍-1" class="headerlink" title="DHCP配置命令介绍 (1)"></a>DHCP配置命令介绍 (1)</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/11.png"></p>
<blockquote>
<p>•此处以ip pool的名字为HW举例说明。</p>
<p>•缺省情况下，没有配置为指定DHCP Client分配固定IP地址。</p>
</blockquote>
<h2 id="DHCP配置命令介绍-2"><a href="#DHCP配置命令介绍-2" class="headerlink" title="DHCP配置命令介绍 (2)"></a>DHCP配置命令介绍 (2)</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/12.png"></p>
<blockquote>
<p>•此处以接口GigabitEthernet0/0/1举例说明。</p>
</blockquote>
<h2 id="DHCP配置举例（1）"><a href="#DHCP配置举例（1）" class="headerlink" title="DHCP配置举例（1）"></a>DHCP配置举例（1）</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/13.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/14.png"></p>
<h2 id="DHCP配置举例（2）"><a href="#DHCP配置举例（2）" class="headerlink" title="DHCP配置举例（2）"></a>DHCP配置举例（2）</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/15.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/16.png"></p>
<h2 id="DHCP配置结果"><a href="#DHCP配置结果" class="headerlink" title="DHCP配置结果"></a>DHCP配置结果</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/17.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/18.png"></p>
<h1 id="3-DHCP-Relay工作原理与配置"><a href="#3-DHCP-Relay工作原理与配置" class="headerlink" title="3.DHCP Relay工作原理与配置"></a>3.DHCP Relay工作原理与配置</h1><h2 id="什么是DHCP-Relay"><a href="#什么是DHCP-Relay" class="headerlink" title="什么是DHCP Relay"></a>什么是DHCP Relay</h2><p>•随着网络规模的不断扩大，网络设备不断增多，企业内不同的用户可能分布在不同的网段，一台DHCP服务器在正常情况下无法满足多个网段的地址分配需求。如果还需要通过DHCP服务器分配IP地址，则需要跨网段发送DHCP报文。</p>
<p>•DHCP Relay即DHCP中继，它是为解决DHCP服务器和DHCP客户端不在同一个广播域而提出的，提供了对DHCP广播报文的中继转发功能，能够把DHCP客户端的广播报文“透明地”传送到其它广播域的DHCP服务器上，同样也能够把DHCP服务器端的应答报文“透明地”传送到其它广播域的DHCP客户端。</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/19.png"></p>
<h2 id="DHCP-Relay报文格式"><a href="#DHCP-Relay报文格式" class="headerlink" title="DHCP Relay报文格式"></a>DHCP Relay报文格式</h2><p>DHCP Relay主要负责转发DHCP客户端与DHCP服务器之间的DHCP报文，所以DHCP Relay的报文格式只是把DHCP的报文部分字段做了相应的修改，报文格式没有发生变化，如下图所示：</p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/20.png"></p>
<p>Hops：表示当前的DHCP报文经过的DHCP中继的数目。该字段由客户端或服务器设置为0，每经过一个DHCP中继时，该字段加1。</p>
<p>Giaddr(gateway ip address)：表示第一个DHCP中继的IP地址。当客户端发出DHCP请求时，第一个DHCP中继在将DHCP请求报文转发给DHCP服务器时，会把自己的IP地址填入此字段。</p>
<blockquote>
<p>•Hops字段的作用是限制DHCP报文所经过的DHCP中继数目。服务器和客户端之间的DHCP中继数目不能超过16个，也就是Hops值不能大于16，否则DHCP报文将被丢弃。</p>
<p>•Giaddr字段，DHCP服务器会根据此字段来判断出客户端所在的网段地址，从而选择合适的地址池，为客户端分配该网段的IP地址。服务器还会根据此地址将响应报文发送给此DHCP中继，再由DHCP中继将此报文转发给客户端。若在到达DHCP服务器前经过了多个DHCP中继，该字段作为客户端所在的网段的标记，填充了第一个DHCP中继的IP地址后不会再变更，只是每经过一个DHCP中继，hops字段的数值会加1。</p>
</blockquote>
<h2 id="DHCP-Relay工作原理"><a href="#DHCP-Relay工作原理" class="headerlink" title="DHCP Relay工作原理"></a>DHCP Relay工作原理</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/21.png"></p>
<p>有中继场景时DHCP客户端首次接入网络的工作原理：</p>
<p>1.发现阶段：DHCP中继接收到DHCP客户端广播发送的DHCP DISCOVER报文后，通过路由转发将DHCP报文单播发送到DHCP服务器或下一跳中继。</p>
<p>2.提供阶段：DHCP服务器根据DHCP DISCOVER报文中的Giaddr字段选择地址池为客户端分配相关网络参数，DHCP中继收到DHCP OFFER报文后，以单播或组播方式发送给DHCP Client。</p>
<p>3.选择阶段：中继接收到来自客户端的DHCP REQUEST报文的处理过程同“发现阶段”。</p>
<p>4.确认阶段：中继接收到来自服务器的DHCP ACK报文的处理过程同“提供阶段”。</p>
<blockquote>
<p>1.DHCP中继收到DHCP DISCOVER报文后，处理规则为：</p>
<ul>
<li>检查DHCP报文中的Hops字段，如果大于16，则丢弃DHCP报文；否则，将Hops字段加1（表明经过一次DHCP中继），并继续下面的操作。</li>
<li>检查DHCP报文中的Giaddr字段。如果是0，将Giaddr字段设置为接收DHCP DISCOVER报文的接口IP地址。如果不是0，则不修改该字段，继续下面的操作。</li>
<li>将DHCP报文的目的IP地址改为DHCP服务器或下一跳中继的IP地址，源地址改为中继连接客户端的接口地址，通过路由转发将DHCP报文单播发送到DHCP服务器或下一跳中继。</li>
</ul>
<p>2.DHCP服务器接收到DHCP DISCOVER报文后，选择与报文中Giaddr字段为同一网段的地址池，并为客户端分配IP地址等参数，然后向Giaddr字段标识的DHCP中继单播发送DHCP OFFER报文，DHCP中继收到DHCP OFFER报文后，会进行如下处理：</p>
<ul>
<li><p>检查报文中的Giaddr字段，如果不是接口的地址，则丢弃该报文；否则，继续下面的操作。</p>
</li>
<li><p>DHCP中继检查报文的广播标志位。如果广播标志位为1，则将DHCP OFFER报文广播发送给DHCP客户端；否则将DHCP OFFER报文单播发送给DHCP客户端。</p>
</li>
</ul>
</blockquote>
<h2 id="DHCP-Relay配置命令介绍"><a href="#DHCP-Relay配置命令介绍" class="headerlink" title="DHCP Relay配置命令介绍"></a>DHCP Relay配置命令介绍</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/22.png"></p>
<h2 id="DHCP-Relay配置举例-1"><a href="#DHCP-Relay配置举例-1" class="headerlink" title="DHCP Relay配置举例 (1)"></a>DHCP Relay配置举例 (1)</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/23.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/24.png"></p>
<blockquote>
<p>•各个设备配置DHCP前需要在全局视图下通过DHCP enable命令开启DHCP功能。</p>
</blockquote>
<h2 id="DHCP-Relay配置举例-2"><a href="#DHCP-Relay配置举例-2" class="headerlink" title="DHCP Relay配置举例 (2)"></a>DHCP Relay配置举例 (2)</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/25.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/26.png"></p>
<h2 id="DHCP-Relay配置验证"><a href="#DHCP-Relay配置验证" class="headerlink" title="DHCP Relay配置验证"></a>DHCP Relay配置验证</h2><p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/27.png"></p>
<p><img src="/2021/05/17/IP-DHCP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/28.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）DHCP客户端向DHCP Server进行续租时会发送哪种报文？</p>
<p>A.DHCP DISCOVER</p>
<p>B.DHCP OFFER</p>
<p><strong>C.DHCP REQUEST</strong></p>
<p>D.DHCP ACK</p>
<p>2.（单选题）以下哪条命令可以开启路由器接口的DHCP中继功能？</p>
<p>A.DHCP select server</p>
<p>B.DHCP select global</p>
<p>C.DHCP select interface</p>
<p><strong>D.DHCP select relay</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•本章节主要讲解了DHCP报文的格式及关键字段的作用。通过报文交互介绍了DHCP服务器如何给DHCP客户端分配IP地址等网络参数的过程，同时阐述了地址续租与DHCP客户端重启之后如何获取IP地址的原理。</p>
<p>•当DHCP客户端与DHCP服务器不在一个广播域的时候，通过DHCP Relay的中继功能，实现DHCP报文的跨网段传输，从而完成DHCP客户端与服务器之间的报文协商。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/" itemprop="url">IP-VRRP原理与配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T20:53:26+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•局域网中的用户终端通常采用配置一个默认网关的形式访问外部网络，如果默认网关设备发生故障，那么所有用户终端访问外部网络的流量将会中断。可以通过部署多个网关的方式来解决单点故障，但是需要解决多个网关之间的冲突问题。</p>
<p>•VRRP（Virtual Router Redundancy Protocol，虚拟路由器冗余协议）既能够实现网关的备份，又能解决多个网关之间互相冲突的问题，从而提高网络可靠性。</p>
<p>•本课程主要介绍VRRP的工作原理与基本配置，以及在网络中的典型应用。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫分析局域网单网关引发的问题</p>
<p>▫阐述VRRP基本概念及工作原理</p>
<p>▫描述VRRP主备切换过程</p>
<p>▫实现VRRP基本配置</p>
<h1 id="1-VRRP技术概述"><a href="#1-VRRP技术概述" class="headerlink" title="1.VRRP技术概述"></a>1.VRRP技术概述</h1><h2 id="单网关面临的问题"><a href="#单网关面临的问题" class="headerlink" title="单网关面临的问题"></a>单网关面临的问题</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/1.png"></p>
<h2 id="VRRP概述"><a href="#VRRP概述" class="headerlink" title="VRRP概述"></a>VRRP概述</h2><p>通过把几台路由设备联合组成一台虚拟的“路由设备”，使用一定的机制保证当主机的下一跳路由设备出现故障时，及时将业务切换到备份路由设备，从而保持通讯的连续性和可靠性。</p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/2.png"></p>
<blockquote>
<p>•VRRP的运行结果是在局域网上提供一个虚拟路由器。</p>
<p>•本例中：</p>
<ul>
<li><p>局域网中有两个路由器R1和R2，R1端口IP地址为192.168.1.251/24，R2端口IP地址为192.168.1.252/24。</p>
</li>
<li><p>配置R1和R2关联到同一个虚拟路由器，该虚拟路由器使用192.168.1.254做为端口IP地址。</p>
</li>
<li><p>所有的PC使用192.168.1.254做为默认网关。</p>
</li>
</ul>
</blockquote>
<h2 id="VRRP的基本概念-1"><a href="#VRRP的基本概念-1" class="headerlink" title="VRRP的基本概念 (1)"></a>VRRP的基本概念 (1)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/3.png"></p>
<p>•<strong>VRRP路由器：</strong>运行VRRP协议的路由器，如R1和R2。VRRP是配置在路由器的接口上的，而且也是基于接口来工作的。</p>
<p>•<strong>VRID：</strong>一个VRRP组（VRRP Group）由多台协同工作的路由器（的接口）组成，使用相同的VRID（Virtual Router Identifier，虚拟路由器标识符）进行标识。属于同一个VRRP组的路由器之间交互VRRP协议报文并产生一台虚拟“路由器”。一个VRRP组中只能出现一台Master路由器。 </p>
<h2 id="VRRP的基本概念-2"><a href="#VRRP的基本概念-2" class="headerlink" title="VRRP的基本概念 (2)"></a>VRRP的基本概念 (2)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/4.png"></p>
<p>•<strong>虚拟路由器：</strong>VRRP为每一个组抽象出一台虚拟“路由器”（Virtual Router），该路由器并非真实存在的物理设备，而是由VRRP虚拟出来的逻辑设备。一个VRRP组只会产生一台虚拟路由器。</p>
<p>•<strong>虚拟IP地址及虚拟MAC地址：</strong>虚拟路由器拥有自己的IP地址以及MAC地址，其中IP地址由网络管理员在配置VRRP时指定，一台虚拟路由器可以有一个或多个IP地址，通常情况下用户使用该地址作为网关地址。而虚拟MAC地址的格式是“0000-5e00-01xx”，其中xx为VRID。</p>
<h2 id="VRRP的基本概念-3"><a href="#VRRP的基本概念-3" class="headerlink" title="VRRP的基本概念 (3)"></a>VRRP的基本概念 (3)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/5.png"></p>
<p>•<strong>Master路由器：</strong>“Master路由器”在一个VRRP组中承担报文转发任务。在每一个VRRP组中，只有Master路由器才会响应针对虚拟IP地址的ARP Request。Master路由器会以一定的时间间隔周期性地发送VRRP报文，以便通知同一个VRRP组中的Backup路由器关于自己的存活情况。</p>
<p>•<strong>Backup路由器：</strong>也被称为备份路由器。Backup路由器将会实时侦听Master路由器发送出来的VRRP报文，它随时准备接替Master路由器的工作。</p>
<p>•<strong>Priority：</strong>优先级值是选举Master路由器和Backup路由器的依据，优先级取值范围0-255，值越大越优先，值相等则比较接口IP地址大小，大者优先。</p>
<h2 id="VRRP报文格式"><a href="#VRRP报文格式" class="headerlink" title="VRRP报文格式"></a>VRRP报文格式</h2><p>VRRP只有一种报文，即Advertisement报文，基于组播方式发送，因此只能在同一个广播域传递。 Advertisement报文的目的组播地址为224.0.0.18。</p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/6.png"></p>
<blockquote>
<p>VRRP报文字段含义如下：</p>
<p>▫Ver：VRRP目前有两个版本，其中VRRPv2仅适用于IPv4网络，VRRPv3适用于IPv4和IPv6两种网络。</p>
<p>▫Virtual Rtr ID：该报文所关联的虚拟路由器的标识。</p>
<p>▫Priority：发送该报文的VRRP路由器的优先级。</p>
<p>▫Count IP Addrs：该VRRP报文中所包含的虚拟IP地址的数量。</p>
<p>▫Auth Type：VRRP支持三种认证类型：不认证、纯文本密码认证、MD5方式认证，对应值分别为0、1、2。</p>
<p>▫Adver Int：发送VRRP通告消息的间隔。默认为1秒</p>
<p>▫IP Address：所关联的虚拟路由器的虚拟IP地址，可以为多个。</p>
<p>▫Authentication Data：验证所需要的密码信息。</p>
</blockquote>
<h2 id="VRRP定时器"><a href="#VRRP定时器" class="headerlink" title="VRRP定时器"></a>VRRP定时器</h2><p>在VRRP协议工作过程中，VRRP定义了两个定时器：</p>
<p>▫ADVER_INTERVAL定时器：Master发送VRRP通告报文时间周期，缺省值为1秒。</p>
<p>▫MASTER_DOWN定时器：Backup设备监听该定时器超时后，会变为Master状态。<br>     MASTER_DOWN定时器计算公式如下：</p>
<ul>
<li>MASTER_DOWN =（3* ADVER_INTERVAL）+ Skew_time（偏移时间）</li>
<li>其中，Skew_Time=（256–Priority）/256</li>
</ul>
<h1 id="2-VRRP技术原理"><a href="#2-VRRP技术原理" class="headerlink" title="2.VRRP技术原理"></a>2.VRRP技术原理</h1><h2 id="VRRP状态机"><a href="#VRRP状态机" class="headerlink" title="VRRP状态机"></a>VRRP状态机</h2><p>VRRP协议状态机有三种状态：Initialize（初始状态）、Master（活动状态）、Backup（备份状态）。</p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/7.png"></p>
<blockquote>
<p>•一个Startup事件可以由系统在VRRP配置完成后自动触发，也可以是在已经配置VRRP的端口上，底层链路由不可用变为可用而触发。</p>
</blockquote>
<h2 id="VRRP协议状态"><a href="#VRRP协议状态" class="headerlink" title="VRRP协议状态"></a>VRRP协议状态</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/8.png"></p>
<h2 id="VRRP主备选举-1"><a href="#VRRP主备选举-1" class="headerlink" title="VRRP主备选举 (1)"></a>VRRP主备选举 (1)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/9.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/10.png"></p>
<blockquote>
<p>•初始创建VRRP的设备工作在Initialize状态，收到接口Up的消息后，若此设备的优先级小于255，则会先切换至Backup状态，等待MASTER_DOWN定时器超时后再切换至Master状态。</p>
<p>•如果优先级高的设备先启动，优先级低的设备后启动，则优先级高的设备先进入Master状态，优先级低的设备收到高优先级的VRRP通告报文，自己仍处于Backup状态。</p>
<p>•如果优先级低的先启动，优先级高的后启动，则优先级低的先由Backup状态切换为Master状态，优先级高的设备收到优先级低的VRRP通告报文，重新进行选举，将优先级高的设备切换为Master状态。</p>
</blockquote>
<h2 id="VRRP主备选举-2"><a href="#VRRP主备选举-2" class="headerlink" title="VRRP主备选举 (2)"></a>VRRP主备选举 (2)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/11.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/12.png"></p>
<blockquote>
<p>•初始创建VRRP的设备工作在Initialize状态，收到接口Up的消息后，若此设备的优先级小于255，则会先切换至Backup状态，等待MASTER_DOWN定时器超时后再切换至Master状态。</p>
<p>•如果优先级高的设备先启动，优先级低的设备后启动，则优先级高的设备先进入Master状态，优先级低的设备收到高优先级的VRRP通告报文，自己仍处于Backup状态。</p>
<p>•如果优先级低的先启动，优先级高的后启动，则优先级低的先由Backup状态切换为Master状态，优先级高的设备收到优先级低的VRRP通告报文，重新进行选举，将优先级高的设备切换为Master状态。</p>
</blockquote>
<h2 id="VRRP主备选举-3"><a href="#VRRP主备选举-3" class="headerlink" title="VRRP主备选举 (3)"></a>VRRP主备选举 (3)</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/13.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/14.png"></p>
<blockquote>
<p>•通常情况下，VRRP路由器的接口IP地址不会与虚拟路由器的IP地址重叠，也就是说我们会为虚拟路由器单独规划一个IP地址，而不会使用某台路由器的接口IP地址。当然也存在一个特殊的情况，例如在某些网络中IP地址资源比较紧缺，那么也有可能会将某台路由器的接口IP地址用于虚拟路由器，此时该路由器将无条件成为Master。</p>
<p>•无法手动将VRRP接口优先级配置为255，当接口IP地址为IP地址拥有者时，优先级自动成为255。</p>
</blockquote>
<h2 id="VRRP主备切换"><a href="#VRRP主备切换" class="headerlink" title="VRRP主备切换"></a>VRRP主备切换</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/15.png"></p>
<blockquote>
<p>•当Master设备主动放弃Master地位（如Master设备退出备份组）时，会发送优先级为0的通告报文，用来使Backup设备快速切换成Master设备，而不用等到MASTER_DOWN定时器超时。这个切换的时间称为Skew_time。</p>
<p>•当Master设备发生网络故障而不能发送通告报文的时候，Backup设备并不能立即知道其工作状况。等到MASTER_DOWN定时器超时后，才会认为Master设备无法正常工作，从而将状态切换为Master。</p>
</blockquote>
<h2 id="VRRP主备回切"><a href="#VRRP主备回切" class="headerlink" title="VRRP主备回切"></a>VRRP主备回切</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/16.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/17.png"></p>
<blockquote>
<p>•开启抢占模式的VRRP备份组，当主备进行切换时，总共时长为：3xAdver_Interval+Skew_time+Delay_time</p>
<p>•在抢占模式下，当Master的设备状态不稳定或者网络质量差时，会导致VRRP备份组频繁切换，从而引发终端ARP表项频繁刷新，为缓解此问题，通常设置抢占延时定时器，通过MASTER_INTERVAL定时器超时时间加上延时时间，确定状态稳定后，再进行主备回切。</p>
</blockquote>
<h1 id="3-VRRP典型应用"><a href="#3-VRRP典型应用" class="headerlink" title="3.VRRP典型应用"></a>3.VRRP典型应用</h1><h2 id="VRRP负载分担"><a href="#VRRP负载分担" class="headerlink" title="VRRP负载分担"></a>VRRP负载分担</h2><p>通过创建多个虚拟路由器，每个物理路由器在不同的VRRP组中扮演不同的角色，不同虚拟路由器的Virtual IP作为不同的内网网关地址可以实现流量转发负载分担。</p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/18.png"></p>
<h2 id="VRRP监视上行端口"><a href="#VRRP监视上行端口" class="headerlink" title="VRRP监视上行端口"></a>VRRP监视上行端口</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/19.png"></p>
<blockquote>
<p>•如果用户未配置VRRP监视上行端口，则当VRRP备份组中的Master设备R1的上行接口或者链路出现故障时，VRRP备份组无法感知，Master无法向外转发流量。但是由于主备不会发生切换，导致出现流量黑洞。</p>
</blockquote>
<h2 id="VRRP与BFD联动"><a href="#VRRP与BFD联动" class="headerlink" title="VRRP与BFD联动"></a>VRRP与BFD联动</h2><p>通过配置VRRP与BFD联动，当Backup设备通过BFD感知故障发生之后，不再等待Master_Down_Timer计时器超时而会在BFD检测周期结束后立即切换VRRP状态，此时可以实现毫秒级的主备切换。</p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/20.png"></p>
<blockquote>
<p>•当VRRP备份组之间的链路出现故障时，由于此时VRRP报文无法正常交互，Backup设备需要等待Master_Down_Timer计时器超时后才会切换为Master设备，在等待切换期间内，业务流量仍会发往Master设备，此时会造成业务流量丢失。</p>
<p>•通过在Master设备和Backup设备之间建立BFD会话并与VRRP备份组进行绑定，由BFD机制快速检测VRRP备份组之间的通信故障，并在出现故障时及时通知VRRP备份组进行主备切换，从而大大减少应用中断时间。</p>
<p>•在普通BFD联动中，VRRP备份组会根据BFD会话的状态进行优先级调整，并根据调整后的优先级判断是否进行主备切换。在实际应用中，通常Master设备配置延时抢占，而Backup设备配置立即抢占，当Backup设备检测到BFD会话状态出现DOWN后，通过增加自身优先级大于Master优先级实现快速切换，当故障排除，BFD会话状态出现UP时，新的Master通过减小自己的优先级，发送vrrp通告报文，经过延迟时间后再次切换为Backup。</p>
</blockquote>
<h2 id="VRRP与MSTP结合应用"><a href="#VRRP与MSTP结合应用" class="headerlink" title="VRRP与MSTP结合应用"></a>VRRP与MSTP结合应用</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/21.png"></p>
<blockquote>
<p>•MSTP是将一个或多个VLAN映射到一个生成树的实例，若干个VLAN共用一个生成树，MSTP可以实现负载均衡。</p>
<p>•VRRP配置网关可以灵活根据网络拓扑变化而自动切换，提高网络可靠性。</p>
<p>•VRRP+MSTP可以在实现负载分担的同时保证网络冗余备份。</p>
</blockquote>
<h1 id="4-VRRP基本配置"><a href="#4-VRRP基本配置" class="headerlink" title="4.VRRP基本配置"></a>4.VRRP基本配置</h1><h2 id="VRRP常用配置命令"><a href="#VRRP常用配置命令" class="headerlink" title="VRRP常用配置命令"></a>VRRP常用配置命令</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/22.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/23.png"></p>
<h2 id="VRRP基础配置实例"><a href="#VRRP基础配置实例" class="headerlink" title="VRRP基础配置实例"></a>VRRP基础配置实例</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/24.png"></p>
<p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/25.png"></p>
<h2 id="VRRP基础配置验证"><a href="#VRRP基础配置验证" class="headerlink" title="VRRP基础配置验证"></a>VRRP基础配置验证</h2><p><img src="/2021/05/17/IP-VRRP%E5%8E%9F%E7%90%86%E4%B8%8E%E9%85%8D%E7%BD%AE/26.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（多选题）以下关于VRRP报文中IP地址的设置正确的说法是(   )。</p>
<p><strong>A.源IP地址为Master设备端口的IP地址</strong></p>
<p>B.源IP地址为虚拟路由器的虚拟IP地址</p>
<p>C.目的IP地址为广播IP地址</p>
<p><strong>D.目的IP地址为组播IP地址</strong></p>
<p>2.（多选题）以下关于VRRP协议中各定时器的说法正确的是(   )。</p>
<p><strong>A.VRRP通告消息发送间隔默认为1秒，关联到同一虚拟路由器VRRP路由器上配置的VRRP消息通告间隔必须一致。</strong></p>
<p>B.配置抢占延迟时间为4秒，表示如果4秒中之内没有收到Master发送的VRRP通告消息，则Slave应当成为新的Master。</p>
<p>C.配置抢占延迟时间为4秒，配置VRRP消息通告间隔为2秒，表示如果6秒中之内没有收到Master发送的VRRP通告消息，则Slave应当成为新的Master。</p>
<p><strong>D.在比较繁忙的网络中，应当适当的将抢占延迟设置为一个较大的值，以避免不必要的VRRP角色振荡。</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•VRRP作为一种非常重要的可靠性技术，常用于实现网关设备冗余，该协议既能提高网络可靠性，又可以实现网络负载分担。</p>
<p>•VRRP主备选举、主备切换及主备回切都主要通过VRRP优先级来控制，为了确保网络稳定性，VRRP设计了抢占延时机制，减少网络震荡。</p>
<p>•VRRP可监视上行接口状态，从而感知网络故障，联动VRRP实现网络可靠性。VRRP亦可绑定BFD会话实现快速收敛。此外，VRRP可与MSTP结合使用，在园区网络中，这是常见的组网方案。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/" itemprop="url">IP-BFD原理与应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T20:42:30+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/BFD.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•随着网络应用的广泛部署，网络发生故障极大可能导致业务异常。为了减小链路、设备故障对业务的影响，提高网络的可靠性，网络设备需要尽快检测到与相邻设备间的通信故障，以便及时采取措施，保证业务正常进行。</p>
<p>•BFD（Bidirectional Forwarding Detection，双向转发检测）提供了一个通用的、标准化的、介质无关和协议无关的快速故障检测机制，用于快速检测、监控网络中链路或者IP路由的转发连通状态。</p>
<p>•本章节主要介绍BFD工作原理以及常见的应用场景。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫阐明BFD的作用</p>
<p>▫描述BFD工作原理</p>
<p>▫实现BFD配置与应用</p>
<h1 id="1-BFD概述"><a href="#1-BFD概述" class="headerlink" title="1.BFD概述"></a>1.BFD概述</h1><h2 id="网络故障检测遇到的问题"><a href="#网络故障检测遇到的问题" class="headerlink" title="网络故障检测遇到的问题"></a>网络故障检测遇到的问题</h2><p>•在无法通过硬件信号检测故障的系统中，应用通常采用上层协议本身的Hello报文机制检测网络故障。</p>
<p>•常用路由协议的Hello报文机制检测时间较长，检测时间超过1秒钟。当应用在网络中传输的数据超过GB/s时，秒级的检测时间将会导致应用传输的数据大量丢失。</p>
<p>•在三层网络中，静态路由本身没有故障检查机制。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/1.png"></p>
<h2 id="BFD概述"><a href="#BFD概述" class="headerlink" title="BFD概述"></a>BFD概述</h2><p>•BFD提供了一个通用的、标准化的、介质无关的、协议无关的快速故障检测机制，有以下两大优点：</p>
<p>​    ▫对相邻转发引擎之间的通道提供轻负荷、快速故障检测。</p>
<p>​    ▫用单一的机制对任何介质、任何协议层进行实时检测。</p>
<p>•BFD是一个简单的“Hello”协议。两个系统之间建立BFD会话通道，并周期性发送BFD检测报文，如果某个系统在规定的时间内没有收到对端的检测报文，则认为该通道的某个部分发生了故障。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/2.png"></p>
<blockquote>
<p>•由于同一个数据路径上只建立一个BFD会话，如果不同的应用使用的BFD参数不一致，则应该配置一个能满足所有应用要求的BFD参数。</p>
</blockquote>
<h1 id="2-BFD工作原理"><a href="#2-BFD工作原理" class="headerlink" title="2.BFD工作原理"></a>2.BFD工作原理</h1><h2 id="BFD报文结构"><a href="#BFD报文结构" class="headerlink" title="BFD报文结构"></a>BFD报文结构</h2><p>•BFD检测是通过维护在两个系统之间建立的BFD会话来实现的，系统通过发送BFD报文建立会话。</p>
<p>•BFD控制报文根据场景不同封装不同，报文结构由强制部分和可选的认证字段组成。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/3.png"></p>
<p>1.Sta：BFD本地状态。</p>
<p>2.Detect Mult：检测超时倍数，用于检测方计算检测超时时间。</p>
<p>3.My Discriminator：BFD会话连接本地标识符（Local Discriminator） 。发送系统产生的一个唯一的、非0鉴别值，用来区分一个系统的多个BFD会话。 </p>
<p>4.Your Discriminator：BFD会话连接远端标识符（Remote Discriminator） 。从远端系统接收到的鉴别值，这个域直接返回接收到的“My Discriminator”，如果不知道这个值就返回0。 </p>
<p>5.Desired Min TX Interval：本地支持的最小BFD报文发送间隔。 </p>
<p>6.Required Min RX Interval：本地支持的最小BFD报文接收间隔。</p>
<p>7.Required Min Echo RX Interval：本地支持的最小Echo报文接收间隔，单位为微秒（如果本地不支持Echo功能，则设置0）。</p>
<blockquote>
<p>•Ver：BFD协议版本号，目前为1。</p>
<p>•Diag：诊断字，标明本地BFD系统最近一次会话状态发生变化的原因。</p>
<p>•P：参数发生改变时，发送方在BFD报文中置该标志，接收方必须立即响应该报文。</p>
<p>•F：响应P标志置位的回应报文中必须将F标志置位。</p>
<p>•C：转发/控制分离标志，一旦置位，控制平面的变化不影响BFD检测。</p>
<p>•A：认证标识，置1代表会话需要进行验证。</p>
<p>•D：查询请求，置位代表发送方期望采用查询模式对链路进行监测。</p>
<p>•M：为BFD将来支持点对多点扩展而设的预留位。</p>
<p>•Length：报文长度，单位为字节。</p>
</blockquote>
<h2 id="BFD会话建立"><a href="#BFD会话建立" class="headerlink" title="BFD会话建立"></a>BFD会话建立</h2><p>BFD会话的建立有两种方式，即静态建立BFD会话和动态建立BFD会话。BFD通过控制报文中的本地标识符和远端标识符区分不同的会话。静态和动态创建BFD会话的主要区别在于Local Discriminator和Remote Discriminator的配置方式不同。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/4.png"></p>
<blockquote>
<p>•动态建立BFD会话时，系统对本地标识符和远端标识符的处理方式如下：</p>
<ul>
<li>动态分配本地标识符，当应用程序触发动态创建BFD会话时，系统分配属于动态会话标识符区域的值作为BFD会话的本地标识符。然后向对端发送Remote Discriminator的值为0的BFD控制报文，进行会话协商。</li>
<li>自学习远端标识符，当BFD会话的一端收到Remote Discriminator的值为0的BFD控制报文时，判断该报文是否与本地BFD会话匹配，如果匹配，则学习接收到的BFD报文中Local Discriminator的值，获取远端标识符。</li>
</ul>
</blockquote>
<h2 id="BFD会话状态"><a href="#BFD会话状态" class="headerlink" title="BFD会话状态"></a>BFD会话状态</h2><p>BFD会话有四种状态：Down、Init、Up和AdminDown。会话状态变化通过BFD报文的State字段传递，系统根据自己本地的会话状态和接收到的对端BFD报文驱动状态改变，如左下图所示。BFD状态机的建立和拆除都采用三次握手机制，如右下图所示，以确保两端系统都能知道状态的变化。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/5.png"></p>
<blockquote>
<p>•BFD会话过程中包含有三个状态：init和up两个用来建立会话，down用来断开会话。建立和断开会话都需要三次握手确保两端系统都感知到。另外还有一个特殊状态：管理down，使会话可以通过管理手段down，在状态机中管理down也是down状态。每个系统通过报文中的sta域发送本端状态，接收报文中的sta域了解对端状态，综合起来决定状态机的跳转。</p>
<p>•Down状态说明会话down。一个会话会维持在down状态直到收到对端的报文并且该报文的sta字段标志着对端状态不是up。如果收到的是down包，状态机将从down状态跳转到init状态，如果收到的是init包，状态机将从down状态跳转到up状态，如果收到的是up包，状态机维持down状态。</p>
<p>•Init状态说明与远端正在通信，并且本地会话期望进入up状态，但是远端还没回应。一个init状态的会话会维持init状态直到收到对端的init包或者up包，就会跳转到up状态，否则等到检测时间超时以后，便会跳转到down状态，意味着与远端的通信丢失。</p>
<p>•Up状态说明BFD会话成功建立，并且正在确认链路的联通性，会话会一直保持在up状态直到链路故障或者管理down操作。如果收到远端的down包或者检测时间超时会话就会从up状态跳转到down状态。</p>
<p>•管理down意味着会话是被管理操作down的，这会导致远端系统会话进入down状态，并且一直保持down状态直到本端退出管理down。管理down并不意味着转发路径的连通性问题。</p>
</blockquote>
<h2 id="BFD检测模式"><a href="#BFD检测模式" class="headerlink" title="BFD检测模式"></a>BFD检测模式</h2><p>BFD的检测机制：两个系统建立BFD会话，并沿它们之间的路径周期性发送BFD控制报文，如果一方在既定的时间内没有收到BFD控制报文，则认为路径上发生了故障。BFD的检测模式有异步模式和查询模式两种。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/6.png"></p>
<blockquote>
<p>•异步模式和查询模式的本质区别：检测的位置不同，异步模式下本端按一定的发送周期发送BFD控制报文，检测位置为远端，远端检测本端是否周期性发送BFD控制报文；查询模式下本端检测自身发送的BFD控制报文是否得到了回应。</p>
</blockquote>
<h2 id="BFD检测时间"><a href="#BFD检测时间" class="headerlink" title="BFD检测时间"></a>BFD检测时间</h2><p>BFD会话检测时长由TX（Desired Min TX Interval），RX（Required Min RX Interval），DM（Detect Multi）三个参数决定。BFD报文的实际发送时间间隔，实际接受时间间隔由BFD会话协商决定。</p>
<p>▫本地BFD报文实际发送时间间隔＝MAX { 本地配置的发送时间间隔，对端配置的接收时间间隔 }</p>
<p>▫本地BFD报文实际接收时间间隔＝MAX { 对端配置的发送时间间隔，本地配置的接收时间间隔 }</p>
<p>▫本地BFD报文实际检测时间：</p>
<ul>
<li><p>异步模式：本地BFD报文实际检测时间＝本地BFD报文实际接收时间间隔×对端配置的BFD检测倍数</p>
</li>
<li><p>查询模式：本地BFD报文实际检测时间 = 本地BFD报文实际接收时间间隔×本端配置的BFD检测倍数</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/7.png"></p>
<blockquote>
<p>•BFD缺省时间参数</p>
<ul>
<li><p>BFD报文发送间隔默认1000毫秒，接受间隔默认1000毫秒，本地检测倍数3次。</p>
</li>
<li><p>BFD会话等待恢复时间0秒，会话延迟Up时间0秒。</p>
</li>
</ul>
<p>•检测超时倍数，用于检测方计算检测超时时间。</p>
<ul>
<li><p>查询模式：采用本地检测倍数。</p>
</li>
<li><p>异步模式：采用对端检测倍数。</p>
</li>
</ul>
</blockquote>
<h2 id="BFD-Echo功能"><a href="#BFD-Echo功能" class="headerlink" title="BFD Echo功能"></a>BFD Echo功能</h2><p>•BFD Echo功能也称为BFD回声功能，是由本地发送BFD Echo报文，远端系统将报文环回的一种检测机制。</p>
<p>•在两台直接相连的设备中，其中一台设备支持BFD功能（R1）；另一台设备不支持BFD功能（R2），只支持基本的网络层转发。为了能够快速的检测这两台设备之间的故障，可以在支持BFD功能的设备上创建单臂回声功能的BFD会话。支持BFD功能的设备主动发起回声请求功能，不支持BFD功能的设备接收到该报文后直接将其环回，从而实现转发链路的连通性检测功能。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/8.png"></p>
<h1 id="3-BFD应用场景"><a href="#3-BFD应用场景" class="headerlink" title="3.BFD应用场景"></a>3.BFD应用场景</h1><h2 id="联动功能简介"><a href="#联动功能简介" class="headerlink" title="联动功能简介"></a>联动功能简介</h2><p>联动功能由检测模块、Track和应用模块三部分组成。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/9.png"></p>
<blockquote>
<p>•监测模块负责对链路状态、网络性能等进行监测，并将探测结果通知给Track模块 。</p>
<p>•Track模块收到监测模块的探测结果后，及时改变Track项的状态，并通知应用模块。</p>
<p>•应用模块根据Track项的状态，进行相应的处理，从而实现联动。</p>
</blockquote>
<h2 id="静态路由与BFD联动"><a href="#静态路由与BFD联动" class="headerlink" title="静态路由与BFD联动"></a>静态路由与BFD联动</h2><p>•静态路由自身没有检测机制，如果静态路由存在冗余路径，通过静态路由与BFD联动，当主用路径故障时，实现静态路由的快速切换 。</p>
<p>•静态路由与BFD联动应用广泛，如下图中R1是园区网的出口路由器，R1通过两条链路分别连接ISP1和ISP2，正常情况下默认路由经过的链路为指向ISP1的链路，当通往ISP1的链路出现故障的时候，BFD会话能够快速感知，并通知路由器将流量切换到指向ISP2的链路。</p>
<blockquote>
<p>•静态路由自身没有检测机制，如果静态路由存在冗余路径，通过静态路由与BFD联动，当主用路径故障时，实现静态路由的快速切换 。</p>
<p>•静态路由与BFD联动应用广泛，如下图中R1是园区网的出口路由器，R1通过两条链路分别连接ISP1和ISP2，正常情况下默认路由经过的链路为指向ISP1的链路，当通往ISP1的链路出现故障的时候，BFD会话能够快速感知，并通知路由器将流量切换到指向ISP2的链路。</p>
</blockquote>
<h2 id="OSPF与BFD联动-1"><a href="#OSPF与BFD联动-1" class="headerlink" title="OSPF与BFD联动 (1)"></a>OSPF与BFD联动 (1)</h2><p>•OSPF在未绑定BFD的情况下，链路故障检测时间由协议Hello机制决定，通常是秒级。通过绑定BFD，可以实现毫秒级故障检测。</p>
<p>•BFD与OSPF联动就是将BFD和OSPF协议关联起来， BFD将链路故障的快速检测结果告知OSPF协议。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/11.png"></p>
<h2 id="OSPF与BFD联动-2"><a href="#OSPF与BFD联动-2" class="headerlink" title="OSPF与BFD联动 (2)"></a>OSPF与BFD联动 (2)</h2><p>BFD会话建立后会周期性地快速发送BFD报文，如果在检测时间内没有收到BFD报文则认为该双向转发路径发生了故障，通知被服务的上层应用进行相应的处理。</p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/12.png"></p>
<h1 id="4-BFD基本配置"><a href="#4-BFD基本配置" class="headerlink" title="4.BFD基本配置"></a>4.BFD基本配置</h1><h2 id="BFD配置命令介绍"><a href="#BFD配置命令介绍" class="headerlink" title="BFD配置命令介绍"></a>BFD配置命令介绍</h2><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/13.png"></p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/14.png"></p>
<blockquote>
<p>•配置编辑完成后，用户可以执行<strong>commit</strong>提交配置，使新的配置数据在当前的系统运行配置中生效。</p>
</blockquote>
<h2 id="静态路由与BFD联动配置"><a href="#静态路由与BFD联动配置" class="headerlink" title="静态路由与BFD联动配置"></a>静态路由与BFD联动配置</h2><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/15.png"></p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/16.png"></p>
<h2 id="BFD会话配置验证"><a href="#BFD会话配置验证" class="headerlink" title="BFD会话配置验证"></a>BFD会话配置验证</h2><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/17.png"></p>
<h2 id="OSPF与BFD联动配置"><a href="#OSPF与BFD联动配置" class="headerlink" title="OSPF与BFD联动配置"></a>OSPF与BFD联动配置</h2><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/18.png"></p>
<p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/19.png"></p>
<h2 id="BFD检测配置验证"><a href="#BFD检测配置验证" class="headerlink" title="BFD检测配置验证"></a>BFD检测配置验证</h2><p><img src="/2021/05/17/IP-BFD%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8/20.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（多选题）BFD会话建立过程中有以下哪几种状态？</p>
<p><strong>A.Down</strong></p>
<p><strong>B.Init</strong></p>
<p><strong>C.Up</strong></p>
<p>D.Establish</p>
<p>2.（多选题）BFD检测模式有哪些？</p>
<p><strong>A.异步模式</strong></p>
<p>B.同步模式</p>
<p><strong>C.查询模式</strong></p>
<p><strong>D.回声模式</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•本章详细介绍了BFD工作原理，内容包括会话建立的过程、检测模式、检测时间以及检测流程。</p>
<p>•BFD会话建立中经过三个不同的状态，包括down、init和up，会话状态建立根据收到报文中的sta字段进行转换。BFD检测模式分为异步检测和查询模式，它们的主要区别不仅是发送检测报文的方式和检测的位置不同，同时检测时间与检测流程也不同。</p>
<p>•BFD能够快速检测链路故障，但是只有被应用模块调用，例如OSPF、静态路由，才能够实现流量路径的快速切换，因此BFD在线网当中应用非常广泛。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/" itemprop="url">IP-VRF基本概念及应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T20:33:30+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/VRF.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•回顾前面学习的课程，您还记得几个名字中带“V”的协议或技术？这些协议或技术又有哪些特点或共同点？</p>
<p>•VRF（Virtual Routing and Rorwarding，虚拟路由转发）技术通过在一台三层转发设备上创建多张路由表实现数据或业务的隔离，常用于MPLS VPN、防火墙等一些需要实现隔离的应用场景。</p>
<p>•本课程将介绍VRF的基本概念及其基本配置方法。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述VRF的基本概念</p>
<p>▫描述VRF的典型应用</p>
<p>▫实现VRF的基本配置</p>
<h1 id="1-VRF基本概念"><a href="#1-VRF基本概念" class="headerlink" title="1.VRF基本概念"></a>1.VRF基本概念</h1><h2 id="网络需求"><a href="#网络需求" class="headerlink" title="网络需求"></a>网络需求</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/1.png"></p>
<h2 id="通过部署ACL实现"><a href="#通过部署ACL实现" class="headerlink" title="通过部署ACL实现"></a>通过部署ACL实现</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/2.png"></p>
<h2 id="通过增加核心交换机实现"><a href="#通过增加核心交换机实现" class="headerlink" title="通过增加核心交换机实现"></a>通过增加核心交换机实现</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/3.png"></p>
<h2 id="通过VRF技术实现"><a href="#通过VRF技术实现" class="headerlink" title="通过VRF技术实现"></a>通过VRF技术实现</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/4.png"></p>
<h2 id="VRF的实现过程"><a href="#VRF的实现过程" class="headerlink" title="VRF的实现过程"></a>VRF的实现过程</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/5.png"></p>
<p>•VRF是对物理设备的一个逻辑划分，每个逻辑单元都被称为一个VPN实例，实例之间在路由层面是隔离的。VRF实现过程如下：</p>
<ol>
<li><p>创建实例，并将三层接口（可以是路由器的物理接口或者子接口，也可以是VLANIF接口）绑定到实例；</p>
</li>
<li><p>（可选）配置与实例绑定的路由协议或静态路由；</p>
</li>
<li><p>基于与实例绑定的接口和路由协议等建立实例路由表并基于实例路由表转发数据，实现实例间隔离。</p>
</li>
</ol>
<blockquote>
<p>•缺省时，一个网络设备的所有接口都属于同一个转发实例——设备的根实例。</p>
<p>当前路由器会有几张路由表呢？</p>
</blockquote>
<h2 id="举例：部署VRF前"><a href="#举例：部署VRF前" class="headerlink" title="举例：部署VRF前"></a>举例：部署VRF前</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/6.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/7.png"></p>
<h2 id="举例：创建VPN实例"><a href="#举例：创建VPN实例" class="headerlink" title="举例：创建VPN实例"></a>举例：创建VPN实例</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/8.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/9.png"></p>
<h2 id="举例：部署动态路由协议"><a href="#举例：部署动态路由协议" class="headerlink" title="举例：部署动态路由协议"></a>举例：部署动态路由协议</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/10.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/11.png"></p>
<h2 id="常见应用场景"><a href="#常见应用场景" class="headerlink" title="常见应用场景"></a>常见应用场景</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/12.png"></p>
<blockquote>
<p>•更多BGP/MPLS IP VPN相关内容，请参考HCIP-Datacom-Advance相关课程。</p>
</blockquote>
<h1 id="2-VRF典型配置案例"><a href="#2-VRF典型配置案例" class="headerlink" title="2.VRF典型配置案例"></a>2.VRF典型配置案例</h1><h2 id="VRF基本配置命令"><a href="#VRF基本配置命令" class="headerlink" title="VRF基本配置命令"></a>VRF基本配置命令</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/13.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/14.png"></p>
<h2 id="配置案例-背景介绍与需求分析"><a href="#配置案例-背景介绍与需求分析" class="headerlink" title="配置案例 - 背景介绍与需求分析"></a>配置案例 - 背景介绍与需求分析</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/15.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/16.png"></p>
<h2 id="配置案例-配置过程-1"><a href="#配置案例-配置过程-1" class="headerlink" title="配置案例 - 配置过程 (1)"></a>配置案例 - 配置过程 (1)</h2><p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/17.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/18.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/19.png"></p>
<p><img src="/2021/05/17/IP-VRF%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%BA%94%E7%94%A8/20.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）VRF技术可以实现（  ）的隔离。</p>
<p>A.物理层</p>
<p><strong>B.网络层</strong></p>
<p>C.数据链路层</p>
<p>D.应用层</p>
<p>2.（判断题）缺省情况下，华为数通产品上所有三层接口都属于根实例。</p>
<p><strong>A.正确</strong></p>
<p>B.错误</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•VRF技术实现了同一物理设备上不同网络之间的逻辑隔离，当在物理设备上部署多个VRF实例时，每一个VRF实例就相当于一个虚拟的网络设备。VRF实例之间的接口和路由天然隔离，当同一个物理设备连接到多个相同的网段时，也不用担心IP地址冲突的问题。</p>
<p>•VRF技术广泛应用在防火墙虚拟系统、BGP/MPLS IP VPN等多个场景中。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/" itemprop="url">IP-VPN技术概述</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T20:19:55+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•对于规模较大的企业来说，网络访问需求不仅仅局限于公司总部网络内，分公司、办事处、出差员工、合作单位等也需要访问公司总部的网络资源，可以采用VPN（Virtual Private Network，虚拟专用网络）技术来实现这一需求。VPN可以在不改变现有网络结构的情况下，建立虚拟专用连接。因其具有廉价、专用和虚拟等多种优势，在现网中应用非常广泛。</p>
<p>•VPN是一类技术的统称，不同的VPN技术拥有不同的特性和实现方式，常见的VPN技术包括IPSec VPN、GRE VPN、L2TP VPN、MPLS VPN等。</p>
<p>•本课程将从VPN的定义、常见的VPN类型与应用场景等几个方面对VPN进行一个简单而又全面的介绍。</p>
<blockquote>
<p>•IPSec：Internet Protocol Security， 因特网协议安全协议。</p>
<p>•GRE：Generic Routing Encapsulation， 通用路由封装协议。</p>
<p>•L2TP：Layer 2 Tunneling Protocol， 二层隧道协议。</p>
<p>•MPLS：Multiprotocol Label Switching，多协议标签交换协议。</p>
</blockquote>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述VPN的分类</p>
<p>▫描述VPN的实现方式</p>
<h1 id="1-什么是VPN"><a href="#1-什么是VPN" class="headerlink" title="1.什么是VPN"></a>1.什么是VPN</h1><h2 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h2><p>•在VPN出现之前，企业分支之间的数据传输只能依靠现有物理网络（例如Internet）。由于Internet中存在多种不安全因素，报文容易被网络中的黑客窃取或篡改，最终造成数据泄密、重要数据被破坏等后果。</p>
<p>•除了通过Internet，还可以通过搭建一条物理专网连接保证数据的安全传输，但其费用会非常昂贵，且专网的搭建和维护十分困难。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/1.png"></p>
<h2 id="VPN简介"><a href="#VPN简介" class="headerlink" title="VPN简介"></a>VPN简介</h2><p>VPN即虚拟专用网，泛指通过VPN技术在公用网络上构建的虚拟专用网络。VPN用户在此虚拟网络中传输私网流量，在不改变网络现状的情况下实现安全、可靠的连接。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/2.png"></p>
<blockquote>
<p>•VPN和传统的数据专网相比具有如下优势：</p>
<ul>
<li><p>安全：在远端用户、驻外机构、合作伙伴、供应商与公司总部之间建立可靠的连接，保证数据传输的安全性。这对于实现电子商务或金融网络与通讯网络的融合特别重要。</p>
</li>
<li><p>廉价：利用公共网络进行信息通讯，企业可以用更低的成本连接远程办事机构、出差人员和业务伙伴。</p>
</li>
<li><p>支持移动业务：支持驻外VPN用户在任何时间、任何地点的移动接入，能够满足不断增长的移动业务需求。</p>
</li>
<li><p>可扩展性：由于VPN为逻辑上的网络，物理网络中增加或修改节点，不影响VPN的部署。</p>
</li>
</ul>
<p>•公共网络又经常被称为VPN骨干网（VPN Backbone），公共网络可以是Internet，也可以是企业自建专网或运营商租赁专网。</p>
</blockquote>
<h2 id="VPN分类-根据建设单位不同"><a href="#VPN分类-根据建设单位不同" class="headerlink" title="VPN分类 - 根据建设单位不同"></a>VPN分类 - 根据建设单位不同</h2><p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/3.png"></p>
<h2 id="VPN分类-根据组网方式不同"><a href="#VPN分类-根据组网方式不同" class="headerlink" title="VPN分类 - 根据组网方式不同"></a>VPN分类 - 根据组网方式不同</h2><p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/4.png"></p>
<h2 id="VPN分类-根据实现的网络层次"><a href="#VPN分类-根据实现的网络层次" class="headerlink" title="VPN分类 - 根据实现的网络层次"></a>VPN分类 - 根据实现的网络层次</h2><p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/5.png"></p>
<blockquote>
<p>•工作在网络层和数据链路层的VPN又被称为三层VPN和二层VPN。</p>
</blockquote>
<h2 id="VPN关键技术-隧道技术"><a href="#VPN关键技术-隧道技术" class="headerlink" title="VPN关键技术 - 隧道技术"></a>VPN关键技术 - 隧道技术</h2><p>•VPN技术的基本原理是利用隧道（Tunnel）技术，对传输报文进行封装，利用VPN骨干网建立专用数据传输通道，实现报文的安全传输。</p>
<p>•位于隧道两端的VPN网关，通过对原始报文的“封装”和“解封装”，建立一个点到点的虚拟通信隧道。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/6.png"></p>
<blockquote>
<p>•隧道的功能就是在两个网络节点之间提供一条通路，使数据能够在这个通路上透明传输。VPN隧道一般是指在VPN骨干网的VPN节点之间建立的用来传输VPN数据的虚拟连接。隧道是构建VPN不可或缺的部分，用于把VPN数据从一个VPN节点透明传送到另一个上。</p>
<p>•隧道通过隧道协议实现。目前已存在不少隧道协议，如GRE（Generic Routing Encapsulation）、L2TP（Layer 2 Tunneling Protocol）等。隧道协议通过在隧道的一端给数据加上隧道协议头，即进行封装，使这些被封装的数据能都在某网络中传输，并且在隧道的另一端去掉该数据携带的隧道协议头，即进行解封装。报文在隧道中传输前后都要通过封装和解封装两个过程。</p>
<p>•部分隧道可以混合使用，如GRE Over IPSec隧道。</p>
</blockquote>
<h2 id="VPN关键技术-身份认证、数据加密与验证"><a href="#VPN关键技术-身份认证、数据加密与验证" class="headerlink" title="VPN关键技术 - 身份认证、数据加密与验证"></a>VPN关键技术 - 身份认证、数据加密与验证</h2><p>身份认证、数据加密和认证技术可以有效保证VPN网络与数据的安全性：</p>
<ul>
<li><p>身份认证：可用于部署了远程接入VPN的场景，VPN网关对用户的身份进行认证，保证接入网络的都是合法用户而非恶意用户。也可以用于VPN网关之间对对方身份的认证。</p>
</li>
<li><p>数据加密：将明文通过加密变成密文，使得数据即使被黑客截获，黑客也无法获取其中的信息。</p>
</li>
<li><p>数据验证：通过数据验证技术对报文的完整性和真伪进行检查，丢弃被伪造和被篡改的报文。</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/7.png"></p>
<h1 id="2-常见VPN技术"><a href="#2-常见VPN技术" class="headerlink" title="2.常见VPN技术"></a>2.常见VPN技术</h1><h2 id="IPSec概述"><a href="#IPSec概述" class="headerlink" title="IPSec概述"></a>IPSec概述</h2><p>IPSec（IP Security） VPN一般部署在企业出口设备之间，通过加密与验证等方式，实现了数据来源验证、数据加密、数据完整性保证和抗重放等功能。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/8.png"></p>
<blockquote>
<p>•数据来源验证：接收方验证发送方身份是否合法。</p>
<p>•数据加密：发送方对数据进行加密，以密文的形式在Internet上传送，接收方对接收的加密数据进行解密后处理或直接转发。</p>
<p>•数据完整性：接收方对接收的数据进行验证，以判定报文是否被篡改。</p>
<p>•抗重放：接收方拒绝旧的或重复的数据包，防止恶意用户通过重复发送捕获到的数据包所进行的攻击。</p>
</blockquote>
<h2 id="IPSec协议体系"><a href="#IPSec协议体系" class="headerlink" title="IPSec协议体系"></a>IPSec协议体系</h2><p>IPSec不是一个单独的协议，它给出了IP网络上数据安全的一整套体系结构，包括AH（Authentication Header）、ESP（Encapsulating Security Payload）、IKE（Internet Key Exchange）等协议。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/9.png"></p>
<blockquote>
<p>•IPSec使用认证头AH（Authentication Header）和封装安全载荷ESP（Encapsulating Security Payload）两种安全协议来传输和封装数据，提供认证或加密等安全服务。</p>
<ul>
<li><p>AH和ESP协议提供的安全功能依赖于协议采用的验证、加密算法。</p>
</li>
<li><p>AH仅支持认证功能，不支持加密功能。ESP支持认证和加密功能。</p>
</li>
<li><p>安全协议提供认证或加密等安全服务需要有秘钥的存在。</p>
</li>
</ul>
<p>•秘钥交换的方式有两种：</p>
<ul>
<li><p>带外共享密钥：在发送、接收设备上手工配置静态的加密、验证密钥。双方通过带外共享的方式（例如通过电话或邮件方式）保证密钥一致性。这种方式的缺点是可扩展性差，在点到多点组网中配置密钥的工作量成倍增加。另外，为提升网络安全性需要周期性修改密钥，这种方式下也很难实施。</p>
</li>
<li><p>通过IKE协议自动协商密钥：IKE建立在Internet安全联盟和密钥管理协议ISAKMP定义的框架上，采用DH（Diffie-Hellman）算法在不安全的网络上安全地分发密钥。这种方式配置简单，可扩展性好，特别是在大型动态的网络环境下此优点更加突出。同时，通信双方通过交换密钥交换材料来计算共享的密钥，即使第三方截获了双方用于计算密钥的所有交换数据，也无法计算出真正的密钥。</p>
</li>
</ul>
</blockquote>
<h2 id="IPSec基本原理"><a href="#IPSec基本原理" class="headerlink" title="IPSec基本原理"></a>IPSec基本原理</h2><p>IPSec隧道建立过程中需要协商IPSec SA（Security Association，安全联盟），IPSec SA一般通过IKE协商生成。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/10.png"></p>
<blockquote>
<p>•SA由一个三元组来唯一标识，这个三元组包括安全参数索引SPI（Security Parameter Index）、目的IP地址和使用的安全协议号（AH或ESP）。其中，SPI是为唯一标识SA而生成的一个32位比特的数值，它在AH和ESP头中传输。在手工配置SA时，需要手工指定SPI的取值。使用IKE协商产生SA时，SPI将随机生成。</p>
<p>•SA是单向的逻辑连接，因此两个IPSec对等体之间的双向通信，最少需要建立两个SA来分别对两个方向的数据流进行安全保护。</p>
<p>•IKE作为秘钥协商协议，存在两个版本：IKEv1和IKEv2，本课程采用IKEv1为例进行介绍，IKEv2内容可参考产品文档对应内容。</p>
<ul>
<li><p>IKEv1协商阶段1的目的是建立IKE SA。IKE SA建立后对等体间的所有ISAKMP消息都将通过加密和验证，这条安全通道可以保证IKEv1第二阶段的协商能够安全进行。IKE SA是一个双向的逻辑连接，两个IPSec对等体间只建立一个IKE SA。</p>
</li>
<li><p>IKEv1协商阶段2的目的就是建立用来安全传输数据的IPSec SA，并为数据传输衍生出密钥。该阶段使用IKEv1协商阶段1中生成的密钥对ISAKMP消息的完整性和身份进行验证，并对ISAKMP消息进行加密，故保证了交换的安全性。</p>
</li>
</ul>
<p>•IKE协商成功意味着双向的IPSec隧道已经建立，可以通过ACL方式或者安全框架方式定义IPSec“感兴趣流”，符合感兴趣流流量特征的数据都将被送入IPSec隧道进行处理。</p>
<p>•感兴趣流：需要被IPSec保护的数据流。</p>
</blockquote>
<h2 id="GRE概述"><a href="#GRE概述" class="headerlink" title="GRE概述"></a>GRE概述</h2><p>通用路由封装协议（General Routing Encapsulation，GRE）是一种三层VPN封装技术。GRE可以对某些网络层协议（如IPX、IPv4、IPv6等）的报文进行封装，使封装后的报文能够在另一种网络中（如IPv4）传输，从而解决了跨越异种网络的报文传输问题。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/11.png"></p>
<blockquote>
<p>•如图所示，通过在IPv4网络上建立GRE隧道，解决了两个IPv6网络的通信问题。</p>
<p>•GRE还具备封装组播报文的能力。由于动态路由协议中会使用组播报文，因此更多时候GRE会在需要传递组播路由数据的场景中被用到，这也是GRE被称为通用路由封装协议的原因。</p>
</blockquote>
<h2 id="GRE基本原理"><a href="#GRE基本原理" class="headerlink" title="GRE基本原理"></a>GRE基本原理</h2><p>•GRE构成要素分为3个部分：乘客协议、封装协议和运输协议。</p>
<p>▫乘客协议是指用户在传输数据时所使用的原始网络协议。</p>
<p>▫封装协议的作用就是用来“包装”乘客协议对应的报文，使原始报文能够在新的网络中传输。</p>
<p>▫运输协议是指被封装以后的报文在新网络中传输时所使用的网络协议。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/12.png"></p>
<blockquote>
<p>•隧道接口（Tunnel Interface）是为实现报文的封装而提供的一种点对点类型的虚拟接口，与Loopback接口类似，都是一种逻辑接口。</p>
<p>•如图所示，乘客协议为IPv6，封装协议为GRE，运输协议为IPv4。整体转发流程如下：</p>
<ol>
<li><p>当R1收到IP1发来的IPv6数据包，查询设备路由表，发现出接口是隧道接口，则将此报文发给隧道接口处理。</p>
</li>
<li><p>隧道接口给原始报文添加GRE头部，然后根据配置信息，给报文加上IP头。该IP头的源地址就是隧道源地址，IP头的目的地址就是隧道目的地址。</p>
</li>
<li><p>封装后的报文在IPv4网络中进行普通的IPv4路由转发，最终到达目的地R2。</p>
</li>
<li><p>解封装过程和封装过程相反，这里不再赘述。</p>
</li>
</ol>
</blockquote>
<h2 id="GRE-Over-IPSec"><a href="#GRE-Over-IPSec" class="headerlink" title="GRE Over IPSec"></a>GRE Over IPSec</h2><p>•GRE的主要缺点是不支持加密和认证，数据的安全传输得不到很好的保障。</p>
<p>•IPSec的主要缺点是只支持IP协议，且不支持组播。</p>
<p>•可通过部署GRE Over IPSec结合两种VPN技术的优点。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/13.png"></p>
<h2 id="L2TP概述"><a href="#L2TP概述" class="headerlink" title="L2TP概述"></a>L2TP概述</h2><p>•L2TP是虚拟私有拨号网VPDN（Virtual Private Dial-up Network）隧道协议的一种，它扩展了点到点协议PPP的应用，是一种在远程办公场景中为出差员工或企业分支远程访问企业内网资源提供接入服务的VPN。</p>
<p>•L2TP组网架构中包括LAC（L2TP Access Concentrator，L2TP访问集中器）和LNS（L2TP Network Server，L2TP网络服务器）</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/14.png"></p>
<blockquote>
<p>•VPDN是指利用公共网络（如ISDN和PSTN）的拨号功能及接入网来实现虚拟专用网，为企业、小型ISP、移动办公人员提供接入服务。VPDN采用专用的网络加密通信协议，在公共网络上为企业建立安全的虚拟专网。企业驻外机构和出差人员可从远程经由公共网络，通过虚拟加密隧道实现和企业总部之间的网络连接，而公共网络上其它用户则无法穿过虚拟隧道访问企业网内部的资源。VPDN隧道协议有多种，目前使用最广泛的是L2TP。</p>
<p>•LAC是网络上具有PPP和L2TP协议处理能力的设备。LAC负责和LNS建立L2TP隧道连接。在不同的组网环境中，LAC可以是不同的设备，可以是一台网关设备，也可以是一台终端设备。LAC可以发起建立多条L2TP隧道使数据流之间相互隔离。</p>
<p>•LNS是LAC的对端设备，即LAC和LNS建立了L2TP隧道；LNS位于企业总部私网与公网边界，通常是企业总部的网关设备。</p>
</blockquote>
<h2 id="L2TP消息"><a href="#L2TP消息" class="headerlink" title="L2TP消息"></a>L2TP消息</h2><p>L2TP协议包含两种类型的消息，控制消息和数据消息，消息的传输在LAC和LNS之间进行。</p>
<p>​    ▫控制消息用于L2TP隧道和会话连接的建立、维护和拆除。</p>
<p>​    ▫数据消息用于封装PPP数据帧并在隧道上传输。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/15.png"></p>
<blockquote>
<p>•控制消息</p>
<ul>
<li><p>用于L2TP隧道和会话连接的建立、维护和拆除。在控制消息的传输过程中，使用消息丢失重传和定时检测隧道连通性等机制来保证控制消息传输的可靠性，支持对控制消息的流量控制和拥塞控制。</p>
</li>
<li><p>控制消息承载在L2TP控制通道上，控制通道实现了控制消息的可靠传输，将控制消息封装在L2TP报头内，再经过IP网络传输。</p>
</li>
</ul>
<p>•数据消息</p>
<ul>
<li><p>用于封装PPP数据帧并在隧道上传输。数据消息是不可靠的传输，不重传丢失的数据报文，不支持对数据消息的流量控制和拥塞控制。</p>
</li>
<li><p>数据消息携带PPP帧承载在不可靠的数据通道上，对PPP帧进行L2TP封装，再经过IP网络传输。</p>
</li>
</ul>
</blockquote>
<h2 id="L2TP工作过程"><a href="#L2TP工作过程" class="headerlink" title="L2TP工作过程"></a>L2TP工作过程</h2><p>L2TP主要可分为以下三种工作场景，其工作过程并不相同：</p>
<p>​    ▫NAS-Initiated场景：拨号用户通过NAS访问企业内网</p>
<p>​    ▫Client-Initiated场景：移动办公用户访问企业内网</p>
<p>​    ▫Call-LNS场景：通过LAC自主拨号实现企业内网互连</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/16.png"></p>
<blockquote>
<p>•NAS-Initiated场景：由远程拨号用户发起，远程系统通过PSTN/ISDN拨入LAC，由LAC通过Internet向LNS发起建立隧道连接请求。拨号用户地址由LNS分配；对远程拨号用户的验证与计费既可由LAC侧的代理完成，也可在LNS完成。</p>
<ul>
<li><p>用户必须采用PPP的方式接入到Internet，也可以是PPPoE等协议。</p>
</li>
<li><p>运营商的接入设备（主要是BAS设备）需要开通相应的VPN服务。用户需要到运营商处申请该业务。</p>
</li>
<li><p>L2TP隧道两端分别驻留在LAC侧和LNS侧，且一个L2TP隧道可以承载多个会话。</p>
</li>
</ul>
<p>•Client-Initialized场景：直接由LAC客户（指可在本地支持L2TP协议的用户）发起。客户需要知道LNS的IP地址。LAC客户可直接向LNS发起隧道连接请求，无需再经过一个单独的LAC设备。在LNS设备上收到了LAC客户的请求之后，根据用户名、密码进行验证，并且给LAC客户分配私有IP地址。</p>
<ul>
<li>用户需要安装L2TP的拔号软件。部分操作系统自带L2TP客户端软件。</li>
<li>用户上网的方式和地点没有限制，不需ISP介入。</li>
<li>L2TP隧道两端分别驻留在用户侧和LNS侧，一个L2TP隧道承载一个L2TP会话。</li>
<li>该场景建立过程如下：</li>
</ul>
<ol>
<li><p>移动办公用户与LNS建立L2TP隧道。</p>
</li>
<li><p>移动办公用户与LNS建立L2TP会话：移动办公用户在第3步会与LNS间建立PPP连接，L2TP会话用来记录和管理它们之间的PPP连接状态。因此，在建立PPP连接以前，隧道双方需要为PPP连接预先协商出一个L2TP会话。会话中携带了移动办公用户的LCP协商信息和用户认证信息，LNS对收到的信息认证通过后，通知移动办公用户会话建立成功。L2TP会话连接由会话ID进行标识。</p>
</li>
<li><p>移动办公用户与LNS建立PPP连接。移动办公用户通过与LNS建立PPP连接获取LNS分配的企业内网IP地址。</p>
</li>
<li><p>移动办公用户发送业务报文访问企业总部服务器。</p>
</li>
</ol>
<p>•Call-LNS场景：L2TP除了可以为出差员工提供远程接入服务以外，还可以进行企业分支与总部的内网互联，实现分支用户与总部用户的互访。一般是由分支路由器充当LAC与LNS建立L2TP隧道，这样就可实现分支与总部网络之间的数据通过L2TP隧道互通。</p>
</blockquote>
<h2 id="L2TP-Over-IPSec"><a href="#L2TP-Over-IPSec" class="headerlink" title="L2TP Over IPSec"></a>L2TP Over IPSec</h2><p>当企业对数据和网络的安全性要求较高时，L2TP无法为报文传输提供足够的保护。这时可以和IPSec功能结合使用，保护传输的数据，有效避免数据被截取或攻击。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/17.png"></p>
<blockquote>
<p>•企业出差用户和总部通信，使用L2TP功能建立VPN连接，总部部署为LNS对接入的用户进行认证。当出差用户需要向总部传输高机密信息时，L2TP无法为报文传输提供足够的保护，这时可以和IPSec功能结合使用，保护传输的数据。在出差用户的PC终端上运行拨号软件，将数据报文先进行L2TP封装，再进行IPSec封装，发往总部。在总部网关，部署IPSec策略，最终还原数据。这种方式IPSec功能会对所有源地址为LAC、目的地址为LNS的报文进行保护。</p>
</blockquote>
<h2 id="MPLS-VPN概述"><a href="#MPLS-VPN概述" class="headerlink" title="MPLS VPN概述"></a>MPLS VPN概述</h2><p>•MPLS是一种利用标签（Label）进行转发的技术，最初为了提高IP报文转发速率而被提出，现主要应用于VPN和流量工程、QoS等场景。 </p>
<p>•根据部署的不同，MPLS VPN可分为MPLS L2 VPN或者MPLS L3 VPN。</p>
<p>•企业可以自建MPLS专网也可以通过租用运营商MPLS专网的方式获得MPLS VPN接入服务。</p>
<p><img src="/2021/05/17/IP-VPN%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0/18.png"></p>
<blockquote>
<p>•MPLS VPN网络一般由运营商搭建，VPN用户购买VPN服务来实现用户网络之间（图中的分公司和总公司）的路由传递、数据互通等。</p>
<p>•基本的MPLS VPN网络架构由CE（Customer Edge）、PE（Provider Edge）和P（Provider）三部分组成：</p>
<ul>
<li><p>CE：用户网络边缘设备，有接口直接与运营商网络相连。CE可以是路由器或交换机，也可以是一台主机。通常情况下，CE“感知”不到VPN的存在，也不需要支持MPLS。</p>
</li>
<li><p>PE：运营商边缘路由器，是运营商网络的边缘设备，与CE直接相连。在MPLS网络中，对VPN的所有处理都发生在PE上，对PE性能要求较高。</p>
</li>
<li><p>P：运营商网络中的骨干路由器，不与CE直接相连。P设备只需要具备基本MPLS转发能力，不维护VPN相关信息。</p>
</li>
</ul>
<p>•更多MPLS及MPLS VPN的相关内容，参考HCIP-Datacom-Advance相应课程。</p>
</blockquote>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（判断题）L2TP VPN工作在网络层。</p>
<p>A. 正确</p>
<p><strong>B. 错误</strong></p>
<p>2.（多选题）IPSec SA包含以下哪些内容？</p>
<p><strong>A. SPI</strong></p>
<p><strong>B. 安全协议</strong></p>
<p>C. 源地址</p>
<p><strong>D. 目的地址</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•VPN技术拥有安全、廉价、支持移动业务、灵活等一系列优势，已经成为现网中部署最为广泛的一类技术。</p>
<p>•本课程从VPN基本概念与分类出发，简单介绍了如下几类常见VPN技术：</p>
<ul>
<li><p>IPSec VPN：是一系列为IP网络提供安全性的协议和服务的集合，为IP网络提供安全的传输。</p>
</li>
<li><p>GRE VPN：提供了将一种协议的报文封装在另一种协议报文中的机制，解决异种网络的传输问题。</p>
</li>
<li><p>L2TP VPN：是一种能够提供移动用户远程接入服务的二层VPN技术。</p>
</li>
<li><p>MPLS VPN：一种通过标签交换技术，实现站点与站点之间互联的VPN技术。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/" itemprop="url">IP-网络设备安全特性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T20:03:25+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•由于IP网络规模庞大，导致网络设备数量众多、通信协议层出不穷。同时，IP网络的管理也变得极其复杂，安全性和业务灵活性以及安全性和管理维护便利性之间存在着矛盾。不同技术能力、管理水平的管理人员，对这些矛盾的处理能力也参差不齐。管理员往往追求业务可用性，而忽略了安全防御能力，导致必要的安全措施没有得到妥善的配置，设备本身的安全能力无法发挥。</p>
<p>•本课程主要介绍常见的网络设备安全加固策略，对一些常见的安全配置进行了举例说明。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述常见的设备安全加固策略。</p>
<p>▫实现Stelnet的配置。</p>
<p>▫实现本机防攻击的配置。</p>
<h1 id="1-常见设备安全加固策略"><a href="#1-常见设备安全加固策略" class="headerlink" title="1.常见设备安全加固策略"></a>1.<strong>常见设备安全加固策略</strong></h1><h2 id="为什么需要网络设备安全"><a href="#为什么需要网络设备安全" class="headerlink" title="为什么需要网络设备安全"></a>为什么需要网络设备安全</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/1.png"></p>
<h2 id="常见设备安全加固策略"><a href="#常见设备安全加固策略" class="headerlink" title="常见设备安全加固策略"></a>常见设备安全加固策略</h2><p>常见的设备安全加固策略主要可以从以下方面部署：</p>
<p>​    ▫关闭不使用的业务和协议端口</p>
<p>​    ▫废弃不安全的访问通道</p>
<p>​    ▫基于可信路径的访问控制</p>
<p>​    ▫本机防攻击</p>
<h2 id="关闭不使用的业务和协议端口"><a href="#关闭不使用的业务和协议端口" class="headerlink" title="关闭不使用的业务和协议端口"></a>关闭不使用的业务和协议端口</h2><p>在分析业务需求的基础上，按照最小授权原则，关闭不使用的业务和协议端口。</p>
<ul>
<li><p>不使用的物理端口，应该默认配置为关闭，即使插上网线也不能通信</p>
</li>
<li><p>不使用的协议端口，应该默认配置为关闭，不对外提供访问。如常见的telnet、FTP、HTTP等端口。</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/2.png"></p>
<h2 id="废弃不安全的访问通道"><a href="#废弃不安全的访问通道" class="headerlink" title="废弃不安全的访问通道"></a>废弃不安全的访问通道</h2><p>在业务需求分析的基础上，优先满足业务的访问需求。在同一个访问需求有多种访问通道服务的情况下，废弃不安全的访问通道，而选择安全的访问通道。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/3.png"></p>
<blockquote>
<p>•通过命令行、WEB、网管等方式登录设备时，建议采用安全加密的通道SSH、HTTPS、SNMPv3。</p>
<p>•设备之间，以及设备和终端之间数据传输，也建议采用加密的数据传输协议SFTP。</p>
</blockquote>
<h2 id="安全的数据访问通道"><a href="#安全的数据访问通道" class="headerlink" title="安全的数据访问通道"></a>安全的数据访问通道</h2><p>•为保证设备安全，尽量选择安全的访问通道。</p>
<p>•设备数据传输安全常见场景及采用协议：</p>
<p>▫用户远程登录：</p>
<ul>
<li><p>Telnet：采用TCP协议进行明文传输。</p>
</li>
<li><p>STelnet：基于SSH协议，提供安全的信息保障和强大的认证功能。</p>
</li>
</ul>
<p>▫设备文件操作：</p>
<ul>
<li>FTP：支持文件传输以及文件目录的操作，具有授权和认证功能，明文传输数据。</li>
<li>TFTP：只支持文件传输，不支持授权和认证，明文传输数据。</li>
<li>SFTP：支持文件传输及文件目录的操作，数据进行了严格加密和完整性保护。</li>
</ul>
<h2 id="SSH概述"><a href="#SSH概述" class="headerlink" title="SSH概述"></a>SSH概述</h2><p>•SSH(Secure Shell，安全外壳协议)，在非安全网络上提供了安全的远程登录、安全文件传输以及TCP/IP安全隧道。不仅在登陆过程中对密码进行加密传送，而且对登陆后执行的命令的数据也进行加密。</p>
<p>•合法用户通过客户端登录，完成用户名以及对应的密码验证后，客户端会尝试和服务端建立会话，每个会话是一个独立的逻辑通道，可以提供给不同的上层应用使用。</p>
<p>•STelnet和SFTP各自利用了其中的一个逻辑通道，通过SSH对数据进行加密，从而实现数据的安全传输。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/4.png"></p>
<blockquote>
<p>•SSH协议由IETF制订，最新版本是V2.0，1.3和1.5版本存在安全隐患，已经逐步被淘汰。</p>
<p>•SSH支持服务端和客户端的双向认证，提供保密性和完整性等安全服务。</p>
</blockquote>
<h2 id="SSH协议结构"><a href="#SSH协议结构" class="headerlink" title="SSH协议结构"></a>SSH协议结构</h2><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/5.png"></p>
<p>SSH协议框架中最主要的部分是三个协议：传输层协议、用户认证协议和连接协议。</p>
<ul>
<li><p>传输层协议：提供版本协商，加密算法协商，密钥交换，服务端认证以及信息完整性支持。</p>
</li>
<li><p>用户认证协议：为服务器提供客户端的身份鉴别。</p>
</li>
<li><p>连接协议：将加密的信息隧道复用为多个逻辑通道，提供给高层的应用协议（STelnet、SFTP）使用；各种高层应用协议可以相对地独立于SSH基本体系之外，并依靠这个基本框架，通过连接协议使用SSH的安全机制。</p>
</li>
</ul>
<blockquote>
<p>•SSH中用到的算法主要有几类：</p>
<ul>
<li><p>用于数据完整性保护的MAC算法，如hmac-md5、hmac-md5-96等；</p>
</li>
<li><p>用于数据信息加密的算法，如3des-cbc、aes128-cbc、des-cbc等；</p>
</li>
<li><p>用于产生会话密钥的密钥交换算法，如diffle-hellman-group-exchange-sha1等；</p>
</li>
<li><p>用于进行数字签名和认证的主机公钥算法，如RSA、DSA等；</p>
</li>
</ul>
<p>•RSA（Rivest-Shamir-Adleman）加密算法，一种非对称加密算法。RSA是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。RSA就是他们三人姓氏开头字母拼在一起组成的。</p>
<p>•DES（Data Encryption Standard）数据加密标准。DES使用一个56比特的密钥。</p>
<p>•3DES（Triple Data Encryption Standard），是DES的一个更安全的变形。它使用3条56位的密钥对数据进行三次加密。</p>
<p>•DSA（Digital Signature Algorithm）数字签名算法。</p>
<p>•对称密钥技术：</p>
<ul>
<li>对称密钥加密又叫专用密钥加密，即发送和接收数据的双方必使用相同的密钥对明文进行加密和解密运算。对称密钥加密算法主要包括：DES、3DES等。</li>
</ul>
<p>•公开密钥技术：</p>
<ul>
<li>公钥加密算法也称非对称密钥算法，用两对密钥：一个公共密钥和一个专用密钥。用户要保障专用密钥的安全；公共密钥则可以发布出去。公共密钥与专用密钥是有紧密关系的，用公共密钥加密的信息只能用专用密钥解密，反之亦然。由于公钥算法不需要联机密钥服务器，密钥分配协议简单，所以极大简化了密钥管理。除加密功能外，公钥系统还可以提供数字签名。</li>
</ul>
<p>•机密性（Confidentiality）：指信息在存储、传输、使用的过程中，不会被泄漏给非授权用户或实体；</p>
<p>•完整性（Integrity）：指信息在存储、传输、使用的过程中，不会被非授权用户篡改或防止授权用户对信息进行不恰当的篡改；</p>
<p>•可用性（Availability）：指确保授权用户或实体对信息资源的正常使用不会被异常拒绝，允许其可靠而及时地访问信息资源。</p>
</blockquote>
<h2 id="基于可信路径的访问控制"><a href="#基于可信路径的访问控制" class="headerlink" title="基于可信路径的访问控制"></a>基于可信路径的访问控制</h2><p>•可以在设备上部署基于可信路径的访问控制策略，以提升网络的安全性。</p>
<p>•部署URPF，可以判定某个报文的源地址是否合法，如果该报文的路径与URPF学习的路径不符，丢弃该报文，用URPF可以有效防范IP地址欺骗。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/6.png"></p>
<blockquote>
<p>•IP网络的开放性决定了，只要路由可达，任何人都可以对目标主机进行访问或者攻击。</p>
<p>•对于某一个主机而言，访问它的客户端的报文历经的路径通常是固定的，尤其是在网络边缘，这种路径的固定特性表现得更加明显。</p>
<p>•URPF（Unicast Reverse Path Forwarding，单播逆向路径转发）分为严格模式和松散模式以及允许匹配缺省路由的方式。其原理是当设备转发IP报文时，检查数据报文的源IP地址是否合法，检查的原理是根据数据包的源IP地址查路由表。</p>
<ul>
<li>对于严格模式：如果报文能匹配明细路由，并且入接口跟匹配路由的出接口一致，则允许报文上送，否则丢弃报文。</li>
<li>对于松散模式：如果报文匹配上明细路由，则运行报文上送，否则丢弃报文，不检查接口是否匹配。默认情况下，会认为缺省路由不存在，不会去匹配缺省路由，只有进行了配置时候，才会去匹配缺省路由的。</li>
<li>对允许匹配缺省路由的模式，必须和严格模式一起配置，报文匹配明细路由或者缺省路由，并且报文入接口跟匹配路由的出接口一致才上送，否则丢弃。不支持缺省路由与松散模式一起配置，因为这样无法达到防攻击的效果。松散模式和严格模式互斥，只能配置一种模式。</li>
</ul>
</blockquote>
<h2 id="本机防攻击"><a href="#本机防攻击" class="headerlink" title="本机防攻击"></a>本机防攻击</h2><p>•在网络中，存在着大量针对CPU的恶意攻击报文以及需要正常上送CPU的各类报文。针对CPU的恶意攻击报文会导致CPU长时间繁忙的处理攻击报文，从而引发其他业务的断续甚至系统的中断；大量正常的报文也会导致CPU占用率过高，性能下降，从而影响正常的业务。</p>
<p>•为了保护CPU，保证CPU对正常业务的处理和响应，设备提供了本机防攻击功能。本机防攻击针对的是上送CPU的报文，主要用于保护设备自身安全，保证已有业务在发生攻击时的正常运转，避免设备遭受攻击时各业务的相互影响。</p>
<p>•本机防攻击包括CPU防攻击和攻击溯源两部分。</p>
<ul>
<li><p>CPU防攻击针对上送CPU的报文进行限制和约束，使单位时间内上送CPU报文的数量限制在一定的范围之内，从而保护CPU的安全，保证CPU对业务的正常处理。</p>
</li>
<li><p>攻击溯源针对DoS（Denial of Service，拒绝服务）攻击进行防御。设备通过对上送CPU的报文进行分析统计，然后对统计的报文设置一定的阈值，将超过阈值的报文判定为攻击报文，再对这些攻击报文根据报文信息找出攻击源用户或者攻击源接口，最后通过日志、告警等方式提醒管理员以便管理员采用一定的措施来保护设备，或者直接丢弃攻击报文以对攻击源进行惩罚。</p>
</li>
</ul>
<h2 id="CPU防攻击"><a href="#CPU防攻击" class="headerlink" title="CPU防攻击"></a>CPU防攻击</h2><p>•多级安全机制，保证设备的安全，实现了对设备的分级保护。设备通过以下策略实现对设备的分级保护：</p>
<ul>
<li><p>第一级：通过黑名单来过滤上送CPU的非法报文。</p>
</li>
<li><p>第二级：CPCAR（Control Plane Committed Access Rate）。对上送CPU的报文按照协议类型进行速率限制，保证每种协议上送CPU的报文不会过多。</p>
</li>
<li><p>第三级：对上送CPU的报文，按照协议优先级进行调度，保证优先级高的协议先得到处理。</p>
</li>
<li><p>第四级：对上送CPU的报文统一限速，对超过统一限速值的报文随机丢弃，保证整体上送CPU的报文不会过多，保护CPU安全。 </p>
</li>
</ul>
<p>•动态链路保护功能的CPU报文限速，是指当设备检测到SSH Session数据、Telnet Session数据、HTTP Session数据、FTP Session数据以及BGP Session数据建立时，会启动对此Session的动态链路保护功能，后续上送报文如匹配此Session特征信息，此类数据将会享受高速率上送的权利，由此保证了此Session相关业务的运行可靠性、稳定性。</p>
<h2 id="攻击溯源原理"><a href="#攻击溯源原理" class="headerlink" title="攻击溯源原理"></a>攻击溯源原理</h2><p>•攻击溯源包括报文解析、流量分析、攻击源识别和发送日志告警通知管理员以及实施惩罚四个过程。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/7.png"></p>
<p>•通过图中所示的四个过程，找出攻击源，然后管理员通过ACL或配置黑名单的方式限制攻击源，以保护设备CPU。 </p>
<h1 id="2-网络设备安全加固部署示例"><a href="#2-网络设备安全加固部署示例" class="headerlink" title="2.网络设备安全加固部署示例"></a>2.网络设备安全加固部署示例</h1><h2 id="STelnet配置"><a href="#STelnet配置" class="headerlink" title="STelnet配置"></a>STelnet配置</h2><h3 id="SSH基本配置-1"><a href="#SSH基本配置-1" class="headerlink" title="SSH基本配置 (1)"></a>SSH基本配置 (1)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/8.png"></p>
<h3 id="SSH基本配置-2"><a href="#SSH基本配置-2" class="headerlink" title="SSH基本配置 (2)"></a>SSH基本配置 (2)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/9.png"></p>
<h3 id="SSH配置示例"><a href="#SSH配置示例" class="headerlink" title="SSH配置示例"></a>SSH配置示例</h3><p>•用户希望安全的远程登录设备，因此配置STelnet方式进行远程的安全登录。</p>
<p>•在R3上配置两个登录用户client001和client002，R1使用client001通过password认证方式登录R3，R2使用client002通过RSA认证方式登录R3。配置安全策略，保证只有R1和R2才能登录设备。</p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/10.png"></p>
<h3 id="SSH配置命令-1"><a href="#SSH配置命令-1" class="headerlink" title="SSH配置命令 (1)"></a>SSH配置命令 (1)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/11.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/12.png"></p>
<h3 id="SSH配置命令-2"><a href="#SSH配置命令-2" class="headerlink" title="SSH配置命令 (2)"></a>SSH配置命令 (2)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/13.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/14.png"></p>
<h3 id="SSH配置命令-3"><a href="#SSH配置命令-3" class="headerlink" title="SSH配置命令 (3)"></a>SSH配置命令 (3)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/15.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/16.png"></p>
<h3 id="SSH配置命令-4"><a href="#SSH配置命令-4" class="headerlink" title="SSH配置命令 (4)"></a>SSH配置命令 (4)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/15.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/17.png"></p>
<h3 id="SSH配置命令-5"><a href="#SSH配置命令-5" class="headerlink" title="SSH配置命令 (5)"></a>SSH配置命令 (5)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/15.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/18.png"></p>
<h3 id="SSH配置验证"><a href="#SSH配置验证" class="headerlink" title="SSH配置验证"></a>SSH配置验证</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/19.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/20.png"></p>
<h2 id="本机防攻击配置"><a href="#本机防攻击配置" class="headerlink" title="本机防攻击配置"></a>本机防攻击配置</h2><h3 id="本机防攻击基本配置-1"><a href="#本机防攻击基本配置-1" class="headerlink" title="本机防攻击基本配置 (1)"></a>本机防攻击基本配置 (1)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/21.png"></p>
<h3 id="本机防攻击基本配置-2"><a href="#本机防攻击基本配置-2" class="headerlink" title="本机防攻击基本配置 (2)"></a>本机防攻击基本配置 (2)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/22.png"></p>
<blockquote>
<p>•缺省情况下，SSH报文、Telnet报文、SSHv6报文、Telnetv6报文、HTTP报文、BGP报文的动态链路保护功能的限制速率是512pps，FTP报文的动态链路保护功能的限制速率是1024pps。</p>
</blockquote>
<h3 id="本机防攻击配置示例"><a href="#本机防攻击配置示例" class="headerlink" title="本机防攻击配置示例"></a>本机防攻击配置示例</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/23.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/24.png"></p>
<blockquote>
<p>•Net：Network。</p>
</blockquote>
<h3 id="本机防攻击配置命令-1"><a href="#本机防攻击配置命令-1" class="headerlink" title="本机防攻击配置命令 (1)"></a>本机防攻击配置命令 (1)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/25.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/26.png"></p>
<h3 id="本机防攻击配置命令-2"><a href="#本机防攻击配置命令-2" class="headerlink" title="本机防攻击配置命令 (2)"></a>本机防攻击配置命令 (2)</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/27.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/28.png"></p>
<blockquote>
<p>•应用层联动不需要使能，只要关闭Router的Telnet服务器功能，Router会丢弃收到的Telnet报文。</p>
</blockquote>
<h3 id="本机防攻击配置验证"><a href="#本机防攻击配置验证" class="headerlink" title="本机防攻击配置验证"></a>本机防攻击配置验证</h3><p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/29.png"></p>
<p><img src="/2021/05/17/IP-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7/30.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（判断题）当远程登录设备时，采用Stelnet的方式比Telnet的方式更加安全，因为Stelnet的方式登录采用TCP封装，而Telnet的方式登录设备采用UDP封装。</p>
<p>A 对</p>
<p><strong>B 错</strong></p>
<p>2.（判断题）本机防攻击包括CPU防攻击和攻击溯源两部分。</p>
<p><strong>A 对</strong></p>
<p>B 错</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•设备的安全加固，需要从管理平面、控制平面和转发平面多个维度进行考虑。从设备本身的脆弱点出发，进行网络安全风险的评估，从而梳理出设备整体的安全架构和安全加固策略。</p>
<p>•在设备支持的情况下，尽量采用SSH、SFTP等安全协议进行设备访问和数据传输。设备的CPU容易成为被攻击的对象，本机防攻击的部署至关重要。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/" itemprop="url">IP-华为防火墙技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-17T19:42:33+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="梳理"><a href="#梳理" class="headerlink" title="梳理"></a>梳理</h1><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF.png"></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•“防火墙”一词起源于建筑领域，用来隔离火灾，阻止火势从一个区域蔓延到另一个区域。引入到通信领域，防火墙这一具体设备通常用于两个网络之间有针对性的、逻辑意义上的隔离。这种隔离是选择性的，隔离“火”的蔓延，而又保证“人”可以穿墙而过。这里的“火”是指网络中的各种攻击，而“人”是指正常的通信报文。</p>
<p>•本课程将介绍在通信领域中什么是防火墙，为什么需要防火墙，以及防火墙的基本工作原理和配置。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述防火墙的定义、类型和发展历史</p>
<p>▫区分防火墙与路由器和交换机</p>
<p>▫阐明防火墙的基本概念，例如安全区域、安全策略、会话表和Server-map等</p>
<p>▫实现防火墙的基本配置</p>
<h1 id="1-防火墙概述"><a href="#1-防火墙概述" class="headerlink" title="1.防火墙概述"></a>1.防火墙概述</h1><h2 id="为什么需要防火墙？"><a href="#为什么需要防火墙？" class="headerlink" title="为什么需要防火墙？"></a>为什么需要防火墙？</h2><p>•安全无处不在。路由器和交换机构建了互联互通的网络，带来便利的同时也带来了安全隐患。</p>
<p>•例如在网络边界，企业有了如下安全诉求：</p>
<p>▫外部网络安全隔离</p>
<p>▫内部网络安全管控</p>
<p>▫内容安全过滤</p>
<p>▫入侵防御</p>
<p>▫防病毒</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/1.png"></p>
<h2 id="什么是防火墙？"><a href="#什么是防火墙？" class="headerlink" title="什么是防火墙？"></a>什么是防火墙？</h2><p>•在通信领域，防火墙是一种安全设备。它用于保护一个网络区域免受来自另一个网络区域的攻击和入侵，通常被应用于网络边界，例如企业互联网出口、企业内部业务边界、数据中心边界等。</p>
<p>•防火墙根据设备形态分为，框式防火墙、盒式防火墙和软件防火墙，支持在云上云下灵活部署。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/2.png"></p>
<blockquote>
<p>•严格意义上，防火墙还有更多的部署形态，例如桌面型防火墙（盒式防火墙的一种）。桌面型防火墙适用于小型企业、行业分支、连锁商业机构等场景。华为盒式防火墙同时支持传统模式和云管理模式。云管理模式由云端统一管理分支机构的安全接入，支持设备即插即用、业务配置自动化、运维可视化和网络大数据分析。</p>
<p>•本课程不过多介绍桌面型防火墙和软件防火墙，后续内容聚焦的框式/盒式硬件防火墙。</p>
</blockquote>
<h2 id="防火墙与交换机、路由器功能对比"><a href="#防火墙与交换机、路由器功能对比" class="headerlink" title="防火墙与交换机、路由器功能对比"></a>防火墙与交换机、路由器功能对比</h2><p>•以园区网为例，交换机作用是接入终端和汇聚内部路由，组建内部互联互通的局域网。</p>
<p>•路由器作用是路由的分发、寻址和转发，构建外部连接网络。</p>
<p>•防火墙作用是流量控制和安全防护，区分和隔离不同安全区域。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/3.png"></p>
<h2 id="防火墙与路由器转发流程对比"><a href="#防火墙与路由器转发流程对比" class="headerlink" title="防火墙与路由器转发流程对比"></a>防火墙与路由器转发流程对比</h2><p>•防火墙的转发流程比路由器复杂。以框式设备为例，硬件上除了接口、LPU（Line Processing Unit）、交换网板等外，防火墙还特有SPU（Service Processing Unit），用于实现防火墙的安全功能。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/4.png"></p>
<h2 id="防火墙的典型应用场景"><a href="#防火墙的典型应用场景" class="headerlink" title="防火墙的典型应用场景"></a>防火墙的典型应用场景</h2><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/5.png"></p>
<blockquote>
<p>•DMZ（Demilitarized Zone）起源于军方，是介于严格的军事管制区和松散的公共区域之间的一种有着部分管制的区域。防火墙设备引用了这一术语，指代一个逻辑上和物理上都与内部网络和外部网络分离的安全区域。在企业中一般用于服务器的放置。</p>
<p>•数据中心网络一般采用Spine-Leaf架构。Spine为骨干节点负责流量高速转发，Leaf为叶子节点负责服务器、防火墙或其他设备接入。Spine-Leaf之间全三层互联。</p>
</blockquote>
<h2 id="防火墙的发展历程"><a href="#防火墙的发展历程" class="headerlink" title="防火墙的发展历程"></a>防火墙的发展历程</h2><p>•纵观防火墙的发展历史，防火墙经历了从低级到高级、从功能简单到功能复杂的过程。网络技术的不断发展和新需求的不断提出，推动着防火墙的发展。</p>
<p>•防火墙从包过滤防火墙发展起经历了状态检测、统一威胁管理、NGFW等到AI防火墙，有以下特点：</p>
<ul>
<li><p>访问控制越来越精细</p>
</li>
<li><p>防护能力越来越强</p>
</li>
<li><p>性能越来越高</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/6.png"></p>
<blockquote>
<p>•更多防火墙发展历史，请参考《强叔侃墙》</p>
</blockquote>
<h2 id="包过滤防火墙"><a href="#包过滤防火墙" class="headerlink" title="包过滤防火墙"></a>包过滤防火墙</h2><p>•包过滤是指基于五元组对每个数据包进行检测，根据配置的安全策略转发或丢弃数据包。</p>
<p>•包过滤防火墙的基本原理是：通过配置访问控制列表（Access Control List，ACL）实施数据包的过滤。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/7.png"></p>
<blockquote>
<p>•包过滤防火墙主要基于数据包中的源/目的IP地址、源/目的端口号、IP 标识和报文传递的方向等信息。</p>
<p>•包过滤防火墙的设计简单，非常易于实现，而且价格便宜。</p>
<p>•包过滤防火墙的缺点主要表现以下几点：</p>
<ul>
<li><p>随着ACL复杂度和长度的增加，其过滤性能呈指数下降；</p>
</li>
<li><p>静态的ACL规则难以适应动态的安全要求；</p>
</li>
<li><p>包过滤不检查会话状态也不分析数据，这很容易让黑客蒙混过关。例如，攻击者可以使用假冒地址进行欺骗，通过把自己主机IP地址设成一个合法主机IP地址，就能很轻易地通过报文过滤器。</p>
</li>
</ul>
</blockquote>
<h2 id="状态检测防火墙"><a href="#状态检测防火墙" class="headerlink" title="状态检测防火墙"></a>状态检测防火墙</h2><p>•状态检测是包过滤技术的发展，它考虑报文前后的关联性，检测的是连接状态而非单个报文。</p>
<p>•状态检测防火墙就是支持状态检测功能的防火墙。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/8.png"></p>
<blockquote>
<p>•状态检测防火墙通过对连接的首个数据包（后续简称首包）检测而确定一条连接的状态。后续数据包根据所属连接的状态进行控制（转发或阻塞）。</p>
</blockquote>
<h2 id="AI防火墙"><a href="#AI防火墙" class="headerlink" title="AI防火墙"></a>AI防火墙</h2><p>•AI防火墙是结合AI技术的新一代防火墙。它通过结合AI算法或AI芯片等多种方式，进一步提高了防火墙的安全防护能力和性能。</p>
<p>•华为AI防火墙，内置的恶意文件检测引擎CDE、诱捕Sensor、APT检测引擎和探针，支持与沙箱和华为大数据分析平台CIS联动检测，打造智能防御体系。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/9.png"></p>
<blockquote>
<p>•华为HiSecEngine USG6000E系列是业界首批推出的AI防火墙。AI防火墙没有统一的标准，例如通过用大量数据和算法“训练”防火墙，让其学会自主识别威胁；通过内置AI芯片，提高应用识别和转发性能，都可以被称为AI防火墙。</p>
<p>•APT（Advanced Persistent Threat，高级持续性威胁）是指用先进的攻击手段对特定目标进行长期持续性攻击的攻击形式。</p>
<p>•沙箱（Sandbox）是一个用于检测病毒的安全设备，它为疑似病毒构建虚拟环境，通过观察其后续行为检测病毒。沙箱是APT检测的重要设备。华为的沙箱产品为Firehunter。</p>
<p>•CIS（Cybersecurity Intelligence System）能够对网络中的流量及各类设备的网络、安全日志等海量网络基础数据执行有效采集，通过大数据实时及离线分析，结合机器学习技术、专家信誉、情报驱动，有效的发现网络中的潜在威胁和高级威胁，实现企业内部的全网安全态势感知，同时可以结合华为HiSec解决方案高效地完成威胁的处置闭环，防患未然。</p>
<p>•自研恶意文件检测引擎（CDE）引入PE Class 2.0 AI算法，对全文件进行还原，对文件内容进行深度检测。（业界主流基于流检测。流检测的检测速度快，但只还原文件头，不对文件内容进行检查。</p>
<p>•华为独创的AIE APT检测引擎，引入AI算法，持续防御最新威胁。</p>
<p>•更多AI防火墙相关内容请参考<a target="_blank" rel="noopener" href="https://e.huawei.com/cn/products/enterprise-networking/security%E5%92%8Chttps://e.huawei.com/cn/material/networking/e1869bfff9ca42c1b4f6a83f69118215%E3%80%82">https://e.huawei.com/cn/products/enterprise-networking/security和https://e.huawei.com/cn/material/networking/e1869bfff9ca42c1b4f6a83f69118215。</a></p>
</blockquote>
<h2 id="本节小结"><a href="#本节小结" class="headerlink" title="本节小结"></a>本节小结</h2><p>•本章节主要介绍防火墙的基本概念、应用场景和发展历史：</p>
<p>▫防火墙是一种安全设备，有灵活的设备形态包括框式、盒式、桌面型和软件防火墙。</p>
<p>▫防火墙可被用于但不仅限于企业边界防护、内网管控与安全隔离、数据中心边界防护和数据中心安全联动。</p>
<p>▫防火墙技术不断的发展，从早期的包过滤防火墙发展到当前的AI防火墙。</p>
<h1 id="2-防火墙的基本概念"><a href="#2-防火墙的基本概念" class="headerlink" title="2.防火墙的基本概念"></a>2.防火墙的基本概念</h1><h2 id="防火墙基本概念：安全区域"><a href="#防火墙基本概念：安全区域" class="headerlink" title="防火墙基本概念：安全区域"></a>防火墙基本概念：安全区域</h2><p>•安全区域（Security Zone），简称为区域（Zone），是防火墙的重要概念。防火墙大部分的安全策略都基于安全区域实施。</p>
<p>•一个安全区域是防火墙若干接口所连网络的集合，一个区域内的用户具有相同的安全属性。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/10.png"></p>
<h2 id="默认安全区域"><a href="#默认安全区域" class="headerlink" title="默认安全区域"></a>默认安全区域</h2><p>•华为防火墙确认已创建四个区域，untrust、dmz、trust和local区域。安全区域有以下特性：</p>
<ul>
<li><p>默认的安全区域不能删除，也不允许修改安全优先级。</p>
</li>
<li><p>每个Zone都必须设置一个安全优先级（Priority），值越大，则Zone的安全优先级越高。</p>
</li>
<li><p>用户可根据自己的需求创建自定义的Zone。</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/11.png"></p>
<blockquote>
<p>防火墙默认安全区域均为小写字母，且大小写敏感，包括：</p>
<p>•非受信区域（untrust）：通常用于定义Internet等不安全的网络。</p>
<p>•非军事化区域（dmz）：通常用于定义内网服务器所在区域。因为这种设备虽然部署在内网，但是经常需要被外网访问，存在较大安全隐患，同时一般又不允许其主动访问外网，所以将其部署一个优先级比trust低，但是比untrust高的安全区域中。</p>
<ul>
<li><p>DMZ（Demilitarized Zone）起源于军方，是介于严格的军事管制区和松散的公共区域之间的一种有着部分管制的区域。防火墙设备引用了这一术语，指代一个逻辑上和物理上都与内部网络和外部网络分离的安全区域。</p>
</li>
<li><p>DMZ安全区域很好地解决了服务器的放置问题。该安全区域可以放置需要对外提供网络服务的设备，如WWW服务器、FTP服务器等。上述服务器如果放置于内部网络，外部恶意用户则有可能利用某些服务的安全漏洞攻击内部网络；如果放置于外部网络，则无法保障它们的安全。</p>
</li>
</ul>
<p>•受信区域（trust）：通常用于定义内网终端用户所在区域。</p>
<p>•本地区域（local）：local区域定义的是设备本身，包括设备的各接口本身。凡是由设备构造并主动发出的报文均可认为是从Local区域中发出，凡是需要设备响应并处理（而不仅是检测或直接转发）的报文均可认为是由local区域接收。用户不能改变local区域本身的任何配置，包括向其中添加接口。</p>
<ul>
<li>由于local区域的特殊性，在很多需要设备本身进行报文收发的应用中，需要开放对端所在安全区域与local区域之间的安全策略。</li>
</ul>
</blockquote>
<h2 id="区域间（Interzone）示例"><a href="#区域间（Interzone）示例" class="headerlink" title="区域间（Interzone）示例"></a>区域间（Interzone）示例</h2><p>流量的源、目的地址决定了互访的区域。本例1中PC访问防火墙的接口的流量实际上是从trust zone到达local zone；本例2中PC访问Internet的流量实际上是从trust zone到达untrust zone。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/12.png"></p>
<h2 id="防火墙基本概念：安全策略"><a href="#防火墙基本概念：安全策略" class="headerlink" title="防火墙基本概念：安全策略"></a>防火墙基本概念：安全策略</h2><p>•安全策略是控制防火墙对流量转发以及对流量进行内容安全一体化检测的策略。</p>
<p>•当防火墙收到流量后，对流量的属性（五元组、用户、时间段等）进行识别，然后与安全策略的条件进行匹配。如果条件匹配，则此流量被执行对应的动作。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/13.png"></p>
<h2 id="安全策略组成"><a href="#安全策略组成" class="headerlink" title="安全策略组成"></a>安全策略组成</h2><p>•安全策略的组成有匹配条件、动作和安全配置文件（可选）。安全配置文件实现内容安全。</p>
<p>•安全策略动作如果为“允许”则可配置安全配置文件，如果为“禁止”则可配置反馈报文。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/14.png"></p>
<blockquote>
<p>•动作说明：</p>
<p>▫允许：如果动作为“允许”，则对流量进行如下处理：</p>
<ul>
<li><p>如果没有配置内容安全检测，则允许流量通过。</p>
</li>
<li><p>如果配置内容安全检测，最终根据内容安全检测的结论来判断是否对流量进行放行。内容安全检测包括反病毒、入侵防御等，它是通过在安全策略中引用安全配置文件实现的。如果其中一个安全配置文件阻断该流量，则防火墙阻断该流量。如果所有的安全配置文件都允许该流量转发，则防火墙允许该流量转发。</p>
</li>
</ul>
<p>▫禁止：表示拒绝符合条件的流量通过。</p>
<ul>
<li>如果动作为“禁止”，防火墙不仅可以将报文丢弃，还可以针对不同的报文类型选择发送对应的反馈报文。发起连接请求的客户端/服务器收到防火墙发送的阻断报文后，可以快速结束会话并让用户感知到请求被阻断。<ul>
<li>Reset客户端：防火墙向TCP客户端发送TCP reset报文。</li>
<li>Reset服务器：防火墙向TCP服务器发送TCP reset报文。</li>
<li>ICMP不可达：FW向报文客户端发送ICMP不可达报文。</li>
</ul>
</li>
</ul>
<p>•更多详细信息，可以参考文档，“安全策略”章节，<a target="_blank" rel="noopener" href="https://support.huawei.com/hedex/hdx.do?docid=EDOC1100084128&amp;lang=zh&amp;idPath=24030814%7C9856724%7C21430823%7C22984765%7C23176238%E3%80%82">https://support.huawei.com/hedex/hdx.do?docid=EDOC1100084128&amp;lang=zh&amp;idPath=24030814%7C9856724%7C21430823%7C22984765%7C23176238。</a></p>
</blockquote>
<h2 id="安全策略的匹配过程"><a href="#安全策略的匹配过程" class="headerlink" title="安全策略的匹配过程"></a>安全策略的匹配过程</h2><p>•当配置多条安全策略规则时，安全策略的匹配按照策略列表的顺序执行，即从策略列表顶端开始逐条向下匹配。如果流量匹配了某个安全策略，将不再进行下一个策略的匹配。</p>
<p>•安全策略的配置顺序很重要，需要先配置条件精确的策略，再配置宽泛的策略。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/15.png"></p>
<blockquote>
<p>•系统默认存在一条缺省安全策略default。缺省安全策略位于策略列表的最底部，优先级最低，所有匹配条件均为any，动作默认为禁止。如果所有配置的策略都未匹配，则将匹配缺省安全策略default。</p>
</blockquote>
<h2 id="防火墙基本概念：会话表"><a href="#防火墙基本概念：会话表" class="headerlink" title="防火墙基本概念：会话表"></a>防火墙基本概念：会话表</h2><p>•会话表是用来记录TCP、UDP、ICMP等协议连接状态的表项，是防火墙转发报文的重要依据。</p>
<p>•防火墙采用了基于“状态”的报文控制机制：只对首包或者少量报文进行检测就确定一条连接的状态，大量报文直接根据所属连接的状态进行控制。这种状态检测机制迅速提高了防火墙的检测和转发效率。会话表就是为了记录连接的状态而存在的。设备在转发TCP、UDP和ICMP报文时都需要查询会话表，来判断该报文所属的连接并采取相应的处理措施。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/16.png"></p>
<blockquote>
<p>•本例中PC1向PC2发起HTTP连接，所以在防火墙会话表中标示出“http”协议和连接信息，并识别出此流量在公共路由表中被转发（图中VPN:public）。</p>
</blockquote>
<h2 id="会话表的创建和包处理过程"><a href="#会话表的创建和包处理过程" class="headerlink" title="会话表的创建和包处理过程"></a>会话表的创建和包处理过程</h2><p>•防火墙状态检测开启情况下，流量的首包会创建会话表项，后续包即可直接匹配会话表项。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/17.png"></p>
<blockquote>
<p>•本流程只是一个示意图，展示了华为防火墙各个模块的基本处理顺序。实际不同的报文处理并非严格按照此流程图依次进行（若无对应配置），且与具体产品实现相关。</p>
<p>•更多详细信息，可以参考指定型号防火墙产品文档，“报文转发流程”章节。</p>
</blockquote>
<h2 id="会话表的老化时间与长连接"><a href="#会话表的老化时间与长连接" class="headerlink" title="会话表的老化时间与长连接"></a>会话表的老化时间与长连接</h2><p>•防火墙为各种协议设定了会话老化机制。当一条会话在老化时间内没有被任何报文匹配，则会被从会话表中删除。这种机制可以避免防火墙的设备资源被大量无用、陈旧的会话表项消耗。</p>
<p>•但是对于某些特殊业务中，一条会话的两个连续报文可能间隔时间很长。例如：</p>
<ul>
<li><p>用户通过FTP下载大文件，需要间隔很长时间才会在控制通道继续发送控制报文。</p>
</li>
<li><p>用户需要查询数据库服务器上的数据，这些查询操作的时间间隔远大于TCP的会话老化时间。</p>
</li>
</ul>
<p>•此时如果其会话表项被删除，则该业务会中断。长连接（Long Link）机制可以给部分连接设定超长的老化时间，有效解决这个问题。</p>
<h2 id="多通道协议在防火墙上的问题"><a href="#多通道协议在防火墙上的问题" class="headerlink" title="多通道协议在防火墙上的问题"></a>多通道协议在防火墙上的问题</h2><p>•如果在防火墙上配置严格的单向安全策略，那么防火墙将只允许业务单方向发起访问。这会导致一些特殊的协议无法工作，例如FTP。</p>
<p>•FTP主动模式传输文件时，首先需要客户端主动向服务器端发起控制连接，然后需要服务器端向客户端发起数据连接。如果设备上配置的安全策略仅允许客户端报文单方向通过，则FTP文件传输不能成功。</p>
<p>•同FTP，通信过程中需占用两个或两个以上端口的协议被称为多通道协议。多通道协议都需要考虑此类问题。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/18.png"></p>
<blockquote>
<p>•单通道协议：通信过程中只需占用一个端口的协议。如：WWW只需占用80端口。</p>
<p>•多通道协议：通信过程中需占用两个或两个以上端口的协议。</p>
<p>•FTP协议是一个典型的多通道协议，在其工作过程中，FTP Client和FTP Server之间将会建立两条连接：控制连接和数据连接。控制连接用来传输FTP指令和参数，其中就包括建立数据连接所需要的信息。数据连接用来获取服务器目录及传输数据。数据连接使用的端口号是在控制连接中临时协商的。根据数据连接的发起方式FTP协议分为两种工作模式：主动模式（PORT模式）和被动模式（PASV模式）。主动模式中，FTP Server 20号端口主动向FTP Client随机端口发起数据连接；被动模式中，FTP Server被动接收FTP Client发起的数据连接。模式在一般的FTP客户端中都是可以设置的，这里我们以主动模式为例。</p>
<p>•多通道协议存在时，防火墙配置较为宽泛的安全策略也可以解决协议不可用问题，但是存在安全隐患。</p>
</blockquote>
<h2 id="多通道协议-–-FTP过程详解"><a href="#多通道协议-–-FTP过程详解" class="headerlink" title="多通道协议 – FTP过程详解"></a>多通道协议 – FTP过程详解</h2><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/19.png"></p>
<blockquote>
<p>•大部分多媒体应用协议（如H.323、SIP）、FTP、netmeeting等协议使用约定的固定端口来初始化一个控制连接，再动态的协商出端口用于数据传输。端口的选择是不可预测的。其中的某些应用甚至可能要同时用到多个端口。传统的包过滤防火墙可以通过配置ACL过滤规则匹配单通道协议的应用传输，保障内部网络不受攻击，但只能阻止一些使用固定端口的应用，无法匹配使用协商出随机端口传输数据的多通道协议应用，留下了许多安全隐患。</p>
</blockquote>
<h2 id="ASPF与Server-map"><a href="#ASPF与Server-map" class="headerlink" title="ASPF与Server-map"></a>ASPF与Server-map</h2><p>•为了解决多通道协议的问题，防火墙需要识别协议在应用层协商的地址和端口。这需要开启ASPF （Application Specific Packet Filter，针对应用层的包过滤）功能。</p>
<p>•ASPF也称作基于状态的报文过滤，ASPF功能可以自动检测某些报文的应用层信息并根据应用层信息放开相应的访问规则，即生成Server-map表。</p>
<p>•Server-map表也记录了类似会话表中连接的状态。Server-map表中的信息相对简单，是简化的会话表，在真实流量到达前生成。在流量真实到达防火墙时，防火墙会基于Server-map表生成会话表，然后执行转发。</p>
<p>•开启ASPF解决多通道协议问题，是生成Server-map表的一种方式。</p>
<blockquote>
<p>•在防火墙配置了ASPF、NAT Server和No-PAT方式的源NAT时，都会生成相应的Server-map表项。</p>
</blockquote>
<h2 id="ASPF与Server-map示例"><a href="#ASPF与Server-map示例" class="headerlink" title="ASPF与Server-map示例"></a>ASPF与Server-map示例</h2><p>•防火墙上配置了ASPF功能后，会检测FTP控制连接中协商的数据连接端口信息，然后生成Server-map表项。Server-map表项包含了FTP控制通道中协商的数据通道的信息。防火墙为命中Server-map表的数据创建会话表。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/20.png"></p>
<blockquote>
<p>Server-map表与会话表的关系如下：</p>
<p>▫Server-map表记录了应用层数据中的关键信息，报文命中该表后，不再受安全策略的控制；</p>
<p>▫会话表是通信双方连接状态的具体体现；</p>
<p>▫Server-map表不是当前的连接信息，而是防火墙对当前连接分析后得到的即将到来报文的预测；</p>
<p>▫防火墙收到报文先检查是否命中会话表；</p>
<p>▫如果没有命中则检查是否命中Server-map表；</p>
<p>▫命中Server-map表的报文不受安全策略控制；</p>
<p>▫防火墙最后为命中Server-map表的数据创建会话表。</p>
</blockquote>
<h2 id="Server-map表与简化的包转发过程"><a href="#Server-map表与简化的包转发过程" class="headerlink" title="Server-map表与简化的包转发过程"></a>Server-map表与简化的包转发过程</h2><p>•当防火墙接收到一个报文且没有命中会话表时，防火墙进入首包处理流程，查询是否有命中的Server-map表。如果有，则会生成会话表转发报文；如果没有，则执行其他包处理过程。</p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/21.png"></p>
<h2 id="本节小结-1"><a href="#本节小结-1" class="headerlink" title="本节小结"></a>本节小结</h2><p>•本章节主要介绍防火墙的基本概念和基础特性，它们有：</p>
<p>​    ▫安全区域</p>
<p>​    ▫安全策略</p>
<p>​    ▫防火墙的会话表</p>
<p>​    ▫防火墙的Server-map</p>
<h1 id="3-防火墙的基础配置"><a href="#3-防火墙的基础配置" class="headerlink" title="3.防火墙的基础配置"></a>3.防火墙的基础配置</h1><h2 id="防火墙基础配置-接口"><a href="#防火墙基础配置-接口" class="headerlink" title="防火墙基础配置 - 接口"></a>防火墙基础配置 - 接口</h2><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/22.png"></p>
<h2 id="防火墙基础配置-安全区域"><a href="#防火墙基础配置-安全区域" class="headerlink" title="防火墙基础配置 - 安全区域"></a>防火墙基础配置 - 安全区域</h2><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/23.png"></p>
<h2 id="防火墙基础配置-安全策略"><a href="#防火墙基础配置-安全策略" class="headerlink" title="防火墙基础配置 - 安全策略"></a>防火墙基础配置 - 安全策略</h2><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/24.png"></p>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/25.png"></p>
<blockquote>
<p>•安全策略规则视图中指定源、目的IP地址可以有很多的可选参数，例如IP地址组、地区和地区组等，本课程不做过多介绍。更多详细内容请参考产品文档。</p>
</blockquote>
<h2 id="防火墙配置案例"><a href="#防火墙配置案例" class="headerlink" title="防火墙配置案例"></a>防火墙配置案例</h2><p>案例描述：</p>
<p>防火墙将网络隔离为三个安全区域，trust、untrust和OM，其中OM区域优先级为95。现有需求如下：</p>
<ul>
<li><p>允许防火墙接口GE1/0/1响应Ping请求。</p>
</li>
<li><p>允许OM区域ICMP流量访问untrust区域。</p>
</li>
</ul>
<p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/26.png"></p>
<h3 id="配置案例-接口"><a href="#配置案例-接口" class="headerlink" title="配置案例 - 接口"></a>配置案例 - 接口</h3><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/27.png"></p>
<h3 id="配置案例-安全区域"><a href="#配置案例-安全区域" class="headerlink" title="配置案例 - 安全区域"></a>配置案例 - 安全区域</h3><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/28.png"></p>
<h3 id="配置案例-安全策略"><a href="#配置案例-安全策略" class="headerlink" title="配置案例 - 安全策略"></a>配置案例 - 安全策略</h3><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/29.png"></p>
<h3 id="配置案例-结果验证-1"><a href="#配置案例-结果验证-1" class="headerlink" title="配置案例 - 结果验证 (1)"></a>配置案例 - 结果验证 (1)</h3><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/30.png"></p>
<h3 id="配置案例-结果验证-2"><a href="#配置案例-结果验证-2" class="headerlink" title="配置案例 - 结果验证 (2)"></a>配置案例 - 结果验证 (2)</h3><p><img src="/2021/05/17/IP-%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99%E6%8A%80%E6%9C%AF/31.png"></p>
<h2 id="本节小结-2"><a href="#本节小结-2" class="headerlink" title="本节小结"></a>本节小结</h2><p>•本小结主要介绍防火墙的基础配置命令。通过学习你已实现使用命令行：</p>
<p>​    ▫配置防火墙接口</p>
<p>​    ▫划分防火墙安全区域</p>
<p>​    ▫配置安全策略</p>
<p>​    ▫查看防火墙会话信息</p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（单选题）缺省情况下，防火墙有几个安全区域？（  ）</p>
<p>A. 1</p>
<p>B. 2      </p>
<p>C. 3     </p>
<p><strong>D. 4</strong></p>
<p>2.（判断题）防火墙在生产会话表之前，都需要先生成Server-map。 （  ）</p>
<p>A.对</p>
<p><strong>B.错</strong></p>
<p>3.（多选题）以下对于华为AI防火墙说法正确的是？ （  ）</p>
<p><strong>A. 内置恶意文件检测引擎（CDE)</strong></p>
<p><strong>B. 内置探针</strong></p>
<p><strong>C. 内置APT检测引擎（AIE）</strong></p>
<p><strong>D. 内置独创诱捕Sensor</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•防火墙是通信领域极为重要的安全设备之一，本章帮助您初步学习防火墙的基本概念、发展历史和基础配置。</p>
<p>•安全区域、安全策略、会话表和Server-map是防火墙基础的、重要的概念，是进一步学习防火墙技术的必要前提。</p>
<p>•防火墙有更多的安全功能，例如内容安全过滤、反病毒和入侵防御等。更多防火墙技术学习请参考华为安全认证。</p>
<h1 id="更多信息"><a href="#更多信息" class="headerlink" title="更多信息"></a>更多信息</h1><p>•华为HiSecEngine USG6000E系列AI防火墙相关文档。</p>
<p>•<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/security/usg6600e-pid-23176231">https://support.huawei.com/enterprise/zh/security/usg6600e-pid-23176231</a></p>
<p>•更多相关教材和视频请关注<a target="_blank" rel="noopener" href="https://e.huawei.com/cn/talent/#/home">https://e.huawei.com/cn/talent/#/home</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">77</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
