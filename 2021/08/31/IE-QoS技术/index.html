<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="HCRSE-114-QoS技术," />










<meta name="description" content="流分类用来定义一组流量匹配规则，以对报文进行分类。      traffic classifier classifier*-name* [ operator { and | or } ] classifier-name*：*指定流分类名称。 **Operator:**指定流分类下各规则之间的逻辑运算符。如果没有指定operator，则各规则之间缺省为逻辑“或”的关系。 **And">
<meta property="og:type" content="article">
<meta property="og:title" content="IE-QoS技术">
<meta property="og:url" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="流分类用来定义一组流量匹配规则，以对报文进行分类。      traffic classifier classifier*-name* [ operator { and | or } ] classifier-name*：*指定流分类名称。 **Operator:**指定流分类下各规则之间的逻辑运算符。如果没有指定operator，则各规则之间缺省为逻辑“或”的关系。 **And">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/QoS%E6%8A%80%E6%9C%AF.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/76.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/77.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/78.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/79.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/80.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/81.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/82.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/83.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/84.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/85.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/86.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/87.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/88.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/89.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/90.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/91.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/92.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/93.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/94.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/95.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/96.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/97.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/98.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/99.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/0.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/1.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/2.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/3.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/4.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/5.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/6.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/7.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/8.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/9.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/10.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/11.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/12.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/13.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/14.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/15.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/16.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/17.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/18.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/19.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/20.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/21.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/22.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/23.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/24.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/25.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/26.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/27.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/28.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/29.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/30.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/31.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/32.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/33.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/34.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/35.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/36.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/37.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/38.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/39.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/40.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/41.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/42.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/43.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/44.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/45.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/46.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/47.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/48.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/49.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/50.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/51.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/52.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/53.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/54.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/55.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/56.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/57.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/58.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/59.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/60.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/61.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/62.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/63.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/64.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/65.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/66.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/67.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/68.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/69.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/70.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/71.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/72.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/73.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/74.png">
<meta property="og:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/75.png">
<meta property="article:published_time" content="2021-08-31T07:08:57.000Z">
<meta property="article:modified_time" content="2021-09-01T06:37:36.012Z">
<meta property="article:author" content="张思宇">
<meta property="article:tag" content="HCRSE-114-QoS技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/QoS%E6%8A%80%E6%9C%AF.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2021/08/31/IE-QoS技术/"/>





  <title>IE-QoS技术 | zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">IE-QoS技术</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-31T15:08:57+08:00">
                2021-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/QoS%E6%8A%80%E6%9C%AF.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/76.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/77.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/78.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/79.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/80.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/81.png"></p>
<blockquote>
<ul>
<li>流分类用来定义一组流量匹配规则，以对报文进行分类。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/82.png"></p>
<blockquote>
<ul>
<li><strong>traffic classifier</strong> <em>classifier*</em>-name* [ <strong>operator</strong> { <strong>and</strong> | <strong>or</strong> } ]<ul>
<li><strong>classifier-name*</strong>：*指定流分类名称。</li>
<li>**Operator:**指定流分类下各规则之间的逻辑运算符。如果没有指定operator，则各规则之间缺省为逻辑“或”的关系。</li>
<li>**And:**指定流分类下各规则之间是逻辑“与”的关系。</li>
<li>**Or:**指定流分类下各规则之间是逻辑“或”的关系。指定该逻辑关系后，报文只需匹配流分类下的一个或多个规则就属于该类。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/83.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/84.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/85.png"></p>
<blockquote>
<ul>
<li>这是一个基于类的QoS的配置示例。在RTA上执行流分类；在RTB上执行带宽限制、重新标记等策略。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/86.png"></p>
<blockquote>
<ul>
<li>RTA上主要是执行流量分类。根据源地址的不同，分别把流量标记为AF11、AF21和EF。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/87.png"></p>
<blockquote>
<ul>
<li>在RTB上根据数据包的标记执行不同的QoS策略。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/88.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/89.png"></p>
<blockquote>
<ul>
<li>要实现流量的控制，必须有一种机制可以对通过设备的流量进行度量。令牌桶是目前最常采用的一种流量测量方法，用来评估流量速率是否超过了规定值。</li>
<li>当数据流到达设备时首先会根据数据的大小从令牌桶中取出与数据大小相当的令牌数量用来传输数据。也就是说要使数据被传输必须保证令牌桶里有足够多的令牌，如果令牌数量不够，则数据会被丢弃或缓存。这就可以限制报文的流量只能小于等于令牌生成的速度，达到限制流量的目的。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/90.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/91.png"></p>
<blockquote>
<ul>
<li>对于单速率标记算法的实现，华为路由器采用双桶结构。</li>
<li>双桶结构由两个桶实现，为方便将两个令牌桶称为C桶和E桶。C桶容量为CBS，E桶容量为EBS，总容量是CBS+EBS。如果不允许有突发流量，EBS则设置成0。</li>
<li>当EBS≠0时，称为单速双桶。当EBS=0，E桶的令牌数始终为0，相当于只使用了一个令牌桶——C桶，这种情况也称为单速单桶。单速单桶中，报文只标记为绿、红两色。</li>
<li>CIR CBS EBS的单位 :<ul>
<li>CIR（Committed Information Rate）：承诺信息速率，单位是bit/s，表示向令牌桶中投放令牌的速率。</li>
<li>CBS（Committed Burst Size）：承诺突发尺寸，单位为bit，用来定义在部分流量超过CIR之前的最大突发流量，即为令牌桶的容量（深度）。承诺突发尺寸必须大于报文的最大长度（最大时一个分组可以领取桶中的全部令牌）。CBS越大，表示所允许的突发量越大。</li>
<li>EBS（Extended burst size）：超额突发尺寸，用来定义在所有流量超过CIR之前的最大突发量。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/92.png"></p>
<blockquote>
<ul>
<li><p><strong>单速率令牌添加方式</strong></p>
<ul>
<li>单速率标记算法中，初始状态时两桶是满的。先往C桶中添加令牌，等C桶满了，再往E桶中添加令牌（E桶的令牌用做以后临时超过CIR的突发流量），当两桶都被填满时，新产生的令牌将会被丢弃。 </li>
</ul>
</li>
<li><p><strong>单速率流量评估规则</strong></p>
<ul>
<li><p>当报文到来后，直接与桶中的令牌数相比较，如果有足够的令牌就转发（通常用一个令牌关联一个比特的转发权限），如果没有足够的令牌则丢弃或缓存。</p>
</li>
<li><p>为方便用Tc和Te表示桶中的令牌数量，Tc和Te初始化等于CBS和EBS。</p>
</li>
<li><p>色盲模式下，在对到达报文（假设报文大小为B）进行评估时，遵循以下规则：</p>
</li>
<li><p>对于单速单桶：</p>
<ul>
<li>如果报文长度不超过C桶中的令牌数Tc，则报文被标记为绿色，且Tc=Tc-B，</li>
<li>如果报文长度超过C桶中的令牌数Tc，报文被标记为红色，Tc值不变。</li>
</ul>
</li>
<li><p>对于单速双桶：</p>
<ul>
<li>如果报文长度不超过C桶中的令牌数Tc，则报文被标记为绿色，且Tc=Tc-B，</li>
<li>如果报文长度超过C桶中的令牌数Tc但不超过E桶中的令牌数Te，则报文被标记为黄色，且Te=Te-B，</li>
<li>如果报文长度超过E桶中的令牌数Te，报文被标记为红色，但Tc和Te不变。</li>
</ul>
</li>
<li><p>色敏模式下，在对到达报文（假设报文大小为B）进行评估时，遵循以下规则：</p>
</li>
<li><p>对于单速单桶：</p>
<ul>
<li>如果报文已被标记为绿色但报文长度不超过C桶中的令牌数Tc，则报文被标记为绿色，且Tc=Tc-B；</li>
<li>如果报文已被标记为绿色且报文长度超过C桶中的令牌数Tc，则报文被标记为红色，Tc保持不变；</li>
<li>如果报文已被标记为黄色或红色，都直接将报文标记为红色，Tc保持不变。</li>
</ul>
</li>
<li><p>对于单速双桶：</p>
<ul>
<li>如果报文已被标记为绿色且报文长度不超过C桶中的令牌数Tc，则报文被标记为绿色，且Tc=Tc-B，</li>
<li>如果报文已被标记为绿色且报文长度超过C桶中的令牌数Tc但不超过E桶中的令牌数Te，则报文被标记为黄色，且Te=Te-B，</li>
<li>如果报文已被标记为黄色但报文长度不超过E桶中的令牌数Te，则报文被标记为黄色，且Te=Te-B，</li>
<li>如果报文已被标记为黄色且报文长度超过E桶中的令牌数Te，则报文被标记为红色，且Te保持不变，</li>
<li>如果报文已被标记为红色，直接将报文标记为红色，Tc和Te不变。</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/93.png"></p>
<blockquote>
<ul>
<li>CIR（Committed Information Rate）：承诺信息速率，表示端口允许的信息流平均速率，单位是bit/s。</li>
<li>CBS（Committed Burst Size）：承诺突发尺寸，用来定义在部分流量超过CIR之前的最大突发流量，单位为bit。承诺突发尺寸必须不小于报文的最大长度。</li>
<li>PIR（Peak Information Rate）：表示峰值信息速率，表示端口允许的突发流量的最大速率，单位是bit/s。该值必须不小于CIR的设置值。</li>
<li>PBS（Peak Burst Size）：表示峰值突发尺寸，用来定义每次突发所允许的最大的流量尺寸。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/94.png"></p>
<blockquote>
<ul>
<li><p>双速率三色标记算法业界都使用两个令牌桶，但它关注的是速率的突发，所以不像单速率三色标记算法那样把第一个桶中未使用的令牌放到第二个桶中，而是使用两个独立的令牌桶，存在两个令牌填充速率。为方便将两个令牌桶称为C桶和P桶，C桶容量为CBS，令牌填充速率为CIR，P桶容量为PBS，令牌填充速率为PIR。</p>
</li>
<li><p>说明： “双速率”是指该算法中两个令牌桶中的令牌填充速率不同。</p>
</li>
<li><p><strong>双速率令牌添加方式</strong></p>
<ul>
<li>初始状态时两桶是满的。往C桶和P桶分别以CIR和PIR的速率填充令牌。因这两个令牌桶是相互独立的，当其中一个桶被填满时，这个桶新产生的令牌将会被丢弃，另一个桶继续填令牌。</li>
</ul>
</li>
<li><p><strong>双速率流量评估规则</strong></p>
<ul>
<li>双速率三色标记算法关注的是速率的突发，首先评估的是数据流的速率是否符合规定的突发要求，其规则是先比较P桶，再比较C桶。</li>
<li>双速率三色标记算法也有色盲模式和色敏模式两种。为方便用Tc和Tp表示桶中的令牌数量，Tc和Tp初始化等于CBS和PBS。</li>
<li>色盲模式下，在对到达报文（假设数据包大小为B）进行评估时，遵循以下规则：<ul>
<li>如果报文长度超过P桶中的令牌数Tp，则报文被标记为红色，且Tc和Tp保持不变，</li>
<li>如果报文长度不超过P桶中的令牌数Tp但超过C桶中的令牌数Tc，则报文被标记为黄色，且Tp=Tp-B，</li>
<li>如果报文长度不超过C桶中的令牌数Tc，报文被标记为绿色，且Tp=Tp-B，Tc=Tc-B。</li>
</ul>
</li>
<li>色敏模式下，在对到达报文（假设报文大小为B）进行评估时，遵循以下规则：<ul>
<li>如果报文已被标记为绿色且报文长度超过P桶中的令牌数Tp，则报文被标记为红色，且Tp和Tc不变。</li>
<li>如果报文已被标记为绿色且报文长度不超过P桶中的令牌数Tp但超过C桶中的令牌数Tc，则报文被标记为黄色，且Tp=Tp-B，Tc不变</li>
<li>如果报文已被标记为绿色且报文长度不超过C桶中的令牌数Tc，则报文被标记为绿色，且Tp=Tp-B，Tc=Tc-B。</li>
<li>如果报文已被标记为黄色，则只比较P桶，如果报文长度超过P桶中的令牌数Tp，则报文被标记为红色，且Tp和Tc不变。</li>
<li>如果报文已被标记为黄色，且报文长度不超过P桶的令牌数，则报文被标记为黄色，且Tp=Tp-B，Tc不变。</li>
<li>如果报文已被标记为红色，直接将报文标记为红色，Tc和Tp不变。</li>
</ul>
</li>
</ul>
</li>
<li><p>CIR PIR CBS PBS的单位 :</p>
<ul>
<li><strong>cir</strong> <em>cir-value</em> 指定承诺信息速率，即保证能够通过的速率。 整数形式，取值范围是0～4294967295，单位是kbit/s。</li>
<li><strong>pir</strong> <em>pir-value</em> 指定峰值速率，即最大能够通过的速率。 整数形式，取值范围是0～4294967295，单位是kbit/s。参数<em>pir*</em>-value<em>的值不应小于已经配置的</em>cir-value*的值。</li>
<li><strong>cbs</strong> <em>cbs-value</em> 指定承诺突发尺寸（Committed Burst Size），即瞬间能够通过的承诺流量，即第一个令牌桶的深度（假定该桶为C桶）。 整数形式，0～4294967295，单位是byte。 CBS的取值必须大于已经配置的CIR的值。缺省值与配置的<em>cir-value</em>有关。</li>
<li><strong>pbs</strong> <em>pbs-value</em> 指定超出突发尺寸（Peak Burst Size），即瞬间能够通过的峰值流量，即第二个令牌桶的深度（假定该桶为P桶）。 整数形式，0～4294967295单位是byte。 缺省值与<em>pir*</em>-value*有关</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/95.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/96.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/97.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/98.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/99.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/0.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/1.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/2.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/3.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/4.png"></p>
<blockquote>
<ul>
<li><p>传统的IP网络无区别地对待所有的报文，网络设备处理报文采用的策略是先入先出FIFO（First In First Out），它依照报文到达时间的先后顺序分配转发所需要的资源。所有报文共享网络和设备的带宽等资源，然而最终得到资源的多少完全取决于报文到达的时机。</p>
</li>
<li><p>FIFO尽最大的努力将报文送到目的地，但对报文的延迟、抖动、丢包率和可靠性等需求不提供任何承诺和保证，故对于一些关键业务（如语音、视频等）的通信质量无法进行保证。</p>
</li>
<li><p>那该如何提升端到端的通信质量呢？影响通信质量的因素都有哪些？</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/5.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/6.png"></p>
<blockquote>
<ul>
<li>我们已经知道影响端到端通信质量的因素，所以从这些因素入手就可以达到我们的目的。那这些因素各自都有什么特点呢？他们影响通信质量的具体表现是什么呢？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/7.png"></p>
<blockquote>
<ul>
<li><p>网络带宽是指在单位时间（一般指的是1秒钟）内能传输的数据量。</p>
</li>
<li><p>如图所示，尽管传输途径上的最大的一段链路带宽是1Gbps，但是数据从一个用户传到另一个用户的最大传输速率只能是256kbps，因为传输的最大带宽是由传输路径上的最小链路带宽决定的。正是因为这样，带宽小的链路是影响传输速率的关键。</p>
</li>
<li><p>如果网络上存在多个数据流，它们互相竞争带宽，可以通过增大带宽来获得更好的网络体验，但是提升了带宽之后又会催生新的应用，故不能无限地增加网络带宽，且增加带宽还需要提高成本，那么我们是否可以先保证重要业务的带宽呢？</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/8.png"></p>
<blockquote>
<ul>
<li><p>时延是指一个报文从一个网络的一端传送到另一端所需要的时间。</p>
</li>
<li><p>实时应用通信质量都比较关注时延大小，如语音、视频等。以语音传输为例，时延是指从说话者开始说话到对方听到所说内容的时间。若时延太大，会引起通话声音不清晰、不连贯或破碎。</p>
</li>
<li><p>单个网络设备的时延包括传输时延、串行化时延、处理时延、以及队列时延。</p>
<ul>
<li>传输时延：一个数据位从发送方到达接收方所需要的时间。该时延取决于传输距离和传输介质，与带宽无关。</li>
<li>串行化时延：指发送节点在传输链路上开始发送报文的第一个比特至发完该报文的最后一个比特所需的时间。该时延取决于链路带宽以及报文大小。</li>
<li>处理时延：指路由器把报文从入接口放到出接口队列需要的时间。它的大小跟路由器的处理性能有关。</li>
<li>队列时延：指报文在队列中等待的时间。它的大小跟队列中报文的大小和数量、带宽以及队列机制有关。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/9.png"></p>
<blockquote>
<ul>
<li>由于每个报文的端到端时延不一样，就会导致这些报文不能等间隔到达目的端，这种现象叫做抖动。一般来说，时延越小则时延抖动的范围越小。</li>
<li>某些业务类型（特别是语音和视频等实时业务）是极其不能容忍抖动的。报文到达时间的差异将在语音或视频中造成断续；另外，抖动也会影响一些网络协议的处理，有些协议是按固定的时间间隔发送交互性报文，抖动过大就会导致协议震荡，而实际上所有传输系统都有抖动，但只要抖动在规定容差之内就不会影响服务质量，另外，可利用缓存来克服过量的抖动，但这将会增加时延。</li>
<li>抖动的大小跟时延的大小直接相关，时延小则抖动的范围也小，时延大则可能抖动的范围也大。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/10.png"></p>
<blockquote>
<ul>
<li><p>丢包率是指在网络传输过程中丢失报文占传输报文的百分比。丢包可用于衡量网络的可靠性。</p>
</li>
<li><p>丢包（packet loss）可能在所有环节中发生，例如：</p>
<ul>
<li>处理过程：路由器在收到报文的时候可能由于CPU繁忙，无法处理报文而导致丢包；</li>
<li>排队过程：在把报文调度到队列的时候可能由于队列被装满而导致丢包；</li>
<li>传输过程：报文在链路上传输的过程中，可能由于种种原因（如链路故障等）导致的丢包。</li>
</ul>
</li>
<li><p>少量的丢包对业务的影响并不大，例如，在语音传输中，丢失一个比特或一个报文的信息，通话双方往往注意不到；在视频广播期间，丢失一个比特或一个报文可能造成屏幕上瞬间的波形干扰，但视频很快就会恢复正常。即使使用传输控制协议（TCP）传送数据也能处理少量的丢包，但大量的丢包就会严重影响到传输效率。</p>
</li>
<li><p>了解完这些影响通信质量因素的特点之后，请思考在进行实际网络部署时，具体该采用什么方法来提升通信质量呢？</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/11.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/12.png"></p>
<blockquote>
<ul>
<li><p>传统的先进先出转发即Best-Effort（尽力而为）服务模型：</p>
<ul>
<li>Best-Effort是一个单一的服务模型，也是最简单的服务模型。应用程序可以在任何时候，发出任意数量的报文，而且不需要事先获得批准，也不需要通知网络。</li>
<li>应用Best-Effort服务模型的网络尽最大的可能性来发送报文，但对时延、可靠性等性能不提供任何保证，但它适用于绝大多数网络应用，如FTP、E-Mail等。</li>
<li>Best-Effort服务是现在Internet的缺省服务模型，它是通过先入先出（FIFO）队列来实现的。</li>
</ul>
</li>
<li><p>在尽力而为的服务模型下，可通过增大网络带宽和升级网络设备来提高端到端通信质量：</p>
<ul>
<li>增大网络带宽：可以增大单位时间内传输的数据量，使其按照传统先进先出的方式在单位时间内传输更多的数据，改善网络拥塞问题。</li>
<li>升级网络设备：可以增大数据处理能力，使其按照传统先进先出的方式在单位时间内能够处理更多的数据，改善网络拥塞问题。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/13.png"></p>
<blockquote>
<ul>
<li>RSVP协议工作过程：在应用程序发送报文前，需要向网络申请特定的带宽和所需的特定服务质量的请求，等收到确认信息后才发送报文。</li>
<li>综合服务模型（Integrated Services Model）：<ul>
<li>IntServ是一种最为复杂的服务模型，它需要用到RSVP（Resource Reservation Protocol）协议。该服务模型在发送报文前，需要向网络申请特定的服务。这个请求是通过信令（signal）来完成的，应用程序首先通知网络它自己的流量参数和所需的特定服务质量的请求，包括带宽、时延等。应用程序一般在收到网络的确认信息后，即认为网络已经为这个应用程序的报文发送预留了资源，然后立即发送报文。</li>
<li>IntServ模型要求端到端网络的所有节点都支持RSVP协议，且每个节点都需要周期性地同相邻节点交换状态信息，这样就会加大协议报文导致的开销。更关键的是，所有网络节点都需要为每个数据流保存状态信息，而当前在Internet骨干网上有着成千上万条数据流，因此IntServ模型在Internet骨干网上无法得到广泛应用。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/14.png"></p>
<blockquote>
<ul>
<li>DiffServ区分服务工作过程：首先将网络中的流量分成多个类，然后为每个类定义相应的处理行为，使其拥有不同的优先转发、丢包率、时延等。</li>
<li>Diffserv服务模型概述：<ul>
<li>业务流分类和标记由边缘路由器来完成。边界路由器可以通过多种条件（比如报文的源地址和目的地址、ToS域中的优先级、协议类型等）灵活地对报文进行分类，然后对不同类型的报文设置不同的标记字段，而其他路由器只需要简单地识别报文中的这些标记，然后对其进行相应的资源分配和流量控制即可。因此，DiffServ是一种基于报文流的QoS模型。</li>
<li>它只包含有限数量的服务等级，少量的状态信息来提供有差别的流量控制和转发。</li>
<li>DS节点：实现DiffServ功能的网络节点称为DS节点。</li>
<li>DS边界节点：负责连接另一个DS域或者连接一个没有DS功能的域的节点。DS边界节点负责将进入此DS域的业务流进行分类和流量调整。</li>
<li>DS内部节点：用于在同一个DS域中连接DS边界节点和其他内部节点。DS内部节点仅需基于报文中的EXP、802.1p、IPP等字段值进行简单的流分类以及对相应的流进行流量控制。</li>
<li>DS域（DS Domain）：一组采用相同的服务提供策略和实现了相同PHB（Per Hop Behaviors）的相连DS节点组成。一个DS域由相同管理部门的一个或多个网络组成，如一个DS域可以是一个ISP，也可以是一个企业的内部网络。</li>
<li>DiffServ模型充分考虑了IP网络本身所具有的灵活性、可扩展性强等特点，将复杂的服务质量保证通过报文自身携带的信息转换为单跳行为，从而大大减少了信令的工作。该模型是目前应用最广的服务模型。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/15.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/16.png"></p>
<blockquote>
<p>1、答案：ABC。</p>
<p>2、答案：带宽、时延、抖动、丢包率。</p>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/17.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/18.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/19.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/20.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/21.png"></p>
<blockquote>
<ul>
<li>报文分类的依据都有哪些呢？先前我们学过利用ACL可以匹配五元组来进行分类，那QoS都支持哪些分类方式呢？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/22.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/23.png"></p>
<blockquote>
<ul>
<li>根据IEEE 802.1Q定义，VLAN TAG中的PRI字段用于标识QoS服务等级。</li>
<li>对于MPLS报文，通常将标签信息中的EXP域作为MPLS报文的CoS域，与IP网络的ToS域等效，用来区分数据流量的服务等级。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/24.png"></p>
<blockquote>
<ul>
<li><p>D bit代表延迟（Delay），T bit代表吞吐量（Throughput），R bit代表可靠性（Reliability）。</p>
</li>
<li><p>根据RFC791定义，IP报文头ToS（Type of Service）域中的Precedence字段标识了该报文的优先级。</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/25.png"></p>
<blockquote>
<ul>
<li>在RFC2474中对IPv4报文头的ToS字段进行了重新定义，称为DS（Differentiated Services）字段。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/26.png"></p>
<blockquote>
<ul>
<li>AFxy中，x代表不同的类别，根据不同的分类后续可以定义进入相对应的队列，y代表当队列被装满的时候丢包的概率，例如AF1类中的报文，其中丢包概率由小到大排序为AF11&lt;AF12&lt;AF13。</li>
<li>不同关键字常用于标识不同报文（可自行定义）：<ul>
<li>CS6和CS7默认用于协议报文，而且是大多数厂商设备的硬件队列里最高优先级的报文，因为如果这些报文无法接收的话会引起协议中断。</li>
<li>EF常用于承载语音的流量，因为语音要求低延迟，低抖动，低丢包率，是仅次于协议报文的最重要的报文。</li>
<li>AF4用来承载语音的信令流量，这里大家可能会有疑问为什么这里语音要优先于信令呢？ 其实是这样的，这里的信令是电话的呼叫控制，你是可以忍受在接通的时候等待几秒钟的，但是绝对不能允许在通话的时候的中断。所以语音要优先于信令。</li>
<li>AF3可以用来承载IPTV的直播流量，直播的实时性很强，需要连续性和大吞吐量的保证。</li>
<li>AF2可以用来承载VOD（Video on Demand：视频点播）的流量，相对于直播流量来说，VOD对实时性要求没那么强烈，允许有时延或者缓冲。</li>
<li>AF1可以用来承载普通上网业务。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/27.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/28.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/29.png"></p>
<blockquote>
<ul>
<li>复杂流分类：<ul>
<li>复杂流分类是指根据五元组（源地址、目的地址、源端口号、目的端口号、协议号码）等报文信息对报文进行精细的分类（一般的分类依据都局限在封装报文的头部信息，使用报文内容作为分类的标准比较少见）。</li>
<li>缺省应用于网络的边缘位置。报文进入边缘节点时，网络管理者可以灵活配置分类规则。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/30.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/31.png"></p>
<blockquote>
<ul>
<li>一般在DS边界节点对报文进行分类（如图SWA、SWB）。</li>
<li>下游（downstream）设备可以选择接收上游（upstream）设备的分类结果，也可以按照自己的分类标准对报文进行重新分类。</li>
<li>端到端进行QoS部署时，如果需要每台设备都对报文进行分类，那么就会导致耗费大量地设备处理资源，为此提出了对报文进行标记的方法，这样下游设备只需要对标记进行识别即可提供差分服务。那标记是如何实现的呢？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/32.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/33.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/34.png"></p>
<blockquote>
<ul>
<li>一般在DS边界节点（如图SWA、SWB）对报文进行标记，DS节点对标记进行识别并提供差分服务即可。</li>
<li>像语音电话、视频终端等设备一般发送的报文都是携带设备默认标识的优先级值。若想通过自定义的值来提供差分服务，可以通过remark操作对报文进行重新标记。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/35.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/36.png"></p>
<blockquote>
<ul>
<li>在DS边界节点SWA上对报文重新进行remark，为DS域提供一个可信任的标记值。DS域内节点可根据此标记值进行QoS调度服务。</li>
<li>在此例中，边界节点SWA被称为可信任边界。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/37.png"></p>
<blockquote>
<p>1、答案：简单流分类和复杂流分类。</p>
<p>2、答案：端到端进行QoS部署时，就需要每台设备都对报文进行分类，这样就会导致耗费大量地设备处理资源，为此提出了对报文进行标记的方法，这样下游设备只需要对标记进行识别即可提供差分服务。</p>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/38.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/39.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/40.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/41.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/42.png"></p>
<blockquote>
<ul>
<li><p>拥塞发生的主要场景：</p>
<ul>
<li>速率不匹配：报文从高速链路进入设备，再由低速链路转发出去。</li>
<li>汇聚问题：报文从多个接口同时进入设备，由一个没有足够带宽的接口转发出去。</li>
</ul>
</li>
<li><p>拥塞可能会引发一系列的负面影响：</p>
<ul>
<li>增加了报文传输的时延和抖动。</li>
<li>过高的延迟会引起报文重传。</li>
<li>使网络的有效吞吐率降低，造成网络资源的损害。</li>
<li>加剧耗费大量的网络资源（特别是存储资源），不合理的资源分配甚至可能导致系统陷入资源死锁而崩溃。</li>
</ul>
</li>
</ul>
<p>由此可见，拥塞使流量不能及时获得资源，是造成服务性能下降的源头。然而在报文交换以及多用户业务并存的复杂环境下，拥塞又是常见的。因此采取有效的避免拥塞以及防止拥塞加剧的方法是必需的，那具体实现的方法是怎样的呢？</p>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/43.png"></p>
<blockquote>
<ul>
<li>LP（本地优先级，又称为内部优先级）：优先级映射实现从数据原始携带的QoS优先级到内部优先级或从内部优先级到QoS优先级的映射。<ul>
<li>对于进入设备的报文，设备将报文携带的优先级或者端口优先级映射为内部优先级，然后根据内部优先级与队列之间的映射关系确定报文进入的队列。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/44.png"></p>
<blockquote>
<ul>
<li>具体差分服务是如何通过队列调度来体现的呢？每种队列调度算法又是如何工作的？各自都有什么优缺点？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/45.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/46.png"></p>
<blockquote>
<ul>
<li>FIFO队列不对报文进行分类，当报文进入接口的速度大于出接口能发送的速度时，FIFO按报文到达接口的先后顺序让报文进入队列，同时，FIFO在队列的出口让报文按进队的顺序出队，先进的报文将先出队，后进的报文将后出队。</li>
<li>FIFO队列具有处理简单，开销小的优点。但FIFO不区分报文类型，采用尽力而为的服务模型，使得对时延敏感的实时应用的延迟得不到保证，关键业务的带宽也不能得到保证。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/47.png"></p>
<blockquote>
<ul>
<li>PQ队列是针对关键业务应用设计的，且关键业务有一个重要特点，就是需要在拥塞发生时要求优先获得服务以减少响应的延迟。</li>
<li>PQ调度机制：分为4个队列，分别为高优先队列、中优先队列、正常优先队列和低优先队列，它们的优先级依次降低。在报文出队的时候，PQ会首先让高优先队列中的报文出队并发送，直到高优先队列中的报文发送完，然后发送中优先队列中的报文，同样，直到发送完，然后是正常优先队列和低优先队列。如此的话，将关键业务的报文放入较高优先级的队列，将非关键业务（如E-Mail）的报文放入较低优先级的队列，可以保证关键业务的报文被优先传送，非关键业务的报文在处理关键业务数据的空闲间隙被传送。</li>
<li>如果高优先级队列中持续有报文等待被发送，那么后面较低优先级队列中的报文就迟迟不能得到发送，出现“饿死”现象。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/48.png"></p>
<blockquote>
<ul>
<li>WRR（Weight Round Robin）加权循环调度在RR（Round Robin）调度的基础上演变而来，根据每个队列的权重来轮流调度各队列中的报文流。实际上，RR调度相当于权值为1的WRR调度。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/49.png"></p>
<blockquote>
<ul>
<li>WFQ对报文按流特征进行分类，对于IP网络，相同源IP地址、目的IP地址、源端口号、目的端口号、协议号、ToS的报文属于同一个流，而对于MPLS网络，具有相同的标签和EXP域值的报文属于同一个流。每一个流被分配到一个队列，该过程称为散列，采用HASH算法来自动完成，这种方式会尽量将不同特征的流分入不同的队列中。WFQ允许的队列数目是有限的，用户可以根据需要配置该值。 </li>
<li>在出队的时候，WFQ按流的优先级来分配每个流应占有的出口带宽。优先级的数值越小，所得的带宽越少。优先级的数值越大，所得的带宽越多。这样就保证了相同优先级业务之间的公平，体现了不同优先级业务之间的权值。</li>
<li>WFQ优点在于配置简单，但由于流是自动分类，无法手工干预，故缺乏一定的灵活性；且受资源限制，当多个流进入同一个队列时无法提供精确服务，无法保证每个流获得的实际资源量。WFQ均衡各个流的延迟与抖动，同样也不适合延迟敏感的业务应用。 </li>
<li>通过以上分析，会发现如果所有队列都应用一种调度算法都存在各自的优缺点，且不能很好地满足业务需求，但通过分析会发现有些调度算法之间的优缺点正好是互补的，试想：是否可以设置不同的队列应用不同的调度算法，这样是否就能很大程度满足业务需求呢？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/50.png"></p>
<blockquote>
<ul>
<li><p>PQ+WFQ调度过程：</p>
<ul>
<li>如图，在进行调度时，首先按照PQ方式优先调度Queue7、Queue6和Queue5队列中的报文流，只有这些队列中的报文流全部调度完毕后，才开始以WFQ方式调度Queue4、Queue3、Queue2、Queue1和Queue0队列中的报文流。其中，Queue4、Queue3、Queue2、Queue1和Queue0队列包含自己的权值。</li>
<li>重要的协议报文以及有低时延需求的业务报文应放入PQ调度队列中，得到优先调度的机会，其他报文则可放入以WFQ方式调度的各队列中。</li>
</ul>
</li>
<li><p>PQ+WFQ优缺点：</p>
<ul>
<li>其集合了PQ调度和WFQ调度各自的优缺点。单纯采用PQ调度时，低优先级队列中的报文流可能会长期得不到带宽，而单纯采用WFQ调度时，低延时需求业务可能得不到及时调度，而如果将两种调度方式结合起来形成PQ+WFQ调度方式，其不仅能发挥两种调度的优势，而且能互补一些各自特有的缺点。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/51.png"></p>
<blockquote>
<ul>
<li>CBQ（Class-based Queueing）基于类的加权公平队列是对WFQ功能的扩展，为用户提供了自定义类的支持。CBQ首先根据IP优先级或者DSCP优先级、入接口、IP报文的五元组等规则来对报文进行分类，然后让不同类别的报文进入不同的队列。对于不匹配任何类别的报文，会送入系统定义的缺省类。</li>
<li>CBQ提供三类队列：<ul>
<li>EF队列：满足低时延业务。<ul>
<li>EF队列拥有绝对优先级，仅当EF队列中的报文调度完毕后，才会调度其他队列中的报文。 </li>
</ul>
</li>
<li>AF队列：满足需要带宽保证的关键数据业务。<ul>
<li>每个AF队列分别对应一类报文，用户可以设定每类报文占用的带宽。当系统调度报文出队的时候，会按用户为各类报文设定的带宽将报文进行出队发送，可实现各个类的队列的公平调度。</li>
</ul>
</li>
<li>BE队列：满足不需要严格QoS保证的尽力发送业务。<ul>
<li>当报文不匹配用户设定的所有类别时，报文会被送入系统定义的缺省BE（Best Effort，尽力传送）类。BE队列使用接口剩余带宽和WFQ调度方式进行发送。</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/52.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/53.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/54.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/55.png"></p>
<blockquote>
<ul>
<li>此页配置参数与前文标题为“拥塞管理实现的第一步”的一页内容相对应。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/56.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/57.png"></p>
<blockquote>
<ul>
<li>思考：尾丢弃这种方式有什么利弊？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/58.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/59.png"></p>
<blockquote>
<ul>
<li>TCP全局同步：对于TCP报文，如果大量的报文被丢弃，将造成TCP超时，从而引发TCP慢启动，使得TCP减少报文的发送。当队列同时丢弃多个TCP连接的报文时，将造成多个TCP连接同时进入拥塞避免和慢启动状态以调整并降低流量，这就被称为TCP全局同步现象。这样多个TCP连接发往队列的报文将同时减少，而后又会在某个时间同时出现流量高峰，如此反复，使网络资源利用率低。</li>
<li>思考：该如何来避免TCP全局同步现象？问题的核心是什么？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/60.png"></p>
<blockquote>
<ul>
<li><p>为避免TCP全局同步现象，出现了RED（Random Early Detection）技术。RED通过随机地丢弃数据报文，让多个TCP连接不同时降低发送速度，从而避免了TCP的全局同步现象。使TCP速率及网络流量都趋于稳定。</p>
</li>
<li><p>RED为每个队列的长度都设定了阈值门限，并规定： </p>
<ul>
<li>当队列的长度小于低门限时，不丢弃报文。 </li>
<li>当队列的长度大于高门限时，丢弃所有收到的报文。 </li>
<li>当队列的长度在低门限和高门限之间时，开始随机丢弃到来的报文。方法是为每个到来的报文赋予一个随机数，并用该随机数与当前队列的丢弃概率比较，如果大于丢弃概率则报文被丢弃。队列越长，报文被丢弃的概率越高。</li>
</ul>
</li>
<li><p>思考：尾丢弃对于丢弃TCP报文造成全局同步现象，还会对其造成其他的影响么？</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/61.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/62.png"></p>
<blockquote>
<ul>
<li>RED技术是否可以解决尾丢弃的缺点二和三？为什么？</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/63.png"></p>
<blockquote>
<ul>
<li>基于RED技术，又实现了WRED（Weighted Random Early Detection）技术，可实现每一种优先级都能独立设置报文的丢包的高门限、低门限及丢包率，报文到达低门限时，开始丢包，到达高门限时丢弃所有的报文，随着门限的增高，丢包率不断增加，最高丢包率不超过设置的最大丢包率，直至到达高门限，报文全部丢弃。这样按照一定的丢弃概率主动丢弃队列中的报文，从一定程度上避免了尾丢弃带来的所有缺点。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/64.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/65.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/66.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/67.png"></p>
<blockquote>
<p>1、答案：拥塞管理机制的实现过程分为：</p>
<ul>
<li>第一步：将准备从一个接口发出的所有报文放入不同的队列中；</li>
<li>第二步：根据各队列间的调度机制实现不同报文的差分转发。</li>
</ul>
<p>2、答案：FIFO、PQ、WFQ、PQ+WFQ、CBQ等。</p>
<p>3、答案：A。</p>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/68.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/69.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/70.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/71.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/72.png"></p>
<blockquote>
<ul>
<li>流量监管功能可对接收或发送的流量进行限速控制，限制进入网络的突发流量，为网络提供了基本的QoS功能。</li>
<li>流量监管TP（Traffic Policing）的典型应用是监督进入网络的某一流量的规格，把它限制在一个合理的范围之内，并对超出部分的流量进行“惩罚”，以保护网络资源和运营商的利益。</li>
<li>流量监管通常使用承诺访问速率CAR（Committed Access Rate）来限制某类报文的流量。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/73.png"></p>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/74.png"></p>
<blockquote>
<ul>
<li>流量整形TS（Traffic Shaping）的典型作用是限制流出某一网络的某一连接的正常流量与突发流量，使这类报文以比较均匀的速度向外发送，是一种主动调整流量输出速率的措施，故只能对输出的流量进行速率控制。常用GTS（Generic Traffic Shaping）技术来限制某类流量。</li>
<li>应用场景：当网络中上下游的接口带宽不匹配，尤其是上游接口的带宽资源大于下游的带宽资源时，容易在下游网络形成拥塞。如果不希望下游网络因为上游发送数据流量过大造成拥塞，可在上游的出接口配置流量整形，使上游发送的流量与下游接收的能力相匹配。报文可以均匀向外发送，而且部分超出规格的报文不直接丢弃，而是进行缓存，等待链路空闲的时候再发送出去。</li>
</ul>
</blockquote>
<p><img src="/2021/08/31/IE-QoS%E6%8A%80%E6%9C%AF/75.png"></p>
<blockquote>
<p>1、答案：在进行报文流量控制时，流量监管是对超过流量限制的报文进行丢弃；而流量整形则将超过流量限制的报文缓存在队列中，等待链路空闲的时候再发送。</p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/HCRSE-114-QoS%E6%8A%80%E6%9C%AF/" rel="tag"># HCRSE-114-QoS技术</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/08/23/IE-MPLS-BGP-VPN%E8%B7%A8%E5%9F%9F/" rel="next" title="IE-MPLS-BGP-VPN跨域">
                <i class="fa fa-chevron-left"></i> IE-MPLS-BGP-VPN跨域
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">77</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
