<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="IP-9-BGP路由优选," />










<meta name="description" content="前言•BGP是一个应用非常广泛的边界网关路由协议，在全球范围内被大量部署。BGP定义了多种路径属性，并且拥有丰富的路由策略工具，这使得BGP在路由操控和路径决策上变得非常灵活。 •针对BGP路由的各种属性的操作都可能影响路由的优选，从而对网络的流量产生影响，因此掌握BGP路由的优选规则十分重要。 目标▫描述BGP路由优选规则 ▫实现BGP路由控制 BGP路由优选BGP路由优选规则当到达同一个目的网">
<meta property="og:type" content="article">
<meta property="og:title" content="BGP路由优选">
<meta property="og:url" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="前言•BGP是一个应用非常广泛的边界网关路由协议，在全球范围内被大量部署。BGP定义了多种路径属性，并且拥有丰富的路由策略工具，这使得BGP在路由操控和路径决策上变得非常灵活。 •针对BGP路由的各种属性的操作都可能影响路由的优选，从而对网络的流量产生影响，因此掌握BGP路由的优选规则十分重要。 目标▫描述BGP路由优选规则 ▫实现BGP路由控制 BGP路由优选BGP路由优选规则当到达同一个目的网">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/2.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/3.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/4.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/5.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/6.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/7.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/8.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/9.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/10.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/11.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/12.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/13.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/14.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/15.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/16.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/17.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/18.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/19.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/20.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/21.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/22.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/23.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/24.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/25.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/26.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/27.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/28.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/29.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/30.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/31.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/32.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/33.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/34.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/35.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/36.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/37.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/38.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/39.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/40.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/41.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/42.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/43.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/44.png">
<meta property="og:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/45.png">
<meta property="article:published_time" content="2021-05-10T09:56:08.000Z">
<meta property="article:modified_time" content="2021-05-17T06:01:23.144Z">
<meta property="article:author" content="张思宇">
<meta property="article:tag" content="IP-9-BGP路由优选">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/2.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2021/05/10/BGP路由优选/"/>





  <title>BGP路由优选 | zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">BGP路由优选</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-10T17:56:08+08:00">
                2021-05-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>•BGP是一个应用非常广泛的边界网关路由协议，在全球范围内被大量部署。BGP定义了多种路径属性，并且拥有丰富的路由策略工具，这使得BGP在路由操控和路径决策上变得非常灵活。</p>
<p>•针对BGP路由的各种属性的操作都可能影响路由的优选，从而对网络的流量产生影响，因此掌握BGP路由的优选规则十分重要。</p>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>▫描述BGP路由优选规则</p>
<p>▫实现BGP路由控制</p>
<h1 id="BGP路由优选"><a href="#BGP路由优选" class="headerlink" title="BGP路由优选"></a>BGP路由优选</h1><h2 id="BGP路由优选规则"><a href="#BGP路由优选规则" class="headerlink" title="BGP路由优选规则"></a>BGP路由优选规则</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p><strong>丢弃下一跳不可达的路由。</strong></p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<blockquote>
<p><strong>↑</strong>  <strong>取值越大越优</strong></p>
</blockquote>
<hr>
<blockquote>
<p><strong>↓</strong>  <strong>取值越小越优</strong></p>
</blockquote>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<blockquote>
<p>当前8条属性全部相同时可以形成路由负载分担</p>
<p>•上述规则依序排列，BGP进行路由优选时，从第一条规则开始执行，如果根据第一条规则无法作出判断，例如路由的Preferred-Value属性值相同，则继续执行下一条规则，如果根据当前的规则，BGP能够决策出最优的路由，则不再继续往下执行。</p>
<p>•本文选取了BGP路由优选规则中最为关键的12条，接下来将逐一讲解并验证上述规则。</p>
<p>•在后续的内容中可能会提到诸如“第8条选路规则”之类的术语，则对应本页所罗列的第8条选路规则。</p>
<p>•AIGP（Accumulated Interior Gateway Protocol，累加IGP度量值）用于传递并累加IGP metric值，该属性值并不常用，在BGP路由优选规则中并不涉及。</p>
</blockquote>
<hr>
<h2 id="拓扑说明-1"><a href="#拓扑说明-1" class="headerlink" title="拓扑说明 (1)"></a>拓扑说明 (1)</h2><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/2.png"></p>
<p>•AS、设备互联地址如图所示，所有设备均创建Loopback0接口，IP地址为10.0.x.x（x为设备编号），所有设备使用环回口地址作为Router ID。</p>
<p>•AS200内运行OSPF，在内部互联接口（不包含连接外部AS的接口）、Loopback接口上激活OSPF。</p>
<h2 id="拓扑说明-2"><a href="#拓扑说明-2" class="headerlink" title="拓扑说明 (2)"></a>拓扑说明 (2)</h2><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/3.png"></p>
<p>•AS内部基于Loopback0接口建立IBGP对等体关系，AS之间基于直连接口建立EBGP对等体关系。</p>
<p>•R4、R5上存在相同的网段：10.0.45.0/24，通过import-route命令将该网段的直连路由注入到BGP，用于验证BGP路由优选规则。</p>
<h2 id="BGP路由优选规则-1"><a href="#BGP路由优选规则-1" class="headerlink" title="BGP路由优选规则"></a>BGP路由优选规则</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   <strong>丢弃下一跳不可达的路由。</strong></p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h2 id="丢弃下一跳不可达的路由-1"><a href="#丢弃下一跳不可达的路由-1" class="headerlink" title="丢弃下一跳不可达的路由 (1)"></a>丢弃下一跳不可达的路由 (1)</h2><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/4.png"></p>
<p>•R4、R5将BGP路由10.0.45.0/24通告给AS200时Next_Hop属性值为10.0.24.4、10.0.34.5。</p>
<p>•R2、R3将路由通告给R1时不修改Next_Hop属性值，R1学习到的两条BGP路由10.0.45.0/24下一跳为10.0.24.4、10.0.34.5。</p>
<p>•R1进行BGP路由下一跳迭代查询时，由于R2、R3未在连接外部AS的接口上激活OSPF，导致路由迭代失败，R1上的BGP路由10.0.45.0/24下一跳不可达。</p>
<p>•在R1上通过<strong>display bgp routing</strong>查看BGP路由表，此时BGP路由10.0.45.0/24为非有效路由条目。</p>
<h2 id="丢弃下一跳不可达的路由-2"><a href="#丢弃下一跳不可达的路由-2" class="headerlink" title="丢弃下一跳不可达的路由 (2)"></a>丢弃下一跳不可达的路由 (2)</h2><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/5.png"></p>
<p>在R2、R3上通过<strong>next-hop-local</strong>命令修改Next_Hop属性值为本地更新源地址。</p>
<p>R2、R3向R1通告BGP路由时Next_Hop属性值将会变为：10.0.2.2、10.0.3.3。</p>
<p>这两个下一跳地址在R1上能够成功进行路由迭代，BGP路由的下一跳地址将会变成可达。</p>
<h2 id="丢弃下一跳不可达的路由-3"><a href="#丢弃下一跳不可达的路由-3" class="headerlink" title="丢弃下一跳不可达的路由 (3)"></a>丢弃下一跳不可达的路由 (3)</h2><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/6.png"></p>
<h2 id="BGP路由优选规则1"><a href="#BGP路由优选规则1" class="headerlink" title="BGP路由优选规则1"></a>BGP路由优选规则1</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p><strong>1.优选Preferred-Value属性值最大的路由。</strong></p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="修改Preferred-Value"><a href="#修改Preferred-Value" class="headerlink" title="修改Preferred-Value"></a>修改Preferred-Value</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/7.png"></p>
<p>使用<strong>preferred-value</strong>命令修改R3通告的BGP路由其Preferred-Value为100 ，优于R2通告BGP路由的默认Preferred-Value ，R1将会优选R3通告的BGP路由10.0.45.0/24。</p>
<h3 id="查看R1-BGP路由表"><a href="#查看R1-BGP路由表" class="headerlink" title="查看R1 BGP路由表"></a>查看R1 BGP路由表</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/8.png"></p>
<p>R3（10.0.3.3）通告的BGP路由拥有更高的Preferred-Value（100），因此R1将会优选R3通告的BGP路由10.0.45.0/24。</p>
<h2 id="BGP路由优选规则2"><a href="#BGP路由优选规则2" class="headerlink" title="BGP路由优选规则2"></a>BGP路由优选规则2</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p><strong>2.优选Local_Preference属性值最大的路由。</strong></p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="修改Local-Preference-1"><a href="#修改Local-Preference-1" class="headerlink" title="修改Local_Preference (1)"></a>修改Local_Preference (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/9.png"></p>
<h3 id="修改Local-Preference-2"><a href="#修改Local-Preference-2" class="headerlink" title="修改Local_Preference (2)"></a>修改Local_Preference (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/10.png"></p>
<p>下一跳可达、相同Preferred-Value的情况下将会比较Local_Preference，R3通告的BGP路由Local_Preference值为200，高于R2通告的BGP路由，R1将会优选R3通告的BGP路由。</p>
<h2 id="BGP路由优选规则3"><a href="#BGP路由优选规则3" class="headerlink" title="BGP路由优选规则3"></a>BGP路由优选规则3</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p><strong>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</strong></p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="本地优先"><a href="#本地优先" class="headerlink" title="本地优先"></a>本地优先</h3><p>•本条规则可以概括为在相同条件下，优选本地生成的路由，从对等体学习到的路由条目为次优。</p>
<p>•同时本地生成的路由也可能存在多种途径，当本地存在多种途径学习到相同路由时，从高到低优先级如下：</p>
<ul>
<li>手动聚合：手动通过aggregate命令在BGP视图内聚合生成的聚合路由</li>
<li>自动聚合：Summary automatic命令生成的自动聚合路由</li>
<li>Network方式注入的路由</li>
<li>Import-route方式注入的路由</li>
</ul>
<blockquote>
<p>•本条规则我们验证了：</p>
<p>​    ▫本地产生的BGP路由优于从对等体学习的BGP路由</p>
<p>​    ▫手动聚合产生的BGP路由优于自动聚合产生的BGP路由</p>
</blockquote>
<h3 id="手动聚合-1"><a href="#手动聚合-1" class="headerlink" title="手动聚合 (1)"></a>手动聚合 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/11.png"></p>
<p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/12.png"></p>
<h3 id="手动聚合-2"><a href="#手动聚合-2" class="headerlink" title="手动聚合 (2)"></a>手动聚合 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/13.png"></p>
<blockquote>
<p>•BGP路由表中“s”标志代表该路由条目被抑制。</p>
</blockquote>
<h3 id="手动聚合-3"><a href="#手动聚合-3" class="headerlink" title="手动聚合 (3)"></a>手动聚合 (3)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/14.png"></p>
<p>•R3上通过<strong>display bgp routing-table</strong> <strong>10.0.45.0</strong> <strong>24</strong>查看BGP路由10.0.45.0/24的详细信息，存在两条有效路由，其中最优的为手动聚合产生的路由。</p>
<p>•在本案例中我们验证了本地产生的BGP路由优于从对等体学习的BGP路由。</p>
<h3 id="自动聚合-1"><a href="#自动聚合-1" class="headerlink" title="自动聚合 (1)"></a>自动聚合 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/15.png"></p>
<p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/16.png"></p>
<h3 id="自动聚合-2"><a href="#自动聚合-2" class="headerlink" title="自动聚合 (2)"></a>自动聚合 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/17.png"></p>
<h3 id="自动聚合-3"><a href="#自动聚合-3" class="headerlink" title="自动聚合 (3)"></a>自动聚合 (3)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/18.png"></p>
<p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/19.png"></p>
<h3 id="自动聚合-4"><a href="#自动聚合-4" class="headerlink" title="自动聚合 (4)"></a>自动聚合 (4)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/20.png"></p>
<p>•R3上通过<strong>display bgp routing-table</strong> <strong>10.0.0.0</strong> 查看BGP路由10.0.0.0/8的详细信息，存在三条有效路由，其中最优的条目由聚合产生，并且存在Atomic-aggregate属性，由此可以看出该聚合条目为手动聚合产生的条目。</p>
<p>•R3上相同的BGP聚合路由：手动聚合 &gt; 自动聚合。</p>
<p>•在该案例中我们验证了手动聚合产生的BGP路由优于自动聚合产生的BGP路由。</p>
<blockquote>
<p>•本地Network优于本地import，此案例不再展示。</p>
<p>•自动聚合产生的聚合路由并不会携带Atomic-aggregate属性。</p>
</blockquote>
<h2 id="BGP路由优选规则4"><a href="#BGP路由优选规则4" class="headerlink" title="BGP路由优选规则4"></a>BGP路由优选规则4</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p><strong>4.优选AS_Path属性值最短的路由。</strong></p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="优选AS-Path最短-1"><a href="#优选AS-Path最短-1" class="headerlink" title="优选AS_Path最短 (1)"></a>优选AS_Path最短 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/21.png"></p>
<h3 id="优选AS-Path最短-2"><a href="#优选AS-Path最短-2" class="headerlink" title="优选AS_Path最短 (2)"></a>优选AS_Path最短 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/22.png"></p>
<h2 id="BGP路由优选规则5"><a href="#BGP路由优选规则5" class="headerlink" title="BGP路由优选规则5"></a>BGP路由优选规则5</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p><strong>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</strong></p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="Origin属性验证-1"><a href="#Origin属性验证-1" class="headerlink" title="Origin属性验证 (1)"></a>Origin属性验证 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/23.png"></p>
<p>•R4、R5上默认采用import-route方式将路由10.0.45.0/24注入到BGP，R1的BGP路由表中两条BGP路由10.0.45.0/24其Origin属性都是“？”，此时R1优选R4注入的BGP路由。</p>
<p>•在R5上修改注入路由的方式为network</p>
<p>•之后在R1上再次查看BGP路由表。</p>
<h3 id="Origin属性验证-2"><a href="#Origin属性验证-2" class="headerlink" title="Origin属性验证 (2)"></a>Origin属性验证 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/24.png"></p>
<p>•此时R5注入的BGP路由10.0.45.0/24其Origin属性为“i”，在前几条优选规则相同情况下，起源类型为“i”的BGP路由成为优选路由。</p>
<h2 id="BGP路由优选规则6"><a href="#BGP路由优选规则6" class="headerlink" title="BGP路由优选规则6"></a>BGP路由优选规则6</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p><strong>6.优选MED属性值最小的路由。</strong></p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="优选MED最小-1"><a href="#优选MED最小-1" class="headerlink" title="优选MED最小 (1)"></a>优选MED最小 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/25.png"></p>
<h3 id="优选MED最小-2"><a href="#优选MED最小-2" class="headerlink" title="优选MED最小 (2)"></a>优选MED最小 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/26.png"></p>
<h2 id="BGP路由优选规则7"><a href="#BGP路由优选规则7" class="headerlink" title="BGP路由优选规则7"></a>BGP路由优选规则7</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p><strong>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</strong></p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="优选从EBGP对等体学来的路由-1"><a href="#优选从EBGP对等体学来的路由-1" class="headerlink" title="优选从EBGP对等体学来的路由 (1)"></a>优选从EBGP对等体学来的路由 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/27.png"></p>
<p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/28.png"></p>
<h3 id="优选从EBGP对等体学来的路由-2"><a href="#优选从EBGP对等体学来的路由-2" class="headerlink" title="优选从EBGP对等体学来的路由 (2)"></a>优选从EBGP对等体学来的路由 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/29.png"></p>
<h2 id="BGP路由优选规则8"><a href="#BGP路由优选规则8" class="headerlink" title="BGP路由优选规则8"></a>BGP路由优选规则8</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p><strong>8.优选到Next_Hop的IGP度量值最小的路由。</strong></p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="IGP-Cost"><a href="#IGP-Cost" class="headerlink" title="IGP Cost"></a>IGP Cost</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/30.png"></p>
<p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/31.png"></p>
<h3 id="优选IGP-Cost值最小-1"><a href="#优选IGP-Cost值最小-1" class="headerlink" title="优选IGP Cost值最小 (1)"></a>优选IGP Cost值最小 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/32.png"></p>
<h3 id="优选IGP-Cost值最小-2"><a href="#优选IGP-Cost值最小-2" class="headerlink" title="优选IGP Cost值最小 (2)"></a>优选IGP Cost值最小 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/33.png"></p>
<h3 id="优选IGP-Cost值最小-3"><a href="#优选IGP-Cost值最小-3" class="headerlink" title="优选IGP Cost值最小 (3)"></a>优选IGP Cost值最小 (3)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/34.png"></p>
<p>•R1上通过<strong>display bgp routing-table</strong> <strong>10.0.45.0 24</strong> 查看BGP路由的详细信息，下一跳10.0.2.2的BGP路由其IGP cost值变为了10，而下一跳为10.0.3.3的BGP路由其IGP cost为默认值1，所以R1优选下一跳为10.0.3.3的路由。</p>
<p>•在R1的路由详细信息中可以看到如下内容：</p>
<p>​    <strong>not preferred for IGP cost</strong></p>
<p>​    表明该路由因为IGP cost未被优选。</p>
<h3 id="BGP路由等价负载分担"><a href="#BGP路由等价负载分担" class="headerlink" title="BGP路由等价负载分担"></a>BGP路由等价负载分担</h3><p>•在大型网络中，到达同一目的地通常会存在多条有效BGP路由，设备只会优选一条最优的BGP路由，将该路由加载到路由表中使用，这一特点往往会造成很多流量负载不均衡的情况。</p>
<p>•通过配置BGP负载分担，可以使得设备同时将多条等代价的BGP路由加载到路由表，实现流量负载均衡，减少网络拥塞。</p>
<p>•值得注意的是，尽管配置了BGP负载分担，设备依然只会在多条到达同一目的地的BGP路由中优选一条路由，并只将这条路由通告给其他对等体。</p>
<p>•在设备上使能BGP负载分担功能后，只有满足条件的多条BGP路由才会成为等价路由，进行负载分担。</p>
<blockquote>
<p>•默认情况下设备只会对AS_Path完全相同的路由进行负载分担，可以使用<strong>load-balancing as-path-ignore</strong>忽略AS_Path路径不一致。</p>
<p>•在公网中到达同一目的地的路由形成负载分担时，系统会首先判断最优路由的类型。若最优路由为IBGP路由则只是IBGP路由参与负载分担，若最优路由为EBGP路由则只是EBGP路由参与负载分担，即公网中到达同一目的地的IBGP和EBGP路由不能形成负载分担。</p>
</blockquote>
<h3 id="形成BGP路由等价负载分担的条件"><a href="#形成BGP路由等价负载分担的条件" class="headerlink" title="形成BGP路由等价负载分担的条件"></a>形成BGP路由等价负载分担的条件</h3><p>•Preferred-Value属性值相同。</p>
<p>•Local_Preference属性值相同。</p>
<p>•都是聚合路由或者非聚合路由。</p>
<p>•AS_Path属性长度相同。</p>
<p>•Origin类型（IGP、EGP、Incomplete）相同。</p>
<p>•MED属性值相同。</p>
<p>•都是EBGP路由或都是IBGP路由。</p>
<p>•AS内部IGP的Metric相同。</p>
<p>•AS_Path属性完全相同。</p>
<h3 id="配置BGP路由负载分担"><a href="#配置BGP路由负载分担" class="headerlink" title="配置BGP路由负载分担"></a>配置BGP路由负载分担</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/35.png"></p>
<p>以左侧拓扑为例，R1上两条BGP路由在不做任何路由策略、配置的情况下，前8条优选规则无法比较出优选路由。因此可以配置IBGP路由的负载分担。</p>
<h3 id="配置BGP路由负载分担后"><a href="#配置BGP路由负载分担后" class="headerlink" title="配置BGP路由负载分担后"></a>配置BGP路由负载分担后</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/36.png"></p>
<h2 id="BGP路由优选规则9"><a href="#BGP路由优选规则9" class="headerlink" title="BGP路由优选规则9"></a>BGP路由优选规则9</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p><strong>9.优选Cluster_List最短的路由。</strong></p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="优选Cluster-List最短案例-1"><a href="#优选Cluster-List最短案例-1" class="headerlink" title="优选Cluster_List最短案例 (1)"></a>优选Cluster_List最短案例 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/37.png"></p>
<p>对拓扑做如下修改：</p>
<p>•只在R5上将10.0.45.0/24发布到BGP</p>
<p>•配置R1为RR，R3为R1的客户端。</p>
<p>•R2、R3之间基于环回口建立IBGP对等体关系</p>
<p>R2上将收到R3通告的BGP路由10.0.45.0/24、R1反射的BGP路由10.0.45.0/24。</p>
<p>默认配置下，前面介绍的规则无法比较出优选路由，此时将根据Cluster_List进行优选。</p>
<h3 id="优选Cluster-List最短案例-2"><a href="#优选Cluster-List最短案例-2" class="headerlink" title="优选Cluster_List最短案例 (2)"></a>优选Cluster_List最短案例 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/38.png"></p>
<p>从BGP路由表中无法看出优选的是R1反射的BGP路由还是R3通告的BGP路由，此时可以通过命令<strong>display</strong> <strong>bgp routing</strong> <strong>10.0.45.0</strong> <strong>24</strong>查看BGP路由详细信息。</p>
<h3 id="优选Cluster-List最短案例-3"><a href="#优选Cluster-List最短案例-3" class="headerlink" title="优选Cluster_List最短案例 (3)"></a>优选Cluster_List最短案例 (3)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/39.png"></p>
<p>•经由R1反射的路由不是最优路由，原因也被标出：</p>
<p><strong>not preferred for Cluster List</strong>*</p>
<p>•R3直接通告给R2的BGP路由因为没有经过路由反射器，不存在Cluster_List属性，即被认为Cluster_List长度为0，小于由R1反射的BGP路由其Cluster_List长度（1），所以R3通告的BGP路由为优选路由。</p>
<h2 id="BGP路由优选规则10"><a href="#BGP路由优选规则10" class="headerlink" title="BGP路由优选规则10"></a>BGP路由优选规则10</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p><strong>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</strong></p>
<p>11.优选具有最小IP地址的对等体通告的路由。</p>
<h3 id="优选Router-ID最小-1"><a href="#优选Router-ID最小-1" class="headerlink" title="优选Router ID最小 (1)"></a>优选Router ID最小 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/40.png"></p>
<p>在我们的讲解拓扑中，默认配置下R1从R2、R3都会收到BGP路由10.0.45.0/24，并且前面的优选规则无法比较出优选路由，最终将会根据本条规则，优选Router ID最小的对等体通告的BGP路由，在本案例中也就是R2通告的BGP路由。</p>
<h3 id="优选Router-ID最小-2"><a href="#优选Router-ID最小-2" class="headerlink" title="优选Router ID最小 (2)"></a>优选Router ID最小 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/41.png"></p>
<p>查看R1的BGP路由表详细信息，来自10.0.3.3的BGP路由因Router ID原因没有被优选：<br> <strong>not preferred for router ID</strong></p>
<h3 id="优选Orginator-ID最小-1"><a href="#优选Orginator-ID最小-1" class="headerlink" title="优选Orginator_ID最小 (1)"></a>优选Orginator_ID最小 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/42.png"></p>
<p>如果BGP路由携带Originator_ID属性，则在本条规则的优选过程中，将比较Originator_ID的大小，并优选Originator_ID最小的BGP路由。</p>
<h3 id="优选Orginator-ID最小-2"><a href="#优选Orginator-ID最小-2" class="headerlink" title="优选Orginator_ID最小 (2)"></a>优选Orginator_ID最小 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/43.png"></p>
<h2 id="BGP路由优选规则11"><a href="#BGP路由优选规则11" class="headerlink" title="BGP路由优选规则11"></a>BGP路由优选规则11</h2><p>当到达同一个目的网段存在多条路由时，BGP通过如下的次序进行路由优选：</p>
<p>   丢弃下一跳不可达的路由。</p>
<p>1.优选Preferred-Value属性值最大的路由。</p>
<p>2.优选Local_Preference属性值最大的路由。</p>
<p>3.本地始发的BGP路由优于从其他对等体学习到的路由，本地始发的路由优先级：优选手动聚合&gt;自动聚合&gt;network&gt;import&gt;从对等体学到的。</p>
<p>4.优选AS_Path属性值最短的路由。</p>
<p>5.优选Origin属性最优的路由。Origin属性值按优先级从高到低的排列是：IGP、EGP及Incomplete。</p>
<p>6.优选MED属性值最小的路由。</p>
<p>7.优选从EBGP对等体学来的路由（EBGP路由优先级高于IBGP路由）。</p>
<p>8.优选到Next_Hop的IGP度量值最小的路由。</p>
<p>9.优选Cluster_List最短的路由。</p>
<p>10.优选Router ID（Orginator_ID）最小的设备通告的路由。</p>
<p><strong>11.优选具有最小IP地址的对等体通告的路由。</strong></p>
<h3 id="优选具有最小IP地址的对等体-1"><a href="#优选具有最小IP地址的对等体-1" class="headerlink" title="优选具有最小IP地址的对等体 (1)"></a>优选具有最小IP地址的对等体 (1)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/44.png"></p>
<p>•当前面所有规则都无法比较出优选路由时，此时会根据对等体地址大小来进行优选，对等体地址较小者发送的路由较优。</p>
<p>•修改前一条规则的验证拓扑，R2、R3都与R4相连，R4作为RR客户端，只在R4上将路由发布到BGP，此时R2、R3反射的BGP路由将拥有相同的Originator ID：10.0.4.4。</p>
<h3 id="优选具有最小IP地址的对等体-2"><a href="#优选具有最小IP地址的对等体-2" class="headerlink" title="优选具有最小IP地址的对等体 (2)"></a>优选具有最小IP地址的对等体 (2)</h3><p><img src="/2021/05/10/BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/45.png"></p>
<h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><p>1.（简答题）从EBGP对等体收到的BGP路由通告给IBGP对等体时如何修改next_hop属性值为自身更新源地址？</p>
<p><strong>使用peer next-hop-local命令指定next_hop属性为TCP连接源地址。</strong></p>
<p>2.（判断题）当前三条优选规则相同的情况下，BGP会比较AS_Path长度，当AS_Path长度相同时会比较AS号的大小。</p>
<p>A.对</p>
<p><strong>B.错</strong></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>•BGP采用路径属性进行路由优选，这让BGP拥有丰富的可选比较项，可以在不同的场景下根据不同的路径属性选择出最适合的路由。</p>
<p>•BGP定义了一套详细的最优路径选择算法，这使得路由器能够在任何复杂的、高冗余性的网络环境下选择出最优的路径，这套算法也被称作BGP路由优选规则，或者BGP选路原则。</p>
<p>•BGP选路原则在实际中频繁应用，需要熟练掌握。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/IP-9-BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89/" rel="tag"># IP-9-BGP路由优选</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/05/10/BGP%E8%B7%AF%E5%BE%84%E5%B1%9E%E6%80%A7%E4%B8%8E%E8%B7%AF%E7%94%B1%E5%8F%8D%E5%B0%84%E5%99%A8/" rel="next" title="BGP路径属性与路由反射器">
                <i class="fa fa-chevron-left"></i> BGP路径属性与路由反射器
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/05/10/BGP-EVPN%E5%9F%BA%E7%A1%80/" rel="prev" title="BGP-EVPN基础">
                BGP-EVPN基础 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">65</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">2.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89"><span class="nav-number">3.</span> <span class="nav-text">BGP路由优选</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%99"><span class="nav-number">3.1.</span> <span class="nav-text">BGP路由优选规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%93%E6%89%91%E8%AF%B4%E6%98%8E-1"><span class="nav-number">3.2.</span> <span class="nav-text">拓扑说明 (1)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%93%E6%89%91%E8%AF%B4%E6%98%8E-2"><span class="nav-number">3.3.</span> <span class="nav-text">拓扑说明 (2)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%99-1"><span class="nav-number">3.4.</span> <span class="nav-text">BGP路由优选规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A2%E5%BC%83%E4%B8%8B%E4%B8%80%E8%B7%B3%E4%B8%8D%E5%8F%AF%E8%BE%BE%E7%9A%84%E8%B7%AF%E7%94%B1-1"><span class="nav-number">3.5.</span> <span class="nav-text">丢弃下一跳不可达的路由 (1)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A2%E5%BC%83%E4%B8%8B%E4%B8%80%E8%B7%B3%E4%B8%8D%E5%8F%AF%E8%BE%BE%E7%9A%84%E8%B7%AF%E7%94%B1-2"><span class="nav-number">3.6.</span> <span class="nav-text">丢弃下一跳不可达的路由 (2)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%A2%E5%BC%83%E4%B8%8B%E4%B8%80%E8%B7%B3%E4%B8%8D%E5%8F%AF%E8%BE%BE%E7%9A%84%E8%B7%AF%E7%94%B1-3"><span class="nav-number">3.7.</span> <span class="nav-text">丢弃下一跳不可达的路由 (3)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%991"><span class="nav-number">3.8.</span> <span class="nav-text">BGP路由优选规则1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Preferred-Value"><span class="nav-number">3.8.1.</span> <span class="nav-text">修改Preferred-Value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8BR1-BGP%E8%B7%AF%E7%94%B1%E8%A1%A8"><span class="nav-number">3.8.2.</span> <span class="nav-text">查看R1 BGP路由表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%992"><span class="nav-number">3.9.</span> <span class="nav-text">BGP路由优选规则2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Local-Preference-1"><span class="nav-number">3.9.1.</span> <span class="nav-text">修改Local_Preference (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Local-Preference-2"><span class="nav-number">3.9.2.</span> <span class="nav-text">修改Local_Preference (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%993"><span class="nav-number">3.10.</span> <span class="nav-text">BGP路由优选规则3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E4%BC%98%E5%85%88"><span class="nav-number">3.10.1.</span> <span class="nav-text">本地优先</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E8%81%9A%E5%90%88-1"><span class="nav-number">3.10.2.</span> <span class="nav-text">手动聚合 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E8%81%9A%E5%90%88-2"><span class="nav-number">3.10.3.</span> <span class="nav-text">手动聚合 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E8%81%9A%E5%90%88-3"><span class="nav-number">3.10.4.</span> <span class="nav-text">手动聚合 (3)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%81%9A%E5%90%88-1"><span class="nav-number">3.10.5.</span> <span class="nav-text">自动聚合 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%81%9A%E5%90%88-2"><span class="nav-number">3.10.6.</span> <span class="nav-text">自动聚合 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%81%9A%E5%90%88-3"><span class="nav-number">3.10.7.</span> <span class="nav-text">自动聚合 (3)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%81%9A%E5%90%88-4"><span class="nav-number">3.10.8.</span> <span class="nav-text">自动聚合 (4)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%994"><span class="nav-number">3.11.</span> <span class="nav-text">BGP路由优选规则4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89AS-Path%E6%9C%80%E7%9F%AD-1"><span class="nav-number">3.11.1.</span> <span class="nav-text">优选AS_Path最短 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89AS-Path%E6%9C%80%E7%9F%AD-2"><span class="nav-number">3.11.2.</span> <span class="nav-text">优选AS_Path最短 (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%995"><span class="nav-number">3.12.</span> <span class="nav-text">BGP路由优选规则5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Origin%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81-1"><span class="nav-number">3.12.1.</span> <span class="nav-text">Origin属性验证 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Origin%E5%B1%9E%E6%80%A7%E9%AA%8C%E8%AF%81-2"><span class="nav-number">3.12.2.</span> <span class="nav-text">Origin属性验证 (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%996"><span class="nav-number">3.13.</span> <span class="nav-text">BGP路由优选规则6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89MED%E6%9C%80%E5%B0%8F-1"><span class="nav-number">3.13.1.</span> <span class="nav-text">优选MED最小 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89MED%E6%9C%80%E5%B0%8F-2"><span class="nav-number">3.13.2.</span> <span class="nav-text">优选MED最小 (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%997"><span class="nav-number">3.14.</span> <span class="nav-text">BGP路由优选规则7</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89%E4%BB%8EEBGP%E5%AF%B9%E7%AD%89%E4%BD%93%E5%AD%A6%E6%9D%A5%E7%9A%84%E8%B7%AF%E7%94%B1-1"><span class="nav-number">3.14.1.</span> <span class="nav-text">优选从EBGP对等体学来的路由 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89%E4%BB%8EEBGP%E5%AF%B9%E7%AD%89%E4%BD%93%E5%AD%A6%E6%9D%A5%E7%9A%84%E8%B7%AF%E7%94%B1-2"><span class="nav-number">3.14.2.</span> <span class="nav-text">优选从EBGP对等体学来的路由 (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%998"><span class="nav-number">3.15.</span> <span class="nav-text">BGP路由优选规则8</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IGP-Cost"><span class="nav-number">3.15.1.</span> <span class="nav-text">IGP Cost</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89IGP-Cost%E5%80%BC%E6%9C%80%E5%B0%8F-1"><span class="nav-number">3.15.2.</span> <span class="nav-text">优选IGP Cost值最小 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89IGP-Cost%E5%80%BC%E6%9C%80%E5%B0%8F-2"><span class="nav-number">3.15.3.</span> <span class="nav-text">优选IGP Cost值最小 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89IGP-Cost%E5%80%BC%E6%9C%80%E5%B0%8F-3"><span class="nav-number">3.15.4.</span> <span class="nav-text">优选IGP Cost值最小 (3)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E7%AD%89%E4%BB%B7%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85"><span class="nav-number">3.15.5.</span> <span class="nav-text">BGP路由等价负载分担</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%A2%E6%88%90BGP%E8%B7%AF%E7%94%B1%E7%AD%89%E4%BB%B7%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="nav-number">3.15.6.</span> <span class="nav-text">形成BGP路由等价负载分担的条件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEBGP%E8%B7%AF%E7%94%B1%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85"><span class="nav-number">3.15.7.</span> <span class="nav-text">配置BGP路由负载分担</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEBGP%E8%B7%AF%E7%94%B1%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85%E5%90%8E"><span class="nav-number">3.15.8.</span> <span class="nav-text">配置BGP路由负载分担后</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%999"><span class="nav-number">3.16.</span> <span class="nav-text">BGP路由优选规则9</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Cluster-List%E6%9C%80%E7%9F%AD%E6%A1%88%E4%BE%8B-1"><span class="nav-number">3.16.1.</span> <span class="nav-text">优选Cluster_List最短案例 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Cluster-List%E6%9C%80%E7%9F%AD%E6%A1%88%E4%BE%8B-2"><span class="nav-number">3.16.2.</span> <span class="nav-text">优选Cluster_List最短案例 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Cluster-List%E6%9C%80%E7%9F%AD%E6%A1%88%E4%BE%8B-3"><span class="nav-number">3.16.3.</span> <span class="nav-text">优选Cluster_List最短案例 (3)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%9910"><span class="nav-number">3.17.</span> <span class="nav-text">BGP路由优选规则10</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Router-ID%E6%9C%80%E5%B0%8F-1"><span class="nav-number">3.17.1.</span> <span class="nav-text">优选Router ID最小 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Router-ID%E6%9C%80%E5%B0%8F-2"><span class="nav-number">3.17.2.</span> <span class="nav-text">优选Router ID最小 (2)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Orginator-ID%E6%9C%80%E5%B0%8F-1"><span class="nav-number">3.17.3.</span> <span class="nav-text">优选Orginator_ID最小 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89Orginator-ID%E6%9C%80%E5%B0%8F-2"><span class="nav-number">3.17.4.</span> <span class="nav-text">优选Orginator_ID最小 (2)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BGP%E8%B7%AF%E7%94%B1%E4%BC%98%E9%80%89%E8%A7%84%E5%88%9911"><span class="nav-number">3.18.</span> <span class="nav-text">BGP路由优选规则11</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89%E5%85%B7%E6%9C%89%E6%9C%80%E5%B0%8FIP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%AF%B9%E7%AD%89%E4%BD%93-1"><span class="nav-number">3.18.1.</span> <span class="nav-text">优选具有最小IP地址的对等体 (1)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E9%80%89%E5%85%B7%E6%9C%89%E6%9C%80%E5%B0%8FIP%E5%9C%B0%E5%9D%80%E7%9A%84%E5%AF%B9%E7%AD%89%E4%BD%93-2"><span class="nav-number">3.18.2.</span> <span class="nav-text">优选具有最小IP地址的对等体 (2)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="nav-number">4.</span> <span class="nav-text">思考题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
