<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="my blog">
<meta property="og:type" content="website">
<meta property="og:title" content="zsy&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="my blog">
<meta property="og:locale">
<meta property="article:author" content="张思宇">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/03/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/03/%E8%B7%AF%E7%94%B1%E7%AD%96%E7%95%A5/" itemprop="url">路由策略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-03T20:32:10+08:00">
                2021-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaoa000/article/details/55097156/">https://blog.csdn.net/kaoa000/article/details/55097156/</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/WLAN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/WLAN/" itemprop="url">WLAN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T16:55:54+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="WLAN概述"><a href="#WLAN概述" class="headerlink" title="WLAN概述"></a>WLAN概述</h2><h3 id="什么是WLAN"><a href="#什么是WLAN" class="headerlink" title="什么是WLAN"></a>什么是WLAN</h3><p>WLAN即Wireless LAN(无线局域网），是指通过无线技术构建的无线局域网络。WLAN广义上是指以无线电波、激光、红外线等无线信号来代替有线局域网中的部分或全部传输介质所构成的网络。</p>
<p><img src="/2021/05/02/WLAN/1.png"></p>
<h3 id="IEEE-802-11、WLAN与Wi-Fi"><a href="#IEEE-802-11、WLAN与Wi-Fi" class="headerlink" title="IEEE 802.11、WLAN与Wi-Fi"></a>IEEE 802.11、WLAN与Wi-Fi</h3><p>IEEE 802.11标准与Wi-Fi的世代</p>
<p><img src="/2021/05/02/WLAN/2.png"></p>
<h3 id="Wi-Fi在办公场景的发展趋势"><a href="#Wi-Fi在办公场景的发展趋势" class="headerlink" title="Wi-Fi在办公场景的发展趋势"></a>Wi-Fi在办公场景的发展趋势</h3><p><img src="/2021/05/02/WLAN/3.png"></p>
<h2 id="WLAN的基本概念"><a href="#WLAN的基本概念" class="headerlink" title="WLAN的基本概念"></a>WLAN的基本概念</h2><h3 id="WLAN设备介绍"><a href="#WLAN设备介绍" class="headerlink" title="WLAN设备介绍"></a>WLAN设备介绍</h3><p><img src="/2021/05/02/WLAN/4.png"></p>
<h3 id="基本的WLAN组网架构"><a href="#基本的WLAN组网架构" class="headerlink" title="基本的WLAN组网架构"></a>基本的WLAN组网架构</h3><p><img src="/2021/05/02/WLAN/5.png"></p>
<h3 id="敏捷分布式AP架构"><a href="#敏捷分布式AP架构" class="headerlink" title="敏捷分布式AP架构"></a>敏捷分布式AP架构</h3><p>架构特点</p>
<ul>
<li>AP的一种特殊架构，将AP拆分为中心AP和敏分AP两部分，中心AP可管理多台敏分AP，在适用的场景下，成本低，覆盖好。敏捷分布式AP可以用于FAT AP、AC+FIT AP、云管理架构。</li>
<li>适用范围:房间分布密集的场景。</li>
</ul>
<p><img src="/2021/05/02/WLAN/6.png"></p>
<h3 id="有线侧组网概念-CAPWAP协议"><a href="#有线侧组网概念-CAPWAP协议" class="headerlink" title="有线侧组网概念:CAPWAP协议"></a>有线侧组网概念:CAPWAP协议</h3><h4 id="什么是CAPWAP隧道"><a href="#什么是CAPWAP隧道" class="headerlink" title="什么是CAPWAP隧道"></a>什么是CAPWAP隧道</h4><p>CAPWAP ( Control And Provisioning of WirelessAccess Points Protocol，无线接入点控制和配置协议）∶该协议定义了如何对AP进行管理、业务配置，即AC通过CAPWAP隧道来实现对AP的集中管理和控制。</p>
<h4 id="CAPWAP隧道的功能"><a href="#CAPWAP隧道的功能" class="headerlink" title="CAPWAP隧道的功能"></a>CAPWAP隧道的功能</h4><ul>
<li>AP与AC间的状态维护。</li>
<li>AC通过CAPWAP隧道对AP进行管理、业务配置下发。</li>
<li>当采用隧道转发模式时，AP将STA发出的数据通过CAPWAP隧道实现与AC之间的交互。</li>
</ul>
<p><img src="/2021/05/02/WLAN/7.png"></p>
<h3 id="有线侧组网概念-AP-AC组网方式"><a href="#有线侧组网概念-AP-AC组网方式" class="headerlink" title="有线侧组网概念:AP-AC组网方式"></a>有线侧组网概念:AP-AC组网方式</h3><p>AP和AC间的组网分为:二层组网和三层组网。</p>
<h4 id="二层组网"><a href="#二层组网" class="headerlink" title="二层组网"></a>二层组网</h4><ul>
<li>二层组网:AP与AC之间的网络为直连或者二层网络。</li>
<li>由于二层组网比较简单，适用于简单临时的组网，能够进行比较快速的组网配置,但不适用于大型组网架构。</li>
</ul>
<p><img src="/2021/05/02/WLAN/8.png"></p>
<h4 id="三层组网"><a href="#三层组网" class="headerlink" title="三层组网"></a>三层组网</h4><ul>
<li><p>AP与AC之间的网络为三层网络。</p>
</li>
<li><p>在实际组网中，一台AC可以连接几十甚至几百台AP，组网一般比较复杂，在大型组网中一般采用三层组网。</p>
</li>
</ul>
<p><img src="/2021/05/02/WLAN/9.png"></p>
<h3 id="有线侧组网概念-AC连接方式"><a href="#有线侧组网概念-AC连接方式" class="headerlink" title="有线侧组网概念:AC连接方式"></a>有线侧组网概念:AC连接方式</h3><p>AC的连接方式分为:直连式组网和旁挂式组网。</p>
<h4 id="直连式组网"><a href="#直连式组网" class="headerlink" title="直连式组网"></a>直连式组网</h4><ul>
<li>直连式组网可以认为AP、AC与上层网络串联在一起，所有数据必须通过AC到达上层网络。</li>
<li>直连式组网中AC同时扮演AC和汇聚交换机的功能,AP的数据业务和管理业务都由AC集中转发和处理。</li>
</ul>
<p><img src="/2021/05/02/WLAN/10.png"></p>
<h4 id="旁挂式组网"><a href="#旁挂式组网" class="headerlink" title="旁挂式组网"></a>旁挂式组网</h4><ul>
<li><p>旁挂式组网，AC旁挂在AP与上行网络的直连网络中，不再直接连接AP。</p>
</li>
<li><p>旁挂式组网，AC旁挂在AP与上行网络的直连网络上,AP的业务数据可以不经AC而直接到达上行网络。</p>
<p><img src="/2021/05/02/WLAN/11.png"></p>
</li>
</ul>
<h3 id="无线侧组网概念-无线通信系统"><a href="#无线侧组网概念-无线通信系统" class="headerlink" title="无线侧组网概念:无线通信系统"></a>无线侧组网概念:无线通信系统</h3><p>无线通信系统中，信息可以是图像、文字、声音等。信息需要先经过信源编码转换为方便于电路计算和处理的数字信号，再经过信道编码和调制，转换为无线电波发射出去。</p>
<p><img src="/2021/05/02/WLAN/12.png"></p>
<h3 id="无线侧组网概念-无线电磁波"><a href="#无线侧组网概念-无线电磁波" class="headerlink" title="无线侧组网概念:无线电磁波"></a>无线侧组网概念:无线电磁波</h3><p>无线电磁波是频率介于3赫兹和约300G赫兹之间的电磁波，也叫作射频电波，或简称射频、射电。无线电技术将声音讯号或其他信号经过转换，利用无线电磁波传播。</p>
<p><img src="/2021/05/02/WLAN/13.png"></p>
<h3 id="无线侧组网概念-无线信道"><a href="#无线侧组网概念-无线信道" class="headerlink" title="无线侧组网概念:无线信道"></a>无线侧组网概念:无线信道</h3><p>信道是传输信息的通道，无线信道就是空间中的无线电磁波。</p>
<h4 id="2-4GHz频段"><a href="#2-4GHz频段" class="headerlink" title="2.4GHz频段"></a>2.4GHz频段</h4><p><img src="/2021/05/02/WLAN/14.png"></p>
<p>2.4GHz频段被划分为14个有重叠的、频率宽度是20MHz的信道。其中包含重叠信道和非重叠信道。</p>
<ul>
<li>重叠信道:在一个空间内同时存在重叠信道，则会产生干扰问题。</li>
<li>非重叠信道:在一个空间内可以同时存在非重叠信道，不会产生干扰问题。</li>
</ul>
<h4 id="5GHz频段"><a href="#5GHz频段" class="headerlink" title="5GHz频段"></a>5GHz频段</h4><p><img src="/2021/05/02/WLAN/15.png"></p>
<p>对于5G频段，支持更宽频谱，频率资源更为丰富，AP不仅支持20MHz带宽的信道，还支持40MHz、80MHz及更大带宽的信道。</p>
<h3 id="无线侧组网概念-BSS-SSID-BSS"><a href="#无线侧组网概念-BSS-SSID-BSS" class="headerlink" title="无线侧组网概念:BSS/SSID/BSS"></a>无线侧组网概念:BSS/SSID/BSS</h3><h4 id="基本服务集BSS-Basic-Service-Set"><a href="#基本服务集BSS-Basic-Service-Set" class="headerlink" title="基本服务集BSS (Basic Service Set)"></a>基本服务集BSS (Basic Service Set)</h4><ul>
<li>一个AP所覆盖的范围。</li>
<li>在一个BSS的服务区域内，STA可以相互通信。</li>
</ul>
<h4 id="基本服务集标识符BSSID-Basic-Service-Setldentifier"><a href="#基本服务集标识符BSSID-Basic-Service-Setldentifier" class="headerlink" title="基本服务集标识符BSSID (Basic Service Setldentifier)"></a>基本服务集标识符BSSID (Basic Service Setldentifier)</h4><ul>
<li>是无线网络的一个身份标识，用AP的MAC地址表示。</li>
</ul>
<h4 id="服务集标识符SSID-Service-Set-ldentifier"><a href="#服务集标识符SSID-Service-Set-ldentifier" class="headerlink" title="服务集标识符SSID (Service Set ldentifier)"></a>服务集标识符SSID (Service Set ldentifier)</h4><ul>
<li>是无线网络的一个身份标识，用字符串表示。</li>
<li>为了便于用户辨识不同的无线网络，用SSID代替BSSID。</li>
</ul>
<p><img src="/2021/05/02/WLAN/16.png"></p>
<h3 id="无线侧组网概念-VAP"><a href="#无线侧组网概念-VAP" class="headerlink" title="无线侧组网概念:VAP"></a>无线侧组网概念:VAP</h3><p>早期的AP只支持1个BSS，如果要在同一空间内部署多个BSS，则需要安放多个AP，这不但增加了成本，还占用了信道资源。为了改善这种状况，现在的AP通常支持创建出多个虚拟AP (Virtual Access Point, VAP)。</p>
<p>虚拟接入点VAP:</p>
<ul>
<li>VAP就是在一个物理实体AP上虚拟出的多个AP。每一个被虚拟出的AP就是一个VAP。每个VAP提供和物理实体AP一样的功能。</li>
<li>每个VAP对应1个BSS。这样1个AP，就可以提供多个BSS,<br>可以再为这些BSS，设置不同的SSID。</li>
</ul>
<p><img src="/2021/05/02/WLAN/17.png"></p>
<h3 id="无线侧组网概念-ESS"><a href="#无线侧组网概念-ESS" class="headerlink" title="无线侧组网概念: ESS"></a>无线侧组网概念: ESS</h3><p>为了满足实际业务的需求，需要对BSS的覆盖范围进行扩展。同时用户从一个BSS移动到另一个BSS时，不能感知到SSID的变化，则可以通过扩展服务集ESS实现。</p>
<p>扩展服务集ESS (Extend Service Set):</p>
<ul>
<li>由多个使用相同SSID的BSS组成，是采用相同的SSID的多个BSS组成的更大规模的虚拟BSS。</li>
</ul>
<p><img src="/2021/05/02/WLAN/18.png"></p>
<h2 id="WLAN的工作原理"><a href="#WLAN的工作原理" class="headerlink" title="WLAN的工作原理"></a>WLAN的工作原理</h2><h3 id="WLAN工作流程概述"><a href="#WLAN工作流程概述" class="headerlink" title="WLAN工作流程概述"></a>WLAN工作流程概述</h3><p><img src="/2021/05/02/WLAN/19.png"></p>
<h3 id="步骤1-AP上线"><a href="#步骤1-AP上线" class="headerlink" title="步骤1-AP上线"></a>步骤1-AP上线</h3><p><img src="/2021/05/02/WLAN/20.png"></p>
<p>其中包含五步</p>
<h4 id="1-AP获取IP地址"><a href="#1-AP获取IP地址" class="headerlink" title="1.AP获取IP地址"></a>1.AP获取IP地址</h4><p>AP必须获得IP地址才能够与AC通信，WLAN网络才能够正常工作。</p>
<p>AP获取IP地址的方式包括以下:</p>
<ul>
<li>静态方式:登录到AP设备上手工配置IP地址。</li>
<li>DHCP方式:通过配置DHCP服务器，使AP作为DHCP客户端向DHCP服务器请求lIP地址。</li>
</ul>
<p>典型方案:</p>
<ul>
<li>部署专门的DHCP Server为AP分配IP地址。</li>
<li>使用AC的DHCP服务为AP分配IP地址。</li>
<li>使用网络中的设备，例如核心交换机为AP分配IP地址。</li>
</ul>
<h5 id="AP获取IP地址-DHCP方式"><a href="#AP获取IP地址-DHCP方式" class="headerlink" title="AP获取IP地址:DHCP方式"></a>AP获取IP地址:DHCP方式</h5><p><img src="/2021/05/02/WLAN/21.png"></p>
<h4 id="2-CAPWAP隧道建立"><a href="#2-CAPWAP隧道建立" class="headerlink" title="2.CAPWAP隧道建立"></a>2.CAPWAP隧道建立</h4><p>AC通过CAPWAP隧道来实现对AP的集中管理和控制。</p>
<p>Step 1: Discovery阶段（AP发现AC阶段)</p>
<ul>
<li>AP通过发送Discovery Request报文，找到可用的AC。</li>
<li>AP发现AC有两种方式:静态方式、动态方式</li>
</ul>
<p>Step 2:建立CAPWAP隧道阶段</p>
<ul>
<li>AP与AC关联，完成CAPWAP隧道建立。包括数据隧道和控制隧道:数据隧道、控制隧道</li>
</ul>
<p><img src="/2021/05/02/WLAN/22.png"></p>
<h5 id="Step1-AP动态发现AC"><a href="#Step1-AP动态发现AC" class="headerlink" title="Step1 : AP动态发现AC"></a>Step1 : AP动态发现AC</h5><p><img src="/2021/05/02/WLAN/23.png"></p>
<h5 id="Step2-建立CAPWAP隧道"><a href="#Step2-建立CAPWAP隧道" class="headerlink" title="Step2:建立CAPWAP隧道"></a>Step2:建立CAPWAP隧道</h5><p>AP与AC关联，完成CAPWAP隧道建立。包括数据隧道和控制隧道:</p>
<ul>
<li>数据隧道:AP接收的业务数据报文经过CAPWAP数据隧道集中到AC上转发。同时还可以选择对数据隧道进行数据传输层安全DTLS ( Datagram Transport Layer Security )加密，使能DTLS加密功能后，CAPWAP数据报文都会经过DTLS加解密。</li>
<li>控制隧道:通过CAPWAP控制隧道实现AP与AC之间的管理报文的交互。同时还可以选择对控制隧道进行数据传输层安全DTLS加密，使能DTLS加密功能后，CAPWAP控制报文都会经过DTLS加解密。</li>
</ul>
<p><img src="/2021/05/02/WLAN/24.png"></p>
<h4 id="3-AP接入控制"><a href="#3-AP接入控制" class="headerlink" title="3.AP接入控制"></a>3.AP接入控制</h4><p>AP接入控制</p>
<ul>
<li>AP发现AC后，会发送Join Request报文。AC收到后会判断是否允许该AP接入，并响应Join Response报文。</li>
<li>AC上支持三种对AP的认证方式:MAC认证、序列号(SN)认证和不认证。</li>
</ul>
<p><img src="/2021/05/02/WLAN/25.png"></p>
<h4 id="4-AP的版本升级（可选）"><a href="#4-AP的版本升级（可选）" class="headerlink" title="4.AP的版本升级（可选）"></a>4.AP的版本升级（可选）</h4><ul>
<li>AP根据收到的Join Response报文中的参数判断当前的系统软件版本是否与AC上指定的一致。如果不一致，则AP通过发送Image Data Request报文请求软件版本，然后进行版本升级，升级方式包括AC模式、FTP模式和SFTP模式。</li>
<li>AP在软件版本更新完成后重新启动，重复进行前面三个步骤。</li>
</ul>
<p><img src="/2021/05/02/WLAN/26.png"></p>
<h4 id="5-CAPWAP隧道维持"><a href="#5-CAPWAP隧道维持" class="headerlink" title="5.CAPWAP隧道维持"></a>5.CAPWAP隧道维持</h4><p>数据隧道维持:</p>
<ul>
<li>AP与AC之间交互Keepalive报文来检测数据隧道的连通状态</li>
</ul>
<p>控制隧道维持:</p>
<ul>
<li>AP与AC交互Echo报文来检测控制隧道的连通状态。</li>
</ul>
<p><img src="/2021/05/02/WLAN/27.png"></p>
<h4 id="AC预配置"><a href="#AC预配置" class="headerlink" title="AC预配置"></a>AC预配置</h4><p>为确保AP能够上线,AC需预先配置如下内容</p>
<p><img src="/2021/05/02/WLAN/28.png"></p>
<h3 id="步骤2-WLAN业务下发配置"><a href="#步骤2-WLAN业务下发配置" class="headerlink" title="步骤2-WLAN业务下发配置"></a>步骤2-WLAN业务下发配置</h3><p><img src="/2021/05/02/WLAN/30.png"></p>
<h4 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h4><p>为了方便用户配置和维护WLAN的各个功能，针对WLAN的不同功能和特性设计了各种类型的模板，这些模板统称为WLAN模板。</p>
<p><img src="/2021/05/02/WLAN/31.png"></p>
<h5 id="VAP模板"><a href="#VAP模板" class="headerlink" title="VAP模板"></a>VAP模板</h5><p><img src="/2021/05/02/WLAN/32.png"></p>
<h3 id="步骤3-STA接入"><a href="#步骤3-STA接入" class="headerlink" title="步骤3-STA接入"></a>步骤3-STA接入</h3><p><img src="/2021/05/02/WLAN/33.png"></p>
<p>步骤3中又包含七步。</p>
<h4 id="1-扫描"><a href="#1-扫描" class="headerlink" title="1.扫描"></a>1.扫描</h4><ul>
<li>STA可以通过主动扫描，定期搜索周围的无线网络，获取到周围的无线网络信息。</li>
<li>根据Probe Request帧（探测请求帧）是否携带SSID，可以将主动扫描分为两种:</li>
</ul>
<p><img src="/2021/05/02/WLAN/34.png"></p>
<h4 id="无线接入安全协议"><a href="#无线接入安全协议" class="headerlink" title="无线接入安全协议"></a>无线接入安全协议</h4><p>链路认证和接入认证常用的安全策略。</p>
<p><img src="/2021/05/02/WLAN/35.png"></p>
<h4 id="2-链路认证"><a href="#2-链路认证" class="headerlink" title="2.链路认证"></a>2.链路认证</h4><p>为了保证无线链路的安全，接入过程中AP需要完成对STA的认证，802.11链路定义了两种认证机制:开放系统认证和共享密钥认证。</p>
<p>开放系统认证(Open System Authentication)</p>
<p><img src="/2021/05/02/WLAN/36.png"></p>
<ul>
<li>开放系统认证:即不认证，任意STA都可以认证成功。</li>
</ul>
<p>共享密钥认证(Shared-key Authentication)</p>
<p><img src="/2021/05/02/WLAN/37.png"></p>
<ul>
<li>共享密钥认证:STA和AP预先配置相同的共享密钥，验证两边的密钥配置是否相同。如果一致，则认证成功;否则，认证失败。</li>
</ul>
<h4 id="3-关联"><a href="#3-关联" class="headerlink" title="3.关联"></a>3.关联</h4><ul>
<li>完成链路认证后，STA会继续发起链路服务协商，具体的协商通过Association报文实现。</li>
<li>终端关联过程实质上就是链路服务协商的过程，协商内容包括:支持的速率、信道等。</li>
</ul>
<p><img src="/2021/05/02/WLAN/38.png"></p>
<h4 id="4-接入认证"><a href="#4-接入认证" class="headerlink" title="4.接入认证"></a>4.接入认证</h4><ul>
<li>接入认证即对用户进行区分，并在用户访问网络之前限制其访问权限。相对于链路认证，接入认证安全性更高。</li>
<li>主要包含:PSK认证和802.1X认证。</li>
</ul>
<p><img src="/2021/05/02/WLAN/39.png"></p>
<h4 id="5-STA地址分配"><a href="#5-STA地址分配" class="headerlink" title="5.STA地址分配"></a>5.STA地址分配</h4><ul>
<li>STA获取到自身的IP地址，是STA正常上线的前提条件。</li>
<li>如果STA是通过DHCP方式获取IP地址，可以用AC设备或汇聚交换机作为DHCP服务器为STA分配IP地址。一般情况下使用汇聚交换机作为DHCP服务器。</li>
</ul>
<p><img src="/2021/05/02/WLAN/40.png"></p>
<h4 id="6-用户认证"><a href="#6-用户认证" class="headerlink" title="6.用户认证"></a>6.用户认证</h4><ul>
<li>用户认证是一种“端到端”的安全结构，包括:802.1X认证、MAC认证和Portal认证。</li>
</ul>
<p>Portal认证</p>
<ul>
<li>也称Web认证，一般将Portal认证网站称为门户网站。</li>
<li>用户上网时，必须在门户网站进行认证。只有认证通过后才可以使用网络资源。</li>
</ul>
<p><img src="/2021/05/02/WLAN/41.png"></p>
<h3 id="步骤4-WLAN业务数据转发"><a href="#步骤4-WLAN业务数据转发" class="headerlink" title="步骤4-WLAN业务数据转发"></a>步骤4-WLAN业务数据转发</h3><p><img src="/2021/05/02/WLAN/42.png"></p>
<h4 id="数据转发方式"><a href="#数据转发方式" class="headerlink" title="数据转发方式"></a>数据转发方式</h4><p><img src="/2021/05/02/WLAN/43.png"></p>
<h2 id="WLAN的基础配置命令"><a href="#WLAN的基础配置命令" class="headerlink" title="WLAN的基础配置命令"></a>WLAN的基础配置命令</h2><h3 id="配置AP上线"><a href="#配置AP上线" class="headerlink" title="配置AP上线"></a>配置AP上线</h3><p>1.配置AC作为DHCP服务器，配置Option 43字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-ip-pool-pool1] option code [ sub-option sub-code ] &#123; ascii asci-string l hex hex-string | cipher cipher-string lip-address ip-address</span><br></pre></td></tr></table></figure>
<p>配置DHCP服务器分配给DHCP客户端的自定义选项。2.创建域管理模板，并配置国家码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC] wlan</span><br><span class="line">[AC-wlan-view]</span><br></pre></td></tr></table></figure>
<p>进入WLAN视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] regulatory-domain-profile name profile-name</span><br><span class="line">[AC-wlan-regulate-domain-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建域管理模板，并进入模板视图，若模板已存在则直接进入模板视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-regulate-domain-profile-name] country-code country-code</span><br></pre></td></tr></table></figure>
<p>配置设备的国家码标识。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name]</span><br></pre></td></tr></table></figure>
<p>创建AP组，并进入AP组视图，若AP组已存在则直接进入AP组视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-ap-group-group-name] regulatory-domain-profile profile-name</span><br></pre></td></tr></table></figure>
<p>将指定的域管理模板引用到AP或AP组。<br>3．配置源接口或源地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC] capwap source interface &#123; loopback loopback-number | vlanif </span><br><span class="line">vlan-id &#125;</span><br></pre></td></tr></table></figure>
<p>配置AC与AP建立CAPWAP隧道的源接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] capwap source ip-address ip-address配置AC的源IP地址。</span><br></pre></td></tr></table></figure>
<p>4.添加AP设备–离线导入AP</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap auth-mode &#123; mac-auth | sn-auth &#125;</span><br></pre></td></tr></table></figure>
<p>配置AP认证模式为MAC地址认证，或SN认证，缺省为MAC地址认证。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-id ap-id [ [ type-id type-id | ap-type ap-type ] &#123; ap-mac ap-mac | ap-sn ap-sn | ap-mac ap-mac ap-sn ap-sn &#125; ]</span><br><span class="line">[AC-wlan-ap-ap-id] ap-name ap-name</span><br></pre></td></tr></table></figure>
<p>离线增加AP设备或进入AP视图，并配置单个AP的名称。[AC-wlan-view] ap-id o</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-ap-0] ap-group ap-group</span><br></pre></td></tr></table></figure>
<p>配置AP所加入的组。<br>5．检查AP上线结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display ap &#123; all | ap-group ap-group &#125;</span><br></pre></td></tr></table></figure>
<p>查看AP信息。</p>
<h3 id="配置射频"><a href="#配置射频" class="headerlink" title="配置射频"></a>配置射频</h3><p>1.进入射频视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-id o</span><br><span class="line">[AC-wlan-ap-0] radio radio-id</span><br><span class="line">[AC-wlan-radio-0]</span><br></pre></td></tr></table></figure>
<p>2.配置指定射频的工作带宽和信道</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] channel &#123; 20mhz | 40mhz-minus &#x2F; 40mhz-plus | 80mhz &#x2F; 160mhz &#125; channe</span><br><span class="line">lWarning: This action may cause service interruption.Continue?[Y&#x2F;N]y</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] channel 80+80mhz channel1 channel2</span><br><span class="line">Warning: This action may cause service interruption.Continue?[Y&#x2F;N]y</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的工作带宽和信道。<br>3.配置天线的增益</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] antenna-gain antenna-gain</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的天线增益。<br>4．配置射频的发射功率</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] eirp eirp</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的发射功率。</p>
<p>5.配置射频覆盖距离参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] coverage distance distance</span><br></pre></td></tr></table></figure>
<p>配置AP组中所有AP或单个AP指定射频的射频覆盖距离参数。</p>
<p>6.配置射频工作的频段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-radio-0&#x2F;0] frequency &#123; 2.4g | 5g &#125;</span><br></pre></td></tr></table></figure>
<p>7．创建射频模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] radio-2g-profile name profile-name</span><br></pre></td></tr></table></figure>
<p>创建2G射频模板，并进入模板视图，若模板已存在则直接进入模板视图。<br>8.引用射频模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name] radio-2g-profile profile-name radio &#123; radio-id | all &#125;</span><br></pre></td></tr></table></figure>
<p>在AP组中，将指定的2G射频模板引用到2G射频。</p>
<h3 id="配置VAP"><a href="#配置VAP" class="headerlink" title="配置VAP"></a>配置VAP</h3><p>1．创建VAP模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建VAP模板，并进入模板视图，若模板已存在则直接进入模板视图。2.配置数据转发方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-vap-prof-profile-name] forward-mode &#123; direct-forward | tunnel &#125;</span><br></pre></td></tr></table></figure>
<p>配置VAP模板下的数据转发方式，可以是直接转发或隧道转发。<br>3.配置业务VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-vap-prof-profile-name] service-vlan &#123; vlan-id vlan-id | vlan-pool pool-name &#125;</span><br></pre></td></tr></table></figure>
<p>配置VAP的业务VLAN。</p>
<p>4.配置安全模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] security-profile name profile-name</span><br><span class="line">[AC-wlan-sec-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建安全模板或者进入安全模板视图。<br>缺省情况下，系统已经创建名称为default、default-wds和default-mesh的安全模板。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name] security-profile profile-name</span><br></pre></td></tr></table></figure>
<p>在指定VAP模板中引用安全模板。</p>
<p>5.配置SSID模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ssid-profile name profile-name</span><br><span class="line">[AC-wlan-ssid-prof-profile-name]</span><br></pre></td></tr></table></figure>
<p>创建SSID模板，并进入模板视图，若模板已存在则直接进入模板视图。<br>缺省情况下，系统上存在名为default的SSID模板。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-ssid-prof-profile-name] ssid ssid</span><br></pre></td></tr></table></figure>
<p>配置当前SSID模板中的服务组合识别码SSID ( Service Set ldentifier ) 。缺省情况下，SSID模板中的SSID为HUAWEI-WLAN。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] vap-profile name profile-name</span><br><span class="line">[AC-wlan-vap-prof-profile-name] ssid-profile profile-name</span><br></pre></td></tr></table></figure>
<p>在指定VAP模板中引用SSID模板。</p>
<p>6.引用VAP模板</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[AC-wlan-view] ap-group name group-name</span><br><span class="line">[AC-wlan-ap-group-group-name] vap-profile profile-name wlan wlan-id radio &#123; radio-id | all &#125; [service-vlan&#123; vlan-id vlan-id \ vlan-pool pool-name &#125; ]</span><br></pre></td></tr></table></figure>
<p>在AP组中，将指定的VAP模板引用到射频。<br>7．查看VAP信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display vap &#123; ap-group ap-group-name \ i ap-name ap-name | ap-id ap-id &#125; [ radio radio-id ] &#125; [ ssid ssid ]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AC] display vap &#123; all | ssid ssid &#125;</span><br></pre></td></tr></table></figure>
<p>查看业务型VAP的相关信息。</p>
<h3 id="案例-旁挂二层组网隧道转发"><a href="#案例-旁挂二层组网隧道转发" class="headerlink" title="案例:旁挂二层组网隧道转发"></a>案例:旁挂二层组网隧道转发</h3><p><img src="/2021/05/02/WLAN/44.png"> </p>
<p><img src="/2021/05/02/WLAN/45.png"></p>
<h4 id="配置网络互通"><a href="#配置网络互通" class="headerlink" title="配置网络互通"></a>配置网络互通</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/46.png"></p>
<h4 id="配置AP上线-1"><a href="#配置AP上线-1" class="headerlink" title="配置AP上线"></a>配置AP上线</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/47.png"></p>
<p><img src="/2021/05/02/WLAN/48.png"></p>
<h4 id="查看AP上线"><a href="#查看AP上线" class="headerlink" title="查看AP上线"></a>查看AP上线</h4><p>将AP上电后，当执行命令display ap all查看到AP的“State”字段为“nor”时，表示AP正常上线。</p>
<p><img src="/2021/05/02/WLAN/49.png"></p>
<h4 id="配置WLAN业务参数"><a href="#配置WLAN业务参数" class="headerlink" title="配置WLAN业务参数"></a>配置WLAN业务参数</h4><p><img src="/2021/05/02/WLAN/53.png"></p>
<p><img src="/2021/05/02/WLAN/50.png"></p>
<p><img src="/2021/05/02/WLAN/51.png"></p>
<h4 id="查看VAP模板信息"><a href="#查看VAP模板信息" class="headerlink" title="查看VAP模板信息"></a>查看VAP模板信息</h4><p>WLAN业务配置会自动下发给AP，配置完成后，通过执行命令display vap ssid wlan-net查看如下信息，当“Status”项显示为“ON”时，表示AP对应的射频上的VAP已创建成功。</p>
<p><img src="/2021/05/02/WLAN/52.png"></p>
<h2 id="新一代WLAN解决方案"><a href="#新一代WLAN解决方案" class="headerlink" title="新一代WLAN解决方案"></a>新一代WLAN解决方案</h2><h3 id="华为WLAN方案满足未来无线建网需求"><a href="#华为WLAN方案满足未来无线建网需求" class="headerlink" title="华为WLAN方案满足未来无线建网需求"></a>华为WLAN方案满足未来无线建网需求</h3><p><img src="/2021/05/02/WLAN/54.png"></p>
<h3 id="双轮驱动-技术与应用发展助推Wi-Fi-6时代到来"><a href="#双轮驱动-技术与应用发展助推Wi-Fi-6时代到来" class="headerlink" title="双轮驱动:技术与应用发展助推Wi-Fi 6时代到来"></a>双轮驱动:技术与应用发展助推Wi-Fi 6时代到来</h3><p><img src="/2021/05/02/WLAN/55.png"></p>
<h3 id="Wi-Fi-6-Vs-Wi-Fi-5"><a href="#Wi-Fi-6-Vs-Wi-Fi-5" class="headerlink" title="Wi-Fi 6 Vs Wi-Fi 5"></a>Wi-Fi 6 Vs Wi-Fi 5</h3><p><img src="/2021/05/02/WLAN/56.png"></p>
<h3 id="下—代园区网络-智简园区（中小型园区网络"><a href="#下—代园区网络-智简园区（中小型园区网络" class="headerlink" title="下—代园区网络:智简园区（中小型园区网络)"></a>下—代园区网络:智简园区（中小型园区网络)</h3><p>基本概念</p>
<ul>
<li>通过云管理平台，可以实现任意地点对设备进行集中的管理和维护，大大降低网络部署运维成本。</li>
<li>适用范围:中小型企业。</li>
</ul>
<p>优势(对比AC+FIT AP架构)</p>
<ul>
<li>即插即用，自动开局，减少网络部署成本。</li>
<li>统一运维:所有云管理网元统一在云管理平台上进行监控和管理。·工具化:通常情况下，云解决方案会在云端提供各类工具，有效降低各类开支。</li>
</ul>
<p><img src="/2021/05/02/WLAN/57.png"></p>
<h3 id="下一代园区网络-智简园区-大中型园区网络"><a href="#下一代园区网络-智简园区-大中型园区网络" class="headerlink" title="下一代园区网络:智简园区(大中型园区网络)"></a>下一代园区网络:智简园区(大中型园区网络)</h3><p>架构特点</p>
<ul>
<li>AP需要配合iMaster NCE使用，由iMaster NCE统一管理和配置，功能丰富，进一步和有线网络融合，结合大数据和Al技术实现园区网络的极简、智慧和安全。</li>
<li>适用范围:大中型企业。</li>
</ul>
<p><img src="/2021/05/02/WLAN/58.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/" itemprop="url">广域网技术</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T16:55:45+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="广域网技术概述"><a href="#广域网技术概述" class="headerlink" title="广域网技术概述"></a>广域网技术概述</h2><h3 id="什么是广域网"><a href="#什么是广域网" class="headerlink" title="什么是广域网"></a>什么是广域网</h3><p>广域网 （WAN）是连接不同地区局域网的网络，通常所覆盖的范围从几十公里到几千公里。它能连接多个地区、城市和国家，或横跨几个洲提供远距离通信，形成国际性的远程网络。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/1.png"></p>
<h3 id="广域网与局域网区别"><a href="#广域网与局域网区别" class="headerlink" title="广域网与局域网区别"></a>广域网与局域网区别</h3><ul>
<li>局域网是一种覆盖地理区域比较小的计算机网络。</li>
<li>广域网是一种通过租用ISP网络或者自建专用网络来构建的覆盖地理区域比较广的计算机网络。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/2.png"></p>
<h3 id="早期广域网技术介绍"><a href="#早期广域网技术介绍" class="headerlink" title="早期广域网技术介绍"></a>早期广域网技术介绍</h3><p>早期广域网与局域网的区别在于数据链路层和物理层的差异性，在TCP/IP参考模型中，其他各层无差异。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/3.png"></p>
<h3 id="广域网络设备角色介绍"><a href="#广域网络设备角色介绍" class="headerlink" title="广域网络设备角色介绍"></a>广域网络设备角色介绍</h3><p>广域网络设备基本角色有三种，CE ( Customer Edge，用户边缘设备）、PE ( Provider Edge，服务提供商边缘设备）和P ( Provider ，服务提供商设备)。具体定义是:</p>
<ul>
<li>CE:用户端连接服务提供商的边缘设备。CE连接一个或多PE，实现用户接入。</li>
<li>PE:服务提供商连接CE的边缘设备。PE同时连接CE和P设备，是重要的网络节点。</li>
<li>P︰服务提供商不连接任何CE的设备。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/4.png"></p>
<h3 id="早期广域网技术的应用"><a href="#早期广域网技术的应用" class="headerlink" title="早期广域网技术的应用"></a>早期广域网技术的应用</h3><p>早期的广域网技术王要定针刈个可日1份在ED笔里干解决用户接入广域网的长距离传输问题。仕ISP之间常用的广域网封装协议有PPP/HDLC/FR等，用于解决用内部常用的广域网协议主要是ATM，它用于解决骨干网高速转发的问题。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/5.png"></p>
<h2 id="PPP协议原理与配置"><a href="#PPP协议原理与配置" class="headerlink" title="PPP协议原理与配置"></a>PPP协议原理与配置</h2><h3 id="PPP协议概述"><a href="#PPP协议概述" class="headerlink" title="PPP协议概述"></a>PPP协议概述</h3><ul>
<li><p>PPP ( Point-to-Point Protocol，点到点协议）是一种常见的广域网数据链路层协议，主要用于在全双工的链路上进行点到点的数据传输封装。</p>
</li>
<li><p>PPP提供了安全认证协议族PAP ( Password Authentication Protocol，密码验证协议）和CHAP (Challenge Handshake Authentication Protocol，挑战握手认证协议）。</p>
</li>
<li><p>PPP协议具有良好的扩展性，例如，当需要在以太网链路上承载PPP协议时，PPP可以扩展为PPPoE。</p>
</li>
<li><p>PPP协议提供LCP(Link Control Protocol，链路控制协议)，用于各种链路层参数的协商，例如最大接收单元，认证模式等。</p>
</li>
<li><p>PPP协议提供各种NCP (Network Control protocol，网络控制协议），如IPCP ( IP Control Protocol ，IP控制协议)，用于各网络层参数的协商，更好地支持了网络层协议。</p>
</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/6.png"></p>
<h3 id="PPP链路建立流程"><a href="#PPP链路建立流程" class="headerlink" title="PPP链路建立流程"></a>PPP链路建立流程</h3><p>PPP链路的建立有三个阶段的协商过程，链路层协商、认证协商（可选）和网络层协商。</p>
<ul>
<li>链路层协商（LCP）:通过LCP报文进行链路参数协商，建立链路层连接。</li>
<li>认证协商（可选)︰通过链路建立阶段协商的认证方式进行链路认证。</li>
<li>网络层协商（NCP）∶通过NCP协商来选择和配置一个网络层协议并进行网络层参数协商。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/7.png"></p>
<h3 id="PPP链路接口状态机"><a href="#PPP链路接口状态机" class="headerlink" title="PPP链路接口状态机"></a>PPP链路接口状态机</h3><p>PPP协商由链路两端的接口完成。接口的状态表示了协议的协商阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/8.png"></p>
<h3 id="LCP报文格式"><a href="#LCP报文格式" class="headerlink" title="LCP报文格式"></a>LCP报文格式</h3><p>PPP报文可由Protocol字段标识不同类型的PPP报文。例如，当Protocol字段为OxC021时，代表是LCP报文。此时又由Code字段标识不同类型LCP报文，如下表所示。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/9.png"></p>
<h3 id="LCP协商过程"><a href="#LCP协商过程" class="headerlink" title="LCP协商过程"></a>LCP协商过程</h3><h4 id="LCP协商过程-正常协商"><a href="#LCP协商过程-正常协商" class="headerlink" title="LCP协商过程-正常协商"></a>LCP协商过程-正常协商</h4><p>LCP协商由不同的LCP报文交互完成。协商由任意一方发送Configure-Request报文发起。如果对端接收此报文且参数匹配，则通过回复Configure-Ack响应协商成功。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/10.png"></p>
<h4 id="LCP协商过程-参数不匹配"><a href="#LCP协商过程-参数不匹配" class="headerlink" title="LCP协商过程-参数不匹配"></a>LCP协商过程-参数不匹配</h4><p>在LCP报文交互中出现LCP参数不匹配时，接收方回复Configure-Nak响应告知对端修改参数然后重新协商。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/11.png"></p>
<h4 id="LCP协商过程-参数不识别"><a href="#LCP协商过程-参数不识别" class="headerlink" title="LCP协商过程-参数不识别"></a>LCP协商过程-参数不识别</h4><p>在LCP报文交互中出现LCP参数不识别时，接收方回复Configure-Reject响应告知对端删除不识别的参数然后重新协商。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/12.png"></p>
<h3 id="PPP认证过程"><a href="#PPP认证过程" class="headerlink" title="PPP认证过程"></a>PPP认证过程</h3><p>链路协商成功后，进行认证协商（此过程可选）。认证协商有两种模式，PAP和CHAP。</p>
<h4 id="PPP认证模式-PAP"><a href="#PPP认证模式-PAP" class="headerlink" title="PPP认证模式- PAP"></a>PPP认证模式- PAP</h4><p>PAP认证双方有两次握手。协商报文以明文的形式在链路上传输。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/13.png"></p>
<h4 id="PPP认证模式-CHAP"><a href="#PPP认证模式-CHAP" class="headerlink" title="PPP认证模式- CHAP"></a>PPP认证模式- CHAP</h4><p>CHAP认证双方有三次握手。协商报文被加密后再在链路上传输。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/14.png"></p>
<h5 id="认证方不携带用户名，被认证方接口有密码"><a href="#认证方不携带用户名，被认证方接口有密码" class="headerlink" title="认证方不携带用户名，被认证方接口有密码"></a>认证方不携带用户名，被认证方接口有密码</h5><p>认证方不带用户名时，被认证方首先使用<strong>自己的接口密码</strong>+random+id生成MD5发送给认证方。</p>
<p>认证方收到回复帧后，到自己的AAA库中找与<strong>被认证方</strong>接口用户名相对应的密码，生成一个MD5值。</p>
<p>最后如果被认证方发送的MD5值和认证方生成的MD5值相同的话，则认证通过，显示Success，若不通过则显示Failure.</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9%E4%B8%8D%E5%B8%A6%E7%94%A8%E6%88%B7%E5%90%8D.png"></p>
<h5 id="认证方（双方）携带用户名，被认证方接口无密码"><a href="#认证方（双方）携带用户名，被认证方接口无密码" class="headerlink" title="认证方（双方）携带用户名，被认证方接口无密码"></a>认证方（双方）携带用户名，被认证方接口无密码</h5><p>认证方携带用户名时，被认证方接受到挑战帧后，首先进入自己AAA库中找到与<strong>认证方</strong>发送过来用户名相对应的密码+random+id生成MD5发送给认证方。</p>
<p>认证方接受到被认证方发送过来的MD5值后，首先也同样进入AAA库中找到与<strong>被认证方</strong>发送过来的用户名相对应的密码+random+id生成自己的MD5值。</p>
<p>最后如果被认证方发送的MD5值和认证方生成的MD5值相同的话，则认证通过，显示Success，若不通过则显示Failure.</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9%E5%B8%A6%E7%94%A8%E6%88%B7%E5%90%8D.png"></p>
<blockquote>
<p>第三次握手中，如果是Success，MESSAGE =”welcome to XXX”。 XXX是认证方接口用户名。</p>
</blockquote>
<h5 id="认证方（双方）携带用户名，被认证方接口有密码"><a href="#认证方（双方）携带用户名，被认证方接口有密码" class="headerlink" title="认证方（双方）携带用户名，被认证方接口有密码"></a>认证方（双方）携带用户名，被认证方接口有密码</h5><p>认证方携带用户名时，被认证方接受到挑战帧，此使被认证方<strong>使用自己的接口密码</strong>生成MD5值，<strong>不再使用AAA库中与认证方用户名相对应的密码</strong>生成MD5值了。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%A2%AB%E8%AE%A4%E8%AF%81%E6%96%B9%E6%8E%A5%E5%8F%A3%E6%9C%89%E5%AF%86%E7%A0%81.png"></p>
<h5 id="双方携带用户名，认证方AAA库中无密码"><a href="#双方携带用户名，认证方AAA库中无密码" class="headerlink" title="双方携带用户名，认证方AAA库中无密码"></a>双方携带用户名，认证方AAA库中无密码</h5><p>此时因为被认证方发送过来的MD5与认证方生成MD5比较失败无法通过认证。</p>
<blockquote>
<p>比较失败的原因是认证方AAA库中没有对应的密码。</p>
</blockquote>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/%E8%AE%A4%E8%AF%81%E6%96%B9aaa%E5%BA%93%E4%B8%AD%E6%97%A0%E5%AF%B9%E5%BA%94%E5%AF%86%E7%A0%81.png"></p>
<h3 id="NCP协商"><a href="#NCP协商" class="headerlink" title="NCP协商"></a>NCP协商</h3><p>PPP认证协商后，双方进入NCP协商阶段，协商在数据链路上所传输的数据包的格式与类型。以常见的IPCP协议为例，它分为静态IP地址协商和动态IP地址协商。</p>
<h4 id="NCP协商-静态IР地址协商"><a href="#NCP协商-静态IР地址协商" class="headerlink" title="NCP协商-静态IР地址协商"></a>NCP协商-静态IР地址协商</h4><p>静态IP地址协商需要手动在链路两端配置IP地址。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/15.png"></p>
<h4 id="NCP协商-动态IP地址协商"><a href="#NCP协商-动态IP地址协商" class="headerlink" title="NCP协商-动态IP地址协商"></a>NCP协商-动态IP地址协商</h4><p>动态IP地址协商支持PPP链路─端为对端配置IP地址。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/16.png"></p>
<h3 id="PPP协议配置"><a href="#PPP协议配置" class="headerlink" title="PPP协议配置"></a>PPP协议配置</h3><h4 id="PPP基础配置命令"><a href="#PPP基础配置命令" class="headerlink" title="PPP基础配置命令"></a>PPP基础配置命令</h4><p>1.配置接口封装PPP协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0]link-protocol ppp</span><br></pre></td></tr></table></figure>
<p>在接口视图下，将接口封装协议改为ppp，华为串行接口默认封装协议为ppp。<br>2.配置协商超时时间间隔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp timer negotiate seconds</span><br></pre></td></tr></table></figure>
<p>在PPPLCP协商过程中，本端设备会向对端设备发送LCP协商报文，如果在指定协商时间间隔内没有收到对端的应答报文，则重新发送。</p>
<h4 id="PAP认证配置命令"><a href="#PAP认证配置命令" class="headerlink" title="PAP认证配置命令"></a>PAP认证配置命令</h4><p>1.配置验证方以PAP方式认证对端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name password &#123; cipher | irreversible-cipher &#125; password</span><br><span class="line">[Huawei-aaa] local-user user-name service-type ppp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp authentication-mode pap</span><br></pre></td></tr></table></figure>
<p>配置验证方以PAP方式认证对端，首先需要通过AAA将被验证方的用户名和密码加入本地用户列表，然后选择认证模式。<br>2.配置被验证方以PAP方式被对端认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp pap local-user user-name password &#123; cipher simple &#125; password</span><br></pre></td></tr></table></figure>
<p>配置本地被对端以PAP方式验证时，本地发送PAP用户名和口令。</p>
<h4 id="CHAP认证配置命令"><a href="#CHAP认证配置命令" class="headerlink" title="CHAP认证配置命令"></a>CHAP认证配置命令</h4><p>1.配置验证方以CHAP方式认证对端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name password &#123; cipher | irreversible-cipher &#125; password</span><br><span class="line">[Huawei-aaa] local-user user-name service-type ppp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp authentication-mode chap</span><br></pre></td></tr></table></figure>
<p>2.配置被验证方以CHAP方式被对端认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp chap user user-name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Serial0&#x2F;0&#x2F;0] ppp chap password &#123; cipher | simple &#125; password</span><br></pre></td></tr></table></figure>
<p>配置本地用户名，配置本地被对端以CHAP方式验证时的口令。</p>
<h3 id="配置举例"><a href="#配置举例" class="headerlink" title="配置举例"></a>配置举例</h3><h4 id="配置举例-PAP认证"><a href="#配置举例-PAP认证" class="headerlink" title="配置举例- PAP认证"></a>配置举例- PAP认证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/17.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/18.png"></p>
<h4 id="配置举例-CHAP认证"><a href="#配置举例-CHAP认证" class="headerlink" title="配置举例-CHAP认证"></a>配置举例-CHAP认证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/19.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/20.png"></p>
<h2 id="PPPoE原理与配置"><a href="#PPPoE原理与配置" class="headerlink" title="PPPoE原理与配置"></a>PPPoE原理与配置</h2><h3 id="什么是PPPoE"><a href="#什么是PPPoE" class="headerlink" title="什么是PPPoE"></a>什么是PPPoE</h3><p>PPPoE ( PPP over Ethernet，以太网承载PPP协议)是一种把PPP帧封装到以太网帧中的链路层协议。PPPoE可以使以太网网络中的多台主机连接到远端的宽带接入服务器。</p>
<p>PPPoE集中了PPP和Ethernet两个技术的优点。既有以太网的组网灵活优势，又可以利用PPP协议实现认证、计费等功能。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/21.png"></p>
<h3 id="PPPoE应用场景"><a href="#PPPoE应用场景" class="headerlink" title="PPPoE应用场景"></a>PPPoE应用场景</h3><p>PPPoE实现了在以太网上提供点到点的连接。PPPoE客户端与PPPoE服务器端之间建立PPP会话，封装PPP数据报文，为以太网上的主机提供接入服务，实现用户控制和计费，在企业网络与运营商网络中应用广泛。</p>
<p>PPPoE的常见应用场景有家庭用户拨号上网、企业用户拨号上网等</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/22.png"></p>
<h3 id="PPPoE会话建立"><a href="#PPPoE会话建立" class="headerlink" title="PPPoE会话建立"></a>PPPoE会话建立</h3><p>PPPoE的会话建立有三个阶段，PPPoE发现阶段、PPPoE会话阶段和PPPoE终结阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/23.png"></p>
<h3 id="PPPoE报文"><a href="#PPPoE报文" class="headerlink" title="PPPoE报文"></a>PPPoE报文</h3><p>PPPoE会话的建立通过不同的PPPoE报文交互实现。PPPoE报文结构及常见的报文类型如下所示:</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/24.png"></p>
<h3 id="PPPoE发现阶段"><a href="#PPPoE发现阶段" class="headerlink" title="PPPoE发现阶段"></a>PPPoE发现阶段</h3><p>PPPoE协议发现有四个步骤:客户端发送请求、服务端响应请求、客户端确认响应和建立会话。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/25.png"></p>
<h3 id="PPPoE会话阶段"><a href="#PPPoE会话阶段" class="headerlink" title="PPPoE会话阶段"></a>PPPoE会话阶段</h3><p>PPPoE会话阶段会进行PPP协商，分为LCP协商、认证协商、NCP协商三个阶段。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/26.png"></p>
<h3 id="PPPoE会话终结阶段"><a href="#PPPoE会话终结阶段" class="headerlink" title="PPPoE会话终结阶段"></a>PPPoE会话终结阶段</h3><p>当PPPoE客户端希望关闭连接时，会向PPPoE服务器端发送一个PADT报文，用于关闭连接。同样，如果PPPoE服务器端希望关闭连接时，也会向PPPoE客户端发送一个PADT报文。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/27.png"></p>
<h3 id="PPPoE基础配置"><a href="#PPPoE基础配置" class="headerlink" title="PPPoE基础配置"></a>PPPoE基础配置</h3><p>1.通过拨号规则来配置发起PPPoE会话的条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] dialer-rule</span><br></pre></td></tr></table></figure>
<p>2.配置拨号接口用户名，此用户名必须与对端服务器用户名相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer user username</span><br></pre></td></tr></table></figure>
<p>3.将接口置于一个拨号访问组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer-group group-number</span><br></pre></td></tr></table></figure>
<p>4.指定当前拨号接口使用的拨号绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Dialer1]dialer-bundle number</span><br></pre></td></tr></table></figure>
<p>5.将物理端口与dialer-bundle进行绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-EthernetO&#x2F;0&#x2F;0]pppoe-client dial-bundle-number number</span><br></pre></td></tr></table></figure>

<h3 id="配置实例"><a href="#配置实例" class="headerlink" title="配置实例"></a>配置实例</h3><h4 id="配置实例-PPPoE客户端"><a href="#配置实例-PPPoE客户端" class="headerlink" title="配置实例-PPPoE客户端"></a>配置实例-PPPoE客户端</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/28.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/29.png"></p>
<h4 id="配置实例-PPPoE服务器端"><a href="#配置实例-PPPoE服务器端" class="headerlink" title="配置实例-PPPoE服务器端"></a>配置实例-PPPoE服务器端</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/30.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/31.png"></p>
<h4 id="配置验证"><a href="#配置验证" class="headerlink" title="配置验证"></a>配置验证</h4><p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/32.png"></p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/33.png"></p>
<h2 id="广域网技术的发展"><a href="#广域网技术的发展" class="headerlink" title="广域网技术的发展"></a>广域网技术的发展</h2><h3 id="传统IР路由转发"><a href="#传统IР路由转发" class="headerlink" title="传统IР路由转发"></a>传统IР路由转发</h3><p>传统的IP转发采用的是逐跳转发。数据报文经过每一台路由器，都要被解封装查看报又网络层信忌，然后依掂哈出取囚四乩原则查找路由表指导报文转发。各路由器重复进行解封装查找路由表和再封装的过程，所以转发性能低。</p>
<p>传统IP路由转发的特点:</p>
<ul>
<li>所有路由器需要知道全网的路由。</li>
<li>传统lP转发是面向无连接的，无法提供较好的端到端QoS保证。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/34.png"></p>
<h3 id="MPLS标签转发"><a href="#MPLS标签转发" class="headerlink" title="MPLS标签转发"></a>MPLS标签转发</h3><ul>
<li>MPLS是一种IP骨干网技术。</li>
<li>MPLS是种隧道技术，在IP路由和控制协议的基础上，向网络层提供面向连接的交换。能够提供较好的QoS保证。</li>
<li>MPLS标签指导报文转发的过程中，使用本地标签查找替代传统IP转发的路由查找，大大提高转发效率。</li>
<li>MPLS转发过程中使用的标签，既可以通过手工静态配置，又可以通过动态标签分发协议分配。</li>
</ul>
<p>MPLS的标签分发有静态和动态两种方式，均面临着不同的问题</p>
<ul>
<li>静态标签分发为手工配置。</li>
<li>动态标签分发的问题。</li>
</ul>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/35.png"></p>
<h3 id="Segment-Routing简介"><a href="#Segment-Routing简介" class="headerlink" title="Segment Routing简介"></a>Segment Routing简介</h3><p>为解决传统IP转发和MPLS转发的问题，业界提出了SR ( Segment Routing，分段路由）。SR的转发机制有很大改进，主要体现在以下几个方面:</p>
<p>1.基于现有协议进行扩展:</p>
<ul>
<li>扩展后的IGP/BGP具有标签分发能力，因此网络中无需其他任何标签分发协议，实现协议简化。</li>
</ul>
<p>2.引入源路由机制:</p>
<ul>
<li>基于源路由机制，支持通过控制器进行集中算路。</li>
</ul>
<p>3.由业务来定义网络:</p>
<ul>
<li>业务驱动网络，由应用提出需求（时延、带宽、丢包率等），控制器收集网络拓扑、带宽利用率、时延等信息，根据业务需求计算显式路径。</li>
</ul>
<h3 id="Segment-Routing转发原理"><a href="#Segment-Routing转发原理" class="headerlink" title="Segment Routing转发原理"></a>Segment Routing转发原理</h3><p>SR将网络路径分成一个个的段( Segment )，并且为这些段分配SID ( Segment ID ) 。</p>
<p>SID的分配对象有两种，转发节点或者邻接链路。本例中转发节点SID 1600X，X为路由器编号;邻接链路SID160xx，XX表示链路两端的节点编号。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/36.png"></p>
<p>邻接链路和网络节点的SID有序排列形成段序列( Segment List )，它代表一条转发路径。SR由源节点将段序列编码在数据包头部，随数据包传输。SR的本质是指令，指引报文去哪里和怎么去。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/37.png"></p>
<h3 id="SR的部署方式"><a href="#SR的部署方式" class="headerlink" title="SR的部署方式"></a>SR的部署方式</h3><p>SR部署分为有控制器部署和无控制器部署。控制器配合方式由控制<br>器收集信息，预留路径资源和计算路径，最后将结果下发到头结点，是更为推荐的部署方式。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/38.png"></p>
<h3 id="Seg-ment-Routing的应用"><a href="#Seg-ment-Routing的应用" class="headerlink" title="Seg ment Routing的应用"></a>Seg ment Routing的应用</h3><p>SR可以简易的指定的报文转发路径，在现网中可以为不同业务定义不同的路径。例如本例定义了数据下载、视频和语音三条显式路径，实现了业务驱动网络。设备由控制器纳管，支持路径实时快速发放。</p>
<p><img src="/2021/05/02/%E5%B9%BF%E5%9F%9F%E7%BD%91%E6%8A%80%E6%9C%AF/39.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/NFV/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/NFV/" itemprop="url">NFV</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T12:03:39+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="NFV的背景-同样来自IT行业变革的启示"><a href="#NFV的背景-同样来自IT行业变革的启示" class="headerlink" title="NFV的背景:同样来自IT行业变革的启示"></a>NFV的背景:同样来自IT行业变革的启示</h2><p>来自IT界的启示，给网络产业带来了网络架构和设备架构两个层面的思考。网络架构层面引入对SDN控制器的思考，设备架构层面引入对设备部署形态的思考。</p>
<h3 id="IT产业的变革"><a href="#IT产业的变革" class="headerlink" title="IT产业的变革"></a>IT产业的变革</h3><p>近年虚拟化和云计算等IT技术蓬勃发展，传统部署于硬件的应用逐渐云化。应用以软件的方式部署于私有云、公有云或者混合云上。</p>
<p><img src="/2021/05/02/NFV/1.png"></p>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ul>
<li>网络产业思考:能否以软件化的方式部署网络应用呢?</li>
<li>这些思考引发了NFV ( Network Functions Virtualization，网络功能虚拟化）。</li>
</ul>
<h2 id="NFV的起源"><a href="#NFV的起源" class="headerlink" title="NFV的起源"></a>NFV的起源</h2><ul>
<li>2012年10月，13家Top运营商(AT&amp;T、Verizon、VDF、DT、T-Mobile、BT、Telefonica等）在SDN和Open Flow世界大会上发布NFV ( Network Functions Virtualization )第一版白皮书，同时成立了ISG ( Industry Specification Group )来推动网络虚拟化的需求定义和系统架构制定。</li>
<li>2013年，ETSI下NFV ISG(行业规范工作组)进行第一阶段研究，已完成相关标准制定。主要定义网络功能虚拟化的需求和架构，并梳理不同接口的标准化进程。</li>
</ul>
<p><img src="/2021/05/02/NFV/2.png"></p>
<h2 id="NFV的价值"><a href="#NFV的价值" class="headerlink" title="NFV的价值"></a>NFV的价值</h2><p>NFV ( Network Functions Virtualization )是运营商为了解决电信网络硬件繁多、部署运维复杂、业务创新困难等问题而提出的。NFV在重构电信网络的同时，给运营商带来的价值如下:</p>
<ul>
<li>缩短业务上线时间</li>
<li>降低建网成本</li>
<li>提升网络运维效率</li>
<li>构建开放的生态系统</li>
</ul>
<h2 id="NFV关键技术-虚拟化"><a href="#NFV关键技术-虚拟化" class="headerlink" title="NFV关键技术:虚拟化"></a>NFV关键技术:虚拟化</h2><ul>
<li>在NFV的道路上，虚拟化是基础，云化是关键。</li>
<li>传统电信网络中，各个网元都是由专用硬件实现，成本高、运维难。虚拟化具有分区、隔离、封装和相对于硬件独立的特征，能够很好匹配NFV的需求。运营商引入此模式，将网元软件化，运行在通用基础设施上。</li>
</ul>
<p><img src="/2021/05/02/NFV/3.png"></p>
<h2 id="NFV关键技术-云化"><a href="#NFV关键技术-云化" class="headerlink" title="NFV关键技术:云化"></a>NFV关键技术:云化</h2><ul>
<li>美国国家标准与技术研究院（NIST）定义︰云计算是一种模型，它可以实现随时随地，便捷地，随需应变地从可配置计算资源共享池中获取所需的资源（例如，网络、服务器、存储、应用、及服务），资源能够快速供应并释放，使管理资源的工作量和与服务提供商的交互减小到最低限度。</li>
<li>云计算拥有诸多好处。运营商网络中网络功能的云化更多的是利用了资源池化和快速弹性伸缩两个特征。</li>
</ul>
<p><img src="/2021/05/02/NFV/4.png"></p>
<h2 id="NFV架构间介"><a href="#NFV架构间介" class="headerlink" title="NFV架构间介"></a>NFV架构间介</h2><p>NFV架构分NFVI ( Network Functions Virtualization Infrastructure，基础设施层)、VNF ( Virtualized Network Function，虚拟化网络功能层）和MANO ( Management and Orchestration，管理编排域)，同还要支持现有的BSS/OSS ( Business support system/ Operation support system )。</p>
<p><img src="/2021/05/02/NFV/5.png"></p>
<h2 id="NFV的标准架构"><a href="#NFV的标准架构" class="headerlink" title="NFV的标准架构"></a>NFV的标准架构</h2><p>ETSI定义了NFV标准架构，由NFVI、VNF以及MANO主要组件组成。NFVI包括通用的硬件设施及其虚书化，VNF使用软件实现虚拟化网络功能，MANO实现NFV架构的管理和编排。</p>
<p><img src="/2021/05/02/NFV/6.png"></p>
<h2 id="NFV架构功能模块"><a href="#NFV架构功能模块" class="headerlink" title="NFV架构功能模块"></a>NFV架构功能模块</h2><p>NFV标准架构定义的主要功能模块:</p>
<p>**OSS/BSS **</p>
<p>服务提供商的管理功能，不属于NFV框架内的功能组件，但MANO和网元需要提供对OSS/BSS 的接口支持。</p>
<p><strong>MANO</strong></p>
<p>NFV管理和编排。包括VIM，VNFM及NFVO，提供对VNF及l层统一的管理和编排功能。</p>
<ul>
<li>VIM: Virtualized Infrastructure Managers，NFVI官理候坎，应市1于APP1oor0 I/ANIE笞理塔快功能包括:资源的发现、虚拟资源的管理分配、故障处理等。VNFM: VNF Managers , VNF管理模块，主要对VNF的生命周期（实例化、配置、关闭等）进行控制。</li>
<li>NFVO: NFV Orchestration，实现对整个NFV基础架构、软件资源、网络服务的编排和管理。</li>
</ul>
<p><strong>VNF</strong></p>
<p>指虚拟机及部署在虚拟机上的业务网元、网络功能软件等。</p>
<p><strong>NFVI</strong></p>
<p>NFV基础设施,包括所需的硬件及软件。为VNF提供运行环境. </p>
<ul>
<li>Hardware:硬件层，包括提供计算、网络、存储资源能力的硬件设备。</li>
<li>Virtualization Layer:虚拟化层，主要完成对硬件资源的抽象，形成虚拟资源，如虚拟计算资源、虚拟存储资源、虚拟网络资源。其虚拟化功能由Hypervisor实现。</li>
</ul>
<h2 id="NFV架构接口"><a href="#NFV架构接口" class="headerlink" title="NFV架构接口"></a>NFV架构接口</h2><p>NFV标准架构的主要接口:</p>
<p><img src="/2021/05/02/NFV/8.png"></p>
<h2 id="华为NFV解决方案"><a href="#华为NFV解决方案" class="headerlink" title="华为NFV解决方案"></a>华为NFV解决方案</h2><ul>
<li>华为NFV架构中，虚拟化层及VIM的功能由华为云Stack NFVI平台实现。华为云Stack可以实现计算资源、存储资源和网络资源的全面虚拟化，并能够对物理硬件虚拟化资源进行统一的管理、监控和优化。</li>
<li>华为提供运营商无线网、承载网、传输网、接入网、核心网等全面云化的解决方案。</li>
</ul>
<p><img src="/2021/05/02/NFV/7.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/SDN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/SDN/" itemprop="url">SDN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T12:03:32+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="传统网络的缺点"><a href="#传统网络的缺点" class="headerlink" title="传统网络的缺点"></a>传统网络的缺点</h2><h3 id="计算机时代的演进"><a href="#计算机时代的演进" class="headerlink" title="计算机时代的演进"></a>计算机时代的演进</h3><p><img src="/2021/05/02/SDN/1.png"></p>
<h3 id="网络产业发展-来自IT行业的启示"><a href="#网络产业发展-来自IT行业的启示" class="headerlink" title="网络产业发展:来自IT行业的启示"></a>网络产业发展:来自IT行业的启示</h3><ul>
<li>IT产业的变革引发了网络产业的思考。业界开始提出SDN (Software Defined Networking )的概念，并不断在其商用化进程上作出尝试。目的是希望网络变得更开放、灵活和简单。</li>
</ul>
<p><img src="/2021/05/02/SDN/2.png"></p>
<h3 id="网络界的现状-经典IP网络–分布式网络"><a href="#网络界的现状-经典IP网络–分布式网络" class="headerlink" title="网络界的现状:经典IP网络–分布式网络"></a>网络界的现状:经典IP网络–分布式网络</h3><ul>
<li>经典的IP网络是一个分布式的、对等控制的网络。每台网络设备存在独立的数据平台、控制平面和管理平面.设备的控制平面对等的交互路由协议，然后独立的生成数据平面指导报文转发。</li>
<li>经典IP网络的优势在于设备与协议解耦，厂家之间兼容性较好且故障场景下协议保证网络收敛。</li>
</ul>
<p><img src="/2021/05/02/SDN/3.png"></p>
<h3 id="网络界的思考-经典网络面临的问题"><a href="#网络界的思考-经典网络面临的问题" class="headerlink" title="网络界的思考:经典网络面临的问题"></a>网络界的思考:经典网络面临的问题</h3><h4 id="网络易拥塞"><a href="#网络易拥塞" class="headerlink" title="网络易拥塞"></a>网络易拥塞</h4><p><img src="/2021/05/02/SDN/4.png"></p>
<h4 id="网络技术太复杂"><a href="#网络技术太复杂" class="headerlink" title="网络技术太复杂"></a>网络技术太复杂</h4><p>网络协议多︰如果您准备成为一名网络技术专家，您需要阅读网络设备相关RFC 2500篇。如果一天阅读一篇，需要长达6年时间，而这只是整个RFC的 1/3，其数量还在持续增加。</p>
<p>网络配置难:如果您准备成为某个设备商设备的百事通，您需要掌握的命令行超过10000条，而其数量还在增加。</p>
<p><img src="/2021/05/02/SDN/5.png"></p>
<h4 id="网络故障定位、诊断困难"><a href="#网络故障定位、诊断困难" class="headerlink" title="网络故障定位、诊断困难"></a>网络故障定位、诊断困难</h4><p><img src="/2021/05/02/SDN/6.png"></p>
<h4 id="网络业务的部署速度太慢"><a href="#网络业务的部署速度太慢" class="headerlink" title="网络业务的部署速度太慢"></a>网络业务的部署速度太慢</h4><p><img src="/2021/05/02/SDN/7.png"></p>
<h2 id="SDN定义"><a href="#SDN定义" class="headerlink" title="SDN定义"></a>SDN定义</h2><h3 id="SDN的起源"><a href="#SDN的起源" class="headerlink" title="SDN的起源"></a>SDN的起源</h3><ul>
<li>SDN ( Software Defined Networking )即软件定义网络。是由斯坦福大学Clean Slate研究组提出的一种新型网络创新架构。其核心理念通过将网络设备控制平面与数据平面分离，从而实现了网络控制平面的集中控制，为网络应用的创新提供了良好的支撑。</li>
<li>SDN起源提出了三个特征，“转控分离”、“集中控制”和“开放可编程接口”。</li>
</ul>
<p><img src="/2021/05/02/SDN/8.png"></p>
<h3 id="OpenFlow基本概念"><a href="#OpenFlow基本概念" class="headerlink" title="OpenFlow基本概念"></a>OpenFlow基本概念</h3><p>OpenFlow是控制器与交换机之间的一种南向接口协议。它定义了三种类型的消息，Controller-to-Switch、Asynchronous和Symmetric。每一种消息又包含了更多的子类型。</p>
<p><strong>Controller-to-Switch</strong><br>该消息由Controller发送。用于管理Switch和查询Switch的相关信息。<br><strong>Asynchronous</strong><br>该消息由Switch发起。当Switch状态发生改变时，发送该消息告诉Controller状态变化。<br><strong>Symmetric</strong><br>该消息没有固定发起方，可由Switch或者Controller发起。例如Hello、Echo、Error等。</p>
<p><img src="/2021/05/02/SDN/9.png"></p>
<h3 id="Flow-Table简介"><a href="#Flow-Table简介" class="headerlink" title="Flow Table简介"></a>Flow Table简介</h3><ul>
<li>OpenFlow交换机基于流表(Flow Table )转发报文。</li>
<li>每个流表项由匹配字段、优先级、计数器、指令、超时、Cookie、Flags这七部分组成。其中关于转发的关键的两个内容是匹配字段和指令。<ul>
<li>匹配字段是匹配规则，支持自定义。</li>
<li>指令是用来描述匹配后的处理方式。</li>
</ul>
</li>
</ul>
<p><img src="/2021/05/02/SDN/10.png"></p>
<h3 id="转发方式对比"><a href="#转发方式对比" class="headerlink" title="转发方式对比"></a>转发方式对比</h3><h4 id="经典路由协议基于路由表转发"><a href="#经典路由协议基于路由表转发" class="headerlink" title="经典路由协议基于路由表转发"></a>经典路由协议基于路由表转发</h4><ul>
<li>经典的网络转发方式是网络设备通过查询路由表指导流量转发。</li>
<li>路由表的条目由网络设备之间运行路由协议而计算生成。</li>
<li>路由表是定长的。路由表通过最长匹配原则执行报文转发。一台网络设备只有一张路由表。</li>
</ul>
<h4 id="OpenFlow基于流表转发"><a href="#OpenFlow基于流表转发" class="headerlink" title="OpenFlow基于流表转发"></a>OpenFlow基于流表转发</h4><p><img src="/2021/05/02/SDN/12.png"></p>
<ul>
<li>OpenFlow是一个网络协议。运行OpenFlow的交换机通过查询流表指导流量转发。</li>
<li>流表一般是由OF控制器统一计算，然后下发到交换机。流表是</li>
<li>变长的，拥有丰富的匹配规则和转发规则。一台网络设备有多张流表。</li>
</ul>
<h3 id="SDN的本质诉求"><a href="#SDN的本质诉求" class="headerlink" title="SDN的本质诉求"></a>SDN的本质诉求</h3><ul>
<li>SDN的本质诉求是让网络更加开放、灵活和简单。它的实现方式是为网络构建一个集中的大脑，通过全局视图集中控制，实现或业务快速部署、或流量调优、或网络业务开放等目标</li>
</ul>
<p>SDN的价值是:</p>
<ul>
<li><p>集中管理，简化网络管理与运维;</p>
</li>
<li><p>屏蔽技术细节，降低网络复杂度，降低运维成本;。自动化调优，提高网络利用率;</p>
</li>
<li><p>快速业务部署，缩短业务上线时间;</p>
</li>
<li><p>网络开放，支撑开放可编程的第三方应用。</p>
</li>
</ul>
<blockquote>
<p>SDN带来了网络架构的变革。</p>
</blockquote>
<h3 id="SDN网络架构"><a href="#SDN网络架构" class="headerlink" title="SDN网络架构"></a>SDN网络架构</h3><p>SDN网络架构分为协同应用层、控制器层和设备层。不同层次之间通过开放接口连接。以控制器层为主要视角，区分面向设备层的南向接口和面向协同应用层的北向接口。OpenFlow属于南向接口协议的一种。</p>
<p><img src="/2021/05/02/SDN/13.png"></p>
<h3 id="华为SDN网络架构"><a href="#华为SDN网络架构" class="headerlink" title="华为SDN网络架构"></a>华为SDN网络架构</h3><p>华为SDN网络架构支持丰富的南北向接口，包括OpenFlow、OVSDB、NETCONF、PCEP、RESTful .SNMP、BGP、JsonRPC、RESTCONF等。</p>
<p><img src="/2021/05/02/SDN/14.png"></p>
<h3 id="华为SDN解决方案-管、控、析构建智简网络"><a href="#华为SDN解决方案-管、控、析构建智简网络" class="headerlink" title="华为SDN解决方案-管、控、析构建智简网络"></a>华为SDN解决方案-管、控、析构建智简网络</h3><p><img src="/2021/05/02/SDN/15.png"></p>
<h2 id="iMaster-NCE解决方案"><a href="#iMaster-NCE解决方案" class="headerlink" title="iMaster NCE解决方案"></a>iMaster NCE解决方案</h2><h3 id="什么是iMaster-NCE"><a href="#什么是iMaster-NCE" class="headerlink" title="什么是iMaster NCE ?"></a>什么是iMaster NCE ?</h3><p>iMaster NCE，自动驾驶网络管理与控制系统，是华为集管理、控制、分析和Al智能功能于一体的网络自动化与智能化平台。</p>
<p><img src="/2021/05/02/SDN/16.png"></p>
<h3 id="iMaster-NCE种类"><a href="#iMaster-NCE种类" class="headerlink" title="iMaster NCE种类"></a>iMaster NCE种类</h3><p><img src="/2021/05/02/SDN/17.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/" itemprop="url">网络编程与自动化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T10:50:27+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络编程与自动化"><a href="#网络编程与自动化" class="headerlink" title="网络编程与自动化"></a>网络编程与自动化</h2><h3 id="背景-传统网络运维困境"><a href="#背景-传统网络运维困境" class="headerlink" title="背景:传统网络运维困境"></a>背景:传统网络运维困境</h3><p>传统的网络运维工作需要网络工程师手动登录网络设备，人工查看和执行配置命令，肉眼筛选配置结果。这种严重依赖“人”的工作方式操作流程长，效率低下，而且操作过程不易审计。</p>
<p>经典运维场景</p>
<ol>
<li>设备升级∶现网有数千台网络设备，你需要周期性、批量<br>性地对设备进行升级。</li>
<li>配置审计:企业年度需要对设备进行配置审计。例如要求<br>所有设备开启Telnet功能，以太网交换机配置生成树安全功能。你需要快速地找出不符合要求的设备。</li>
<li>配置变更:因为网络安全要求，需要每三个月修改设备账<br>号和密码。你需要在数干台网络设备上删除原有账号并新建账号。</li>
</ol>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/1.png"></p>
<h3 id="网络自动化"><a href="#网络自动化" class="headerlink" title="网络自动化"></a>网络自动化</h3><ul>
<li>网络自动化，通过工具实现网络自动化地部署、运行和运维，逐步减少对“人”的依赖。这能够很好地解决传统网络运维的问题。</li>
<li>业界有很多实现网络自动化的开源工具，例如Ansible、SaltStack、Puppet、Chef等。从网络工程能力构建的角度考虑，更推荐工程师具备代码编程能力。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/2.png"></p>
<h3 id="基于编程实现的网络自动化"><a href="#基于编程实现的网络自动化" class="headerlink" title="基于编程实现的网络自动化"></a>基于编程实现的网络自动化</h3><ul>
<li>近几年随着网络自动化技术的兴起，以Python为主的编程能力成为了网络工程师的新技能要求。</li>
<li>Python编写的自动化脚本能够很好的执行重复、耗时、有规则的操作。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/3.png"></p>
<h2 id="编程语言概述"><a href="#编程语言概述" class="headerlink" title="编程语言概述"></a>编程语言概述</h2><h3 id="编程语言"><a href="#编程语言" class="headerlink" title="编程语言"></a>编程语言</h3><ul>
<li>编程语言（Programming Language )，是一种用于编写计算机程序的语言，用于控制计算机的行为。</li>
<li>按照语言在执行之前是否需要编译区分，可以将编程语言分为需要编译的编译型语言(Compiled Language)，不需要编译的解释型语言( Interpreted Language )。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/4.png"></p>
<h3 id="计算技术栈与程序执行过程"><a href="#计算技术栈与程序执行过程" class="headerlink" title="计算技术栈与程序执行过程"></a>计算技术栈与程序执行过程</h3><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/5.png"></p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/6.png"></p>
<h3 id="高级编程语言–编译型语言"><a href="#高级编程语言–编译型语言" class="headerlink" title="高级编程语言–编译型语言"></a>高级编程语言–编译型语言</h3><ul>
<li>编译型语言︰编译型语言的程序在执行之前有一个编译过程，把程序编译成为机器语言的文件。运行时不需要重新翻译，直接使用编译的结果。典型的如C/C++/Go语言，都属于编译型语言。</li>
<li>从源码到程序的过程:源码需要由编译器、汇编器翻译成机器指令，再通过链接器链接库函数生成机器语言程序。机器语言必须与CPU的指令集匹配，在运行时通过加载器加载到内存，由CPU执行指令。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/7.png"></p>
<h3 id="高级编程语言–解释型语言"><a href="#高级编程语言–解释型语言" class="headerlink" title="高级编程语言–解释型语言"></a>高级编程语言–解释型语言</h3><ul>
<li>解释型语言∶解释型语言的程序不需要在运行前编译，在运行程序的时候才逐行翻译。典型的如Java/Python语言，都属于解释型语言。</li>
<li>从源码到程序的过程:解释型语言的源代码由编译器生成字节码，然后再由虚拟机（JVM/PVM）解释执行。虚拟机将不<br>同CPU指令集的差异屏蔽，因此解释型语言的可移植性相对较好。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/8.png"></p>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>.Python是一门完全开源的高级编程语言。它的作者是Guido Van Rossum。</p>
<h3 id="Python的优缺点"><a href="#Python的优缺点" class="headerlink" title="Python的优缺点"></a>Python的优缺点</h3><p>优点：</p>
<ul>
<li>Python拥有优雅的语法、动态类型具有解释性质。能够让学习者从语法细节的学习中抽离，专注于程序逻辑。</li>
<li>Python同时支持面向过程和面向对象的编程。</li>
<li>Python拥有丰富的第三方库。</li>
<li> Python可以调用其他语言所写的代码，又被称为胶水语言。</li>
</ul>
<p>缺点：</p>
<ul>
<li>运行速度慢。Python是解释型语言,不需要编译即可运行。代码在运行时会逐行地翻译成CPU能理解的机器码这个翻译过程非常耗时。</li>
</ul>
<p>由于Python具有非常丰富的第三方库，加上Python语言本身的优点，所以Python可以在非常多的领域内使用:人工智能、数据科学、APP、自动化运维脚本等。</p>
<h3 id="Python代码执行过程"><a href="#Python代码执行过程" class="headerlink" title="Python代码执行过程"></a>Python代码执行过程</h3><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/9.png"></p>
<h3 id="Python运行方式"><a href="#Python运行方式" class="headerlink" title="Python运行方式"></a>Python运行方式</h3><p>Python有两种运行方式，交互式运行和脚本式运行。</p>
<h4 id="交互式运行"><a href="#交互式运行" class="headerlink" title="交互式运行"></a>交互式运行</h4><p>交互式编程不需要创建脚本文件，是通过Python解释器的交互模式编写代码。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/10.png"></p>
<h4 id="脚本式运行"><a href="#脚本式运行" class="headerlink" title="脚本式运行"></a>脚本式运行</h4><p>脚本模式里的代码可以在各种Python编译器或者集成开发环境上运行。例如Python自带的IDLE、Atom、Visual Studio、Pycharm和Anaconda等。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/11.png"></p>
<h3 id="Python编码规范"><a href="#Python编码规范" class="headerlink" title="Python编码规范"></a>Python编码规范</h3><ul>
<li>编码规范是使用Python编写代码时应遵守的命名规则、代码缩进、代码和语句分割方式等。良好的编码规范<br>有助于提高代码的可读性，便于代码的维护和修改。</li>
<li>例如分号、圆括号、空行和空格的使用规范建议如下:</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/12.png"></p>
<h4 id="Python编码规范-标识符命名"><a href="#Python编码规范-标识符命名" class="headerlink" title="Python编码规范-标识符命名"></a>Python编码规范-标识符命名</h4><ul>
<li>Python标识符用于表示常量、变量、函数以及其他对象的名称。</li>
<li>标识符通常由字母、数字和下划线组成，但不能以数字开头。标识符大小写敏感，不允许重名。如果标识符不符合规则，编译器运行代码时会输出SyntaxError语法错误。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/13.png"></p>
<h4 id="Python编码规范-代码缩进"><a href="#Python编码规范-代码缩进" class="headerlink" title="Python编码规范-代码缩进"></a>Python编码规范-代码缩进</h4><ul>
<li>在Python程序中，代码缩进代表代码块的作用域。如果一个代码块包含两个或更多的语句，则这些语句必须具有相同的缩进量。对于Python而言代码缩进是一种语法规则，它使用代码缩进和冒号来区分代码之间的层次。</li>
<li>编写代码时候，建议使用4个空格来生成缩进。如果程序代码中使用了错误的缩进，则会在运行中发出IndentationError错误信息。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/14.png"></p>
<h4 id="Python编码规范-使用注释"><a href="#Python编码规范-使用注释" class="headerlink" title="Python编码规范-使用注释"></a>Python编码规范-使用注释</h4><ul>
<li>注释就是在程序中添加解释说明，能够增强程序的可读性。在Python程序中，注释分为单行注释和多行注释。</li>
<li>单行注释以#字符开始直到行尾结束。</li>
<li>多行注释内容可以包含多行，这些内容包含在一对三引号内(“…””或者”””…”””)。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/15.png"></p>
<h4 id="Python编码规范–源码文件结构"><a href="#Python编码规范–源码文件结构" class="headerlink" title="Python编码规范–源码文件结构"></a>Python编码规范–源码文件结构</h4><ul>
<li>一个完整的Python源码文件一般包含几个组成部分︰解释器和编码格式声明、文档字符串、模块导入和运行代码。</li>
<li>如果会在程序中调用标准库或其他第三方库的类时，需要先使用import或from…. import语句导入相关的模块。导入语句始终在文件的顶部。在模块注释或文档字符串(docstring)之后。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/16.png"></p>
<h3 id="Python的函数与模块"><a href="#Python的函数与模块" class="headerlink" title="Python的函数与模块"></a>Python的函数与模块</h3><ul>
<li>函数(Function)是组织好的、可重复使用的一段代码。它能够提高程序的模块化程度和代码利用率。函数使用关键字def定义。</li>
<li>模块(Module)是一个保存好的Python文件。模块可以由函数或者类组成。模块和常规Python程序之间的唯一区别是用途不同:模块用于被其他程序调用。因此，模块通常没有main函数。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/17.png"></p>
<h3 id="Python的类与方法"><a href="#Python的类与方法" class="headerlink" title="Python的类与方法"></a>Python的类与方法</h3><ul>
<li>类(Class)是用来描述具有一类相同的属性和方法的集合。类的定义使用关键字class。</li>
<li>被实例化的类的”函数”被称作方法(Method)。类定义方法时候必须携带 self 关键字，它表示类的实例本身。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/18.png"></p>
<h3 id="telnetlib介绍"><a href="#telnetlib介绍" class="headerlink" title="telnetlib介绍"></a>telnetlib介绍</h3><p>telnetlib是Python标准库中的模块。它提供了实现Telnet功能的类telnetlib.Telnet。这里通过调用telnetlib.Telnet类里的不同方法实现不同功能。</p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/19.png"></p>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/20.png"></p>
<h3 id="案例-使用telnetlib登陆设备"><a href="#案例-使用telnetlib登陆设备" class="headerlink" title="案例:使用telnetlib登陆设备"></a>案例:使用telnetlib登陆设备</h3><h4 id="案例描述"><a href="#案例描述" class="headerlink" title="案例描述"></a>案例描述</h4><ul>
<li>现有一台网络设备作为Telnet服务器，需要实现使用Python telnetlib作为Telnet客户端登录此设备。</li>
</ul>
<p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/21.png"></p>
<p>实现过程分为四个步骤:</p>
<ul>
<li><p>配置设备Telnet服务。</p>
</li>
<li><p>手动验证和查看Telnet登录步骤，作为代码实现的参考。</p>
</li>
<li><p>编写和运行Python代码。</p>
</li>
<li><p>验证结果。</p>
</li>
</ul>
<h4 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h4><h5 id="配置设备Telnet"><a href="#配置设备Telnet" class="headerlink" title="配置设备Telnet"></a>配置设备Telnet</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/22.png"></p>
<h5 id="查看Telent登录步骤"><a href="#查看Telent登录步骤" class="headerlink" title="查看Telent登录步骤"></a>查看Telent登录步骤</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/23.png"></p>
<h5 id="编写Python代码"><a href="#编写Python代码" class="headerlink" title="编写Python代码"></a>编写Python代码</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/24.png"></p>
<h5 id="运行结果对比"><a href="#运行结果对比" class="headerlink" title="运行结果对比"></a>运行结果对比</h5><p><img src="/2021/05/02/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/25.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/02/IP%E8%B7%AF%E7%94%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/02/IP%E8%B7%AF%E7%94%B1/" itemprop="url">IP路由</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-02T08:53:42+08:00">
                2021-05-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="路由概述"><a href="#路由概述" class="headerlink" title="路由概述"></a>路由概述</h2><h3 id="背景-网段间通信"><a href="#背景-网段间通信" class="headerlink" title="背景:网段间通信"></a>背景:网段间通信</h3><ul>
<li>IP地址唯一标识了网络中的一个节点，每个IP地址都拥有自己的网段，各个网段可能分布在网络的不同区域。</li>
<li>为实现IP寻址，分布在不同区域的网段之间要能够相互通信。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/3.png"></p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><ul>
<li>路由是指导报文转发的路径信息，通过路由可以确认转发IP报文的路径。</li>
<li>路由设备是依据路由转发报文到目的网段的网络设备，最常见的路由设备:路由器。</li>
<li>路由设备维护着一张路由表，保存着路由信息。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/1.png"></p>
<h3 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h3><ul>
<li>路由器通过各种方式发现路由</li>
<li>路由器选择最优的路由条目放入路由表中</li>
<li>路由表指导设备对IP报文的转发</li>
<li>路由器通过对路由表的管理实现对路径信息的管理</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/2.png"></p>
<h3 id="路由信息获取方式"><a href="#路由信息获取方式" class="headerlink" title="路由信息获取方式"></a>路由信息获取方式</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/4.png"></p>
<h3 id="最优路由条目优选"><a href="#最优路由条目优选" class="headerlink" title="最优路由条目优选"></a>最优路由条目优选</h3><h4 id="查看路由表"><a href="#查看路由表" class="headerlink" title="查看路由表"></a>查看路由表</h4><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/7.png"></p>
<h4 id="路由表中各个内容的含义"><a href="#路由表中各个内容的含义" class="headerlink" title="路由表中各个内容的含义"></a>路由表中各个内容的含义</h4><ul>
<li>Destination/Mask:︰表示此路由的目的网络地址与网络掩码。将目的地址和子网掩码“逻辑与”后可得到目的主机或路由器所在网段的地址。例如:目的地址为1.1.1.1，掩码为255.255.255.0的主机或路由器所在网段的地址为1.1.1.0</li>
<li>. Proto ( Protocol )∶该路由的协议类型，也即路由器是通过什么协议获知该路由的。</li>
<li>pre ( Preference)∶表示此路由的路由协议优先级。针对同一目的地，可能存在不同下一跳、出接口等多条路由，这些不同的路由可能是由不同的路由协议发现的，也可以是手工配置的静态路由。优先级最高（数值最小)者将成为当前的最优路由。</li>
<li>Cost:路由开销。当到达同一目的地的多条路由具有相同的路由优先级时，路由开销最小的将成为当前的最优路由。</li>
<li>NextHop:表示对于本路由器而言，到达该路由指向的目的网络的下一跳地址。该字段指明了数据转发的下一个设备。</li>
<li>Interface:表示此路由的出接口。指明数据将从本路由器的哪个接口转发出去。</li>
</ul>
<h4 id="路由优先级"><a href="#路由优先级" class="headerlink" title="路由优先级"></a>路由优先级</h4><h5 id="优先级比较"><a href="#优先级比较" class="headerlink" title="优先级比较"></a>优先级比较</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/8.png"></p>
<h5 id="比较示例"><a href="#比较示例" class="headerlink" title="比较示例"></a>比较示例</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/9.png"></p>
<h5 id="优先级默认数值"><a href="#优先级默认数值" class="headerlink" title="优先级默认数值"></a>优先级默认数值</h5><p>常见路由类型的默认优先级如下:</p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/10.png"></p>
<h4 id="度量值"><a href="#度量值" class="headerlink" title="度量值"></a>度量值</h4><h5 id="度量值比较"><a href="#度量值比较" class="headerlink" title="度量值比较"></a>度量值比较</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/11.png"></p>
<h5 id="比较示例-1"><a href="#比较示例-1" class="headerlink" title="比较示例"></a>比较示例</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/12.png"></p>
<h3 id="路由转发"><a href="#路由转发" class="headerlink" title="路由转发"></a>路由转发</h3><h4 id="最长掩码匹配原则"><a href="#最长掩码匹配原则" class="headerlink" title="最长掩码匹配原则"></a>最长掩码匹配原则</h4><ul>
<li>当路由器收到一个IP数据包时，会将数据包的目的IP地址与自己本地路由表中的所有路由表项进行逐位（Bit-By-Bit)比对，直到找到掩码匹配度最长的条目，这就是最长前缀匹配机制。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/13.png"></p>
<h4 id="最长匹配示例"><a href="#最长匹配示例" class="headerlink" title="最长匹配示例"></a>最长匹配示例</h4><h5 id="示例1"><a href="#示例1" class="headerlink" title="示例1"></a>示例1</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/14.png"></p>
<h5 id="示例2"><a href="#示例2" class="headerlink" title="示例2"></a>示例2</h5><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/15.png"></p>
<h4 id="路由转发流程"><a href="#路由转发流程" class="headerlink" title="路由转发流程"></a>路由转发流程</h4><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/16.png"></p>
<h2 id="直连路由"><a href="#直连路由" class="headerlink" title="直连路由"></a>直连路由</h2><ul>
<li>直连路由指向本地直连网络的路由，由设备自动生成。</li>
<li>当路由器为路由转发的最后一跳路由器时，IP报文匹配直连路由，路由器转发IP报文到目的主机。</li>
<li>使用直连路由进行路由转发时，报文的目的IP和路由器接口IP在一个网段之中。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/5.png"></p>
<ul>
<li>并不是所有接口生成的直连路由都会出现在路由表中，直连路由出现在路由表中的前提是该接口的物理状态、协议状态都为UP。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/6.png"></p>
<h2 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h2><h3 id="静态路由定义"><a href="#静态路由定义" class="headerlink" title="静态路由定义"></a>静态路由定义</h3><p>通过手工配置一条路由，加入到设备路由表中，相当于人工加入一条寻址路径，帮助设备进行路由转发。</p>
<h3 id="静态路由应用场景"><a href="#静态路由应用场景" class="headerlink" title="静态路由应用场景"></a>静态路由应用场景</h3><p>当设备中缺少路由条目时，无法进行报文的路由转发，此时就需要配置静态路由。</p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/17.png"></p>
<h3 id="静态路由配置"><a href="#静态路由配置" class="headerlink" title="静态路由配置"></a>静态路由配置</h3><p>1.关联下一跳IP的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] ip route-static ip-address &#123; mask | mask-length &#125; nexthop-address</span><br></pre></td></tr></table></figure>
<p>2.关联出接口的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] ip route-static ip-address &#123; mask | mask-length &#125; interface-type interface-number</span><br></pre></td></tr></table></figure>
<p>3.关联出接口和下一跳IP方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] ip route-static ip-address &#123; mask | mask-length &#125; interface-type interface-number [ nexthop-address ]</span><br></pre></td></tr></table></figure>
<p>在创建静态路由时，可以同时指定出接口和下一跳。对于不同的出接口类型，也可以只指定出接口或只指定下一跳。</p>
<p>对于点到点接口（如串口)，<strong>必须指定出接口</strong>。<br>对于广播接口（如以太网接口）和VT ( Virtual-template)接口，<strong>必须指定下一跳。</strong></p>
<h3 id="静态路由配置举例"><a href="#静态路由配置举例" class="headerlink" title="静态路由配置举例"></a>静态路由配置举例</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/18.png"></p>
<p>RTA的配置如下:<br>[RTA] ip route-static 20.1.1.0 255.255.255.0 10.0.0.2<br>RTC的配置如下:<br>[RTC] ip route-static 10.0.0.0 255.255.255.0 S1/0/0</p>
<h3 id="缺省路由"><a href="#缺省路由" class="headerlink" title="缺省路由"></a>缺省路由</h3><ul>
<li>缺省路由是一种特殊的路由，当报文没有在路由表中找到匹配的具体路由表项时才使用的路由。如果报文的目的地址不能与路由表的任何目的地址相匹配，那么该报文将选取缺省路由进行转发。</li>
<li>缺省路由在路由表中的形式为0.0.0.0/0，缺省路由也被叫做<strong>默认路由</strong>。</li>
<li>缺省路由通常用在出口路由器上，为了将报文路由到运营商路由器上，减少大量的静态路由的配置。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/19.png"></p>
<h3 id="缺省路由应用场景"><a href="#缺省路由应用场景" class="headerlink" title="缺省路由应用场景"></a>缺省路由应用场景</h3><p>缺省路由一般用于企业网络出口，配置一条缺省路由让出口设备能够转发前往Internet上任意地址的IP报文。</p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/20.png"></p>
<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><h3 id="动态路由和静态路由区别"><a href="#动态路由和静态路由区别" class="headerlink" title="动态路由和静态路由区别"></a>动态路由和静态路由区别</h3><p><strong>动态路由</strong></p>
<ul>
<li>自动发现、学习路由</li>
<li>感知拓扑变更</li>
</ul>
<p><strong>静态路由</strong></p>
<ul>
<li>所有设备手动配置</li>
<li>无法感知到链路变化</li>
</ul>
<h3 id="动态路由分类"><a href="#动态路由分类" class="headerlink" title="动态路由分类"></a>动态路由分类</h3><p><strong>按工作区域分类</strong></p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/21.png"></p>
<p><strong>按工作机制及算法分类</strong></p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/22.png"></p>
<h2 id="路由高级特性"><a href="#路由高级特性" class="headerlink" title="路由高级特性"></a>路由高级特性</h2><h3 id="路由递归"><a href="#路由递归" class="headerlink" title="路由递归"></a>路由递归</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/23.png"></p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/24.png"></p>
<h3 id="等价路由"><a href="#等价路由" class="headerlink" title="等价路由"></a>等价路由</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/25.png"></p>
<p>路由表中存在等价路由之后，前往该目的网段的IP报文路由器会通过所有有效的接口、下一跳转发，这种转发行为被称为负载分担。</p>
<h3 id="浮动路由"><a href="#浮动路由" class="headerlink" title="浮动路由"></a>浮动路由</h3><p>确保路由的可靠性，引入浮动路由，一条路由转发路径不可达，可通过浮动路由选择另一跳路径进行转发。</p>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/26.png"></p>
<h4 id="浮动路由切换使用示例"><a href="#浮动路由切换使用示例" class="headerlink" title="浮动路由切换使用示例"></a>浮动路由切换使用示例</h4><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/27.png"></p>
<h3 id="路由汇总"><a href="#路由汇总" class="headerlink" title="路由汇总"></a>路由汇总</h3><ul>
<li>CIDR ( classless inter-domain routing，无类别域间路由）采用IP地址加掩码长度来标识网络和子网，而不是按照传统A、B、C等类型对网络地址进行划分。</li>
<li>CIDR容许任意长度的掩码长度，将IP地址看成连续的地址空间，可以使用任意长度的前缀分配，多个连续的前缀可以聚合成一个网络，该特性可以有效减少路由表条目数。</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/28.png"></p>
<h3 id="路由汇总的需求"><a href="#路由汇总的需求" class="headerlink" title="路由汇总的需求"></a>路由汇总的需求</h3><ul>
<li><p>子网划分、VLSM解决了地址空间浪费的问题，但同时也带了新的问题:路由表中的路由条目数量增加。</p>
</li>
<li><p>为减少路由条目数量可以使用路由汇总。</p>
</li>
<li><p>路由汇总将一组具有相同前缀的路由汇聚成一条路由，从而达到减小路由表规模以及优化设备资源利用率的目的。</p>
</li>
<li><p>路由汇总采用了CIDR的思想:将相同前缀的地址聚合成一个。</p>
</li>
</ul>
<p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/30.png"></p>
<h3 id="汇总计算"><a href="#汇总计算" class="headerlink" title="汇总计算"></a>汇总计算</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/31.png"></p>
<p>基于一系列连续的、有规律的IP网段，如果需计算相应的汇总路由，且确保得出的汇总路由刚好“囊括”上述IP网段，则需保证汇总路由的掩码长度尽可能长。</p>
<h3 id="汇总引发的问题"><a href="#汇总引发的问题" class="headerlink" title="汇总引发的问题"></a>汇总引发的问题</h3><h4 id="路由汇总带来的环路问题"><a href="#路由汇总带来的环路问题" class="headerlink" title="路由汇总带来的环路问题"></a>路由汇总带来的环路问题</h4><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/32.png"></p>
<h4 id="路由汇总带来的环路问题-解决方案"><a href="#路由汇总带来的环路问题-解决方案" class="headerlink" title="路由汇总带来的环路问题-解决方案"></a>路由汇总带来的环路问题-解决方案</h4><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/33.png"></p>
<h3 id="精确汇总"><a href="#精确汇总" class="headerlink" title="精确汇总"></a>精确汇总</h3><p><img src="/2021/05/02/IP%E8%B7%AF%E7%94%B1/34.png"></p>
<ul>
<li><p>为了让RTA能够到达RTB上的172.16.1.0/24-172.16.31.0/24网段，配置了一条静态的汇总路由，这条网段虽然优化了网络配置，但是汇总的范围太广，将RTC上的网段也包括在内，导致前往RTC上网段的流量到达RTA之后会被发往RTB,造成数据包的丢失，这种路由为不精确的路由。为此配置汇总路由时要尽量精确，刚好包括所有明细路由。</p>
</li>
<li><p>RTA-RTB的路由可汇总为172.16.0.0/19</p>
</li>
<li><p>RTA-RTC的路由可汇总为172.16.32.0/19</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/01/IP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/01/IP/" itemprop="url">网络层</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-01T18:26:57+08:00">
                2021-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h2><h3 id="网络层协议"><a href="#网络层协议" class="headerlink" title="网络层协议"></a>网络层协议</h3><p>网络层经常被称为IP层。</p>
<p><img src="/2021/05/01/IP/1.png"></p>
<h3 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h3><p><strong>IP Internet Protocol</strong><br>Internet Protocol本身是一个协议文件的名称，主要是定义并阐述了IP报文的格式。<br>经常被提及的IP，一般不是特指Internet Protocol这个协议文件本身，而是泛指直接或间接与IP协议相关的任何内容。</p>
<p><strong>作用</strong></p>
<ul>
<li>为网络层的设备提供逻辑地址</li>
<li>负责数据包的寻址和转发</li>
</ul>
<p><strong>版本</strong></p>
<ul>
<li>lPv4 (IP Version 4)</li>
<li>lPv6 (IP Version 6)</li>
</ul>
<h3 id="数据封装"><a href="#数据封装" class="headerlink" title="数据封装"></a>数据封装</h3><p><img src="/2021/05/01/IP/2.png"></p>
<h3 id="IPv4报文格式"><a href="#IPv4报文格式" class="headerlink" title="IPv4报文格式"></a>IPv4报文格式</h3><p><img src="/2021/05/01/IP/3.png"></p>
<h4 id="数据包分片"><a href="#数据包分片" class="headerlink" title="数据包分片"></a>数据包分片</h4><p>分片：将报文分割成多个片段的过程。</p>
<p>网络中转发的IP报文的长度可以不同，但如果报文长度超过了数据链路所支持的最大长度，则报文就需要分割成若干个较小的片段才能够在链路上传输。</p>
<p><img src="/2021/05/01/IP/4.png"></p>
<h4 id="生存时间-Time-to-Live，TTL"><a href="#生存时间-Time-to-Live，TTL" class="headerlink" title="生存时间(Time to Live，TTL)"></a>生存时间(Time to Live，TTL)</h4><p>TTL字段设置了数据包可以经过的路由器数目。<br>一旦经过一个路由器，TTL值就会减1，当该字段值为0时，数据包将被丢弃。</p>
<p><img src="/2021/05/01/IP/5.png"></p>
<h4 id="协议号-Protocol"><a href="#协议号-Protocol" class="headerlink" title="协议号(Protocol)"></a>协议号(Protocol)</h4><p>IP报文头中的协议号字段标识了将会继续处理该报文的协议。<br>即指出此数据包携带的数据使用何种协议，以便目的主机的IP层将数据部分上报给哪个进程处理。</p>
<ul>
<li>TCP为6 UDP为17 ICMP为1</li>
</ul>
<p><img src="/2021/05/01/IP/6.png"></p>
<h2 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h2><h3 id="IP地址表示"><a href="#IP地址表示" class="headerlink" title="IP地址表示"></a>IP地址表示</h3><p>一个IPv4地址有32 bit。<br>IPv4地址通常采用“点分十进制”表示。</p>
<p><img src="/2021/05/01/IP/7.png"></p>
<h3 id="lР地址构成"><a href="#lР地址构成" class="headerlink" title="lР地址构成"></a>lР地址构成</h3><p>网络部分：用来标识一个网络，代表IP地址所属网络。。<br>主机部分：用来区分一个网络内的不同主机，能唯一标识网段上的某台设备。<br>网络掩码区分一个IP地址中的网络部分及主机部分。</p>
<p><img src="/2021/05/01/IP/8.png"></p>
<h3 id="IP地址分类-有类编址"><a href="#IP地址分类-有类编址" class="headerlink" title="IP地址分类(有类编址)"></a>IP地址分类(有类编址)</h3><p>为了方便IP地址的管理及组网，IP地址分成五类:</p>
<p><img src="/2021/05/01/IP/9.png"></p>
<p>A/B/C类默认网络掩码</p>
<ul>
<li>A类:8 bit， 0.0.0.0~127.255.255.255/8。</li>
<li>B类:16 bit，128.0.0.0~191.255.255.255/16。</li>
<li>C类:24 bit，192.0.0.0~223.255.255.255/24</li>
</ul>
<h3 id="IP地址类型"><a href="#IP地址类型" class="headerlink" title="IP地址类型"></a>IP地址类型</h3><p>我们通常把一个网络号所定义的网络范围称为一个网段。</p>
<p>网络地址:用于标识一个网络。</p>
<p><img src="/2021/05/01/IP/10.png"></p>
<p>广播地址:用于向该网络中的所有主机发送数据的特殊地址。</p>
<p><img src="/2021/05/01/IP/11.png"></p>
<p>可用地址:可分配给网络中的节点或网络设备接口的地址。</p>
<p><img src="/2021/05/01/IP/12.png"></p>
<p><strong>注意</strong></p>
<ul>
<li>网络地址和广播地址不能直接被节点或网络设备所使用。</li>
<li>一个网段可用地址数量为:2n-2( n:主机部分的比特位数)</li>
</ul>
<h3 id="私网IP地址"><a href="#私网IP地址" class="headerlink" title="私网IP地址"></a>私网IP地址</h3><p>公网IP地址：IP地址是由IANA统一分配的，以保证任何一个IP地址在Internet上的唯一性。<br>公网IP地址：实际上一些网络不需要连接到Internet，比如一个大学的封闭实验室内的网络，只要同一网络中的网络设备的IP地址不冲突即可。在IP地址空间里，A、B、C三类地址中各预留了一些地址专门用于上述情况，称为私网IP地址。</p>
<p><img src="/2021/05/01/IP/13.png"></p>
<h3 id="特殊IP地址"><a href="#特殊IP地址" class="headerlink" title="特殊IP地址"></a>特殊IP地址</h3><p>IP地址空间中，有一些特殊的IP地址，这些IP地址有特殊的含义和作用，举例如下。</p>
<p><img src="/2021/05/01/IP/14.png"></p>
<h3 id="lPv4-vs-lPv6"><a href="#lPv4-vs-lPv6" class="headerlink" title="lPv4 vs lPv6"></a>lPv4 vs lPv6</h3><p>由全球IP地址分配机构，IANA (Internet Assigned Numbers Authority)管理的IPv4地址，于2011年完全用尽随着最后一个IPv4公网地址分配完毕，加上接入公网的用户及设备越来越多，IPv4地址枯竭的问题日益严重,这是当前IPv6替代IPv4的最大源动力。</p>
<p><img src="/2021/05/01/IP/15.png"></p>
<h2 id="子网划分"><a href="#子网划分" class="headerlink" title="子网划分"></a>子网划分</h2><h3 id="为什么要划分子网"><a href="#为什么要划分子网" class="headerlink" title="为什么要划分子网"></a>为什么要划分子网</h3><p><img src="/2021/05/01/IP/16.png"></p>
<h3 id="如何进行子网划分-原网段分析"><a href="#如何进行子网划分-原网段分析" class="headerlink" title="如何进行子网划分-原网段分析"></a>如何进行子网划分-原网段分析</h3><p><img src="/2021/05/01/IP/17.png"></p>
<h3 id="如何进行子网划分-向主机借位"><a href="#如何进行子网划分-向主机借位" class="headerlink" title="如何进行子网划分-向主机借位"></a>如何进行子网划分-向主机借位</h3><p><img src="/2021/05/01/IP/18.png"></p>
<h3 id="如何进行子网划分-计算子网网络地址"><a href="#如何进行子网划分-计算子网网络地址" class="headerlink" title="如何进行子网划分-计算子网网络地址"></a>如何进行子网划分-计算子网网络地址</h3><p><img src="/2021/05/01/IP/19.png"></p>
<h3 id="如何进行子网划分-计算子网广播地址"><a href="#如何进行子网划分-计算子网广播地址" class="headerlink" title="如何进行子网划分-计算子网广播地址"></a>如何进行子网划分-计算子网广播地址</h3><p><img src="/2021/05/01/IP/20.png"></p>
<h2 id="ICMP协议"><a href="#ICMP协议" class="headerlink" title="ICMP协议"></a>ICMP协议</h2><p>lCMP：Internet Control Message Protocol<br>Internet控制消息协议是IP协议的辅助协议。用来在网络设备间传递各种差错和控制信息。</p>
<p><img src="/2021/05/01/IP/21.png"></p>
<h3 id="ICMP重定向"><a href="#ICMP重定向" class="headerlink" title="ICMP重定向"></a>ICMP重定向</h3><p>ICMP重定向报文是ICMP控制报文中的一种。</p>
<p><img src="/2021/05/01/IP/ICMP%E9%87%8D%E5%AE%9A%E5%90%91.png"></p>
<h3 id="ICMP差错检测"><a href="#ICMP差错检测" class="headerlink" title="ICMP差错检测"></a>ICMP差错检测</h3><p>ICMP Echo消息常用于诊断源和目的地之间的网络连通性，同时还可以提供其他信息，如报文往返时间等。</p>
<p><img src="/2021/05/01/IP/22.png"></p>
<h3 id="ICMP错误报告"><a href="#ICMP错误报告" class="headerlink" title="ICMP错误报告"></a>ICMP错误报告</h3><p>ICMP定义了各种错误消息，用于诊断网络连接性问题;根据这些错误消息，源设备可以判断出数据传输失败的原因。</p>
<p><img src="/2021/05/01/IP/23.png"></p>
<h2 id="IP地址基础配置命令"><a href="#IP地址基础配置命令" class="headerlink" title="IP地址基础配置命令"></a>IP地址基础配置命令</h2><p>1.进入接口视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] interface interface-type interface-number</span><br></pre></td></tr></table></figure>
<p>通过此命令可以进入指定的接口视图，配置接口的相关属性。</p>
<ul>
<li>interface-type interface-number:指定接口类型和接口编号。接口类型和接口编号之间可以输入空格也可以不输<br>入空格。</li>
</ul>
<p>2.配置接口的IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernetO&#x2F;0&#x2F;1] ip address ip-address &#123; mask | mask-length &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，通过此命令来给网络设备上的接口配置IP地址，实现网络的互连。</p>
<ul>
<li>ip-address:指定接口的IP地址，点分十进制形式。</li>
<li>mask:指定子网掩码，点分十进制形式。</li>
<li>mask-length:指定掩码长度，整数形式，取值范围是0~32。</li>
</ul>
<h2 id="网络IP地址规划"><a href="#网络IP地址规划" class="headerlink" title="网络IP地址规划"></a>网络IP地址规划</h2><p>IP地址规划要和网络结构、路由协议、流量规划、业务规则等结合起来考虑。IP地址的规划应尽可能和网络层次相对应，应该是自顶向下的一种规划。<br>IP地址规划的目标是∶易管理、易扩展、利用率高。</p>
<p>参考规划原则:唯一性、连续性、扩展性、结构化、业务相关性</p>
<p><img src="/2021/05/01/IP/24.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/" itemprop="url">以太网交换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-01T09:34:21+08:00">
                2021-05-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="以太网是什么？"><a href="#以太网是什么？" class="headerlink" title="以太网是什么？"></a>以太网是什么？</h2><p>以太网(Ethernet)最早是由Xerox(施乐)公司创建的局域网组网规范，1980年DEC、Intel和Xeox三家公司联合开发了初版Ethernet规范—DIX 1.0，1982年这三家公司又推出了修改版本DIX 2.0，并将其提交给EEE 802工作组，经IEEEE成员修改并通过后，成为IEEE的正式标准，并编号为IEEE 802.3。虽然Ethernet规范和IEEE 802.3规范并不完全相同，但一般认为Ethernet和正IEEE 802.3是兼容的。</p>
<p>以太网是应用最广泛的局域网技术。根据传输速率的不同，以太网分为标准以太网(10Mbit/s)、快速以太网(100Mbis)千兆以太网(1000Mbs)和万兆以太网(10Gbit/s)，这些以太网都符合IEEE 802.3是兼容的。</p>
<h3 id="1、标准以太网"><a href="#1、标准以太网" class="headerlink" title="1、标准以太网"></a>1、标准以太网</h3><p>标准以太网是最早期的以太网，其传输速率为10Mbts，也称为传统以太网。此种以太网的组网方式非常灵活，既可以使用粗、细缆组成总线网络，也可以使用双绞线组成星状网络，还可以同时使用同轴电缆和双绞线组成混合网络。这些网络都符合EE8023标准，EEE8023中规定的一些传统以太网物理层标准如下。</p>
<p>①10 Base-2：使用细同轴电缆，最大网段长度为185m。</p>
<p>②10 Base-5：使用粗同轴电缆，最大网段长度为500m。</p>
<p>③10 Base-T：使用双纹线，最大网段长度为100m。</p>
<p>④10 Boad-36：使用同轴电缆，最大网段长度为3600m。</p>
<p>⑤10 Base-F：使用光纤，最大网段长度为2000m，传输速率为10Mb/s。</p>
<p>以土标准中首部的数字代表传输速率，单位为Mbis；末尾的数字代表单段网线长度(基准单位为100m)；Base表示基带传输， Broad表示宽带传输。</p>
<h3 id="2、快速以太网"><a href="#2、快速以太网" class="headerlink" title="2、快速以太网"></a>2、快速以太网</h3><p>随着网络的发展和各项网络技术的普及，标准以太网技术已难以满足人们对网络数据流量和速率的需求。1993年10月以前，人们只能选择价格昂贵、基于100Mbs光缆的FDD技术组建高标准网络，1993年10月， Grand Junction公司推出了世界上第一台快速以太网集线器FastSwitch10/100和百兆网络接口卡 Fast NIC 100，快速以太网技术正式得到应用。</p>
<p>随后，Intel、3COM等公司也相继推出了自己的快速以太网设备，同时EEE802工作组对100Mbi/s以太网的各种标准进行了研究，并于1995年4月发布了IEEE 802.3u 100Base-T快速以太网标准，快速以太网时代到来。</p>
<p>IEEE 802.3U标准基本保持了标准局域网的规定，包括帧格式、接口、介质访问控制方法</p>
<p>( CSMA/CD)等，只是将数据传输速率从10Mbts提升到了100Mbit/s，又使用了一些新的物理层标准，具体如下所示。</p>
<p>① 100 Base-1X：使用两对5类屏蔽或非屏蔽双绞线，一对用于发送数据，一对用于传输数据；使用RJ-45或DB9接口，节点与集线器的最大距离为100m，支持全双工。</p>
<p>② 100 Base-T4：使用4对3类、4类或5类双绞线，3对用于发送数据，1对用于检测冲突信号；使用R-45连接器，最大网段长度为100m，不支持全双工。</p>
<p>③ 100Base-FX：使用一对单模或多模光纤，一路用于发送数据，一路用于接收数据；最大网段长度为200m(使用单模光纤时可达2000m)，支持全双工。此种网络主要用于搭建主千网，以提升主干网络传输速率。</p>
<h3 id="3、千兆以太网"><a href="#3、千兆以太网" class="headerlink" title="3、千兆以太网"></a>3、千兆以太网</h3><p>千兆以太网(GigabitEthernet)也称为吉比特以太网。1995年11月，IEEE 802.3工作组委任一个高速研究组，以研究将快速以太网速率增至1000Mbls的可行性和方法。1996年6月，IEEE标准委员会批准了千兆以太网方案授权申请，随后IEE 802.3工作组成立了EEE 802.3z工作委员会，该委员会建立了千兆以太网标准，该标准的主要规定如下：</p>
<p>① 速率为1000Mbit/s的以太网在通信时的全双工/伴半双工操作。</p>
<p>② 使用8023以太网帧格式、CSMA/CD技术。</p>
<p>③ 在一个冲突域中支持一个中继器。</p>
<p>④ 向下兼容10Base-T和100Base-TIEEE 802.3。</p>
<p>工作组为千兆以太网制定了一系列物理层标准，其中常用的标准如下。</p>
<p>（1）1000 Base-SX：使用芯径为50m及625m、工作波长为850m的多模光纤，采用8B/10B编码方式，传输距离分别为260m和525m。此标准主要应用于建筑物中同一层的短距离主于网。</p>
<p>（2）1000 Base-LX：使用芯径为50pm及625m、工作波长为850nm和芯径为5m、工作波长为1300nm的多模、单模光纤，传输距离分别为525m、550m和3000m。此标准主要应用于校园主干网。</p>
<p>（3）1000 Base-CX：使用1500屏蔽双绞线，采用8B/10B编码方式，传输速率为1.25Gbis，传输距离为25m。此标准主要用于集群设备的连接，如一个交换机机房内的设备互联。</p>
<p>（4）1000 Base-T：使用4对5类非屏蔽双绞线，采用PAM5编码方式，传输距离为100m。</p>
<p>此标准主要用于同一层建筑的通信，从而可利用标准以太网或快速以太网已铺设的非屏蔽双绞线电缆。</p>
<p>千兆以太网采用光纤作为上行链路，用于楼宇间的连接，原本被作为一种交换技术设计，之后被广泛应用于服务器的连接和主干网中。如今，千兆以太网已成为主流的网络技术，无论是大型企业还是中小型企业，在组建网络时都会把千兆以太网作为首选高速网络技术。</p>
<h3 id="4、万兆以太网"><a href="#4、万兆以太网" class="headerlink" title="4、万兆以太网"></a>4、万兆以太网</h3><p>万兆以太网(10 Gigabit Ethernet，10GE)也称为10吉比特以太网，是继千兆以太网之后产生的高速以太网。在千兆以太网的IEEE 802.3Z规范通过后不久，IEEEE成立了高速研究组（High Speed Study Group，HssG)，该研究组主要致力于10GE的研究。</p>
<p>10GE并非简单地将千兆以太网的速率提升了10倍，2002年6月，IEEE 802.3ae委员会制定了10GE的正式标准，该标准主要包括以下内容。</p>
<p>① 兼容8023标准中定义的最小和最大以太网帧长度。</p>
<p>②仅支持全双工方式。</p>
<p>③使用点对点链路和结构化布线组建星状局域网。</p>
<p>④在 MAC/PLS服务接口上实现10Gbs的速度。</p>
<p>⑤定义两种物理层规范，即局域网PHY和广域网PHY。</p>
<p>⑥定义将 MAC/PLS的数据传输速率对应到广域网PHY数据传输速率的适配机制。</p>
<p>⑦定义支持特定物理介质相关接口(PMD)的物理层规范，包括多模光纤和单模光纤以及相应传输距离;支持ISO/C11801第二版中定义的光纤介质类型等。</p>
<p>⑧通过WAN界面子层，10Gbi/s也能被调整为较低的传输速率。</p>
<p>此外，10Gbis不再使用铜线，只使用光纤作为传输媒介;不再使用 CSMA/CD协议。千兆以太网仍可使用已有的光纤通道技术，但10GE使用新开发的物理层。10GE常用的物理层规范如下。</p>
<p>①10G Base-SR：SR表示” Short Reach”(短距离)，10GBae-SR仅用于短距离连接，该规范支持编码方式为64B/66B的短波(850mm)多模光纤，有效传输距离为2m~300m。</p>
<p>② 10G Base-LR：LR表示“Long Reach”(长距离)，10 G Base-LR主要用于长距离连接，该规范支持编码方式为64B/66B的长波(1310mm)单模光纤，有效传输距离为2m~10km，最高可达25km。</p>
<p>④ 10 G Base-ER：ER表示“ Extended Reach”(超长距离，10G Base-ER支持超长波（1550nm)单模光纤，有效传输距离为2m~40km。</p>
<h2 id="IEEE802-3与以太网的关系"><a href="#IEEE802-3与以太网的关系" class="headerlink" title="IEEE802.3与以太网的关系"></a>IEEE802.3与以太网的关系</h2><p>以太网从历史的角度看有两个，第一个是由三家公司开发的DIX以太网标准。这个标准有两个版本，分别是1980年9月发布的1.0版本和1982年11月发布的2.0版本，这也是DIX的最后一个版本。在其后1985年IEEE在DIX以太网标准的基础上制定了IEEE 802.3标准。</p>
<p>DIX与IEEE 802.3从工作机制上是一致的。但实际上，DIX以太网标准与IEEE 802.3有一些区别，DIX是把定义的OSI参考模型中的物理层和数据链路层所完成的功能，包括在一起了。它把LLC SUBLAYER(子层)和MAC SUBLAYER 媒介访问控制子层划分成了数据链路层的两个子层。目的是为了数据侦传输独立与所用的物理介质和介质访问控制方法。而IEEE 802.3规定了物理层和数据链路层中媒介访问控制子层的MAC部分，它只包括了第二层的一部分功能，而IEEE 802.2定义了逻辑链路控制子层LLC的功能。MAC与介质访问控制方法密切相关，而LLC子层与所有介质访问方法无关。LLC的隔离作用，使得网络层仅针对LLC这种接口工作，不必关心下面的介质类型及介质访问方法。而IEEE 802.3是针对以太网的标准，而IEEE 802.2并不属于以太网。所以说DIX与IEEE 802.3只是包括的范围不同，相应它们两中协议的侦格式也有一些差异。我们也可以这样的理解。</p>
<p>通俗地说就是，以太网先出来，IEEE发现这个东西很有前途，就赶紧以它为原型制定了一个有线局域网标准叫做IEEE 802.3，这个标准与原始以太网基本一样，只有些许不同，所以我们常常不加区分地将二者等同。但鉴于本篇文章的目的就是为了搞清楚这些层次之间的关系，所以我们要严格地对二者进行区分，IEEE802.3和以太网是不一样的，前者只定义了物理层和链路层的MAC子层，后者包括链路和物理两层。</p>
<p>链路层分为LLC和MAC，其中LLC叫做802.2，MAC+PHY叫做802.3，所以有如下公式：802.3+802.2=以太网</p>
<p>以太网协议栈在OSI模型中的位置，如下图</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/OSI%E4%BD%8D%E7%BD%AE.png"></p>
<p>IEEE 802中定义的服务和协议限定在OSI模型的最低两层（即物理层和数据链路层）。事实上，IEEE 802将OSI的数据链路层分为两个子层，分别是逻辑链路控制（LLC， Logical Link Control）和介质访问控制（MAC， Media Access Control），如下所示：</p>
<ul>
<li>数据链路层<ul>
<li>逻辑链路控制子层</li>
<li>介质访问控制子层</li>
</ul>
</li>
<li>物理层</li>
</ul>
<p>从上面我们可以看出，以太网占了两层（物理层+完整链路层），而IEEE802.3占了一层（物理层+链路层中的MAC子层）。</p>
<p>了解了以太网和IEEE802.3在OSI模型中的位置以后，下面来看看以太网的层次划分</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/1.png"></p>
<p>其实在MAC（介质访问控制子层）上面还有一个LLC（逻辑链路控制子层），这两个部分共同构成了链路层。链路层通过MII（或者其它一些升级版的接口，如GMII等）将数据传送到物理层，物理层对这些数据进行处理并以差分信号的形式发送出去，下面解释了图中物理层的一些缩略词的含义：</p>
<p>MII（media independent interface）：MII的实例应用，就是一种协议，用来将数据从数据链路层传输到物理层。<br>PCS（physical coding sublayer）：对要通过支撑体传送的信息进行编码。实际定义的子层有 4 个：100BASE-X、100BASE-T4、100BASE-T2 和 1000BASE-X。<br>PMA（physical media attachment）：用于给定的介质类型。其功能是：数据传送、冲突侦测、时钟同步等。<br>PMD（physical medium dependent）：就在 MDI 接口之前，用于为MDI和传送支撑体提供接口。<br>MDI（media dependent device）：用于将收发器连接到发送支撑的插头的总称。它可以是 10BASE2 网络中的 BNC 插头，或者双绞线网络的 RJ-45 插头，或者光纤连接器。<br>上面看了那么多是不是有点蒙，下面我们会以网卡为例将抽象与实际关联。</p>
<h3 id="结合网卡硬件具体分析"><a href="#结合网卡硬件具体分析" class="headerlink" title="结合网卡硬件具体分析"></a>结合网卡硬件具体分析</h3><p>网卡的主要工作原理:发送数据时，计算机把要传输的数据并行写到网卡的缓存，网卡对要传输的数据进编码(10M以太网使用曼切斯特码，100M以太网使用差分曼切斯特码)，串行发到传输介质上.接收数据时，则相反。对于网卡而言，每块网卡都有一个唯一的网络节点地址，它是网卡生产厂家在生产时烧入ROM（只读存储芯片）中的，我们把它叫做MAC地址（物理地址），且保证绝对不会重复。MAC为48bit，前24比特由IEEE分配，是需要钱买的，后24bit由网卡生产厂家自行分配。</p>
<p>网卡的功能主要有两个:</p>
<p>将电脑的数据封装为帧，并通过网线(对无线网络来说就是电磁波)将数据发送到网络上去。<br>是接收网络上其它设备传过来的帧，并将帧重新组合成数据，发送到所在的电脑中。<br>网卡能接收所有在网络上传输的信号，但正常情况下只接受发送到该电脑的帧和广播帧，将其余的帧丢弃。然后，传送到系统CPU做进一步处理。当电脑发送数据时，网卡等待合适的时间将分组插入到数据流中。接收系统通知电脑消息是否完整地到达，如果出现问题，将要求对方重新发送。</p>
<p>现在的网卡大多集成在主板上面了，不过为了说明结构组成，我们还是用上古时期的独立网卡来介绍其结构</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/2.png"></p>
<p>以最常见的PCI接口的网卡为例，一块网卡主要由PCB线路板、主芯片、数据汞、金手指(总线插槽接口)、BOOTROM、EEPROM、晶振、RJ45接口、指示灯、固定片等等，以及一些二极管、电阻电容等组成。下面我们就来分别了解一下其中主要部件。</p>
<p>主芯片</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/3.png"></p>
<p>主芯片有两大类，一种是集成了MAC和PHY的，另一种是只有MAC的，前者对应着数据链路层和物理层，后者只对应数据链路层，需要单独的芯片来构成物理层。在二者分离的情况下，主芯片与PHY芯片之间就需要MII来进行通信</p>
<p>网卡的主控制芯片是网卡的核心元件，一块网卡性能的好坏和功能的强弱多寡，主要就是看这块芯片的质量。</p>
<p>bootroom</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/4.png"></p>
<p>BOOTROM插座也就是常说的无盘启动ROM接口，其是用来通过远程启动服务构造无盘工作站的。远程启动服务(Remoteboot，通常也叫RPL)使通过使用服务器硬盘上的软件来代替工作站硬盘引导一台网络上的工作站成为可能。网卡上必须装有一个RPL(Remote Program Load远程初始程序加载)ROM芯片才能实现无盘启动，每一种RPL ROM芯片都是为一类特定的网络接口卡而制作的，它们之间不能互换。带有RPL的网络接口卡发出引导记录请求的广播(broadcasts)，服务器自动的建立一个连接来响应它，并加载MS-DOS启动文件到工作站的内存中。</p>
<p>此外，在BOOTROM插槽中心一般还有一颗93C46、93LC46或93c56的EEPROM芯片(93C56是128<em>16bit的EEPROM，而93C46是64</em>16bit的EEPROM)，它相当于网卡的BIOS，里面记录了网卡芯片的供应商ID、子系统供应商ID、网卡的MAC地址、网卡的一些配置，如总线上PHY的地址，BOOTROM的容量，是否启用BOOTROM引导系统等内容。主板板载网卡的EEPROM信息一般集成在主板BIOS中。</p>
<p>LED指示灯</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/5.png"></p>
<p>一般来讲，每块网卡都具有1个以上的LED(Light Emitting Diode发光二极管)指示灯，用来表示网卡的不同工作状态，以方便我们查看网卡是否工作正常。典型的LED指示灯有Link/Act、Full、Power等。Link/Act表示连接活动状态，Full表示是否全双工(Full Duplex)，而Power是电源指示(主要用在USB或PCMCIA网卡上)等 。</p>
<p>数据汞</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/6.png"></p>
<p>数据汞是消费级PCI网卡上都具备的设备，数据汞也被叫做网络变压器或可称为网络隔离变压器。它在一块网卡上所起的作用主要有两个，一是传输数据，它把PHY送出来的差分信号用差模耦合的线圈耦合滤波以增强信号，并且通过电磁场的转换耦合到不同电平的连接网线的另外一端;一是隔离网线连接的不同网络设备间的不同电平，以防止不同电压通过网线传输损坏设备。除此而外，数据汞还能对设备起到一定的防雷保护作用。</p>
<p>晶振</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/7.png"></p>
<p>晶振是石英振荡器的简称，英文名为Crystal，它是时钟电路中最重要的部件，它的作用是向显卡、网卡、主板等配件的各分提供基准频率，它就像个标尺，工作频率不稳定会造成相关设备工作频率不稳定，自然容易出现问题。由于制造工艺不断提高，现在晶振的频率偏差、温度稳定性、老化率、密封性等重要技术指标都很好，已不容易出现故障，但在选用时仍可留意一下晶振的质量。</p>
<p>网线接口</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/8.png"></p>
<p>对应着MDI</p>
<p>网卡上还剩一些组件，PMA，PCS和PMD没有提，自己去了解一下吧，而且并不是所有以太网解决方案都会包括完整的标准内容。</p>
<h2 id="互联网和以太网的区别"><a href="#互联网和以太网的区别" class="headerlink" title="互联网和以太网的区别"></a>互联网和以太网的区别</h2><h3 id="互联网"><a href="#互联网" class="headerlink" title="互联网"></a>互联网</h3><p>互联网（Internet）是一个网络的网络，它是由从地方到全球范围内几百万个私人的，政府的，学术界的，企业的和政府的网络所构成，通过电子，无线和光纤网络技术等等一系列广泛的技术联系在一起。</p>
<h3 id="以太网"><a href="#以太网" class="headerlink" title="以太网"></a>以太网</h3><p>以太网（Ethernet）是为了实现局域网通信而设计的一种数据链路层技术，它规定了包括物理层的连线、电子信号和介质访问层协议的内容。以太网是目前应用最普遍的局域网技术，取代了其他局域网标准如令牌环、FDDI和ARCNET。</p>
<h3 id="二者区别"><a href="#二者区别" class="headerlink" title="二者区别"></a>二者区别</h3><p>1、简单地说，以太网是一直为了实现局域网通信而设计的一系列技术方案，包括物理层传输媒介和 CSMA/CD 协议等内容，而互联网是计算机网络。</p>
<p>2、以太网很普及，电脑上的以太网接口，Wi-Fi 接口，以太网交换机、路由器上的千兆，万兆以太网口，还有网线，它们都是以太网的组成部分，以太网可以用在局域网、广域网、也可以用在互联网上，现在网络有以太网化的趋势，因为简单易用，造成很普及，然后就得到很好的研究，10兆带宽，100 兆，1000 兆，万兆…这就是它的速率升级图。</p>
<p>而互联网则是由大大小小的运营商、公司、机构、用户连接起来网络的总称，里面包含以太网、ATM网、还有其它接口，如 E1/E3等等。</p>
<h2 id="以太网协议"><a href="#以太网协议" class="headerlink" title="以太网协议"></a>以太网协议</h2><p>以太网是当今现有局域网(Local Area Network, LAN)采用的最通用的通信协议标准,定义了局域网中采用的电缆类型和信号处理方法。<br>以太网是建立在CSMA/CD (Carrier Sense Multiple Access/Collision Detection，载波监听多路访问/冲突检测)机制上的广播型网络。</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%8D%8F%E8%AE%AE.png"></p>
<h3 id="冲突域"><a href="#冲突域" class="headerlink" title="冲突域"></a>冲突域</h3><p>冲突域是指连接在同一共享介质上的所有节点的集合。</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/%E5%86%B2%E7%AA%81%E5%9F%9F.png"></p>
<h3 id="广播域"><a href="#广播域" class="headerlink" title="广播域"></a>广播域</h3><p>广播报文所能到达的整个访问范围称为二层广播域，简称广播域。</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/%E5%B9%BF%E6%92%AD%E5%9F%9F.png"></p>
<h3 id="以太网卡"><a href="#以太网卡" class="headerlink" title="以太网卡"></a>以太网卡</h3><p>网络接口卡(Network Interface Card,NIC)也称为“网卡”</p>
<p>网络接口</p>
<ul>
<li>简称“网口”或“接口”或“端口”</li>
</ul>
<p>网卡</p>
<ul>
<li>每个网口都有一块网卡与之对应。</li>
<li>计算机或交换机通过网卡来转发数据。</li>
</ul>
<h2 id="以太网帧"><a href="#以太网帧" class="headerlink" title="以太网帧"></a>以太网帧</h2><h3 id="以太网帧格式"><a href="#以太网帧格式" class="headerlink" title="以太网帧格式"></a>以太网帧格式</h3><ul>
<li><p>以太网技术所使用的帧称为以太网帧(Ethernet Frame)，或简称以太帧。</p>
</li>
<li><p>以太帧的格式有两个标准:Ethernet_ll格式和IEEE 802.3格式。</p>
</li>
</ul>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/%E5%B8%A7%E6%A0%BC%E5%BC%8F.png"></p>
<h3 id="什么是MAC地址"><a href="#什么是MAC地址" class="headerlink" title="什么是MAC地址"></a>什么是MAC地址</h3><ul>
<li>MAC (Media Access Control)地址在网络中唯一标识一个网卡。</li>
<li>一块网卡的MAC地址是具有全球唯一性的。</li>
</ul>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/MAC%E5%9C%B0%E5%9D%80.png"></p>
<h3 id="IP地址-vs-MAC地址"><a href="#IP地址-vs-MAC地址" class="headerlink" title="IP地址 vs MAC地址"></a>IP地址 vs MAC地址</h3><p>IP地址的特点:</p>
<ul>
<li>IP地址是唯一的</li>
<li>IP地址可变</li>
<li>基于网络拓扑进行IP地址分配</li>
</ul>
<p>MAC地址的特点:</p>
<ul>
<li>MAC地址是唯一的</li>
<li>MAC地址不可变</li>
<li>基于制造商进行MAC地址分配</li>
</ul>
<h3 id="MAC地址表示"><a href="#MAC地址表示" class="headerlink" title="MAC地址表示"></a>MAC地址表示</h3><p>一个MAC地址有48 bit，6 Byte。</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/MAC%E8%A1%A8%E7%A4%BA.png"></p>
<h3 id="MAC地址构成及分类"><a href="#MAC地址构成及分类" class="headerlink" title="MAC地址构成及分类"></a>MAC地址构成及分类</h3><ul>
<li>OUI( Organizationally Unique ldentifier ) :厂商代码，由IEEE分配，3 Byte，24 bit</li>
<li>制造商分配:3 Byte，24 bit</li>
</ul>
<p><strong>MAC地址分类</strong></p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/MAC%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png"></p>
<h2 id="以太网交换机"><a href="#以太网交换机" class="headerlink" title="以太网交换机"></a>以太网交换机</h2><h3 id="MAC地址表"><a href="#MAC地址表" class="headerlink" title="MAC地址表"></a>MAC地址表</h3><ul>
<li>每台交换机中都有一个MAC地址表，存放了MAC地址与交换机端口编号之间的映射关系。</li>
</ul>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/MAC%E5%9C%B0%E5%9D%80%E8%A1%A8.png"></p>
<h3 id="MAC地址表学习过程"><a href="#MAC地址表学习过程" class="headerlink" title="MAC地址表学习过程"></a>MAC地址表学习过程</h3><p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/9.png"></p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/10.png"></p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/11.png"></p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/12.png"></p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/13.png"></p>
<h3 id="交换机转发过程"><a href="#交换机转发过程" class="headerlink" title="交换机转发过程"></a>交换机转发过程</h3><h4 id="交换机的3种数据帧处理行为"><a href="#交换机的3种数据帧处理行为" class="headerlink" title="交换机的3种数据帧处理行为"></a>交换机的3种数据帧处理行为</h4><p>交换机对于从传输介质进入某一端口的帧的处理行为一共有3种:泛洪、转发和丢弃。</p>
<p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/14.png"></p>
<h4 id="泛洪"><a href="#泛洪" class="headerlink" title="泛洪"></a>泛洪</h4><p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/15.png"></p>
<h4 id="转发"><a href="#转发" class="headerlink" title="转发"></a>转发</h4><p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/16.png"></p>
<h4 id="丢弃"><a href="#丢弃" class="headerlink" title="丢弃"></a>丢弃</h4><p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/17.png"></p>
<h2 id="数据封装过程"><a href="#数据封装过程" class="headerlink" title="数据封装过程"></a>数据封装过程</h2><p><img src="/2021/05/01/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2/18.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/30/VLAN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/30/VLAN/" itemprop="url">VLAN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-30T14:47:09+08:00">
                2021-04-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么需要VLAN"><a href="#为什么需要VLAN" class="headerlink" title="为什么需要VLAN"></a>为什么需要VLAN</h2><p>　　1. 什么是VLAN?</p>
<p>　　VLAN(Virtual LAN)，翻译成中文是“虚拟局域网”。LAN可以是由少数几台家用计算机构成的网络，也可以是数以百计的计算机构成的企业网络。VLAN所指的LAN特指使用路由器分割的网络——也就是广播域。</p>
<p>　　在此让我们先复习一下广播域的概念。广播域，指的是广播帧(目标MAC地址全部为1)所能传递到的范围，亦即能够直接通信的范围。严格地说，并不仅仅是广播帧，多播帧(Multicast Frame)和目标不明的单播帧(Unknown Unicast Frame)也能在同一个广播域中畅行无阻。</p>
<p>　　本来，二层交换机只能构建单一的广播域，不过使用VLAN功能后，它能够将网络分割成多个广播域。</p>
<p>　　2.未分割广播域时……</p>
<p>　　那么，为什么需要分割广播域呢?那是因为，如果仅有一个广播域，有可能会影响到网络整体的传输性能。具体原因，请参看附图加深理解。</p>
<p><img src="/2021/04/30/VLAN/1.png"></p>
<p>　　图中，是一个由5台二层交换机(交换机1～5)连接了大量客户机构成的网络。假设这时，计算机A需要与计算机B通信。在基于以太网的通信中，必须在数据帧中指定目标MAC地址才能正常通信，因此计算机A必须先广播“ARP请求(ARP Request)信息”，来尝试获取计算机B的MAC地址。</p>
<p>　　交换机1收到广播帧(ARP请求)后，会将它转发给除接收端口外的其他所有端口，也就是Flooding了。接着，交换机2收到广播帧后也会Flooding。交换机3、4、5也还会Flooding。最终ARP请求会被转发到同一网络中的所有客户机上。</p>
<p><img src="/2021/04/30/VLAN/2.png"></p>
<p>　　请大家注意一下，这个ARP请求原本是为了获得计算机B的MAC地址而发出的。也就是说：只要计算机B能收到就万事大吉了。可是事实上，数据帧却传遍整个网络，导致所有的计算机都收到了它。如此一来，一方面广播信息消耗了网络整体的带宽，另一方面，收到广播信息的计算机还要消耗一部分CPU时间来对它进行处理。造成了网络带宽和CPU运算能力的大量无谓消耗。</p>
<p>　　3. 广播信息是那么经常发出的吗?</p>
<p>　　读到这里，您也许会问：广播信息真是那么频繁出现的吗?</p>
<p>　　答案是：是的!实际上广播帧会非常频繁地出现。利用TCP/IP协议栈通信时，除了前面出现的ARP外，还有可能需要发出DHCP、RIP等很多其他类型的广播信息。</p>
<p>　　ARP广播，是在需要与其他主机通信时发出的。当客户机请求DHCP服务器分配IP地址时，就必须发出DHCP的广播。而使用RIP作为路由协议时，每隔30秒路由器都会对邻近的其他路由器广播一次路由信息。RIP以外的其他路由协议使用多播传输路由信息，这也会被交换机转发(Flooding)。除了TCP/IP以外，NetBEUI、IPX和Apple Talk等协议也经常需要用到广播。例如在Windows下双击打开“网络计算机”时就会发出广播(多播)信息。(Windows XP除外……)</p>
<p>　　总之，广播就在我们身边。下面是一些常见的广播通信：</p>
<p>　　(1)ARP请求：建立IP地址和MAC地址的映射关系。</p>
<p>　　(2)RIP：一种路由协议。</p>
<p>　　(3)DHCP：用于自动设定IP地址的协议。</p>
<p>　　(4)NetBEUI：Windows下使用的网络协议。</p>
<p>　　(5)IPX：NovellNetware使用的网络协议。</p>
<p>　　(6)Apple Talk：苹果公司的Macintosh计算机使用的网络协议。</p>
<p>　　如果整个网络只有一个广播域，那么一旦发出广播信息，就会传遍整个网络，并且对网络中的主机带来额外的负担。因此，在设计LAN时，需要注意如何才能有效地分割广播域。</p>
<p>　　4.广播域的分割与VLAN的必要性</p>
<p>　　分割广播域时，一般都必须使用到路由器。使用路由器后，可以以路由器上的网络接口(LAN Interface)为单位分割广播域。</p>
<p>　　但是，通常情况下路由器上不会有太多的网络接口，其数目多在1～4个左右。随着宽带连接的普及，宽带路由器(或者叫IP共享器)变得较为常见，但是需要注意的是，它们上面虽然带着多个(一般为4个左右)连接LAN一侧的网络接口，但那实际上是路由器内置的交换机，并不能分割广播域。</p>
<p>　　况且使用路由器分割广播域的话，所能分割的个数完全取决于路由器的网络接口个数，使得用户无法自由地根据实际需要分割广播域。</p>
<p>　　与路由器相比，二层交换机一般带有多个网络接口。因此如果能使用它分割广播域，那么无疑运用上的灵活性会大大提高。</p>
<p>　　用于在二层交换机上分割广播域的技术，就是VLAN。通过利用VLAN，我们可以自由设计广播域的构成，提高网络设计的自由度。</p>
<h2 id="实现VLAN的机制"><a href="#实现VLAN的机制" class="headerlink" title="实现VLAN的机制"></a>实现VLAN的机制</h2><p>　　1. 实现VLAN的机制</p>
<p>　　在理解了“为什么需要VLAN”之后，接下来让我们来了解一下交换机是如何使用VLAN分割广播域的。</p>
<p>　　首先，在一台未设置任何VLAN的二层交换机上，任何广播帧都会被转发给除接收端口外的所有其他端口(Flooding)。例如，计算机A发送广播信息后，会被转发给端口2、3、4。</p>
<p><img src="/2021/04/30/VLAN/3.png"></p>
<p>　　这时，如果在交换机上生成红、蓝两个VLAN;同时设置端口1、2属于红色VLAN、端口3、4属于蓝色VLAN。再从A发出广播帧的话，交换机就只会把它转发给同属于一个VLAN的其他端口——也就是同属于红色VLAN的端口2，不会再转发给属于蓝色VLAN的端口。</p>
<p>　　同样，C发送广播信息时，只会被转发给其他属于蓝色VLAN的端口，不会被转发给属于红色VLAN的端口。</p>
<p><img src="/2021/04/30/VLAN/4.png"></p>
<p>　　就这样，VLAN通过限制广播帧转发的范围分割了广播域。上图中为了便于说明，以红、蓝两色识别不同的VLAN，在实际使用中则是用“VLAN ID”来区分的。</p>
<p>　　2.直观地描述VLAN</p>
<p>　　如果要更为直观地描述VLAN的话，我们可以把它理解为将一台交换机在逻辑上分割成了数台交换机。在一台交换机上生成红、蓝两个VLAN，也可以看作是将一台交换机换做一红一蓝两台虚拟的交换机。</p>
<p><img src="/2021/04/30/VLAN/5.png"></p>
<p>　　在红、蓝两个VLAN之外生成新的VLAN时，可以想象成又添加了新的交换机。</p>
<p>　　但是，VLAN生成的逻辑上的交换机是互不相通的。因此，在交换机上设置VLAN后，如果未做其他处理，VLAN间是无法通信的。</p>
<p>　　明明接在同一台交换机上，但却偏偏无法通信——这个事实也许让人难以接受。但它既是VLAN方便易用的特征，又是使VLAN令人难以理解的原因。</p>
<p>　　3. 需要VLAN间通信时怎么办</p>
<p>　　那么，当我们需要在不同的VLAN间通信时又该如何是好呢?</p>
<p>　　请大家再次回忆一下：VLAN是广播域。而通常两个广播域之间由路由器连接，广播域之间来往的数据包都是由路由器中继的。因此，VLAN间的通信也需要路由器提供中继服务，这被称作“VLAN间路由”。</p>
<p>　　VLAN间路由，可以使用普通的路由器，也可以使用三层交换机。其中的具体内容，等有机会再细说吧。在这里希望大家先记住不同VLAN间互相通信时需要用到路由功能。</p>
<p>　　VLAN的访问链接(Access Link)</p>
<p>　　1.交换机的端口类型</p>
<p>　　交换机的端口，可以分为以下两种：</p>
<p>　　(1)访问链接(Access Link)</p>
<p>　　(2)汇聚链接(Trunk Link)</p>
<p>　　接下来就让我们来依次学习这两种不同端口的特征。这一讲，首先学习“访问链接”。</p>
<p>　　2.访问链接</p>
<p>　　访问链接，指的是“只属于一个VLAN，且仅向该VLAN转发数据帧”的端口。在大多数情况下，访问链接所连的是客户机。</p>
<p>　　通常设置VLAN的顺序是：</p>
<p>　　(1)生成VLAN</p>
<p>　　(2)设定访问链接(决定各端口属于哪一个VLAN)</p>
<p>　　设定访问链接的手法，可以是事先固定的、也可以是根据所连的计算机而动态改变设定。前者被称为“静态VLAN”、后者自然就是“动态VLAN”了。</p>
<p>　　● 静态VLAN——基于端口</p>
<p>　　静态VLAN又被称为基于端口的VLAN(PortBased VLAN)。顾名思义，就是明确指定各端口属于哪个VLAN的设定方法。</p>
<p><img src="/2021/04/30/VLAN/6.png"></p>
<p>　　由于需要一个个端口地指定，因此当网络中的计算机数目超过一定数字(比如数百台)后，设定操作就会变得烦杂无比。并且，客户机每次变更所连端口，都必须同时更改该端口所属VLAN的设定——这显然不适合那些需要频繁改变拓补结构的网络。</p>
<p>　　● 动态VLAN</p>
<p>　　另一方面，动态VLAN则是根据每个端口所连的计算机，随时改变端口所属的VLAN。这就可以避免上述的更改设定之类的操作。动态VLAN可以大致分为3类：</p>
<p>　　(1)基于MAC地址的VLAN(MAC Based VLAN)</p>
<p>　　(2)基于子网的VLAN(Subnet Based VLAN)</p>
<p>　　(3)基于用户的VLAN(User Based VLAN)</p>
<p>　　其间的差异，主要在于根据OSI参照模型哪一层的信息决定端口所属的VLAN。</p>
<p><img src="/2021/04/30/VLAN/VLAN%E9%97%B4%E5%88%92%E5%88%86.png"></p>
<p>　　● 基于MAC地址的VLAN</p>
<p>　　基于MAC地址的VLAN，就是通过查询并记录端口所连计算机上网卡的MAC地址来决定端口的所属。假定有一个MAC地址“A”被交换机设定为属于VLAN “10”，那么不论MAC地址为“A”的这台计算机连在交换机哪个端口，该端口都会被划分到VLAN 10中去。计算机连在端口1时，端口1属于VLAN 10;而计算机连在端口2时，则是端口2属于VLAN 10。</p>
<p><img src="/2021/04/30/VLAN/7.png"></p>
<p>　　由于是基于MAC地址决定所属VLAN的，因此可以理解为这是一种在OSI的第二层设定访问链接的办法。</p>
<p>　　但是，基于MAC地址的VLAN，在设定时必须调查所连接的所有计算机的MAC地址并加以登录。而且如果计算机交换了网卡，还是需要更改设定。</p>
<p>　　● 基于IP地址的VLAN</p>
<p>　　基于子网的VLAN，则是通过所连计算机的IP地址，来决定端口所属VLAN的。不像基于MAC地址的VLAN，即使计算机因为交换了网卡或是其他原因导致MAC地址改变，只要它的IP地址不变，就仍可以加入原先设定的VLAN。</p>
<p><img src="/2021/04/30/VLAN/8.png"></p>
<p>　　因此，与基于MAC地址的VLAN相比，能够更为简便地改变网络结构。IP地址是OSI参照模型中第三层的信息，所以我们可以理解为基于子网的VLAN是一种在OSI的第三层设定访问链接的方法。</p>
<p>　　基于用户的VLAN，则是根据交换机各端口所连的计算机上当前登录的用户，来决定该端口属于哪个VLAN。这里的用户识别信息，一般是计算机操作系统登录的用户，比如可以是Windows域中使用的用户名。这些用户名信息，属于OSI第四层以上的信息。</p>
<p>　　总的来说，决定端口所属VLAN时利用的信息在OSI中的层面越高，就越适于构建灵活多变的网络。</p>
<p>　　VLAN的汇聚链接(Trunk Link)</p>
<p>　　1.需要设置跨越多台交换机的VLAN时……</p>
<p>　　到此为止，我们学习的都是使用单台交换机设置VLAN时的情况。那么，如果需要设置跨越多台交换机的VLAN时又如何呢?</p>
<p>　　在规划企业级网络时，很有可能会遇到隶属于同一部门的用户分散在同一座建筑物中的不同楼层的情况，这时可能就需要考虑到如何跨越多台交换机设置VLAN的问题了。假设有如下图所示的网络，且需要将不同楼层的A、C和B、D设置为同一个VLAN。</p>
<p><img src="/2021/04/30/VLAN/9.png"></p>
<p>　　这时最关键的就是“交换机1和交换机2该如何连接才好呢?”</p>
<p>　　最简单的方法，自然是在交换机1和交换机2上各设一个红、蓝VLAN专用的接口并互联了。</p>
<p><img src="/2021/04/30/VLAN/10.png"></p>
<p>　　但是，这个办法从扩展性和管理效率来看都不好。例如，在现有网络基础上再新建VLAN时，为了让这个VLAN能够互通，就需要在交换机间连接新的网线。建筑物楼层间的纵向布线是比较麻烦的，一般不能由基层管理人员随意进行。并且，VLAN越多，楼层间(严格地说是交换机间)互联所需的端口也越来越多，交换机端口的利用效率低是对资源的一种浪费、也限制了网络的扩展。</p>
<p>　　为了避免这种低效率的连接方式，人们想办法让交换机间互联的网线集中到一根上，这时使用的就是汇聚链接(Trunk Link)。</p>
<p>　　2.何谓汇聚链接?</p>
<p>　　汇聚链接(Trunk Link)指的是能够转发多个不同VLAN的通信的端口。</p>
<p>　　汇聚链路上流通的数据帧，都被附加了用于识别分属于哪个VLAN的特殊信息。</p>
<p>　　现在再让我们回过头来考虑一下刚才那个网络如果采用汇聚链路又会如何呢?用户只需要简单地将交换机间互联的端口设定为汇聚链接就可以了。这时使用的网线还是普通的UTP线，而不是什么其他的特殊布线。图例中是交换机间互联，因此需要用交叉线来连接。</p>
<p>　　接下来，让我们具体看看汇聚链接是如何实现跨越交换机间的VLAN的。</p>
<p>　　A发送的数据帧从交换机1经过汇聚链路到达交换机2时，在数据帧上附加了表示属于红色VLAN的标记。</p>
<p>　　交换机2收到数据帧后，经过检查VLAN标识发现这个数据帧是属于红色VLAN的，因此去除标记后根据需要将复原的数据帧只转发给其他属于红色VLAN的端口。这时的转送，是指经过确认目标MAC地址并与MAC地址列表比对后只转发给目标MAC地址所连的端口。只有当数据帧是一个广播帧、多播帧或是目标不明的帧时，它才会被转发到所有属于红色VLAN的端口。</p>
<p>　　蓝色VLAN发送数据帧时的情形也与此相同。</p>
<p><img src="/2021/04/30/VLAN/11.png"></p>
<p>　　通过汇聚链路时附加的VLAN识别信息，有可能支持标准的“IEEE 802.1Q”协议，也可能是Cisco产品独有的“ISL(Inter Switch Link)”。如果交换机支持这些规格，那么用户就能够高效率地构筑横跨多台交换机的VLAN。</p>
<p>　　另外，汇聚链路上流通着多个VLAN的数据，自然负载较重。因此，在设定汇聚链接时，有一个前提就是必须支持100Mbps以上的传输速度。</p>
<p>　　另外，默认条件下，汇聚链接会转发交换机上存在的所有VLAN的数据。换一个角度看，可以认为汇聚链接(端口)同时属于交换机上所有的VLAN。由于实际应用中很可能并不需要转发所有VLAN的数据，因此为了减轻交换机的负载、也为了减少对带宽的浪费，我们可以通过用户设定限制能够经由汇聚链路互联的VLAN。</p>
<p>　　关于IEEE 802.1Q和ISL的具体内容，将在下一讲中提到。</p>
<p>　　3.访问链接的总结</p>
<p>　　综上所述，设定访问链接的手法有静态VLAN和动态VLAN两种，其中动态VLAN又可以继续细分成几个小类。</p>
<p>　　其中基于子网的VLAN和基于用户的VLAN有可能是网络设备厂商使用独有的协议实现的，不同厂商的设备之间互联有可能出现兼容性问题;因此在选择交换机时，一定要注意事先确认。</p>
<p>　　下表总结了静态VLAN和动态VLAN的相关信息。</p>
<p>　　种类解说</p>
<p>　　静态VLAN(基于端口的VLAN)将交换机的各端口固定指派给VLAN</p>
<p>　　动态VLAN基于MAC地址的VLAN根据各端口所连计算机的MAC地址设定</p>
<p>　　基于子网的VLAN根据各端口所连计算机的IP地址设定</p>
<p>　　基于用户的VLAN根据端口所连计算机上登录用户设定</p>
<p>　　VLAN的汇聚方式——IEEE802.1Q与ISL</p>
<p>　　1.汇聚方式</p>
<p>　　在交换机的汇聚链接上，可以通过对数据帧附加VLAN信息，构建跨越多台交换机的VLAN。</p>
<p>　　附加VLAN信息的方法，最具有代表性的有：</p>
<p>　　(1)IEEE 802.1Q</p>
<p>　　(2)ISL</p>
<p>　　现在就让我们看看这两种协议分别如何对数据帧附加VLAN信息。</p>
<p>　　2.IEEE 802.1Q</p>
<p>　　IEEE 802.1Q，俗称“Dot One Q”，是经过IEEE认证的对数据帧附加VLAN识别信息的协议。</p>
<p>　　在此，请大家先回忆一下以太网数据帧的标准格式。</p>
<p>　　IEEE 802.1Q所附加的VLAN识别信息，位于数据帧中“发送源MAC地址”与“类别域”(Type Field)之间。具体内容为2字节的TPID(Tag Protocol IDentifier)和2字节的TCI(Tag Control Information)，共计4字节。</p>
<p>　　在数据帧中添加了4字节的内容，那么CRC值自然也会有所变化。这时数据帧上的CRC是插入TPID、TCI后，对包括它们在内的整个数据帧重新计算后所得的值。</p>
<p><img src="/2021/04/30/VLAN/12.png"></p>
<p>　　而当数据帧离开汇聚链路时，TPID和TCI会被去除，这时还会进行一次CRC的重新计算。</p>
<p>　　TPID字段在以太网报文中所处位置与不带VLAN Tag的报文中协议类型字段所处位置相同。TPID的值固定为0x8100，它标示网络帧承载的802.1Q类型，交换机通过它来确定数据帧内附加了基于IEEE 802.1Q的VLAN信息。而实质上的VLAN ID，是TCI中的12位元。由于总共有12位，因此最多可供识别4096个VLAN。</p>
<p>　　基于IEEE 802.1Q附加的VLAN信息，就像在传递物品时附加的标签。因此，它也被称作“标签型VLAN”(Tagging VLAN)。</p>
<p>　　3.ISL(Inter Switch Link)</p>
<p>　　ISL，是Cisco产品支持的一种与IEEE 802.1Q类似的、用于在汇聚链路上附加VLAN信息的协议。</p>
<p>　　使用ISL后，每个数据帧头部都会被附加26字节的“ISL包头(ISL Header)”，并且在帧尾带上通过对包括ISL包头在内的整个数据帧进行计算后得到的4字节CRC值。换而言之，就是总共增加了30字节的信息。</p>
<p>　　在使用ISL的环境下，当数据帧离开汇聚链路时，只要简单地去除ISL包头和新CRC就可以了。由于原先的数据帧及其CRC都被完整保留，因此无需重新计算CRC。</p>
<p><img src="/2021/04/30/VLAN/13.png"></p>
<p>　　ISL有如用ISL包头和新CRC将原数据帧整个包裹起来，因此也被称为“封装型VLAN”(Encapsulated VLAN)。</p>
<p>　　需要注意的是，不论是IEEE802.1Q的“Tagging VLAN”，还是ISL的“Encapsulated VLAN”，都不是很严密的称谓。不同的书籍与参考资料中，上述词语有可能被混合使用，因此需要大家在学习时格外注意。</p>
<p>　　并且由于ISL是Cisco独有的协议，因此只能用于Cisco网络设备之间的互联。</p>
<h2 id="VLAN间路由"><a href="#VLAN间路由" class="headerlink" title="VLAN间路由"></a>VLAN间路由</h2><p>1.VLAN间路由的必要性</p>
<p>　　根据目前为止学习的知识，我们已经知道两台计算机即使连接在同一台交换机上，只要所属的VLAN不同就无法直接通信。接下来我们将要学习的就是如何在不同的VLAN间进行路由，使分属不同VLAN的主机能够互相通信。</p>
<p>　　首先，先来复习一下为什么不同VLAN间不通过路由就无法通信。在LAN内的通信，必须在数据帧头中指定通信目标的MAC地址。而为了获取MAC地址，TCP/IP协议下使用的是ARP。ARP解析MAC地址的方法，则是通过广播。也就是说，如果广播报文无法到达，那么就无从解析MAC地址，亦即无法直接通信。</p>
<p>　　计算机分属不同的VLAN，也就意味着分属不同的广播域，自然收不到彼此的广播报文。因此，属于不同VLAN的计算机之间无法直接互相通信。为了能够在VLAN间通信，需要利用OSI参照模型中更高一层——网络层的信息(IP地址)来进行路由。关于路由的具体内容，以后有机会再详细解说吧。</p>
<p>　　路由功能，一般主要由路由器提供。但在今天的局域网里，我们也经常利用带有路由功能的交换机——三层交换机(Layer 3 Switch)来实现。接下来就让我们分别看看使用路由器和三层交换机进行VLAN间路由时的情况。</p>
<p>2.使用路由器进行VLAN间路由</p>
<p>　　在使用路由器进行VLAN间路由时，与构建横跨多台交换机的VLAN时的情况类似，我们还是会遇到“该如何连接路由器与交换机”这个问题。路由器和交换机的接线方式，大致有以下两种：</p>
<p>　　(1)将路由器与交换机上的每个VLAN分别连接</p>
<p>　　(2)不论VLAN有多少个，路由器与交换机都只用一条网线连接</p>
<p>　　最容易想到的，当然还是“把路由器和交换机以VLAN为单位分别用网线连接”了。将交换机上用于和路由器互联的每个端口设为访问链接(Access Link)，然后分别用网线与路由器上的独立端口互联。如下图所示，交换机上有2个VLAN，那么就需要在交换机上预留2个端口用于与路由器互联;路由器上同样需要有2个端口;两者之间用2条网线分别连接。</p>
<p><img src="/2021/04/30/VLAN/14.png"></p>
<p>　　如果采用这个办法，大家应该不难想象它的扩展性很成问题。每增加一个新的VLAN，都需要消耗路由器的端口和交换机上的访问链接，而且还需要重新布设一条网线。而路由器，通常不会带有太多LAN接口的。新建VLAN时，为了对应增加的VLAN所需的端口，就必须将路由器升级成带有多个LAN接口的高端产品，这部分成本、还有重新布线所带来的开销，都使得这种接线法成为一种不受欢迎的办法。</p>
<p>　　那么，第二种办法“不论VLAN数目多少，都只用一条网线连接路由器与交换机”呢?当使用一条网线连接路由器与交换机、进行VLAN间路由时，需要用到汇聚链接。</p>
<p>　　具体实现过程为：首先将用于连接路由器的交换机端口设为汇聚链接(Trunk Link)，而路由器上的端口也必须支持汇聚链路。双方用于汇聚链路的协议自然也必须相同。接着在路由器上定义对应各个VLAN的“子接口”(Sub Interface)。尽管实际与交换机连接的物理端口只有一个，但在理论上我们可以把它分割为多个虚拟端口。</p>
<p>　　VLAN将交换机从逻辑上分割成了多台，因而用于VLAN间路由的路由器，也必须拥有分别对应各个VLAN的虚拟接口。</p>
<p><img src="/2021/04/30/VLAN/15.png"></p>
<p>　　采用这种方法的话，即使之后在交换机上新建VLAN，仍只需要一条网线连接交换机和路由器。用户只需要在路由器上新设一个对应新VLAN的子接口就可以了。与前面的方法相比，扩展性要强得多，也不用担心需要升级LAN接口数不足的路由器或是重新布线。</p>
<p>3.同一VLAN内的通信</p>
<p>　　接下来，我们继续学习使用汇聚链路连接交换机与路由器时，VLAN间路由是如何进行的。如下图所示，为各台计算机以及路由器的子接口设定IP地址。</p>
<p><img src="/2021/04/30/VLAN/16.png"></p>
<p>　　红色VLAN(VLAN ID=1)的网络地址为192.168.1.0/24，蓝色VLAN(VLAN ID=2)的网络地址为192.168.2.0/24。各计算机的MAC地址分别为A/B/C/D，路由器汇聚链接端口的MAC地址为R。交换机通过对各端口所连计算机MAC地址的学习，生成如下的MAC地址列表。</p>
<p>　　首先考虑计算机A与同一VLAN内的计算机B之间通信时的情形。</p>
<p>　　计算机A发出ARP请求信息，请求解析B的MAC地址。交换机收到数据帧后，检索MAC地址列表中与收信端口同属一个VLAN的表项。结果发现，计算机B连接在端口2上，于是交换机将数据帧转发给端口2，最终计算机B收到该帧。收发信双方同属一个VLAN之内的通信，一切处理均在交换机内完成。</p>
<p><img src="/2021/04/30/VLAN/17.png"></p>
<p>4.不同VLAN间的通信</p>
<p>　　接下来是这一讲的核心内容，不同VLAN间的通信。让我们来考虑一下计算机A与计算机C之间通信时的情况。</p>
<p><img src="/2021/04/30/VLAN/18.png"></p>
<p>　　计算机A从通信目标的IP地址(192.168.2.1)得出C与本机不属于同一个网段。因此会向设定的默认网关(DefaultGateway，GW)转发数据帧。在发送数据帧之前，需要先用ARP获取路由器的MAC地址。</p>
<p>　　得到路由器的MAC地址R后，接下来就是按图中所示的步骤发送往C去的数据帧。①的数据帧中，目标MAC地址是路由器的地址R、但内含的目标IP地址仍是最终要通信的对象C的地址。这一部分的内容，涉及到局域网内经过路由器转发时的通信步骤，有机会再详细解说吧。</p>
<p>　　交换机在端口1上收到①的数据帧后，检索MAC地址列表中与端口1同属一个VLAN的表项。由于汇聚链路会被看作属于所有的VLAN，因此这时交换机的端口6也属于被参照对象。这样交换机就知道往MAC地址R发送数据帧，需要经过端口6转发。</p>
<p>　　从端口6发送数据帧时，由于它是汇聚链接，因此会被附加上VLAN识别信息。由于原先是来自红色VLAN的数据帧，因此如图中②所示，会被加上红色VLAN的识别信息后进入汇聚链路。路由器收到②的数据帧后，确认其VLAN识别信息，由于它是属于红色VLAN的数据帧，因此交由负责红色VLAN的子接口接收。</p>
<p>　　接着，根据路由器内部的路由表，判断该向哪里中继。</p>
<p>　　由于目标网络192.168.2.0/24是蓝色VLAN，，且该网络通过子接口与路由器直连，因此只要从负责蓝色VLAN的子接口转发就可以了。这时，数据帧的目标MAC地址被改写成计算机C的目标地址;并且由于需要经过汇聚链路转发，因此被附加了属于蓝色VLAN的识别信息。这就是图中③的数据帧。</p>
<p>　　交换机收到③的数据帧后，根据VLAN标识信息从MAC地址列表中检索属于蓝色VLAN的表项。由于通信目标——计算机C连接在端口3上、且端口3为普通的访问链接，因此交换机会将数据帧去除VLAN识别信息后(数据帧④)转发给端口3，最终计算机C才能成功地收到这个数据帧。</p>
<p>　　进行VLAN间通信时，即使通信双方都连接在同一台交换机上，也必须经过：“发送方——交换机——路由器——交换机——接收方”这样一个流程。</p>
<p>　　三层交换机</p>
<p>　　1.使用路由器进行VLAN间路由时的问题</p>
<p>　　现在，我们知道只要能提供VLAN间路由，就能够使分属不同VLAN的计算机互相通信。但是，如果使用路由器进行VLAN间路由的话，随着VLAN之间流量的不断增加，很可能导致路由器成为整个网络的瓶颈。</p>
<p>　　交换机使用被称为ASIC(ApplicationSpecified Integrated Circuit)的专用硬件芯片处理数据帧的交换操作，在很多机型上都能实现以缆线速度(Wired Speed)交换。而路由器，则基本上是基于软件处理的。即使以缆线速度接收到数据包，也无法在不限速的条件下转发出去，因此会成为速度瓶颈。就VLAN间路由而言，流量会集中到路由器和交换机互联的汇聚链路部分，这一部分尤其特别容易成为速度瓶颈。并且从硬件上看，由于需要分别设置路由器和交换机，在一些空间狭小的环境里可能连设置的场所都成问题。</p>
<p>　　2.三层交换机(Layer 3 Switch)</p>
<p>　　为了解决上述问题，三层交换机应运而生。三层交换机，本质上就是“带有路由功能的(二层)交换机”。路由属于OSI参照模型中第三层网络层的功能，因此带有第三层路由功能的交换机才被称为“三层交换机”。</p>
<p>　　关于三层交换机的内部结构，可以参照下面的简图。</p>
<p><img src="/2021/04/30/VLAN/19.png"></p>
<p>　　在一台本体内，分别设置了交换机模块和路由器模块;而内置的路由模块与交换模块相同，使用ASIC硬件处理路由。因此，与传统的路由器相比，可以实现高速路由。并且，路由与交换模块是汇聚链接的，由于是内部连接，可以确保相当大的带宽。</p>
<p>　　● 使用三层交换机进行VLAN间路由(VLAN内通信)</p>
<p>　　在三层交换机内部数据究竟是怎样传播的呢?基本上，它和使用汇聚链路连接路由器与交换机时的情形相同。</p>
<p>　　假设有如下图所示的4台计算机与三层交换机互联。当使用路由器连接时，一般需要在LAN接口上设置对应各VLAN的子接口;而三层交换机则是在内部生成“VLAN接口”(VLAN Interface)。VLAN接口，是用于各VLAN收发数据的接口。(注：在Cisco的Catalyst系列交换机上，VLAN Interface被称为SVI——Switched Virtual Interface)</p>
<p><img src="/2021/04/30/VLAN/20.png"></p>
<p>　　为了与使用路由器进行VLAN间路由对比，让我们同样来考虑一下计算机A与计算机B之间通信时的情况。首先是目标地址为B的数据帧被发到交换机;通过检索同一VLAN的MAC地址列表发现计算机B连在交换机的端口2上;因此将数据帧转发给端口2。</p>
<p>　　● 使用三层交换机进行VLAN间路由(VLAN间通信)</p>
<p>　　接下来设想一下计算机A与计算机C间通信时的情形。针对目标IP地址，计算机A可以判断出通信对象不属于同一个网络，因此向默认网关发送数据(Frame 1)。</p>
<p>　　交换机通过检索MAC地址列表后，经由内部汇聚链接，将数据帧转发给路由模块。在通过内部汇聚链路时，数据帧被附加了属于红色VLAN的VLAN识别信息(Frame 2)。</p>
<p>　　路由模块在收到数据帧时，先由数据帧附加的VLAN识别信息分辨出它属于红色VLAN，据此判断由红色VLAN接口负责接收并进行路由处理。因为目标网络192.168.2.0/24是直连路由器的网络、且对应蓝色VLAN;因此，接下来就会从蓝色VLAN接口经由内部汇聚链路转发回交换模块。在通过汇聚链路时，这次数据帧被附加上属于蓝色VLAN的识别信息(Frame 3)。</p>
<p>　　交换机收到这个帧后，检索蓝色VLAN的MAC地址列表，确认需要将它转发给端口3。由于端口3是通常的访问链接，因此转发前会先将VLAN识别信息去除(Frame 4)。最终，计算机C成功地收到交换机转发来的数据帧。</p>
<p><img src="/2021/04/30/VLAN/21.png"></p>
<p>　　整体的流程，与使用外部路由器时的情况十分相似——都需要经过“发送方→交换模块→路由模块→交换模块→接收方”。</p>
<h2 id="加速VLAN间通信的手段"><a href="#加速VLAN间通信的手段" class="headerlink" title="加速VLAN间通信的手段"></a>加速VLAN间通信的手段</h2><p>　　1.流(Flow)</p>
<p>　　根据到此为止的学习，我们已经知道VLAN间路由，必须经过外部的路由器或是三层交换机的内置路由模块。但是，有时并不是所有的数据都需要经过路由器(或路由模块)。</p>
<p>　　例如，使用FTP(File Transfer Protocol)传输容量为数MB以上的较大的文件时，由于MTU的限制，IP协议会将数据分割成小块后传输、并在接收方重新组合。这些被分割的数据，“发送的目标”是完全相同的。发送目标相同，也就意味着同样的目标IP地址、目标端口号(注：特别强调一下，这里指的是TCP/UDP端口)。自然，源IP地址、源端口号也应该相同。这样一连串的数据流被称为“流”(Flow)。</p>
<p>　　只要将流最初的数据正确地路由以后，后继的数据理应也会被同样地路由。</p>
<p>　　据此，后继的数据不再需要路由器进行路由处理;通过省略反复进行的路由操作，可以进一步提高VLAN间路由的速度。</p>
<p><img src="/2021/04/30/VLAN/22.png"></p>
<p>　　2.加速VLAN间路由的机制</p>
<p>　　接下来，让我们具体考虑一下该如何使用三层交换机进行高速VLAN间路由。</p>
<p>　　首先，整个流的第一块数据，照常由交换机转发→路由器路由→再次由交换机转发到目标所连端口。这时，将第一块数据路由的结果记录到缓存里保存下来。需要记录的信息有：</p>
<p>　　(1)目标IP地址</p>
<p>　　(2)源IP地址</p>
<p>　　(3)目标TCP/UDP端口号</p>
<p>　　(4)源TCP/UDP端口号</p>
<p>　　(5)接收端口号(交换机)</p>
<p>　　(6)转发端口号(交换机)</p>
<p>　　(7)转发目标MAC地址</p>
<p>　　等等。</p>
<p>　　同一个流的第二块以后的数据到达交换机后，直接通过查询先前保存在缓存中的信息查出“转发端口号”后就可以转发给目标所连端口了。</p>
<p>　　这样一来，就不需要再一次次经由内部路由模块中继，而仅凭交换机内部的缓存信息就足以判断应该转发的端口。</p>
<p>　　这时，交换机会对数据帧进行由路由器中继时相似的处理，例如改写MAC地址、IP包头中的TTL和Check Sum校验码信息等。</p>
<p><img src="/2021/04/30/VLAN/23.png"></p>
<p>　　通过在交换机上缓存路由结果，实现了以缆线速度(Wired Speed)接收发送方传输来数据的数据、并且能够全速路由、转发给接收方。</p>
<p>　　需要注意的是，类似的加速VLAN间路由的手法多由各厂商独有的技术所实现，并且该功能的称谓也因厂商而异。例如，在Cisco的Catalyst系列交换机上，这种功能被称为“多层交换”(Multi Layer Switching)。另外，除了三层交换机的内部路由模块，外部路由器中的某些机型也支持类似的高速VLAN间路由机制。</p>
<h2 id="VLAN间路由举例"><a href="#VLAN间路由举例" class="headerlink" title="VLAN间路由举例"></a>VLAN间路由举例</h2><h3 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h3><ul>
<li>通过使用路由器可以实现VLAN间通信。</li>
<li>当路由器使用多臂的方式实现VLAN间的通信时，路由器的接口资源将受到极大的挑战，当VLAN数量特别多时，采用多臂路由的方式是不具备可行性的，并且此种方式的可扩展性并不高。</li>
<li>当路由器采用单臂的方式实现VLAN间通信时，与多臂路由相比，是一种更佳的选择，因为单臂的可扩展性更高、更经济。</li>
<li>但是单臂路由也存在一定的短板：（1）路由器与交换机之间的链路由于需承载所有VLAN间的通信数据，因此它的负载将变得非常高，尤其是当VLAN的数量特别多、VLAN间通信的流量特别大时，这段链路将变得不堪重负。（2）单臂链路也不具备冗余性，一旦链路发生故障，VLAN之间的通信也就无法再正常进行。</li>
<li>使用三层交换机（Layer 3 Switch）也可以实现VLAN间通信，并且能优化上述问题。</li>
</ul>
<h3 id="三层交换机"><a href="#三层交换机" class="headerlink" title="三层交换机"></a>三层交换机</h3><ul>
<li>三层交换机除了能够实现二层交换机所有功能，还支持路由功能。</li>
<li>三层交换机除了拥有二层接口外，还拥有三层接口。</li>
<li>VLANIF （VLAN Interface）VLAN接口就是一种非常重要的三层接口，这是一种逻辑接口，物理上并不存在。</li>
<li>在一台三层交换机上创建了一个VLAN时，就可以将交换机的物理接口(比如GE0/0/1)加入到该VLAN中，此时这些物理接口都是二层接口。与此同时，还能在交换机上配置这个VLAN对应的VLANIF，也就是这个VLAN对应的三层接口。</li>
<li>三层接口能够与同处于这个VLAN内的设备进行二层通信。另外VLANIF作为一个三层接口，拥有路由功能，可以进行IP地址配置，而通常情况下，这个IP地址会作为VLAN中设备的默认网关地址。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>如下图所示的网络拓扑中：</p>
<ul>
<li>交换机拥有两个VLAN，分别是VLAN 10及VLAN20，物理接口GE0/0/1, GE0/0/2及GE0/0/3都被配置为Access类型，其中GE0/0/1及GE0/0/2接口加入了VLAN10，而GE0/0/3接口则加入了VLAN20。</li>
<li>VLANIF 10配置了IP地址192.168.10.254, VLANIF 20则配置了IP地址192.168.20.254。</li>
<li>各VLAN内的PC都将其默认网关地址配置为相应VLAN的VLANIF IP地址。</li>
<li>由于交换机配置了VLAN IF接口，那么三层交换机同时拥有交换模块以及路由模块。</li>
</ul>
<p><img src="/2021/04/30/VLAN/%E4%B8%BE%E4%BE%8B.png"></p>
<h3 id="在三层交换机上，同网段二层数据交换"><a href="#在三层交换机上，同网段二层数据交换" class="headerlink" title="在三层交换机上，同网段二层数据交换"></a>在三层交换机上，同网段二层数据交换</h3><p>以PC1发送一份数据给PC2为例，大致过程如下：<br>（1）PC1构造单播数据帧：</p>
<ul>
<li>PC1的上层协议产生的数据载荷到了网络层，数据载荷被封装IP头部，在IP头部中，源IP地址是192.168.10.1，目的IP地址是192.168.10.2。</li>
<li>数据载荷被封装好IP头部后，数据下发到网卡，继续为其进行数据链路层封装，将其封装成以太网数据帧，该数据帧的源MAC地址为PC1的网卡MAC地址，而目的MAC地址为192.168.10.2这个IP地址对应的MAC地址。</li>
<li>PC1查询ARP表试图寻找相应的ARP表项，初始时PC1的ARP表中并没有相应的表项，因此PCl发送一个广播的ARP Request去请求PC2的MAC地址。</li>
</ul>
<p>（2）交换机处理PC1发送的广播ARP Request数据帧：</p>
<ul>
<li>ARP Request的广播数据帧到达了交换机的GE0/0/1接口后，会被打上VLAN10的Tag。</li>
<li>交换机通过读取数据帧头部，发现这是一个广播数据帧，此时有三个动作：<br>a.将收到的ARP Request广播数据帧在所有加入VLAN10的端口上泛洪，b.将数据帧解封装，将数据帧帧中的源Mac地址、VLAN10、GE0/0/1形成一条新的Mac地址表项c 另外交换机通过数据帧头部的“类型”字段发现该帧内封装着一个ARP报文，将数据帧解封装后上送到自己的ARP协议模块，而ARP模块发现这个ARP报文请求的是192.168.10.2这个IP地址的MAC地址，该IP地址并非自己所有，因此它直接忽略这个数据帧。</li>
</ul>
<p>（3）PC2处理泛洪得到的广播ARP Request数据帧：</p>
<ul>
<li>交换机在VLAN10内泛洪了PC1发送的ARP Request，因此PC2会收到这个数据帧，它将记录相应的ARP表项（PC1的IP地址和Mac地址），</li>
<li>通过解析ARP Request广播数据帧，发现该报文请求的IP地址就是自己，于是会发送一个单播的ARP Reply帧进行回应。</li>
</ul>
<p>（4）交换机处理PC2回应的单播ARP Reply数据帧：</p>
<ul>
<li>交换机收到这个数据帧，解析数据帧头部，将数据帧帧中的源Mac地址、VLAN10、GE0/0/2形成一条新的Mac地址表项</li>
<li>另外解析数据帧头部后，通过查询MAC地址表并找到目的MAC地址所关联的出接口（通过PC1发送的广播ARP Request报文学习的Mac地址表项），将数据帧从GE0/0/1接口发出。</li>
</ul>
<p>（5）PC1处理交换机传递的单播ARP Reply数据帧：</p>
<ul>
<li>PC1收到了这个ARP Reply，解析数据帧，可以获知了192.168.10.2对应的MAC地址，形成相应的ARP表项（PC2的IP地址和Mac地址）</li>
<li>PC1获取PC2的Mac地址后，可以继续封装单播数据帧，然后将单播数据帧从网卡发出。</li>
</ul>
<p>（6）交换机处理PC1发送的单播数据帧：</p>
<ul>
<li>交换机收到这个数据帧，发现这是一个单播数据帧，于是在MAC地址表中查询目的MAC地址，找到匹配的表项后（PC2回应的ARP Reply报文学习的Mac地址表项），将该帧从GE0/0/2接口发出。</li>
</ul>
<p>（7）PC2处理交换机传递的单播数据帧：</p>
<ul>
<li>PC2收到这个数据帧后，解析以太网头部，发现目的Mac地址正是自己网卡的Mac地址，通过数据帧头部的“类型”字段发现该帧内封装着一个IP数据报</li>
<li>将IP数据报上送IP协议栈，继续继续IP头部，发现目的IP地址也是自己网卡的IP地址，通IP数据报头部中的“协议”字段发现数据报内还封装上层应用协议的数据</li>
<li>将上层应用协议的数据上送给上层协议模块处理数据。</li>
</ul>
<h3 id="在三层交换机上，跨网段三层数据交换"><a href="#在三层交换机上，跨网段三层数据交换" class="headerlink" title="在三层交换机上，跨网段三层数据交换"></a>在三层交换机上，跨网段三层数据交换</h3><p>以PC1发送一份数据给PC3为例，大致过程如下:<br>（1）PC1构造单播数据帧：</p>
<ul>
<li>PC1的上层协议产生的数据载荷到了网络层，数据载荷被封装IP头部，源IP地址是192.168.10.1，目的IP地址是192.168.20.1。</li>
<li>将数据帧下送到了PC1的网卡，网卡将其封装成以太网数据帧，由于数据包的目的IP地址与本机不在相同网段（PC2可以通过将IP地址与地址掩码做 &amp;操作，确定其IP网段范围），这意味着PC1需要先把报文发送到默认网关，因此数据帧的目的MAC地址需填写网关(192.168.10.254)的MAC地址。</li>
<li>PC1在ARP表中查询192.168.10.254，发现并没有匹配的表项，因此它发送一个广播的ARP Request试图查询网关的MAC地址。</li>
</ul>
<p>（2）交换机处理广播ARP Request数据帧：</p>
<ul>
<li>广播ARP Request数据帧到达了交换机的GE0/0/1接口，会被打上VLAN10的Tag。</li>
<li>交换机通过读取数据帧头部，发现这是一个广播数据帧，有三个动作：<br>a. 将广播报文在加入VLAN 10的端口上进行泛洪，b.将数据帧解封装，将数据帧帧中的源Mac地址、VLAN10、GE0/0/1形成一条新的Mac地址表项c 另外交换机通过数据帧头部的“类型”字段发现该帧内封装着一个ARP报文，将数据帧解封装后上送到自己的ARP协议模块，而ARP模块发现这个ARP报文请求的是192.168.10.254这个IP地址的MAC地址，恰好VLANIF 10的IP地址就是192.168.10.254，因此它直接发送一个ARP Reply对PCI进行回应。</li>
</ul>
<p>（3）PC1处理收到的ARP Reply报文：</p>
<ul>
<li>PC1收到了这个ARP Reply，获知了192.168.10.254对应的MAC地址，因此继续封装数据帧，然后将数据帧从网卡发出。</li>
</ul>
<p>（4）交换机处理收到的单播数据帧：</p>
<ul>
<li>交换机收到这个数据帧，发现这是一个单播数据帧，而且该帧的目的MAC地址正是本机的MAC地址，因此交换机将数据帧解封装，并将里面的数据上送到IP模块进行处理（通过数据帧头部的“类型”字段可以得知数据帧封装着一个IP数据报）。</li>
<li>IP模块读取数据包的目的IP地址后，发现目的IP地址并非本机的IP地址，于是它在路由表中查询这个地址，结果发现有一条本地直连路由匹配（最长掩码匹配原则），而该直连路由的出接口是VLANIF20，因此交换机重新将这个数据包封装成帧。</li>
<li>新的以太网帧头中，源MAC地址填写的是交换机的MAC地址，而目的MAC则需填写192.168.20.1的MAC地址，如果交换机的ARP表中没有相关的表项，那么它需要在VLAN20中发送广播ARPRequest去请求PC3的MAC地址（此过程和1-2过程类似，不在赘述），最后将封装好的数据帧从GE0/0/3接口发出。</li>
</ul>
<p>（5）PC3处理交换机传递的单播数据帧：</p>
<ul>
<li>PC3收到这个数据帧后，解析以太网帧头部，发现目的Mac地址正是自己网卡的Mac地址，通过数据帧头部的“类型”字段发现该帧内封装着一个IP数据报</li>
<li>将IP数据报上送IP协议栈，继续继续IP头部，发现目的IP地址也是自己网卡的IP地址，通IP数据报头部中的“协议”字段发现数据报内还封装上层应用协议的数据</li>
<li>将上层应用协议的数据上送给上层协议模块处理数据。</li>
</ul>
<h2 id="传统型路由器存在的意义"><a href="#传统型路由器存在的意义" class="headerlink" title="传统型路由器存在的意义"></a>传统型路由器存在的意义</h2><p>　　1.路由器的必要性</p>
<p>　　三层交换机的价格，在问世之初非常昂贵，但是现在它们的价格已经下降了许多。目前国外一些廉价机型的售价，折合成人民币后仅为一万多元，而且还在继续下降中。</p>
<p>　　既然三层交换机能够提供比传统型路由器更为高速的路由处理，那么网络中还有使用路由器的必要吗?</p>
<p>　　答案是：“是”。</p>
<p>　　使用路由器的必要性，主要表现在以下几个方面：</p>
<p>　　(1)用于与WAN连接</p>
<p>　　三层交换机终究是“交换机”。也就是说，绝大多数机型只配有LAN(以太网)接口。在少数高端交换机上也有用于连接WAN的串行接口或是ATM接口，但在大多数情况下，连接WAN还是需要用到路由器。</p>
<p>　　(2)保证网络安全</p>
<p>　　在三层交换机上，通过数据包过滤也能确保一定程度的网络安全。但是使用路由器所提供的各种网络安全功能，用户可以构建更为安全可靠的网络。</p>
<p>　　路由器提供的网络安全功能中，除了最基本的数据包过滤功能外，还能基于IPSec构建VPN(VirtualPrivate Network)、利用RADIUS进行用户认证等等。</p>
<p>　　(3)支持除TCP/IP以外的异构网络架构</p>
<p>　　尽管TCP/IP已经成为当前网络协议架构的主流，但还有不少网络利用Novell Netware下的IPX/SPX或Macintosh下的AppleTalk等网络协议。三层交换机中，除了部分高端机型外基本上还只支持TCP/IP。因此，在需要使用除TCP/IP之外其他网络协议的环境下，路由器还是必不可少的。</p>
<p>　　注：在少数高端交换机上，也能支持上述路由器的功能。例如Cisco的Catalyst 6500系列，就可以选择与WAN连接的接口模块;还有可选的基于IPSec实现VPN的模块;并且也能支持TCP/IP以外的其他网络协议。</p>
<p>　　2.路由器和交换机配合构建LAN的实例</p>
<p>　　下面让我们来看一个路由器和交换机搭配构建LAN的实例。</p>
<p><img src="/2021/04/30/VLAN/24.png"></p>
<p>　　利用在各楼层配置的二层交换机定义VLAN，连接TCP/IP客户计算机。各楼层间的VLAN间通信，利用三层交换机的高速路由加以实现。如果网络环境要求高可靠性，还可以考虑冗余配置三层交换机。</p>
<p>　　与WAN的连接，则通过带有各种网络接口的路由器进行。并且，通过路由器的数据包过滤和VPN等功能实现网络安全。此外，使用路由器还能支持Novell Netware等TCP/IP之外的网络。</p>
<p>　　只有在充分掌握了二层、三层交换机以及传统路由器的基础上，才能做到物竞其用，构筑出高效率、高性价比的网络。</p>
<h2 id="使用VLAN设计局域网"><a href="#使用VLAN设计局域网" class="headerlink" title="使用VLAN设计局域网"></a>使用VLAN设计局域网</h2><p>　　1.使用VLAN设计局域网的特点</p>
<p>　　通过使用VLAN构建局域网，用户能够不受物理链路的限制而自由地分割广播域。</p>
<p>　　另外，通过先前提到的路由器与三层交换机提供的VLAN间路由，能够适应灵活多变的网络构成。</p>
<p>　　但是，由于利用VLAN容易导致网络构成复杂化，因此也会造成整个网络的组成难以把握。</p>
<p>　　可以这样说，在利用VLAN时，除了有“网络构成灵活多变”这个优点外，还搭配着“网络构成复杂化”这个缺点。</p>
<p>　　下面，就让我们来看看具体的实例。</p>
<p>　　2.不使用VLAN的局域网中网络构成的改变</p>
<p>　　假设有如图所示的由1台路由器、2台交换机构成的“不使用VLAN构建”的网络。</p>
<p><img src="/2021/04/30/VLAN/25.png"></p>
<p>　　图中的路由器，带有2个LAN接口。左侧的网络是192.168.1.0/24，右侧是192.168.2.0/24。</p>
<p>　　现在如果想将192.168.1.0/24这个网络上的计算机A转移到192.168.2.0/24上去，就需要改变物理连接、将A接到右侧的交换机上。</p>
<p>　　并且，当需要新增一个地址为192.168.3.0/24的网络时，还要在路由器上再占用一个LAN接口并添置一台交换机。而由于这台路由器上只带了2个LAN接口，因此为了新增网络还必须将路由器升级为带有3个以上LAN接口的产品。</p>
<p>　　3.使用VLAN的局域网中网络构成的改变</p>
<p>　　接下来再假设有一个由1台路由器、2台交换机构成的“使用VLAN”的局域网。交换机与交换机、交换机与路由器之间均为汇聚链路;并且假设192.168.1.0/24对应红色VLAN、192.168.2.0/24对应蓝色VLAN。</p>
<p><img src="/2021/04/30/VLAN/26.png"></p>
<p>　　需要将连接在交换机1上192.168.1.0/24这个网段的计算机A转属192.168.2.0/24时，无需更改物理布线。只要在交换机上生成蓝色VLAN，然后将计算机A所连的端口1加入到蓝色VLAN中去，使它成为访问链接即可。</p>
<p>　　然后，根据需要设定计算机A的IP地址、默认网关等信息就可以了。如果IP地址相关的设定是由DHCP获取的，那么在客户机方面无需进行任何设定修改，就可以在不同网段间移动。</p>
<p>　　利用VLAN后，我们可以在免于改动任何物理布线的前提下，自由进行网络的逻辑设计。如果所处的工作环境恰恰需要经常改变网络布局，那么利用VLAN的优势就非常明显了。</p>
<p>　　并且，当需要新增一个地址为192.168.3.0/24的网段时，也只需要在交换机上新建一个对应192.168.3.0/24的VLAN，并将所需的端口加入它的访问链路就可以了。</p>
<p>　　如果网络环境中还需要利用外部路由器，则只要在路由器的汇聚端口上新增一个子接口的设定就可以完成全部操作，而不需要消耗更多的物理接口(LAN接口)。要使用的是三层交换机内部的路由模块，则只需要新设一个VLAN接口即可。</p>
<p>　　网络环境的成长，往往是难以预测的，很可能经常会出现需要分割现有网络或是增加新网络的情况。而充分活用VLAN后，就可以轻易地解决这些问题。</p>
<p>　　4.利用VLAN而导致的网络结构复杂化</p>
<p>　　虽然利用VLAN可以灵活地构建网络，但是同时，它也带来了网络结构复杂化的问题。</p>
<p>　　特别是由于数据流纵横交错，一旦发生故障时，准确定位并排除故障会比较困难。</p>
<p>　　为了便于理解数据流向的复杂化，假设有下图所示的网络。计算机A向计算机C发送数据时，数据流的整体走向如下：</p>
<p>　　计算机A→交换机1→路由器→交换机1→交换机2→计算机C</p>
<p><img src="/2021/04/30/VLAN/27.png"></p>
<p><img src="/2021/04/30/VLAN/28.png"></p>
<p>　　首先计算机A向交换机1送出数据(①)，其后数据被转发给路由器(②)进行VLAN间路由。路由后的数据，再从汇聚链路返回交换机1(③)。由于通信目标计算机C并不直连在交换机1上，因此还需要经过汇聚链路转发到交换机2(④)。在交换机2上，数据最终被转发到C所连的端口2上，这才完成整个流程(⑤)。</p>
<p>　　在这个例子中，仅由2台交换机构成网络，其数据流已经如此复杂，如果构建横跨多台交换机的VLAN的话，每个数据流的流向显然会更加难以把握。</p>
<p>　　5. 网络的逻辑结构与物理结构</p>
<p>　　为了对应日渐复杂化的数据流，管理员需要从“逻辑结构”与“物理结构”两方面入手，把握好网络的现状。</p>
<p>　　物理结构，指的是从物理层和数据链路层观察到的网络的现状，表示了网络的物理布线形态和VLAN的设定等等。</p>
<p>　　而逻辑结构，则表示从网络层以上的层面观察到的网络结构。下面我们就试着以路由器为中心分析一个IP网络的逻辑结构。</p>
<p>　　还是先前的那个例子，描绘了布线形态和VLAN设定的“物理结构”如下图所示。</p>
<p><img src="/2021/04/30/VLAN/29.png"></p>
<p>　　分析这个物理结构并转换成以路由器为中心的逻辑结构后，会得到如下的逻辑结构图。当我们需要进行路由或是数据包过滤的设定时，都必须在逻辑结构的基础上进行。</p>
<p><img src="/2021/04/30/VLAN/30.png"></p>
<p>　　把握这两种网络结构图的区别是十分重要的，特别是在VLAN和三层交换机大行其道的现代企业级网络当中。</p>
<h2 id="VLAN以太网二层接口类型"><a href="#VLAN以太网二层接口类型" class="headerlink" title="VLAN以太网二层接口类型"></a>VLAN以太网二层接口类型</h2><h3 id="Access接口"><a href="#Access接口" class="headerlink" title="Access接口"></a>Access接口</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧,打上PVID，接收。</li>
<li>Tagged数据帧，与PVID比较，相同则接收;不同则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID与PVID比较，相同则剥离标签发送;不同则丢弃。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Aceess.png"></p>
<h3 id="Trunk接口"><a href="#Trunk接口" class="headerlink" title="Trunk接口"></a>Trunk接口</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧，打上PVID，且VID在允许列表中，则接收;VID不在允许列表,则丢弃。</li>
<li>Tagged数据帧，查看VID是否在允许列表中，在允许列表中，则接收;VID不在允许列表，则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID在允许列表中，且VID与PVID一致，则剥离标签发送。</li>
<li>VID在允许列表，但VID与PVID不一致，则直接带标签发送。</li>
<li>不在允许列表中，则直接丢弃。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Trunk.png"></p>
<h3 id="Hybrid接口-前两者混合接口"><a href="#Hybrid接口-前两者混合接口" class="headerlink" title="Hybrid接口(前两者混合接口)"></a>Hybrid接口(前两者混合接口)</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧，打上PVID，且VID在允许列表中，则接收;VID不在允许列表中，则丢弃。</li>
<li>Tagged数据帧,查看VID是否在允许列表中，在允许列表中，则接收;VID不在允许列表，则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID不在允许列表中，直接丢弃。</li>
<li>VID在Untagged列表中，剥离标签发送。</li>
<li>VID在Tagged列表中，带标签直接发送。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Hybrid.png"></p>
<h2 id="VLAN基础配置命令"><a href="#VLAN基础配置命令" class="headerlink" title="VLAN基础配置命令"></a>VLAN基础配置命令</h2><p>1.创建VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>通过此命令创建VLAN并进入VLAN视图，如果VLAN已存在，直接进入该VLAN的视图。</p>
<p>vlan-id是整数形式，取值范围是1~4094。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] vlan batch &#123; vlan-id1 [ to vlan-id2 ] &#125;</span><br></pre></td></tr></table></figure>
<p>通过此命令批量创建VLAN。其中:</p>
<ul>
<li>batch:指定批量创建的VLAN ID。</li>
<li>vlan-id1:表示第一个VLAN的编号。</li>
<li>vlan-id2:表示最后一个VLAN的编号。</li>
</ul>
<h3 id="Access接口配置命令"><a href="#Access接口配置命令" class="headerlink" title="Access接口配置命令"></a>Access接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port link-type access</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Access。<br>2.配置Access接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port default vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的缺省VLAN并同时加入这个VLAN。</p>
<ul>
<li>vlan-id:配置缺省VLAN的编号。整数形式，取值范围是1~4094。</li>
</ul>
<h3 id="Trunk接口配置命令"><a href="#Trunk接口配置命令" class="headerlink" title="Trunk接口配置命令"></a>Trunk接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Trunk。<br>2.配置Trunk接口加入指定VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan &#123; &#123; vlan-id1 [ to vlan-id2 ] &#125;| all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Trunk类型接口加入的VLAN。<br>3.(可选)配置Trunk接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port trunk pvid vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Trunk类型接口的缺省VLAN。</p>
<h3 id="Hybrid接口配置命令"><a href="#Hybrid接口配置命令" class="headerlink" title="Hybrid接口配置命令"></a>Hybrid接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] port link-type hybrid</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Hybrid。<br>2.配置Hybrid接口加入指定VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid untagged vlan &#123; &#123; vlan-id1 [ to vlan-id2 ] &#125; | all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Untagged方式通过接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid tagged vlan &#123; &#123; vlan-id1 [ to vlan-id2] &#125; | all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Tagged方式通过接口。<br>3.(可选)配置Hybrid接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid pvid vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口的缺省VLAN。</p>
<h3 id="基于MAC地址划分VLAN配置命令"><a href="#基于MAC地址划分VLAN配置命令" class="headerlink" title="基于MAC地址划分VLAN配置命令"></a>基于MAC地址划分VLAN配置命令</h3><p>1.关联MAC地址与VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-vlan10] mac-vlan mac-address mac-address [ mac-address-mask | mac-address-mask-length ]</span><br></pre></td></tr></table></figure>
<p>通过此命令配置MAC地址与VLAN关联。</p>
<ul>
<li>mac-address:指定与VLAN关联的MAC地址。格式为H-H-H。其中H为4位的十六进制数，可以输入1~4位，如00e0、fcO1。当输入不足4位时，表示前面的几位为0，如:输入e0，等同于O0e0。MAC地址不可设置为O000-0000-0000、FFFF-FFFF-FFFF和组播地址。</li>
<li>mac-address-mask:指定MAC地址掩码。格式为H-H-H，其中H为1至4位的十六进制数。</li>
<li> mac-address-mask-length:指定MAC地址掩码长度。整数形式，取值范围是1~48。</li>
</ul>
<p>2.使能MAC地址与VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] mac-vlan enable</span><br></pre></td></tr></table></figure>
<p>通过此命令使能接口的MAC VLAN功能。</p>
<h2 id="VLAN间路由子接口配置命令"><a href="#VLAN间路由子接口配置命令" class="headerlink" title="VLAN间路由子接口配置命令"></a>VLAN间路由子接口配置命令</h2><p><img src="/2021/04/30/VLAN/%E5%AD%90%E6%8E%A5%E5%8F%A3.png"></p>
<h2 id="VLANIF接口接口配置"><a href="#VLANIF接口接口配置" class="headerlink" title="VLANIF接口接口配置"></a>VLANIF接口接口配置</h2><p><img src="/2021/04/30/VLAN/VLANIF.png"></p>
<h2 id="二层接口和三层接口对比"><a href="#二层接口和三层接口对比" class="headerlink" title="二层接口和三层接口对比"></a>二层接口和三层接口对比</h2><table>
<thead>
<tr>
<th>二层接口(Layer2 Interface )</th>
<th>三层接口(Layer3 Interface )</th>
</tr>
</thead>
<tbody><tr>
<td>二层接口不能配置IP地址</td>
<td>三层接口可以配置IP地址</td>
</tr>
<tr>
<td>二层接口不具备MAC地址</td>
<td>三层接口具备MAC地址</td>
</tr>
<tr>
<td>当二层接口收到数据帧时，设备在其MAC地址表中查询该帧的目的MAC地址，找到匹配的MAC地址表项后按照该表项的指示转发帧;如果没有找到匹配的MAC地址表项，则将帧进行泛洪。</td>
<td>三层接口收到数据帧后，如果数据帧的目的MAC地址与设备的本地MAC地址相同，则将数据帧解除封装，然后在路由表中查询数据包的目的IP地址，找到匹配的路由表项后按照该表项的指示转发包;如果没有找到匹配的表项，则将包丢弃。</td>
</tr>
<tr>
<td>典型的二层接口如二层交换机（只具备二层交换能力的交换机)的物理接口;大部分三层交换机（同时具备二层及三层交换能力的交换机）的物理接口缺省为二层接口。</td>
<td>典型的三层接口如路由器的三层接口。某些三层交换机的物理接口可以切换成三层模式。此外除了物理三层接口，还存在逻辑三层接口，例如交换机的VLANIF，或者网络设备上的逻辑子接口，如GEO/0/1.10。</td>
</tr>
<tr>
<td>二层接口并不隔离广播域，当二层接口收到广播帧时，会将数据帧进行泛洪。</td>
<td>三层接口隔离广播域，当三层接口收到广播帧时，缺省不会进行泛洪，而是直接终结。</td>
</tr>
</tbody></table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
