<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="my blog">
<meta property="og:type" content="website">
<meta property="og:title" content="zsy&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="zsy&#39;s blog">
<meta property="og:description" content="my blog">
<meta property="og:locale">
<meta property="article:author" content="张思宇">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>zsy's blog</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">zsy's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">just simple</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/30/VLAN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/30/VLAN/" itemprop="url">VLAN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-30T14:47:09+08:00">
                2021-04-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么需要VLAN"><a href="#为什么需要VLAN" class="headerlink" title="为什么需要VLAN"></a>为什么需要VLAN</h2><p>　　1. 什么是VLAN?</p>
<p>　　VLAN(Virtual LAN)，翻译成中文是“虚拟局域网”。LAN可以是由少数几台家用计算机构成的网络，也可以是数以百计的计算机构成的企业网络。VLAN所指的LAN特指使用路由器分割的网络——也就是广播域。</p>
<p>　　在此让我们先复习一下广播域的概念。广播域，指的是广播帧(目标MAC地址全部为1)所能传递到的范围，亦即能够直接通信的范围。严格地说，并不仅仅是广播帧，多播帧(Multicast Frame)和目标不明的单播帧(Unknown Unicast Frame)也能在同一个广播域中畅行无阻。</p>
<p>　　本来，二层交换机只能构建单一的广播域，不过使用VLAN功能后，它能够将网络分割成多个广播域。</p>
<p>　　2.未分割广播域时……</p>
<p>　　那么，为什么需要分割广播域呢?那是因为，如果仅有一个广播域，有可能会影响到网络整体的传输性能。具体原因，请参看附图加深理解。</p>
<p><img src="/2021/04/30/VLAN/1.png"></p>
<p>　　图中，是一个由5台二层交换机(交换机1～5)连接了大量客户机构成的网络。假设这时，计算机A需要与计算机B通信。在基于以太网的通信中，必须在数据帧中指定目标MAC地址才能正常通信，因此计算机A必须先广播“ARP请求(ARP Request)信息”，来尝试获取计算机B的MAC地址。</p>
<p>　　交换机1收到广播帧(ARP请求)后，会将它转发给除接收端口外的其他所有端口，也就是Flooding了。接着，交换机2收到广播帧后也会Flooding。交换机3、4、5也还会Flooding。最终ARP请求会被转发到同一网络中的所有客户机上。</p>
<p><img src="/2021/04/30/VLAN/2.png"></p>
<p>　　请大家注意一下，这个ARP请求原本是为了获得计算机B的MAC地址而发出的。也就是说：只要计算机B能收到就万事大吉了。可是事实上，数据帧却传遍整个网络，导致所有的计算机都收到了它。如此一来，一方面广播信息消耗了网络整体的带宽，另一方面，收到广播信息的计算机还要消耗一部分CPU时间来对它进行处理。造成了网络带宽和CPU运算能力的大量无谓消耗。</p>
<p>　　3. 广播信息是那么经常发出的吗?</p>
<p>　　读到这里，您也许会问：广播信息真是那么频繁出现的吗?</p>
<p>　　答案是：是的!实际上广播帧会非常频繁地出现。利用TCP/IP协议栈通信时，除了前面出现的ARP外，还有可能需要发出DHCP、RIP等很多其他类型的广播信息。</p>
<p>　　ARP广播，是在需要与其他主机通信时发出的。当客户机请求DHCP服务器分配IP地址时，就必须发出DHCP的广播。而使用RIP作为路由协议时，每隔30秒路由器都会对邻近的其他路由器广播一次路由信息。RIP以外的其他路由协议使用多播传输路由信息，这也会被交换机转发(Flooding)。除了TCP/IP以外，NetBEUI、IPX和Apple Talk等协议也经常需要用到广播。例如在Windows下双击打开“网络计算机”时就会发出广播(多播)信息。(Windows XP除外……)</p>
<p>　　总之，广播就在我们身边。下面是一些常见的广播通信：</p>
<p>　　(1)ARP请求：建立IP地址和MAC地址的映射关系。</p>
<p>　　(2)RIP：一种路由协议。</p>
<p>　　(3)DHCP：用于自动设定IP地址的协议。</p>
<p>　　(4)NetBEUI：Windows下使用的网络协议。</p>
<p>　　(5)IPX：NovellNetware使用的网络协议。</p>
<p>　　(6)Apple Talk：苹果公司的Macintosh计算机使用的网络协议。</p>
<p>　　如果整个网络只有一个广播域，那么一旦发出广播信息，就会传遍整个网络，并且对网络中的主机带来额外的负担。因此，在设计LAN时，需要注意如何才能有效地分割广播域。</p>
<p>　　4.广播域的分割与VLAN的必要性</p>
<p>　　分割广播域时，一般都必须使用到路由器。使用路由器后，可以以路由器上的网络接口(LAN Interface)为单位分割广播域。</p>
<p>　　但是，通常情况下路由器上不会有太多的网络接口，其数目多在1～4个左右。随着宽带连接的普及，宽带路由器(或者叫IP共享器)变得较为常见，但是需要注意的是，它们上面虽然带着多个(一般为4个左右)连接LAN一侧的网络接口，但那实际上是路由器内置的交换机，并不能分割广播域。</p>
<p>　　况且使用路由器分割广播域的话，所能分割的个数完全取决于路由器的网络接口个数，使得用户无法自由地根据实际需要分割广播域。</p>
<p>　　与路由器相比，二层交换机一般带有多个网络接口。因此如果能使用它分割广播域，那么无疑运用上的灵活性会大大提高。</p>
<p>　　用于在二层交换机上分割广播域的技术，就是VLAN。通过利用VLAN，我们可以自由设计广播域的构成，提高网络设计的自由度。</p>
<h2 id="实现VLAN的机制"><a href="#实现VLAN的机制" class="headerlink" title="实现VLAN的机制"></a>实现VLAN的机制</h2><p>　　1. 实现VLAN的机制</p>
<p>　　在理解了“为什么需要VLAN”之后，接下来让我们来了解一下交换机是如何使用VLAN分割广播域的。</p>
<p>　　首先，在一台未设置任何VLAN的二层交换机上，任何广播帧都会被转发给除接收端口外的所有其他端口(Flooding)。例如，计算机A发送广播信息后，会被转发给端口2、3、4。</p>
<p><img src="/2021/04/30/VLAN/3.png"></p>
<p>　　这时，如果在交换机上生成红、蓝两个VLAN;同时设置端口1、2属于红色VLAN、端口3、4属于蓝色VLAN。再从A发出广播帧的话，交换机就只会把它转发给同属于一个VLAN的其他端口——也就是同属于红色VLAN的端口2，不会再转发给属于蓝色VLAN的端口。</p>
<p>　　同样，C发送广播信息时，只会被转发给其他属于蓝色VLAN的端口，不会被转发给属于红色VLAN的端口。</p>
<p><img src="/2021/04/30/VLAN/4.png"></p>
<p>　　就这样，VLAN通过限制广播帧转发的范围分割了广播域。上图中为了便于说明，以红、蓝两色识别不同的VLAN，在实际使用中则是用“VLAN ID”来区分的。</p>
<p>　　2.直观地描述VLAN</p>
<p>　　如果要更为直观地描述VLAN的话，我们可以把它理解为将一台交换机在逻辑上分割成了数台交换机。在一台交换机上生成红、蓝两个VLAN，也可以看作是将一台交换机换做一红一蓝两台虚拟的交换机。</p>
<p><img src="/2021/04/30/VLAN/5.png"></p>
<p>　　在红、蓝两个VLAN之外生成新的VLAN时，可以想象成又添加了新的交换机。</p>
<p>　　但是，VLAN生成的逻辑上的交换机是互不相通的。因此，在交换机上设置VLAN后，如果未做其他处理，VLAN间是无法通信的。</p>
<p>　　明明接在同一台交换机上，但却偏偏无法通信——这个事实也许让人难以接受。但它既是VLAN方便易用的特征，又是使VLAN令人难以理解的原因。</p>
<p>　　3. 需要VLAN间通信时怎么办</p>
<p>　　那么，当我们需要在不同的VLAN间通信时又该如何是好呢?</p>
<p>　　请大家再次回忆一下：VLAN是广播域。而通常两个广播域之间由路由器连接，广播域之间来往的数据包都是由路由器中继的。因此，VLAN间的通信也需要路由器提供中继服务，这被称作“VLAN间路由”。</p>
<p>　　VLAN间路由，可以使用普通的路由器，也可以使用三层交换机。其中的具体内容，等有机会再细说吧。在这里希望大家先记住不同VLAN间互相通信时需要用到路由功能。</p>
<p>　　VLAN的访问链接(Access Link)</p>
<p>　　1.交换机的端口类型</p>
<p>　　交换机的端口，可以分为以下两种：</p>
<p>　　(1)访问链接(Access Link)</p>
<p>　　(2)汇聚链接(Trunk Link)</p>
<p>　　接下来就让我们来依次学习这两种不同端口的特征。这一讲，首先学习“访问链接”。</p>
<p>　　2.访问链接</p>
<p>　　访问链接，指的是“只属于一个VLAN，且仅向该VLAN转发数据帧”的端口。在大多数情况下，访问链接所连的是客户机。</p>
<p>　　通常设置VLAN的顺序是：</p>
<p>　　(1)生成VLAN</p>
<p>　　(2)设定访问链接(决定各端口属于哪一个VLAN)</p>
<p>　　设定访问链接的手法，可以是事先固定的、也可以是根据所连的计算机而动态改变设定。前者被称为“静态VLAN”、后者自然就是“动态VLAN”了。</p>
<p>　　● 静态VLAN——基于端口</p>
<p>　　静态VLAN又被称为基于端口的VLAN(PortBased VLAN)。顾名思义，就是明确指定各端口属于哪个VLAN的设定方法。</p>
<p><img src="/2021/04/30/VLAN/6.png"></p>
<p>　　由于需要一个个端口地指定，因此当网络中的计算机数目超过一定数字(比如数百台)后，设定操作就会变得烦杂无比。并且，客户机每次变更所连端口，都必须同时更改该端口所属VLAN的设定——这显然不适合那些需要频繁改变拓补结构的网络。</p>
<p>　　● 动态VLAN</p>
<p>　　另一方面，动态VLAN则是根据每个端口所连的计算机，随时改变端口所属的VLAN。这就可以避免上述的更改设定之类的操作。动态VLAN可以大致分为3类：</p>
<p>　　(1)基于MAC地址的VLAN(MAC Based VLAN)</p>
<p>　　(2)基于子网的VLAN(Subnet Based VLAN)</p>
<p>　　(3)基于用户的VLAN(User Based VLAN)</p>
<p>　　其间的差异，主要在于根据OSI参照模型哪一层的信息决定端口所属的VLAN。</p>
<p><img src="/2021/04/30/VLAN/VLAN%E9%97%B4%E5%88%92%E5%88%86.png"></p>
<p>　　● 基于MAC地址的VLAN</p>
<p>　　基于MAC地址的VLAN，就是通过查询并记录端口所连计算机上网卡的MAC地址来决定端口的所属。假定有一个MAC地址“A”被交换机设定为属于VLAN “10”，那么不论MAC地址为“A”的这台计算机连在交换机哪个端口，该端口都会被划分到VLAN 10中去。计算机连在端口1时，端口1属于VLAN 10;而计算机连在端口2时，则是端口2属于VLAN 10。</p>
<p><img src="/2021/04/30/VLAN/7.png"></p>
<p>　　由于是基于MAC地址决定所属VLAN的，因此可以理解为这是一种在OSI的第二层设定访问链接的办法。</p>
<p>　　但是，基于MAC地址的VLAN，在设定时必须调查所连接的所有计算机的MAC地址并加以登录。而且如果计算机交换了网卡，还是需要更改设定。</p>
<p>　　● 基于IP地址的VLAN</p>
<p>　　基于子网的VLAN，则是通过所连计算机的IP地址，来决定端口所属VLAN的。不像基于MAC地址的VLAN，即使计算机因为交换了网卡或是其他原因导致MAC地址改变，只要它的IP地址不变，就仍可以加入原先设定的VLAN。</p>
<p><img src="/2021/04/30/VLAN/8.png"></p>
<p>　　因此，与基于MAC地址的VLAN相比，能够更为简便地改变网络结构。IP地址是OSI参照模型中第三层的信息，所以我们可以理解为基于子网的VLAN是一种在OSI的第三层设定访问链接的方法。</p>
<p>　　基于用户的VLAN，则是根据交换机各端口所连的计算机上当前登录的用户，来决定该端口属于哪个VLAN。这里的用户识别信息，一般是计算机操作系统登录的用户，比如可以是Windows域中使用的用户名。这些用户名信息，属于OSI第四层以上的信息。</p>
<p>　　总的来说，决定端口所属VLAN时利用的信息在OSI中的层面越高，就越适于构建灵活多变的网络。</p>
<p>　　VLAN的汇聚链接(Trunk Link)</p>
<p>　　1.需要设置跨越多台交换机的VLAN时……</p>
<p>　　到此为止，我们学习的都是使用单台交换机设置VLAN时的情况。那么，如果需要设置跨越多台交换机的VLAN时又如何呢?</p>
<p>　　在规划企业级网络时，很有可能会遇到隶属于同一部门的用户分散在同一座建筑物中的不同楼层的情况，这时可能就需要考虑到如何跨越多台交换机设置VLAN的问题了。假设有如下图所示的网络，且需要将不同楼层的A、C和B、D设置为同一个VLAN。</p>
<p><img src="/2021/04/30/VLAN/9.png"></p>
<p>　　这时最关键的就是“交换机1和交换机2该如何连接才好呢?”</p>
<p>　　最简单的方法，自然是在交换机1和交换机2上各设一个红、蓝VLAN专用的接口并互联了。</p>
<p><img src="/2021/04/30/VLAN/10.png"></p>
<p>　　但是，这个办法从扩展性和管理效率来看都不好。例如，在现有网络基础上再新建VLAN时，为了让这个VLAN能够互通，就需要在交换机间连接新的网线。建筑物楼层间的纵向布线是比较麻烦的，一般不能由基层管理人员随意进行。并且，VLAN越多，楼层间(严格地说是交换机间)互联所需的端口也越来越多，交换机端口的利用效率低是对资源的一种浪费、也限制了网络的扩展。</p>
<p>　　为了避免这种低效率的连接方式，人们想办法让交换机间互联的网线集中到一根上，这时使用的就是汇聚链接(Trunk Link)。</p>
<p>　　2.何谓汇聚链接?</p>
<p>　　汇聚链接(Trunk Link)指的是能够转发多个不同VLAN的通信的端口。</p>
<p>　　汇聚链路上流通的数据帧，都被附加了用于识别分属于哪个VLAN的特殊信息。</p>
<p>　　现在再让我们回过头来考虑一下刚才那个网络如果采用汇聚链路又会如何呢?用户只需要简单地将交换机间互联的端口设定为汇聚链接就可以了。这时使用的网线还是普通的UTP线，而不是什么其他的特殊布线。图例中是交换机间互联，因此需要用交叉线来连接。</p>
<p>　　接下来，让我们具体看看汇聚链接是如何实现跨越交换机间的VLAN的。</p>
<p>　　A发送的数据帧从交换机1经过汇聚链路到达交换机2时，在数据帧上附加了表示属于红色VLAN的标记。</p>
<p>　　交换机2收到数据帧后，经过检查VLAN标识发现这个数据帧是属于红色VLAN的，因此去除标记后根据需要将复原的数据帧只转发给其他属于红色VLAN的端口。这时的转送，是指经过确认目标MAC地址并与MAC地址列表比对后只转发给目标MAC地址所连的端口。只有当数据帧是一个广播帧、多播帧或是目标不明的帧时，它才会被转发到所有属于红色VLAN的端口。</p>
<p>　　蓝色VLAN发送数据帧时的情形也与此相同。</p>
<p><img src="/2021/04/30/VLAN/11.png"></p>
<p>　　通过汇聚链路时附加的VLAN识别信息，有可能支持标准的“IEEE 802.1Q”协议，也可能是Cisco产品独有的“ISL(Inter Switch Link)”。如果交换机支持这些规格，那么用户就能够高效率地构筑横跨多台交换机的VLAN。</p>
<p>　　另外，汇聚链路上流通着多个VLAN的数据，自然负载较重。因此，在设定汇聚链接时，有一个前提就是必须支持100Mbps以上的传输速度。</p>
<p>　　另外，默认条件下，汇聚链接会转发交换机上存在的所有VLAN的数据。换一个角度看，可以认为汇聚链接(端口)同时属于交换机上所有的VLAN。由于实际应用中很可能并不需要转发所有VLAN的数据，因此为了减轻交换机的负载、也为了减少对带宽的浪费，我们可以通过用户设定限制能够经由汇聚链路互联的VLAN。</p>
<p>　　关于IEEE 802.1Q和ISL的具体内容，将在下一讲中提到。</p>
<p>　　3.访问链接的总结</p>
<p>　　综上所述，设定访问链接的手法有静态VLAN和动态VLAN两种，其中动态VLAN又可以继续细分成几个小类。</p>
<p>　　其中基于子网的VLAN和基于用户的VLAN有可能是网络设备厂商使用独有的协议实现的，不同厂商的设备之间互联有可能出现兼容性问题;因此在选择交换机时，一定要注意事先确认。</p>
<p>　　下表总结了静态VLAN和动态VLAN的相关信息。</p>
<p>　　种类解说</p>
<p>　　静态VLAN(基于端口的VLAN)将交换机的各端口固定指派给VLAN</p>
<p>　　动态VLAN基于MAC地址的VLAN根据各端口所连计算机的MAC地址设定</p>
<p>　　基于子网的VLAN根据各端口所连计算机的IP地址设定</p>
<p>　　基于用户的VLAN根据端口所连计算机上登录用户设定</p>
<p>　　VLAN的汇聚方式——IEEE802.1Q与ISL</p>
<p>　　1.汇聚方式</p>
<p>　　在交换机的汇聚链接上，可以通过对数据帧附加VLAN信息，构建跨越多台交换机的VLAN。</p>
<p>　　附加VLAN信息的方法，最具有代表性的有：</p>
<p>　　(1)IEEE 802.1Q</p>
<p>　　(2)ISL</p>
<p>　　现在就让我们看看这两种协议分别如何对数据帧附加VLAN信息。</p>
<p>　　2.IEEE 802.1Q</p>
<p>　　IEEE 802.1Q，俗称“Dot One Q”，是经过IEEE认证的对数据帧附加VLAN识别信息的协议。</p>
<p>　　在此，请大家先回忆一下以太网数据帧的标准格式。</p>
<p>　　IEEE 802.1Q所附加的VLAN识别信息，位于数据帧中“发送源MAC地址”与“类别域”(Type Field)之间。具体内容为2字节的TPID(Tag Protocol IDentifier)和2字节的TCI(Tag Control Information)，共计4字节。</p>
<p>　　在数据帧中添加了4字节的内容，那么CRC值自然也会有所变化。这时数据帧上的CRC是插入TPID、TCI后，对包括它们在内的整个数据帧重新计算后所得的值。</p>
<p><img src="/2021/04/30/VLAN/12.png"></p>
<p>　　而当数据帧离开汇聚链路时，TPID和TCI会被去除，这时还会进行一次CRC的重新计算。</p>
<p>　　TPID字段在以太网报文中所处位置与不带VLAN Tag的报文中协议类型字段所处位置相同。TPID的值固定为0x8100，它标示网络帧承载的802.1Q类型，交换机通过它来确定数据帧内附加了基于IEEE 802.1Q的VLAN信息。而实质上的VLAN ID，是TCI中的12位元。由于总共有12位，因此最多可供识别4096个VLAN。</p>
<p>　　基于IEEE 802.1Q附加的VLAN信息，就像在传递物品时附加的标签。因此，它也被称作“标签型VLAN”(Tagging VLAN)。</p>
<p>　　3.ISL(Inter Switch Link)</p>
<p>　　ISL，是Cisco产品支持的一种与IEEE 802.1Q类似的、用于在汇聚链路上附加VLAN信息的协议。</p>
<p>　　使用ISL后，每个数据帧头部都会被附加26字节的“ISL包头(ISL Header)”，并且在帧尾带上通过对包括ISL包头在内的整个数据帧进行计算后得到的4字节CRC值。换而言之，就是总共增加了30字节的信息。</p>
<p>　　在使用ISL的环境下，当数据帧离开汇聚链路时，只要简单地去除ISL包头和新CRC就可以了。由于原先的数据帧及其CRC都被完整保留，因此无需重新计算CRC。</p>
<p><img src="/2021/04/30/VLAN/13.png"></p>
<p>　　ISL有如用ISL包头和新CRC将原数据帧整个包裹起来，因此也被称为“封装型VLAN”(Encapsulated VLAN)。</p>
<p>　　需要注意的是，不论是IEEE802.1Q的“Tagging VLAN”，还是ISL的“Encapsulated VLAN”，都不是很严密的称谓。不同的书籍与参考资料中，上述词语有可能被混合使用，因此需要大家在学习时格外注意。</p>
<p>　　并且由于ISL是Cisco独有的协议，因此只能用于Cisco网络设备之间的互联。</p>
<h2 id="VLAN间路由"><a href="#VLAN间路由" class="headerlink" title="VLAN间路由"></a>VLAN间路由</h2><p>1.VLAN间路由的必要性</p>
<p>　　根据目前为止学习的知识，我们已经知道两台计算机即使连接在同一台交换机上，只要所属的VLAN不同就无法直接通信。接下来我们将要学习的就是如何在不同的VLAN间进行路由，使分属不同VLAN的主机能够互相通信。</p>
<p>　　首先，先来复习一下为什么不同VLAN间不通过路由就无法通信。在LAN内的通信，必须在数据帧头中指定通信目标的MAC地址。而为了获取MAC地址，TCP/IP协议下使用的是ARP。ARP解析MAC地址的方法，则是通过广播。也就是说，如果广播报文无法到达，那么就无从解析MAC地址，亦即无法直接通信。</p>
<p>　　计算机分属不同的VLAN，也就意味着分属不同的广播域，自然收不到彼此的广播报文。因此，属于不同VLAN的计算机之间无法直接互相通信。为了能够在VLAN间通信，需要利用OSI参照模型中更高一层——网络层的信息(IP地址)来进行路由。关于路由的具体内容，以后有机会再详细解说吧。</p>
<p>　　路由功能，一般主要由路由器提供。但在今天的局域网里，我们也经常利用带有路由功能的交换机——三层交换机(Layer 3 Switch)来实现。接下来就让我们分别看看使用路由器和三层交换机进行VLAN间路由时的情况。</p>
<p>2.使用路由器进行VLAN间路由</p>
<p>　　在使用路由器进行VLAN间路由时，与构建横跨多台交换机的VLAN时的情况类似，我们还是会遇到“该如何连接路由器与交换机”这个问题。路由器和交换机的接线方式，大致有以下两种：</p>
<p>　　(1)将路由器与交换机上的每个VLAN分别连接</p>
<p>　　(2)不论VLAN有多少个，路由器与交换机都只用一条网线连接</p>
<p>　　最容易想到的，当然还是“把路由器和交换机以VLAN为单位分别用网线连接”了。将交换机上用于和路由器互联的每个端口设为访问链接(Access Link)，然后分别用网线与路由器上的独立端口互联。如下图所示，交换机上有2个VLAN，那么就需要在交换机上预留2个端口用于与路由器互联;路由器上同样需要有2个端口;两者之间用2条网线分别连接。</p>
<p><img src="/2021/04/30/VLAN/14.png"></p>
<p>　　如果采用这个办法，大家应该不难想象它的扩展性很成问题。每增加一个新的VLAN，都需要消耗路由器的端口和交换机上的访问链接，而且还需要重新布设一条网线。而路由器，通常不会带有太多LAN接口的。新建VLAN时，为了对应增加的VLAN所需的端口，就必须将路由器升级成带有多个LAN接口的高端产品，这部分成本、还有重新布线所带来的开销，都使得这种接线法成为一种不受欢迎的办法。</p>
<p>　　那么，第二种办法“不论VLAN数目多少，都只用一条网线连接路由器与交换机”呢?当使用一条网线连接路由器与交换机、进行VLAN间路由时，需要用到汇聚链接。</p>
<p>　　具体实现过程为：首先将用于连接路由器的交换机端口设为汇聚链接(Trunk Link)，而路由器上的端口也必须支持汇聚链路。双方用于汇聚链路的协议自然也必须相同。接着在路由器上定义对应各个VLAN的“子接口”(Sub Interface)。尽管实际与交换机连接的物理端口只有一个，但在理论上我们可以把它分割为多个虚拟端口。</p>
<p>　　VLAN将交换机从逻辑上分割成了多台，因而用于VLAN间路由的路由器，也必须拥有分别对应各个VLAN的虚拟接口。</p>
<p><img src="/2021/04/30/VLAN/15.png"></p>
<p>　　采用这种方法的话，即使之后在交换机上新建VLAN，仍只需要一条网线连接交换机和路由器。用户只需要在路由器上新设一个对应新VLAN的子接口就可以了。与前面的方法相比，扩展性要强得多，也不用担心需要升级LAN接口数不足的路由器或是重新布线。</p>
<p>3.同一VLAN内的通信</p>
<p>　　接下来，我们继续学习使用汇聚链路连接交换机与路由器时，VLAN间路由是如何进行的。如下图所示，为各台计算机以及路由器的子接口设定IP地址。</p>
<p><img src="/2021/04/30/VLAN/16.png"></p>
<p>　　红色VLAN(VLAN ID=1)的网络地址为192.168.1.0/24，蓝色VLAN(VLAN ID=2)的网络地址为192.168.2.0/24。各计算机的MAC地址分别为A/B/C/D，路由器汇聚链接端口的MAC地址为R。交换机通过对各端口所连计算机MAC地址的学习，生成如下的MAC地址列表。</p>
<p>　　首先考虑计算机A与同一VLAN内的计算机B之间通信时的情形。</p>
<p>　　计算机A发出ARP请求信息，请求解析B的MAC地址。交换机收到数据帧后，检索MAC地址列表中与收信端口同属一个VLAN的表项。结果发现，计算机B连接在端口2上，于是交换机将数据帧转发给端口2，最终计算机B收到该帧。收发信双方同属一个VLAN之内的通信，一切处理均在交换机内完成。</p>
<p><img src="/2021/04/30/VLAN/17.png"></p>
<p>4.不同VLAN间的通信</p>
<p>　　接下来是这一讲的核心内容，不同VLAN间的通信。让我们来考虑一下计算机A与计算机C之间通信时的情况。</p>
<p><img src="/2021/04/30/VLAN/18.png"></p>
<p>　　计算机A从通信目标的IP地址(192.168.2.1)得出C与本机不属于同一个网段。因此会向设定的默认网关(DefaultGateway，GW)转发数据帧。在发送数据帧之前，需要先用ARP获取路由器的MAC地址。</p>
<p>　　得到路由器的MAC地址R后，接下来就是按图中所示的步骤发送往C去的数据帧。①的数据帧中，目标MAC地址是路由器的地址R、但内含的目标IP地址仍是最终要通信的对象C的地址。这一部分的内容，涉及到局域网内经过路由器转发时的通信步骤，有机会再详细解说吧。</p>
<p>　　交换机在端口1上收到①的数据帧后，检索MAC地址列表中与端口1同属一个VLAN的表项。由于汇聚链路会被看作属于所有的VLAN，因此这时交换机的端口6也属于被参照对象。这样交换机就知道往MAC地址R发送数据帧，需要经过端口6转发。</p>
<p>　　从端口6发送数据帧时，由于它是汇聚链接，因此会被附加上VLAN识别信息。由于原先是来自红色VLAN的数据帧，因此如图中②所示，会被加上红色VLAN的识别信息后进入汇聚链路。路由器收到②的数据帧后，确认其VLAN识别信息，由于它是属于红色VLAN的数据帧，因此交由负责红色VLAN的子接口接收。</p>
<p>　　接着，根据路由器内部的路由表，判断该向哪里中继。</p>
<p>　　由于目标网络192.168.2.0/24是蓝色VLAN，，且该网络通过子接口与路由器直连，因此只要从负责蓝色VLAN的子接口转发就可以了。这时，数据帧的目标MAC地址被改写成计算机C的目标地址;并且由于需要经过汇聚链路转发，因此被附加了属于蓝色VLAN的识别信息。这就是图中③的数据帧。</p>
<p>　　交换机收到③的数据帧后，根据VLAN标识信息从MAC地址列表中检索属于蓝色VLAN的表项。由于通信目标——计算机C连接在端口3上、且端口3为普通的访问链接，因此交换机会将数据帧去除VLAN识别信息后(数据帧④)转发给端口3，最终计算机C才能成功地收到这个数据帧。</p>
<p>　　进行VLAN间通信时，即使通信双方都连接在同一台交换机上，也必须经过：“发送方——交换机——路由器——交换机——接收方”这样一个流程。</p>
<p>　　三层交换机</p>
<p>　　1.使用路由器进行VLAN间路由时的问题</p>
<p>　　现在，我们知道只要能提供VLAN间路由，就能够使分属不同VLAN的计算机互相通信。但是，如果使用路由器进行VLAN间路由的话，随着VLAN之间流量的不断增加，很可能导致路由器成为整个网络的瓶颈。</p>
<p>　　交换机使用被称为ASIC(ApplicationSpecified Integrated Circuit)的专用硬件芯片处理数据帧的交换操作，在很多机型上都能实现以缆线速度(Wired Speed)交换。而路由器，则基本上是基于软件处理的。即使以缆线速度接收到数据包，也无法在不限速的条件下转发出去，因此会成为速度瓶颈。就VLAN间路由而言，流量会集中到路由器和交换机互联的汇聚链路部分，这一部分尤其特别容易成为速度瓶颈。并且从硬件上看，由于需要分别设置路由器和交换机，在一些空间狭小的环境里可能连设置的场所都成问题。</p>
<p>　　2.三层交换机(Layer 3 Switch)</p>
<p>　　为了解决上述问题，三层交换机应运而生。三层交换机，本质上就是“带有路由功能的(二层)交换机”。路由属于OSI参照模型中第三层网络层的功能，因此带有第三层路由功能的交换机才被称为“三层交换机”。</p>
<p>　　关于三层交换机的内部结构，可以参照下面的简图。</p>
<p><img src="/2021/04/30/VLAN/19.png"></p>
<p>　　在一台本体内，分别设置了交换机模块和路由器模块;而内置的路由模块与交换模块相同，使用ASIC硬件处理路由。因此，与传统的路由器相比，可以实现高速路由。并且，路由与交换模块是汇聚链接的，由于是内部连接，可以确保相当大的带宽。</p>
<p>　　● 使用三层交换机进行VLAN间路由(VLAN内通信)</p>
<p>　　在三层交换机内部数据究竟是怎样传播的呢?基本上，它和使用汇聚链路连接路由器与交换机时的情形相同。</p>
<p>　　假设有如下图所示的4台计算机与三层交换机互联。当使用路由器连接时，一般需要在LAN接口上设置对应各VLAN的子接口;而三层交换机则是在内部生成“VLAN接口”(VLAN Interface)。VLAN接口，是用于各VLAN收发数据的接口。(注：在Cisco的Catalyst系列交换机上，VLAN Interface被称为SVI——Switched Virtual Interface)</p>
<p><img src="/2021/04/30/VLAN/20.png"></p>
<p>　　为了与使用路由器进行VLAN间路由对比，让我们同样来考虑一下计算机A与计算机B之间通信时的情况。首先是目标地址为B的数据帧被发到交换机;通过检索同一VLAN的MAC地址列表发现计算机B连在交换机的端口2上;因此将数据帧转发给端口2。</p>
<p>　　● 使用三层交换机进行VLAN间路由(VLAN间通信)</p>
<p>　　接下来设想一下计算机A与计算机C间通信时的情形。针对目标IP地址，计算机A可以判断出通信对象不属于同一个网络，因此向默认网关发送数据(Frame 1)。</p>
<p>　　交换机通过检索MAC地址列表后，经由内部汇聚链接，将数据帧转发给路由模块。在通过内部汇聚链路时，数据帧被附加了属于红色VLAN的VLAN识别信息(Frame 2)。</p>
<p>　　路由模块在收到数据帧时，先由数据帧附加的VLAN识别信息分辨出它属于红色VLAN，据此判断由红色VLAN接口负责接收并进行路由处理。因为目标网络192.168.2.0/24是直连路由器的网络、且对应蓝色VLAN;因此，接下来就会从蓝色VLAN接口经由内部汇聚链路转发回交换模块。在通过汇聚链路时，这次数据帧被附加上属于蓝色VLAN的识别信息(Frame 3)。</p>
<p>　　交换机收到这个帧后，检索蓝色VLAN的MAC地址列表，确认需要将它转发给端口3。由于端口3是通常的访问链接，因此转发前会先将VLAN识别信息去除(Frame 4)。最终，计算机C成功地收到交换机转发来的数据帧。</p>
<p><img src="/2021/04/30/VLAN/21.png"></p>
<p>　　整体的流程，与使用外部路由器时的情况十分相似——都需要经过“发送方→交换模块→路由模块→交换模块→接收方”。</p>
<h2 id="加速VLAN间通信的手段"><a href="#加速VLAN间通信的手段" class="headerlink" title="加速VLAN间通信的手段"></a>加速VLAN间通信的手段</h2><p>　　1.流(Flow)</p>
<p>　　根据到此为止的学习，我们已经知道VLAN间路由，必须经过外部的路由器或是三层交换机的内置路由模块。但是，有时并不是所有的数据都需要经过路由器(或路由模块)。</p>
<p>　　例如，使用FTP(File Transfer Protocol)传输容量为数MB以上的较大的文件时，由于MTU的限制，IP协议会将数据分割成小块后传输、并在接收方重新组合。这些被分割的数据，“发送的目标”是完全相同的。发送目标相同，也就意味着同样的目标IP地址、目标端口号(注：特别强调一下，这里指的是TCP/UDP端口)。自然，源IP地址、源端口号也应该相同。这样一连串的数据流被称为“流”(Flow)。</p>
<p>　　只要将流最初的数据正确地路由以后，后继的数据理应也会被同样地路由。</p>
<p>　　据此，后继的数据不再需要路由器进行路由处理;通过省略反复进行的路由操作，可以进一步提高VLAN间路由的速度。</p>
<p><img src="/2021/04/30/VLAN/22.png"></p>
<p>　　2.加速VLAN间路由的机制</p>
<p>　　接下来，让我们具体考虑一下该如何使用三层交换机进行高速VLAN间路由。</p>
<p>　　首先，整个流的第一块数据，照常由交换机转发→路由器路由→再次由交换机转发到目标所连端口。这时，将第一块数据路由的结果记录到缓存里保存下来。需要记录的信息有：</p>
<p>　　(1)目标IP地址</p>
<p>　　(2)源IP地址</p>
<p>　　(3)目标TCP/UDP端口号</p>
<p>　　(4)源TCP/UDP端口号</p>
<p>　　(5)接收端口号(交换机)</p>
<p>　　(6)转发端口号(交换机)</p>
<p>　　(7)转发目标MAC地址</p>
<p>　　等等。</p>
<p>　　同一个流的第二块以后的数据到达交换机后，直接通过查询先前保存在缓存中的信息查出“转发端口号”后就可以转发给目标所连端口了。</p>
<p>　　这样一来，就不需要再一次次经由内部路由模块中继，而仅凭交换机内部的缓存信息就足以判断应该转发的端口。</p>
<p>　　这时，交换机会对数据帧进行由路由器中继时相似的处理，例如改写MAC地址、IP包头中的TTL和Check Sum校验码信息等。</p>
<p><img src="/2021/04/30/VLAN/23.png"></p>
<p>　　通过在交换机上缓存路由结果，实现了以缆线速度(Wired Speed)接收发送方传输来数据的数据、并且能够全速路由、转发给接收方。</p>
<p>　　需要注意的是，类似的加速VLAN间路由的手法多由各厂商独有的技术所实现，并且该功能的称谓也因厂商而异。例如，在Cisco的Catalyst系列交换机上，这种功能被称为“多层交换”(Multi Layer Switching)。另外，除了三层交换机的内部路由模块，外部路由器中的某些机型也支持类似的高速VLAN间路由机制。</p>
<h2 id="VLAN间路由举例"><a href="#VLAN间路由举例" class="headerlink" title="VLAN间路由举例"></a>VLAN间路由举例</h2><h3 id="技术背景"><a href="#技术背景" class="headerlink" title="技术背景"></a>技术背景</h3><ul>
<li>通过使用路由器可以实现VLAN间通信。</li>
<li>当路由器使用多臂的方式实现VLAN间的通信时，路由器的接口资源将受到极大的挑战，当VLAN数量特别多时，采用多臂路由的方式是不具备可行性的，并且此种方式的可扩展性并不高。</li>
<li>当路由器采用单臂的方式实现VLAN间通信时，与多臂路由相比，是一种更佳的选择，因为单臂的可扩展性更高、更经济。</li>
<li>但是单臂路由也存在一定的短板：（1）路由器与交换机之间的链路由于需承载所有VLAN间的通信数据，因此它的负载将变得非常高，尤其是当VLAN的数量特别多、VLAN间通信的流量特别大时，这段链路将变得不堪重负。（2）单臂链路也不具备冗余性，一旦链路发生故障，VLAN之间的通信也就无法再正常进行。</li>
<li>使用三层交换机（Layer 3 Switch）也可以实现VLAN间通信，并且能优化上述问题。</li>
</ul>
<h3 id="三层交换机"><a href="#三层交换机" class="headerlink" title="三层交换机"></a>三层交换机</h3><ul>
<li>三层交换机除了能够实现二层交换机所有功能，还支持路由功能。</li>
<li>三层交换机除了拥有二层接口外，还拥有三层接口。</li>
<li>VLANIF （VLAN Interface）VLAN接口就是一种非常重要的三层接口，这是一种逻辑接口，物理上并不存在。</li>
<li>在一台三层交换机上创建了一个VLAN时，就可以将交换机的物理接口(比如GE0/0/1)加入到该VLAN中，此时这些物理接口都是二层接口。与此同时，还能在交换机上配置这个VLAN对应的VLANIF，也就是这个VLAN对应的三层接口。</li>
<li>三层接口能够与同处于这个VLAN内的设备进行二层通信。另外VLANIF作为一个三层接口，拥有路由功能，可以进行IP地址配置，而通常情况下，这个IP地址会作为VLAN中设备的默认网关地址。</li>
</ul>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>如下图所示的网络拓扑中：</p>
<ul>
<li>交换机拥有两个VLAN，分别是VLAN 10及VLAN20，物理接口GE0/0/1, GE0/0/2及GE0/0/3都被配置为Access类型，其中GE0/0/1及GE0/0/2接口加入了VLAN10，而GE0/0/3接口则加入了VLAN20。</li>
<li>VLANIF 10配置了IP地址192.168.10.254, VLANIF 20则配置了IP地址192.168.20.254。</li>
<li>各VLAN内的PC都将其默认网关地址配置为相应VLAN的VLANIF IP地址。</li>
<li>由于交换机配置了VLAN IF接口，那么三层交换机同时拥有交换模块以及路由模块。</li>
</ul>
<p><img src="/2021/04/30/VLAN/%E4%B8%BE%E4%BE%8B.png"></p>
<h3 id="在三层交换机上，同网段二层数据交换"><a href="#在三层交换机上，同网段二层数据交换" class="headerlink" title="在三层交换机上，同网段二层数据交换"></a>在三层交换机上，同网段二层数据交换</h3><p>以PC1发送一份数据给PC2为例，大致过程如下：<br>（1）PC1构造单播数据帧：</p>
<ul>
<li>PC1的上层协议产生的数据载荷到了网络层，数据载荷被封装IP头部，在IP头部中，源IP地址是192.168.10.1，目的IP地址是192.168.10.2。</li>
<li>数据载荷被封装好IP头部后，数据下发到网卡，继续为其进行数据链路层封装，将其封装成以太网数据帧，该数据帧的源MAC地址为PC1的网卡MAC地址，而目的MAC地址为192.168.10.2这个IP地址对应的MAC地址。</li>
<li>PC1查询ARP表试图寻找相应的ARP表项，初始时PC1的ARP表中并没有相应的表项，因此PCl发送一个广播的ARP Request去请求PC2的MAC地址。</li>
</ul>
<p>（2）交换机处理PC1发送的广播ARP Request数据帧：</p>
<ul>
<li>ARP Request的广播数据帧到达了交换机的GE0/0/1接口后，会被打上VLAN10的Tag。</li>
<li>交换机通过读取数据帧头部，发现这是一个广播数据帧，此时有三个动作：<br>a.将收到的ARP Request广播数据帧在所有加入VLAN10的端口上泛洪，b.将数据帧解封装，将数据帧帧中的源Mac地址、VLAN10、GE0/0/1形成一条新的Mac地址表项c 另外交换机通过数据帧头部的“类型”字段发现该帧内封装着一个ARP报文，将数据帧解封装后上送到自己的ARP协议模块，而ARP模块发现这个ARP报文请求的是192.168.10.2这个IP地址的MAC地址，该IP地址并非自己所有，因此它直接忽略这个数据帧。</li>
</ul>
<p>（3）PC2处理泛洪得到的广播ARP Request数据帧：</p>
<ul>
<li>交换机在VLAN10内泛洪了PC1发送的ARP Request，因此PC2会收到这个数据帧，它将记录相应的ARP表项（PC1的IP地址和Mac地址），</li>
<li>通过解析ARP Request广播数据帧，发现该报文请求的IP地址就是自己，于是会发送一个单播的ARP Reply帧进行回应。</li>
</ul>
<p>（4）交换机处理PC2回应的单播ARP Reply数据帧：</p>
<ul>
<li>交换机收到这个数据帧，解析数据帧头部，将数据帧帧中的源Mac地址、VLAN10、GE0/0/2形成一条新的Mac地址表项</li>
<li>另外解析数据帧头部后，通过查询MAC地址表并找到目的MAC地址所关联的出接口（通过PC1发送的广播ARP Request报文学习的Mac地址表项），将数据帧从GE0/0/1接口发出。</li>
</ul>
<p>（5）PC1处理交换机传递的单播ARP Reply数据帧：</p>
<ul>
<li>PC1收到了这个ARP Reply，解析数据帧，可以获知了192.168.10.2对应的MAC地址，形成相应的ARP表项（PC2的IP地址和Mac地址）</li>
<li>PC1获取PC2的Mac地址后，可以继续封装单播数据帧，然后将单播数据帧从网卡发出。</li>
</ul>
<p>（6）交换机处理PC1发送的单播数据帧：</p>
<ul>
<li>交换机收到这个数据帧，发现这是一个单播数据帧，于是在MAC地址表中查询目的MAC地址，找到匹配的表项后（PC2回应的ARP Reply报文学习的Mac地址表项），将该帧从GE0/0/2接口发出。</li>
</ul>
<p>（7）PC2处理交换机传递的单播数据帧：</p>
<ul>
<li>PC2收到这个数据帧后，解析以太网头部，发现目的Mac地址正是自己网卡的Mac地址，通过数据帧头部的“类型”字段发现该帧内封装着一个IP数据报</li>
<li>将IP数据报上送IP协议栈，继续继续IP头部，发现目的IP地址也是自己网卡的IP地址，通IP数据报头部中的“协议”字段发现数据报内还封装上层应用协议的数据</li>
<li>将上层应用协议的数据上送给上层协议模块处理数据。</li>
</ul>
<h3 id="在三层交换机上，跨网段三层数据交换"><a href="#在三层交换机上，跨网段三层数据交换" class="headerlink" title="在三层交换机上，跨网段三层数据交换"></a>在三层交换机上，跨网段三层数据交换</h3><p>以PC1发送一份数据给PC3为例，大致过程如下:<br>（1）PC1构造单播数据帧：</p>
<ul>
<li>PC1的上层协议产生的数据载荷到了网络层，数据载荷被封装IP头部，源IP地址是192.168.10.1，目的IP地址是192.168.20.1。</li>
<li>将数据帧下送到了PC1的网卡，网卡将其封装成以太网数据帧，由于数据包的目的IP地址与本机不在相同网段（PC2可以通过将IP地址与地址掩码做 &amp;操作，确定其IP网段范围），这意味着PC1需要先把报文发送到默认网关，因此数据帧的目的MAC地址需填写网关(192.168.10.254)的MAC地址。</li>
<li>PC1在ARP表中查询192.168.10.254，发现并没有匹配的表项，因此它发送一个广播的ARP Request试图查询网关的MAC地址。</li>
</ul>
<p>（2）交换机处理广播ARP Request数据帧：</p>
<ul>
<li>广播ARP Request数据帧到达了交换机的GE0/0/1接口，会被打上VLAN10的Tag。</li>
<li>交换机通过读取数据帧头部，发现这是一个广播数据帧，有三个动作：<br>a. 将广播报文在加入VLAN 10的端口上进行泛洪，b.将数据帧解封装，将数据帧帧中的源Mac地址、VLAN10、GE0/0/1形成一条新的Mac地址表项c 另外交换机通过数据帧头部的“类型”字段发现该帧内封装着一个ARP报文，将数据帧解封装后上送到自己的ARP协议模块，而ARP模块发现这个ARP报文请求的是192.168.10.254这个IP地址的MAC地址，恰好VLANIF 10的IP地址就是192.168.10.254，因此它直接发送一个ARP Reply对PCI进行回应。</li>
</ul>
<p>（3）PC1处理收到的ARP Reply报文：</p>
<ul>
<li>PC1收到了这个ARP Reply，获知了192.168.10.254对应的MAC地址，因此继续封装数据帧，然后将数据帧从网卡发出。</li>
</ul>
<p>（4）交换机处理收到的单播数据帧：</p>
<ul>
<li>交换机收到这个数据帧，发现这是一个单播数据帧，而且该帧的目的MAC地址正是本机的MAC地址，因此交换机将数据帧解封装，并将里面的数据上送到IP模块进行处理（通过数据帧头部的“类型”字段可以得知数据帧封装着一个IP数据报）。</li>
<li>IP模块读取数据包的目的IP地址后，发现目的IP地址并非本机的IP地址，于是它在路由表中查询这个地址，结果发现有一条本地直连路由匹配（最长掩码匹配原则），而该直连路由的出接口是VLANIF20，因此交换机重新将这个数据包封装成帧。</li>
<li>新的以太网帧头中，源MAC地址填写的是交换机的MAC地址，而目的MAC则需填写192.168.20.1的MAC地址，如果交换机的ARP表中没有相关的表项，那么它需要在VLAN20中发送广播ARPRequest去请求PC3的MAC地址（此过程和1-2过程类似，不在赘述），最后将封装好的数据帧从GE0/0/3接口发出。</li>
</ul>
<p>（5）PC3处理交换机传递的单播数据帧：</p>
<ul>
<li>PC3收到这个数据帧后，解析以太网帧头部，发现目的Mac地址正是自己网卡的Mac地址，通过数据帧头部的“类型”字段发现该帧内封装着一个IP数据报</li>
<li>将IP数据报上送IP协议栈，继续继续IP头部，发现目的IP地址也是自己网卡的IP地址，通IP数据报头部中的“协议”字段发现数据报内还封装上层应用协议的数据</li>
<li>将上层应用协议的数据上送给上层协议模块处理数据。</li>
</ul>
<h2 id="传统型路由器存在的意义"><a href="#传统型路由器存在的意义" class="headerlink" title="传统型路由器存在的意义"></a>传统型路由器存在的意义</h2><p>　　1.路由器的必要性</p>
<p>　　三层交换机的价格，在问世之初非常昂贵，但是现在它们的价格已经下降了许多。目前国外一些廉价机型的售价，折合成人民币后仅为一万多元，而且还在继续下降中。</p>
<p>　　既然三层交换机能够提供比传统型路由器更为高速的路由处理，那么网络中还有使用路由器的必要吗?</p>
<p>　　答案是：“是”。</p>
<p>　　使用路由器的必要性，主要表现在以下几个方面：</p>
<p>　　(1)用于与WAN连接</p>
<p>　　三层交换机终究是“交换机”。也就是说，绝大多数机型只配有LAN(以太网)接口。在少数高端交换机上也有用于连接WAN的串行接口或是ATM接口，但在大多数情况下，连接WAN还是需要用到路由器。</p>
<p>　　(2)保证网络安全</p>
<p>　　在三层交换机上，通过数据包过滤也能确保一定程度的网络安全。但是使用路由器所提供的各种网络安全功能，用户可以构建更为安全可靠的网络。</p>
<p>　　路由器提供的网络安全功能中，除了最基本的数据包过滤功能外，还能基于IPSec构建VPN(VirtualPrivate Network)、利用RADIUS进行用户认证等等。</p>
<p>　　(3)支持除TCP/IP以外的异构网络架构</p>
<p>　　尽管TCP/IP已经成为当前网络协议架构的主流，但还有不少网络利用Novell Netware下的IPX/SPX或Macintosh下的AppleTalk等网络协议。三层交换机中，除了部分高端机型外基本上还只支持TCP/IP。因此，在需要使用除TCP/IP之外其他网络协议的环境下，路由器还是必不可少的。</p>
<p>　　注：在少数高端交换机上，也能支持上述路由器的功能。例如Cisco的Catalyst 6500系列，就可以选择与WAN连接的接口模块;还有可选的基于IPSec实现VPN的模块;并且也能支持TCP/IP以外的其他网络协议。</p>
<p>　　2.路由器和交换机配合构建LAN的实例</p>
<p>　　下面让我们来看一个路由器和交换机搭配构建LAN的实例。</p>
<p><img src="/2021/04/30/VLAN/24.png"></p>
<p>　　利用在各楼层配置的二层交换机定义VLAN，连接TCP/IP客户计算机。各楼层间的VLAN间通信，利用三层交换机的高速路由加以实现。如果网络环境要求高可靠性，还可以考虑冗余配置三层交换机。</p>
<p>　　与WAN的连接，则通过带有各种网络接口的路由器进行。并且，通过路由器的数据包过滤和VPN等功能实现网络安全。此外，使用路由器还能支持Novell Netware等TCP/IP之外的网络。</p>
<p>　　只有在充分掌握了二层、三层交换机以及传统路由器的基础上，才能做到物竞其用，构筑出高效率、高性价比的网络。</p>
<h2 id="使用VLAN设计局域网"><a href="#使用VLAN设计局域网" class="headerlink" title="使用VLAN设计局域网"></a>使用VLAN设计局域网</h2><p>　　1.使用VLAN设计局域网的特点</p>
<p>　　通过使用VLAN构建局域网，用户能够不受物理链路的限制而自由地分割广播域。</p>
<p>　　另外，通过先前提到的路由器与三层交换机提供的VLAN间路由，能够适应灵活多变的网络构成。</p>
<p>　　但是，由于利用VLAN容易导致网络构成复杂化，因此也会造成整个网络的组成难以把握。</p>
<p>　　可以这样说，在利用VLAN时，除了有“网络构成灵活多变”这个优点外，还搭配着“网络构成复杂化”这个缺点。</p>
<p>　　下面，就让我们来看看具体的实例。</p>
<p>　　2.不使用VLAN的局域网中网络构成的改变</p>
<p>　　假设有如图所示的由1台路由器、2台交换机构成的“不使用VLAN构建”的网络。</p>
<p><img src="/2021/04/30/VLAN/25.png"></p>
<p>　　图中的路由器，带有2个LAN接口。左侧的网络是192.168.1.0/24，右侧是192.168.2.0/24。</p>
<p>　　现在如果想将192.168.1.0/24这个网络上的计算机A转移到192.168.2.0/24上去，就需要改变物理连接、将A接到右侧的交换机上。</p>
<p>　　并且，当需要新增一个地址为192.168.3.0/24的网络时，还要在路由器上再占用一个LAN接口并添置一台交换机。而由于这台路由器上只带了2个LAN接口，因此为了新增网络还必须将路由器升级为带有3个以上LAN接口的产品。</p>
<p>　　3.使用VLAN的局域网中网络构成的改变</p>
<p>　　接下来再假设有一个由1台路由器、2台交换机构成的“使用VLAN”的局域网。交换机与交换机、交换机与路由器之间均为汇聚链路;并且假设192.168.1.0/24对应红色VLAN、192.168.2.0/24对应蓝色VLAN。</p>
<p><img src="/2021/04/30/VLAN/26.png"></p>
<p>　　需要将连接在交换机1上192.168.1.0/24这个网段的计算机A转属192.168.2.0/24时，无需更改物理布线。只要在交换机上生成蓝色VLAN，然后将计算机A所连的端口1加入到蓝色VLAN中去，使它成为访问链接即可。</p>
<p>　　然后，根据需要设定计算机A的IP地址、默认网关等信息就可以了。如果IP地址相关的设定是由DHCP获取的，那么在客户机方面无需进行任何设定修改，就可以在不同网段间移动。</p>
<p>　　利用VLAN后，我们可以在免于改动任何物理布线的前提下，自由进行网络的逻辑设计。如果所处的工作环境恰恰需要经常改变网络布局，那么利用VLAN的优势就非常明显了。</p>
<p>　　并且，当需要新增一个地址为192.168.3.0/24的网段时，也只需要在交换机上新建一个对应192.168.3.0/24的VLAN，并将所需的端口加入它的访问链路就可以了。</p>
<p>　　如果网络环境中还需要利用外部路由器，则只要在路由器的汇聚端口上新增一个子接口的设定就可以完成全部操作，而不需要消耗更多的物理接口(LAN接口)。要使用的是三层交换机内部的路由模块，则只需要新设一个VLAN接口即可。</p>
<p>　　网络环境的成长，往往是难以预测的，很可能经常会出现需要分割现有网络或是增加新网络的情况。而充分活用VLAN后，就可以轻易地解决这些问题。</p>
<p>　　4.利用VLAN而导致的网络结构复杂化</p>
<p>　　虽然利用VLAN可以灵活地构建网络，但是同时，它也带来了网络结构复杂化的问题。</p>
<p>　　特别是由于数据流纵横交错，一旦发生故障时，准确定位并排除故障会比较困难。</p>
<p>　　为了便于理解数据流向的复杂化，假设有下图所示的网络。计算机A向计算机C发送数据时，数据流的整体走向如下：</p>
<p>　　计算机A→交换机1→路由器→交换机1→交换机2→计算机C</p>
<p><img src="/2021/04/30/VLAN/27.png"></p>
<p><img src="/2021/04/30/VLAN/28.png"></p>
<p>　　首先计算机A向交换机1送出数据(①)，其后数据被转发给路由器(②)进行VLAN间路由。路由后的数据，再从汇聚链路返回交换机1(③)。由于通信目标计算机C并不直连在交换机1上，因此还需要经过汇聚链路转发到交换机2(④)。在交换机2上，数据最终被转发到C所连的端口2上，这才完成整个流程(⑤)。</p>
<p>　　在这个例子中，仅由2台交换机构成网络，其数据流已经如此复杂，如果构建横跨多台交换机的VLAN的话，每个数据流的流向显然会更加难以把握。</p>
<p>　　5. 网络的逻辑结构与物理结构</p>
<p>　　为了对应日渐复杂化的数据流，管理员需要从“逻辑结构”与“物理结构”两方面入手，把握好网络的现状。</p>
<p>　　物理结构，指的是从物理层和数据链路层观察到的网络的现状，表示了网络的物理布线形态和VLAN的设定等等。</p>
<p>　　而逻辑结构，则表示从网络层以上的层面观察到的网络结构。下面我们就试着以路由器为中心分析一个IP网络的逻辑结构。</p>
<p>　　还是先前的那个例子，描绘了布线形态和VLAN设定的“物理结构”如下图所示。</p>
<p><img src="/2021/04/30/VLAN/29.png"></p>
<p>　　分析这个物理结构并转换成以路由器为中心的逻辑结构后，会得到如下的逻辑结构图。当我们需要进行路由或是数据包过滤的设定时，都必须在逻辑结构的基础上进行。</p>
<p><img src="/2021/04/30/VLAN/30.png"></p>
<p>　　把握这两种网络结构图的区别是十分重要的，特别是在VLAN和三层交换机大行其道的现代企业级网络当中。</p>
<h2 id="VLAN以太网二层接口类型"><a href="#VLAN以太网二层接口类型" class="headerlink" title="VLAN以太网二层接口类型"></a>VLAN以太网二层接口类型</h2><h3 id="Access接口"><a href="#Access接口" class="headerlink" title="Access接口"></a>Access接口</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧,打上PVID，接收。</li>
<li>Tagged数据帧，与PVID比较，相同则接收;不同则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID与PVID比较，相同则剥离标签发送;不同则丢弃。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Aceess.png"></p>
<h3 id="Trunk接口"><a href="#Trunk接口" class="headerlink" title="Trunk接口"></a>Trunk接口</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧，打上PVID，且VID在允许列表中，则接收;VID不在允许列表,则丢弃。</li>
<li>Tagged数据帧，查看VID是否在允许列表中，在允许列表中，则接收;VID不在允许列表，则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID在允许列表中，且VID与PVID一致，则剥离标签发送。</li>
<li>VID在允许列表，但VID与PVID不一致，则直接带标签发送。</li>
<li>不在允许列表中，则直接丢弃。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Trunk.png"></p>
<h3 id="Hybrid接口-前两者混合接口"><a href="#Hybrid接口-前两者混合接口" class="headerlink" title="Hybrid接口(前两者混合接口)"></a>Hybrid接口(前两者混合接口)</h3><p>接收数据帧</p>
<ul>
<li>Untagged数据帧，打上PVID，且VID在允许列表中，则接收;VID不在允许列表中，则丢弃。</li>
<li>Tagged数据帧,查看VID是否在允许列表中，在允许列表中，则接收;VID不在允许列表，则丢弃。</li>
</ul>
<p>发送数据帧</p>
<ul>
<li>VID不在允许列表中，直接丢弃。</li>
<li>VID在Untagged列表中，剥离标签发送。</li>
<li>VID在Tagged列表中，带标签直接发送。</li>
</ul>
<p><img src="/2021/04/30/VLAN/Hybrid.png"></p>
<h2 id="VLAN基础配置命令"><a href="#VLAN基础配置命令" class="headerlink" title="VLAN基础配置命令"></a>VLAN基础配置命令</h2><p>1.创建VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>通过此命令创建VLAN并进入VLAN视图，如果VLAN已存在，直接进入该VLAN的视图。</p>
<p>vlan-id是整数形式，取值范围是1~4094。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] vlan batch &#123; vlan-id1 [ to vlan-id2 ] &#125;</span><br></pre></td></tr></table></figure>
<p>通过此命令批量创建VLAN。其中:</p>
<ul>
<li>batch:指定批量创建的VLAN ID。</li>
<li>vlan-id1:表示第一个VLAN的编号。</li>
<li>vlan-id2:表示最后一个VLAN的编号。</li>
</ul>
<h3 id="Access接口配置命令"><a href="#Access接口配置命令" class="headerlink" title="Access接口配置命令"></a>Access接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port link-type access</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Access。<br>2.配置Access接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port default vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的缺省VLAN并同时加入这个VLAN。</p>
<ul>
<li>vlan-id:配置缺省VLAN的编号。整数形式，取值范围是1~4094。</li>
</ul>
<h3 id="Trunk接口配置命令"><a href="#Trunk接口配置命令" class="headerlink" title="Trunk接口配置命令"></a>Trunk接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port link-type trunk</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Trunk。<br>2.配置Trunk接口加入指定VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port trunk allow-pass vlan &#123; &#123; vlan-id1 [ to vlan-id2 ] &#125;| all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Trunk类型接口加入的VLAN。<br>3.(可选)配置Trunk接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port trunk pvid vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Trunk类型接口的缺省VLAN。</p>
<h3 id="Hybrid接口配置命令"><a href="#Hybrid接口配置命令" class="headerlink" title="Hybrid接口配置命令"></a>Hybrid接口配置命令</h3><p>1.配置接口类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] port link-type hybrid</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置接口的链路类型为Hybrid。<br>2.配置Hybrid接口加入指定VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid untagged vlan &#123; &#123; vlan-id1 [ to vlan-id2 ] &#125; | all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Untagged方式通过接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid tagged vlan &#123; &#123; vlan-id1 [ to vlan-id2] &#125; | all &#125;</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口加入的VLAN，这些VLAN的帧以Tagged方式通过接口。<br>3.(可选)配置Hybrid接口的缺省VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Huawei-GigabitEthernet0&#x2F;0&#x2F;1] port hybrid pvid vlan vlan-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，配置Hybrid类型接口的缺省VLAN。</p>
<h3 id="基于MAC地址划分VLAN配置命令"><a href="#基于MAC地址划分VLAN配置命令" class="headerlink" title="基于MAC地址划分VLAN配置命令"></a>基于MAC地址划分VLAN配置命令</h3><p>1.关联MAC地址与VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-vlan10] mac-vlan mac-address mac-address [ mac-address-mask | mac-address-mask-length ]</span><br></pre></td></tr></table></figure>
<p>通过此命令配置MAC地址与VLAN关联。</p>
<ul>
<li>mac-address:指定与VLAN关联的MAC地址。格式为H-H-H。其中H为4位的十六进制数，可以输入1~4位，如00e0、fcO1。当输入不足4位时，表示前面的几位为0，如:输入e0，等同于O0e0。MAC地址不可设置为O000-0000-0000、FFFF-FFFF-FFFF和组播地址。</li>
<li>mac-address-mask:指定MAC地址掩码。格式为H-H-H，其中H为1至4位的十六进制数。</li>
<li> mac-address-mask-length:指定MAC地址掩码长度。整数形式，取值范围是1~48。</li>
</ul>
<p>2.使能MAC地址与VLAN</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] mac-vlan enable</span><br></pre></td></tr></table></figure>
<p>通过此命令使能接口的MAC VLAN功能。</p>
<h2 id="VLAN间路由子接口配置命令"><a href="#VLAN间路由子接口配置命令" class="headerlink" title="VLAN间路由子接口配置命令"></a>VLAN间路由子接口配置命令</h2><p><img src="/2021/04/30/VLAN/%E5%AD%90%E6%8E%A5%E5%8F%A3.png"></p>
<h2 id="VLANIF接口接口配置"><a href="#VLANIF接口接口配置" class="headerlink" title="VLANIF接口接口配置"></a>VLANIF接口接口配置</h2><p><img src="/2021/04/30/VLAN/VLANIF.png"></p>
<h2 id="二层接口和三层接口对比"><a href="#二层接口和三层接口对比" class="headerlink" title="二层接口和三层接口对比"></a>二层接口和三层接口对比</h2><table>
<thead>
<tr>
<th>二层接口(Layer2 Interface )</th>
<th>三层接口(Layer3 Interface )</th>
</tr>
</thead>
<tbody><tr>
<td>二层接口不能配置IP地址</td>
<td>三层接口可以配置IP地址</td>
</tr>
<tr>
<td>二层接口不具备MAC地址</td>
<td>三层接口具备MAC地址</td>
</tr>
<tr>
<td>当二层接口收到数据帧时，设备在其MAC地址表中查询该帧的目的MAC地址，找到匹配的MAC地址表项后按照该表项的指示转发帧;如果没有找到匹配的MAC地址表项，则将帧进行泛洪。</td>
<td>三层接口收到数据帧后，如果数据帧的目的MAC地址与设备的本地MAC地址相同，则将数据帧解除封装，然后在路由表中查询数据包的目的IP地址，找到匹配的路由表项后按照该表项的指示转发包;如果没有找到匹配的表项，则将包丢弃。</td>
</tr>
<tr>
<td>典型的二层接口如二层交换机（只具备二层交换能力的交换机)的物理接口;大部分三层交换机（同时具备二层及三层交换能力的交换机）的物理接口缺省为二层接口。</td>
<td>典型的三层接口如路由器的三层接口。某些三层交换机的物理接口可以切换成三层模式。此外除了物理三层接口，还存在逻辑三层接口，例如交换机的VLANIF，或者网络设备上的逻辑子接口，如GEO/0/1.10。</td>
</tr>
<tr>
<td>二层接口并不隔离广播域，当二层接口收到广播帧时，会将数据帧进行泛洪。</td>
<td>三层接口隔离广播域，当三层接口收到广播帧时，缺省不会进行泛洪，而是直接终结。</td>
</tr>
</tbody></table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/" itemprop="url">网络管理与运维</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-29T18:24:58+08:00">
                2021-04-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络管理与运维"><a href="#网络管理与运维" class="headerlink" title="网络管理与运维"></a>网络管理与运维</h2><h3 id="什么是网络管理？"><a href="#什么是网络管理？" class="headerlink" title="什么是网络管理？"></a>什么是网络管理？</h3><p>网络管理是通过对网络中设备的管理，保证设备工作正常，使通信网络正常地运行，以提供高效、可靠和安全的通信服务，是通信网络生命周期中的重要一环。</p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86.png"></p>
<h3 id="网络管理基本功能"><a href="#网络管理基本功能" class="headerlink" title="网络管理基本功能"></a>网络管理基本功能</h3><p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD.png"></p>
<p>OSI定义了网络管理的五大功能模型:</p>
<ul>
<li><p>配置管理(Configuration Management )∶配置管理负责监控网络的配置信息，使网络管理人员可以生成、查询和修改硬件、软件的运行参数和条件，并可以进行相关业务的配置。</p>
</li>
<li><p>性能管理（ Performance Management )︰性能管理以网络性能为准则，保证在使用较少网络资源和具有较小<br>时延的前提下，网络能够提供可靠、连续的通信能力。</p>
</li>
<li><p>故障管理(（ Fault Management)︰故障管理的主要目标是确保网络始终可用，并在发生故障时尽快将其修复。</p>
</li>
<li><p>安全管理( Security Management ):安全管理可以保护网络和系统免受未经授权的访问和安全攻击。</p>
</li>
<li><p>计费管理(Accounting Management):记录用户使用网络资源的情况并核收费用，同时也统计网络的利用率。</p>
</li>
</ul>
<h3 id="网络管理方式"><a href="#网络管理方式" class="headerlink" title="网络管理方式"></a>网络管理方式</h3><p>网络管理方式分为传统网络管理与和基于iMaster NCE的网络管理。</p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F.png"></p>
<h2 id="传统网络管理"><a href="#传统网络管理" class="headerlink" title="传统网络管理"></a>传统网络管理</h2><h3 id="通过CLI或Web进行管理"><a href="#通过CLI或Web进行管理" class="headerlink" title="通过CLI或Web进行管理"></a>通过CLI或Web进行管理</h3><p>当网络规模较小时，CLI和Web方式是常见的网络管理方式。</p>
<ul>
<li>网络管理员可以通过HTTPS、Telnet、Console等方式登录设备后，对设备逐一进行管理。</li>
<li>这种管理方式不需要在网络中安装任何程序或部署服务器，成本较低。</li>
<li>网络管理员自身需要熟练掌握网络理论知识、各设备厂商网络配置命令。</li>
<li>当网络规模较大，网络拓扑较为复杂时，这种方式的局限性较大。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E4%B8%80%E5%AF%B9%E4%B8%80.png"></p>
<h3 id="基于SNMP的集中式管理"><a href="#基于SNMP的集中式管理" class="headerlink" title="基于SNMP的集中式管理"></a>基于SNMP的集中式管理</h3><p>SNMP ( Simple Network Management Protocol，简单网络管理协议）是广泛用于TCP/IP网络的网络管理标准协议，传输层使用UDP协议，提供了一种通过运行网络管理软件的中心计算机，即NMS ( Network Management Station，网络管理工作站）来管理网元的方法。</p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E4%B8%80%E5%AF%B9%E5%A4%9A.png"></p>
<h3 id="SNMP典型架构"><a href="#SNMP典型架构" class="headerlink" title="SNMP典型架构"></a>SNMP典型架构</h3><ul>
<li>在基于SNMP进行管理的网络中，NMS是整个网络的网管中心，在它之上运行管理进程。每个被管理设备需要运行代理(Agent )进程。管理进程和代理进程利用SNMP报文进行通信。</li>
<li>NMS是一个采用SNMP协议对网络设备进行管理/监控的系统，运行在NMS服务器上。</li>
<li>被管理设备是网络中接受NMS管理的设备。</li>
<li>代理进程运行于被管理设备上，用于维护被管理设备的信息数据并响应来自NMS的请求，把管理数据汇报给发送请求的NMS。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/SNMP%E5%85%B8%E5%9E%8B%E6%9E%B6%E6%9E%84.png"></p>
<h3 id="SNMP的信息交互"><a href="#SNMP的信息交互" class="headerlink" title="SNMP的信息交互"></a>SNMP的信息交互</h3><ul>
<li>NMS和被管理设备的信息交互分为两种:<ol>
<li>NMS通过SNMP协议给被管理设备发送修改配置信息请求或<br>查询配置信息请求。被管理设备上运行的代理进程根据NMS的请求消息做出响应。</li>
<li>被管理设备可以主动向NMS上报告警信息( Trap )以便网络管理员及时发现故障。</li>
</ol>
</li>
<li>被管理对象(Managed object ) :每一个设备可能包含多个被管理对象，被管理对象可以是设备中的某个硬件，也可以是在硬件、软件（如路由选择协议）上配置的参数集合。</li>
<li>SNMP规定通过MIB ( Management Information Base,管理信息库）去描述可管理实体的一组对象。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/SNMP%E4%BF%A1%E6%81%AF%E4%BA%A4%E4%BA%92.png"></p>
<h3 id="MIB"><a href="#MIB" class="headerlink" title="MIB"></a>MIB</h3><ul>
<li>MIB是一个数据库，指明了被管理设备所维护的变量（即能够被代理进程查询和设置的信息）。MIB在数据库中定义了被管理设备的一系列属性:<ul>
<li>对象标识符(Object IDentifier，OID )</li>
<li>对象的状态</li>
<li>对象的访问权限</li>
<li>对象的数据类型等</li>
</ul>
</li>
<li>MIB给出了一个数据结构，包含了网络中所有可能的被管理对象的集合。因为数据结构与树相似，MIB又被称为对象命名树。</li>
</ul>
<h3 id="常见MIB节点"><a href="#常见MIB节点" class="headerlink" title="常见MIB节点"></a>常见MIB节点</h3><ul>
<li>用于查询或修改的节点:</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E6%9F%A5%E8%AF%A2.png"></p>
<ul>
<li>用于告警通知的节点：</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E5%91%8A%E8%AD%A6.png"></p>
<h3 id="SNMP管理模型"><a href="#SNMP管理模型" class="headerlink" title="SNMP管理模型"></a>SNMP管理模型</h3><p>查询/修改操作:</p>
<ul>
<li>NMS作为管理者，向代理进程发送SNMP请求报文。</li>
<li>代理进程通过设备端的MIB找到所要查询或修改的信息，<br>向NMS发送SNMP响应报文。</li>
</ul>
<p>告警操作:</p>
<ul>
<li>口设备端的模块由于达到模块定义的告警触发条件，通过<br>代理进程向NMS发送消息，告知设备侧出现的情况，这样便于网络管理人员及时对网络中出现的情况进行处理。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/SNMP%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9E%8B.png"></p>
<h3 id="SNMP版本"><a href="#SNMP版本" class="headerlink" title="SNMP版本"></a>SNMP版本</h3><h4 id="SNMPv1"><a href="#SNMPv1" class="headerlink" title="SNMPv1"></a>SNMPv1</h4><p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/v1.png"></p>
<h4 id="SNMPv2"><a href="#SNMPv2" class="headerlink" title="SNMPv2"></a>SNMPv2</h4><ul>
<li><p>对SNMPv1版本报文类型进行优化，GetBulk报文进行打包操作。</p>
</li>
<li><p>SNMP使用UDP传输，可能造成丢包情况，因此收到告警信息后必须回复一个确认，否则一只发送告警信息。</p>
</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/v2.png"></p>
<h4 id="SNMPv3"><a href="#SNMPv3" class="headerlink" title="SNMPv3"></a>SNMPv3</h4><ul>
<li>SNMPv3与SNMPv1和SNMPv2c的工作机制基本一致但添加了</li>
<li>报头数据和安全参数。SNMPv3报文具有身份验证和加密处理的功能。</li>
<li>SNMPv3适用于各种规模的网络，安全性极高。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/v3.png"></p>
<h3 id="SNMP小结"><a href="#SNMP小结" class="headerlink" title="SNMP小结"></a>SNMP小结</h3><ul>
<li><p>SNMP的特点如下∶<br>1.简单:SNMP采用轮询机制，提供基本的功能集，适合快速、低价格的场景使用，而且SNMP以UDP报文为承载，因而得到绝大多数设备的支持。</p>
<p>2.强大:SNMP的目标是保证管理信息在任意两点传送，便于管理员在网络上的任何节点检索信息，进行故障排查。</p>
</li>
<li><p>SNMPv1版本适用于小型网络。组网简单、安全性要求不高或网络环境比较安全且比较稳定的网络，比如校园网，小型企业网。</p>
</li>
<li><p>SNMPv2c版本适用于大中型网络。安全性要求不高或者网络环境比较安全，但业务比较繁忙，有可能发生流量拥塞的网络。</p>
</li>
<li><p>SNMPv3版本作为推荐版本，适用于各种规模的网络。尤其是对安全性要求较高，只有合法的管<br>理员才能对网络设备进行管理的网络。</p>
</li>
</ul>
<h3 id="SNMP基础配置"><a href="#SNMP基础配置" class="headerlink" title="SNMP基础配置"></a>SNMP基础配置</h3><p>1.使能SNMP代理功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent</span><br></pre></td></tr></table></figure>
<p>2.配置SNMP的版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent sys-info version [v1 | v2c | v3]</span><br></pre></td></tr></table></figure>
<p>用户可以根据自己的需求配置对应的SNMP版本，但设备侧使用的协议版本必须与网管侧一致。<br>3.创建或者更新MIB视图的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent mib-view view-name &#123; exclude | include &#125; subtree-name [mask mask]</span><br></pre></td></tr></table></figure>
<p>4.增加一个新的SNMP组，将该组用户映射到SNMP视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent group v3 group-name &#123; authentication | noauth | privacy ]&#125; [ read-view view-name|write-view view-name | notify-view view-name ]</span><br></pre></td></tr></table></figure>
<p>该命令用于SNMPv3版本中创建SNMP组，指定认证加密方式、只读视图、读写视图、通知视图。是安全性需求较高的网管网络中的必需指令。<br>5.为一个SNMP组添加一个新用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent usm-user v3 user-name group group-name</span><br></pre></td></tr></table></figure>
<p>6.配置SNMPv3用户认证密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent usm-user v3 user-name authentication-mode &#123; md5 I sha l sha2-256 &#125;</span><br></pre></td></tr></table></figure>
<p>7.配置SNMPv3用户加密密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent usm-user v3 user-name privacy-mode &#123; aes128 | des56 &#125;</span><br></pre></td></tr></table></figure>
<p>8.配置设备发送Trap报文的参数信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent target-host trap-paramsname paramsname v3 securityname securityname&#123; authentication | noauthnopriv \ privacy &#125;</span><br></pre></td></tr></table></figure>
<p>9.配置Trap报文的目的主机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent target-host trap-hostname hostname address ipv4-address trap-paramsname paramsname</span><br></pre></td></tr></table></figure>
<p>10．打开设备的所有告警开关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent trap enable</span><br></pre></td></tr></table></figure>
<p>注意该命令只是打开设备发送Trap告警的功能，要与snmp-agent target-host协同使用，由snmp-agent target-host指定Trap告警发送给哪台设备。<br>11．配置发送告警的源接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] snmp-agent trap source interface-type interface-number</span><br></pre></td></tr></table></figure>
<p>注意Trap告警无论从哪个接口发出都必须有一个发送的源地址，因此源接口必须是已经配置了IP地址的接口。</p>
<h3 id="SNMP配置举例（网络设备侧）"><a href="#SNMP配置举例（网络设备侧）" class="headerlink" title="SNMP配置举例（网络设备侧）"></a>SNMP配置举例（网络设备侧）</h3><p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/SNMP%E9%85%8D%E7%BD%AE1.png"></p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/SNMP%E9%85%8D%E7%BD%AE2.png"></p>
<h2 id="基于华为iMaster-NCE的网络管理"><a href="#基于华为iMaster-NCE的网络管理" class="headerlink" title="基于华为iMaster NCE的网络管理"></a>基于华为iMaster NCE的网络管理</h2><h3 id="网络产业的变革与挑战"><a href="#网络产业的变革与挑战" class="headerlink" title="网络产业的变革与挑战"></a>网络产业的变革与挑战</h3><ul>
<li>伴随5G和云时代的到来，VR/AR、直播、无人驾驶等各类创新性业务大量涌现，整个ICT产业迸发出蓬勃生机。与此同时，整个网络的流量也呈现出爆炸式增长，华为GIV ( Global Industry Vision，全球产业展望)预计，2025年新增的数据量将达到180 ZB。业务的动态复杂性也使得整个网络复杂度不断攀升。</li>
<li>整体来看，这些问题的源头都指向了现有的网络系统，只有通过构建自动化、智能化的以用户体验为中心的网络系统才能有效应对。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E8%B0%83%E6%95%B4.png"></p>
<h3 id="华为iMaster-NCE"><a href="#华为iMaster-NCE" class="headerlink" title="华为iMaster NCE"></a>华为iMaster NCE</h3><p>华为iMaster NCE是一款集管理、控制、分析和Al智能功能于一体的网络自动化与智能化平台。</p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/NCE.png"></p>
<h3 id="NETCONF简介"><a href="#NETCONF简介" class="headerlink" title="NETCONF简介"></a>NETCONF简介</h3><p>NETCONF ( Network Configuration Protocol，网络配置协议），提供一套管理网络设备的机制。用户可以使用这套机制增加、修改、删除网络设备的配置，获取网络设备的配置和状态信息。</p>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/NETCONF.png"></p>
<h3 id="NETCONF的优势"><a href="#NETCONF的优势" class="headerlink" title="NETCONF的优势"></a>NETCONF的优势</h3><table>
<thead>
<tr>
<th>功能</th>
<th>NETCONF</th>
<th>SNMP</th>
<th>CLI</th>
</tr>
</thead>
<tbody><tr>
<td>接口类型</td>
<td>机机接口:接口定义完善、规范、标准，便于接口控制和使用。</td>
<td>机机接口</td>
<td>人机接口</td>
</tr>
<tr>
<td>操作效率</td>
<td>高:基于对象建模，对象操作一次交互即可，支持过滤、批量等操作。</td>
<td>中</td>
<td>低</td>
</tr>
<tr>
<td>扩展能力</td>
<td>可以扩展协议私有能力。</td>
<td>弱</td>
<td>一般</td>
</tr>
<tr>
<td>事务处理</td>
<td>支持:试运行、出错回滚、配置回退等事务处理机制。</td>
<td>不支持</td>
<td>部分支持</td>
</tr>
<tr>
<td>安全传输</td>
<td>多种安全协议:SSH，TLS，BEEP/TLS,SOAP/HTTP/TLS</td>
<td>仅SNMPv3支持</td>
<td>支持SSH</td>
</tr>
</tbody></table>
<h3 id="一次典型NETCONF交互"><a href="#一次典型NETCONF交互" class="headerlink" title="一次典型NETCONF交互"></a>一次典型NETCONF交互</h3><p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/%E4%BA%A4%E4%BA%92.png"></p>
<h3 id="YANG语言概述"><a href="#YANG语言概述" class="headerlink" title="YANG语言概述"></a>YANG语言概述</h3><ul>
<li>YANG ( Yet Another Next Generation )是一种数据建模语言，实现了NETCONF数据内容的标准化。</li>
<li>YANG模型定义了数据的层次化结构，可用于基于NETCONF的操作。建模对象包括配置、状态数据、远程过程调用和通知。它可以对NETCONF客户端和服务器端之间发送的所有数据进行一个完整的描述。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/YANG.png"></p>
<h3 id="YANG与XLM"><a href="#YANG与XLM" class="headerlink" title="YANG与XLM"></a>YANG与XLM</h3><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><ul>
<li>在NETCONF客户端（例如网管平台/SDN控制器）加载YANG文件。</li>
<li>通过YANG文件将数据转换为XML格式的NETCONF消息发送到设备。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/YANG%E4%B8%8EXML.png"></p>
<h4 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h4><ul>
<li>在NETCONF服务器（例如路由器/交换机等）加载YANG文件</li>
<li>通过YANG文件将接收到的XML格式的NETCONF消息转换为数据并做后续处理。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/YANG%E4%B8%8EXML1.png"></p>
<h3 id="Telemetry基本概述"><a href="#Telemetry基本概述" class="headerlink" title="Telemetry基本概述"></a>Telemetry基本概述</h3><ul>
<li>Telemetry也作Network Telemetry，即网络遥测技术，是一项远程地从物理设备或虚拟设备上高速采集数据的技术。</li>
<li>设备通过推模式 ( Push Mode)周期性地主动向采集器上送设备的接口流量统计、CPU或内存数据等信息，相对传统拉模式(Pull Mode )的一问一答式交互，提供了更实时更高速的数据采集功能。</li>
</ul>
<p><img src="/2021/04/29/%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E4%B8%8E%E8%BF%90%E7%BB%B4/Telemetry.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/29/NAT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/29/NAT/" itemprop="url">NAT</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-29T09:10:52+08:00">
                2021-04-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="NAT概述"><a href="#NAT概述" class="headerlink" title="NAT概述"></a>NAT概述</h2><h3 id="NAT产生背景"><a href="#NAT产生背景" class="headerlink" title="NAT产生背景"></a>NAT产生背景</h3><ul>
<li>随着互联网用户的增多，lPv4的公有地址资源显得越发短缺。</li>
<li>同时IPv4公有地址资源存在地址分配不均的问题，这导致部分地区的IPv4可用公有地址严重不足。</li>
</ul>
<p><img src="/2021/04/29/NAT/NAT%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF.png" alt="NAT产生背景"></p>
<h3 id="NAT优势"><a href="#NAT优势" class="headerlink" title="NAT优势"></a>NAT优势</h3><ul>
<li>网络地址转换NAT ( Network Address Translation)是将IP数据报文头中的IP地址转换为另一个IP地址的过程。作为减缓lP地址枯竭的一种过渡方案，NAT通过地址重用的方法来满足IP地址的需要，可以在一定程度上缓解IP地址空间枯竭的压力。</li>
</ul>
<p>NAT除了解决IP地址短缺的问题，还带来了两个好处:</p>
<ul>
<li>有效避免来自外网的攻击，可以很大程度上提高网络安全性。</li>
<li>控制内网主机访问外网，同时也可以控制外网主机访问内网，解决了内网和外网不能互通的问题。</li>
</ul>
<h3 id="私网IP地址"><a href="#私网IP地址" class="headerlink" title="私网IP地址"></a>私网IP地址</h3><ul>
<li><p>公有地址︰由专门的机构管理、分配，可以在Internet上直接通信的IP地址。</p>
</li>
<li><p>私有地址:组织和个人可以任意使用，无法在Internet上直接通信，只能在内网使用的IP地址。</p>
</li>
<li><p>A、B、C类地址中各预留了一些地址专门作为私有IP地址:</p>
<p>A类:10.0.0.0 ~ 10.255.255.255</p>
<p>B类:172.16.0.0 ~172.31.255.255                                </p>
<p>C类:192.168.0.0~192.168.255.255</p>
</li>
</ul>
<p><img src="/2021/04/29/NAT/%E7%A7%81%E7%BD%91%E5%9C%B0%E5%9D%80.png" alt="私网地址"></p>
<h3 id="NAT技术原理"><a href="#NAT技术原理" class="headerlink" title="NAT技术原理"></a>NAT技术原理</h3><p>NAT:对IP数据报文中的IP地址进行转换，一般部署在<strong>网络出口设备</strong>，例如路由器或防火墙上。</p>
<p>NAT的典型应用场景</p>
<ul>
<li>对于从内到外的流量，网络设备通过NAT将数据包的<strong>源地址</strong>进行转换。</li>
<li>对于从外到内的流量，则对数据包的<strong>目的地址</strong>进行转换。</li>
</ul>
<p><img src="/2021/04/29/NAT/NAT%E5%8E%9F%E7%90%86.png" alt="NAT原理"></p>
<h2 id="静态NAT"><a href="#静态NAT" class="headerlink" title="静态NAT"></a>静态NAT</h2><h3 id="静态NAT原理"><a href="#静态NAT原理" class="headerlink" title="静态NAT原理"></a>静态NAT原理</h3><ul>
<li>静态NAT:每个私有地址都有一个与之对应并且固定的公有地址</li>
<li>静态NAT用在从内到外和从外到内的流量均可，静态NAT提供了一对一映射，支持双向互访。</li>
</ul>
<p><img src="/2021/04/29/NAT/%E9%9D%99%E6%80%81NAT.png" alt="静态NAT"></p>
<h3 id="静态NAT转换示例"><a href="#静态NAT转换示例" class="headerlink" title="静态NAT转换示例"></a>静态NAT转换示例</h3><p><img src="/2021/04/29/NAT/%E9%9D%99%E6%80%81NAT%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B.png" alt="静态NAT转换示例"></p>
<h3 id="静态NAT配置介绍"><a href="#静态NAT配置介绍" class="headerlink" title="静态NAT配置介绍"></a>静态NAT配置介绍</h3><p>1.方式一:接口视图下配置静态NAT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] nat static global &#123; global-address&#125; inside &#123;host-address&#125; </span><br></pre></td></tr></table></figure>
<p>global参数用于配置外部公有地址，inside参数用于配置内部私有地址。<br>2.方式二:系统视图下配置静态NAT</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] nat static global &#123; global-address] inside &#123;host-address &#125;</span><br></pre></td></tr></table></figure>
<p>配置命令相同，视图为系统视图，之后在具体的接口下开启静态NAT。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] nat static enable</span><br></pre></td></tr></table></figure>
<p>在接口下使能nat static功能。</p>
<h3 id="静态NAT配置示例"><a href="#静态NAT配置示例" class="headerlink" title="静态NAT配置示例"></a>静态NAT配置示例</h3><p><img src="/2021/04/29/NAT/%E9%9D%99%E6%80%81NAT%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B.png" alt="静态NAT配置示例"></p>
<p><img src="/2021/04/29/NAT/R1%E9%85%8D%E7%BD%AE.png" alt="R1配置"></p>
<h2 id="动态NAT"><a href="#动态NAT" class="headerlink" title="动态NAT"></a>动态NAT</h2><h3 id="动态NAT原理"><a href="#动态NAT原理" class="headerlink" title="动态NAT原理"></a>动态NAT原理</h3><ul>
<li>动态NAT:当<strong>内部主机访问外部网络时</strong>临时分配一个地址池中未使用的地址，并将该地址标记为“In Use”。当该主机不再访问外部网络时回收分配的地址，重新标记为“Not Use”。</li>
<li>动态NAT适用于由内到外的流量，为私网主机访问公网提供源地址转换。</li>
</ul>
<p><img src="/2021/04/29/NAT/%E5%8A%A8%E6%80%81NAT%E5%8E%9F%E7%90%86.png" alt="动态NAT原理"></p>
<h3 id="动态NAT转换示例"><a href="#动态NAT转换示例" class="headerlink" title="动态NAT转换示例"></a>动态NAT转换示例</h3><p><img src="/2021/04/29/NAT/%E5%8A%A8%E6%80%81NAT%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B1.png" alt="动态NAT转换示例"></p>
<p><img src="/2021/04/29/NAT/%E5%8A%A8%E6%80%81NAT%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B2.png" alt="动态NAT转换示例"></p>
<h3 id="动态NAT配置介绍"><a href="#动态NAT配置介绍" class="headerlink" title="动态NAT配置介绍"></a>动态NAT配置介绍</h3><p>1.创建地址池</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] nat address-group group-index start-address end-address</span><br></pre></td></tr></table></figure>
<p>配置公有地址范围，其中group-index为地址池编号，start-address、end-address分别为地址池起始地址、结束地址。<br>2.配置地址转换的ACL规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] acl number</span><br><span class="line">[Huawei-acl-basic-number ] rule permit source source-address source-wildcard</span><br></pre></td></tr></table></figure>
<p>配置基础ACL，匹配需要进行动态转换的源地址范围。<br>3.接口视图下配置带地址池的NAT Outbound</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] nat outbound acl-number address-group group-index [ no-pat]</span><br></pre></td></tr></table></figure>
<p>接口下关联ACL与地址池进行动态地址转换，no-pat参数指定不进行端口转换。</p>
<h3 id="动态NAT配置示例"><a href="#动态NAT配置示例" class="headerlink" title="动态NAT配置示例"></a>动态NAT配置示例</h3><p><img src="/2021/04/29/NAT/%E5%8A%A8%E6%80%81NAT%E7%A4%BA%E4%BE%8B.png" alt="动态NAT配置"></p>
<p><img src="/2021/04/29/NAT/%E5%8A%A8%E6%80%81NAT%E7%A4%BA%E4%BE%8B3.png" alt="动态NAT配置"></p>
<h2 id="NAPT-、-Easy-IP"><a href="#NAPT-、-Easy-IP" class="headerlink" title="NAPT 、 Easy IP"></a>NAPT 、 Easy IP</h2><h3 id="NAPT原理"><a href="#NAPT原理" class="headerlink" title="NAPT原理"></a>NAPT原理</h3><ul>
<li><p>NAPT ( Network Address and Port Translation，网络地址端口转换）︰从地址池中选择地址进行地址转换时不仅转换IP地址，同时也会对端口号进行转换，从而实现公有地址与私有地址的1:n映射，可以有效提高公有地址利用率。</p>
</li>
<li><p>NAPT适用于由内到外的流量，NAPT为私网主机访问公网提供源地址转换。</p>
</li>
</ul>
<p><img src="/2021/04/29/NAT/NAPT%E5%8E%9F%E7%90%86.png" alt="NAPT"></p>
<h3 id="NAPT转换示例"><a href="#NAPT转换示例" class="headerlink" title="NAPT转换示例"></a>NAPT转换示例</h3><p><img src="/2021/04/29/NAT/NAPT%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B1.png" alt="NAPT"></p>
<p><img src="/2021/04/29/NAT/NAPT%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B2.png" alt="NAPT"></p>
<h3 id="NAPT配置示例"><a href="#NAPT配置示例" class="headerlink" title="NAPT配置示例"></a>NAPT配置示例</h3><p><img src="/2021/04/29/NAT/NAPT%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B1.png" alt="NAPT"></p>
<p><img src="/2021/04/29/NAT/NAPT%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B2.png" alt="NAPT"></p>
<h3 id="Easy-IP"><a href="#Easy-IP" class="headerlink" title="Easy IP"></a>Easy IP</h3><ul>
<li><p>Easy IP:实现原理和NAPT相同，同时转换IP地址、传输层端口，区别在于Easy IP没有地址池的概念，使用接<br>口地址作为NAT转换的公有地址。</p>
</li>
<li><p>Easy IP适用于不具备固定公网IP地址的场景:如通过DHCP、PPPoE拨号获取地址的私有网络出口，可以直接<br>使用获取到的动态地址进行转换。</p>
</li>
<li><p>Easy IP适用于由内到外的流量，Easy IP为私网主机访问公网提供源地址转换。</p>
</li>
</ul>
<p><img src="/2021/04/29/NAT/Easy%E5%8E%9F%E7%90%86.png" alt="Easy"></p>
<h3 id="Easy-IP配置示例"><a href="#Easy-IP配置示例" class="headerlink" title="Easy IP配置示例"></a>Easy IP配置示例</h3><p><img src="/2021/04/29/NAT/Easy%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B.png" alt="Easy配置示例"></p>
<p><img src="/2021/04/29/NAT/Easy%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B1.png" alt="Easy配置示例"></p>
<h2 id="NAT-Server"><a href="#NAT-Server" class="headerlink" title="NAT Server"></a>NAT Server</h2><h3 id="NAT-Server使用场景"><a href="#NAT-Server使用场景" class="headerlink" title="NAT Server使用场景"></a>NAT Server使用场景</h3><ul>
<li>NAT Server:指定[公有地址:端口]与[私有地址:端口]的一对一映射关系，将内网服务器映射到公网，当私有网络中的服务器需要对公网提供服务时使用。</li>
<li>nat server命令用来定义一个内部服务器的映射表，外部用户可以通过地址和端口转换来访问内部服务器的某项服务。配置内部服务器可以使外部网络主动访问私网中的服务器。当外部网络向内部服务器的外部地址( global-address)发起连接请求时，NAT将该请求的目的地址替换为私网地址( inside-address)后，转发给私网内的服务器。 </li>
<li>NAT Server适用于由外到内的流量，NAT Server实现了内网主机对公网提供服务。</li>
</ul>
<p><img src="/2021/04/29/NAT/Server%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF.png" alt="Sever"></p>
<h3 id="NAT-Server转换示例"><a href="#NAT-Server转换示例" class="headerlink" title="NAT Server转换示例"></a>NAT Server转换示例</h3><p><img src="/2021/04/29/NAT/Server%E8%BD%AC%E6%8D%A2%E7%A4%BA%E4%BE%8B.png" alt="Sever"></p>
<h3 id="NAT-Server配置示例"><a href="#NAT-Server配置示例" class="headerlink" title="NAT Server配置示例"></a>NAT Server配置示例</h3><p><img src="/2021/04/29/NAT/Server%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B1.png" alt="Sever"></p>
<p><img src="/2021/04/29/NAT/Server%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B2.png" alt="Sever"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/" itemprop="url">网络服务和应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-28T18:52:35+08:00">
                2021-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h2><h3 id="文件传输协议"><a href="#文件传输协议" class="headerlink" title="文件传输协议"></a>文件传输协议</h3><p>主机之间传输文件是IP网络的一个重要功能，如今人们可以方便地使用网页、邮箱进行文件传输。<br>然而在互联网早期，Web (World Wide Web，万维网）还未出现，操作系统使用命令行的时代，用户使用命令行工具进行文件传输。其中最通用的方式就是使用FTP(File Transfer Protocol，文件传输协议)以及TFTP ( Trivial File Transfer Protocol，简单文件传输协议)。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE.png"></p>
<h3 id="FTP基本概念"><a href="#FTP基本概念" class="headerlink" title="FTP基本概念"></a>FTP基本概念</h3><p>FTP采用典型的C/S架构（即服务器端与客户端模型），客户端与服务器端建立TCP连接之后即可实现文件的上传、下载。<br>针对传输的文件类型不同，FTP可以采用不同的传输模式:</p>
<ul>
<li>ASCII模式</li>
<li>Binary (二进制）模式</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/FTP%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.png"></p>
<h3 id="FTP传输过程"><a href="#FTP传输过程" class="headerlink" title="FTP传输过程"></a>FTP传输过程</h3><h4 id="主动模式（PORT）"><a href="#主动模式（PORT）" class="headerlink" title="主动模式（PORT）"></a>主动模式（PORT）</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E4%B8%BB%E5%8A%A8%E6%A8%A1%E5%BC%8F.png"></p>
<h4 id="被动模式（PASV）"><a href="#被动模式（PASV）" class="headerlink" title="被动模式（PASV）"></a>被动模式（PASV）</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E8%A2%AB%E5%8A%A8%E6%A8%A1%E5%BC%8F.png"></p>
<h3 id="配置命令介绍"><a href="#配置命令介绍" class="headerlink" title="配置命令介绍"></a>配置命令介绍</h3><h4 id="设备作为服务器端"><a href="#设备作为服务器端" class="headerlink" title="设备作为服务器端"></a>设备作为服务器端</h4><p>用户通过FTP访问设备</p>
<p>1．开启FTP服务器端功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ftp [ ipv6 ] server enable</span><br></pre></td></tr></table></figure>
<p>缺省情况下，设备的FTP服务器端功能是关闭的。<br>2.配置FTP本地用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]aaa</span><br><span class="line">[Huawei]local-user user-name password irreversible-cipher password[Huawei]local-user user-name privilege level level</span><br><span class="line">[Huawei]local-user user-name service-type ftp</span><br><span class="line">[Huawei]local-user user-name ftp-directory directory</span><br></pre></td></tr></table></figure>
<p>必须将用户级别配置在3级或者3级以上，否则FTP连接将无法成功。</p>
<h4 id="设备作为客户端"><a href="#设备作为客户端" class="headerlink" title="设备作为客户端"></a>设备作为客户端</h4><ol>
<li>VRP作为FTP客户端访问FTP服务器端<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FTP Client&gt;ftp 10.1.1.1</span><br><span class="line">Trying 10.1.1.1 ...</span><br><span class="line">Press CTRL+K to abortConnected to 10.1.1.1.220 FTP service ready.User(10.1.1.1:(none)):ftp</span><br><span class="line">331 Password required for ftp.Enter password: 输入的密码</span><br><span class="line">230 User logged in.</span><br></pre></td></tr></table></figure></li>
<li>VRP作为FTP客户端的常用命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ascii   Set the file transfer type to ASCIl, and it is the default type</span><br><span class="line">binary   Set the file transfer type to support the binary image</span><br><span class="line">ls      List the contents of the current or remote directory</span><br><span class="line">passive    Set the toggle passive mode, the default is on</span><br><span class="line">get    Download the remote file to the local host</span><br><span class="line">put     Upload a local file to the remote host</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B1.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B2.png"></p>
<h3 id="TFTP基础"><a href="#TFTP基础" class="headerlink" title="TFTP基础"></a>TFTP基础</h3><p>相较于FTP，TFTP的设计就是以传输小文件为目标，协议实现就简单很多:</p>
<ul>
<li>使用UDP进行传输（端口号69 )</li>
<li>无需认证</li>
<li>只能直接向服务器端请求某个文件或者上传某个文件，无法查看服务器端的文件目录。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/TFPT.png"></p>
<h3 id="TFTP传输示例"><a href="#TFTP传输示例" class="headerlink" title="TFTP传输示例"></a>TFTP传输示例</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/TFTP%E4%BC%A0%E8%BE%93%E7%A4%BA%E4%BE%8B.png"></p>
<h3 id="TFPT配置命令"><a href="#TFPT配置命令" class="headerlink" title="TFPT配置命令"></a>TFPT配置命令</h3><p>1.VRP作为TFTP客户端下载文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; tftp TFTP_Server-lP-address get filenameTFTP</span><br></pre></td></tr></table></figure>
<p>无需登录，直接输入服务器端IP地址以及操作命令即可。</p>
<p>2.VRP作为TFTP客户端上传文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; tftp TFTP_Server-lP-address put filename</span><br></pre></td></tr></table></figure>
<p>TFTP无需登录，直接输入服务器端lP地址以及操作命令即可。<br>目前VRP设备只支持作为TFTP客户端。</p>
<h2 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h2><h3 id="Telnet应用场景"><a href="#Telnet应用场景" class="headerlink" title="Telnet应用场景"></a>Telnet应用场景</h3><p>为方便通过命令行管理设备，可以使用Telnet协议对设备进行管理。</p>
<p>Telnet协议与使用Console接口管理设备不同，无需专用线缆直连设备的Console接口，只要IP地址可达、能够和设备的TCP 23端口通信即可。</p>
<p>支持通过Telnet协议进行管理的设备被称为Telnet服务器端，而对应的终端则被称为Telnet客户端。很多网络设备同时支持作为Telnet服务器端、Telnet客户端。<br><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/Telnet%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.png"></p>
<h3 id="虚拟用户界面"><a href="#虚拟用户界面" class="headerlink" title="虚拟用户界面"></a>虚拟用户界面</h3><p>当用户使用Console接口、Telnet等方式登录设备的时候，系统会分配一个用户界面( user-interface )来管理、监控设备与用户间的当前会话，每个用户界面视图可以配置一系列参数用于指定用户的认证方式、登录后的权限级别，当用户登录设备后将会受这些参数限制。</p>
<p>Telnet所对应的用户界面类型为VTY ( Virtual Type Terminal，虚拟类型终端）。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2.png"></p>
<h3 id="配置命令"><a href="#配置命令" class="headerlink" title="配置命令"></a>配置命令</h3><p>1.开启Telnet服务器端功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] telnet server enable</span><br></pre></td></tr></table></figure>
<p>使能设备的Telnet服务器端功能。缺省情况下，设备的Telnet服务器端功能处于去使能状态，undo telnet server enable即可重新关闭Telnet服务器端功能。<br>2.进入用户视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] user-interface vty first-ui-number [ last-ui-number ]</span><br></pre></td></tr></table></figure>
<p>进入VTY用户界面视图。不同设备型号的VTY接口可能并不一致。<br>3.配置VTY用户界面支持的协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ui-vty0-4]] protocol inbound &#123; all &#x2F; telnet &#125;</span><br></pre></td></tr></table></figure>
<p>缺省情况下，VTY用户界面支持的协议是SSH ( Secure Shell Protocol，安全外壳协议）和Telnet。<br>4．配置认证方式以及密码认证方式下的认证密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ui-vty0-4] authentication-mode &#123;aaa &#x2F; none | password&#125;[Huawei-ui-vtyO-4] set authentication password cipher</span><br></pre></td></tr></table></figure>
<p>缺省情况下，无默认认证方式，需要进行手动配置。<br>不同VRP版本执行set authentication password cipher命令有差异:某些版本需要回车后输入密码，某些版本可直接在命令后输入密码。</p>
<h3 id="配置示例-1"><a href="#配置示例-1" class="headerlink" title="配置示例"></a>配置示例</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/Telnet%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B1.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/Telnet%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B2.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/Telnet%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B3.png"></p>
<h2 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h2><h3 id="手动配置网络参数的问题"><a href="#手动配置网络参数的问题" class="headerlink" title="手动配置网络参数的问题"></a>手动配置网络参数的问题</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E6%89%8B%E5%B7%A5%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%981.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E6%89%8B%E5%B7%A5%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%982.png"></p>
<h3 id="DHCP基本概念"><a href="#DHCP基本概念" class="headerlink" title="DHCP基本概念"></a>DHCP基本概念</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>DHCP ： Dynamic Host Configuration Protocol，动态主机配置协议，是一个用于局域网的网络协议，位于OSI模型的应用层，使用UDP协议工作，主要有两个用途：</p>
<ul>
<li>用于内部网或网络服务供应商自动分配IP地址给用户</li>
<li>用于内部网管理员对所有电脑作中央管理</li>
</ul>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p>动态分配IP地址，过程自动化，终端无需一一手工配置，配置信息统一管理（DNS,网关），IP地址有限、需要大量配置IP地址、经常移动终端。</p>
<h4 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h4><p>DHCP采用C/S构架，主机无需配置，从服务器端获取地址，可实现接入网络后即插即用。</p>
<h4 id="适用性"><a href="#适用性" class="headerlink" title="适用性"></a>适用性</h4><p>DHCP用一台或一组DHCP服务器来管理网络参数的分配，这种方案具有容错性。甚至对于那些很少改变地址的服务器来说，DHCP仍然被建议用来设置它们的地址。如果服务器需要被重新分配地址（RFC 2071）的时候，就尽可能不去做更改。对于一些设备，如路由器和防火墙，则不应使用DHCP。把TFTP或SSH服务器放在同一台运行DHCP的机器上也是有用的，目的是为了集中管理。</p>
<p>DHCP也可用于直接为服务器和桌面计算机分配地址，并且透过一个PPP代理，也可为拨接及宽带的主机，以及住宅NAT网关和路由器分配地址。DHCP一般不适用于使用在无边际路由器和DNS服务器上。</p>
<h4 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h4><p>DHCP于1993年10月成为标准协议，其前身是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/BOOTP">BOOTP</a>协议。当前的DHCP定义可以在RFC 2131中找到，而基于IPv6的建议标（DHCPv6）可以在RFC 3315中找到。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>动态主机设置协议（DHCP）是一种使网络管理员能够集中管理和自动分配IP网络地址的通信协议。在IP网络中，每个连接Internet的设备都需要分配唯一的IP地址。DHCP使网络管理员能从中心结点监控和分配IP地址。当某台计算机移到网络中的其它位置时，能自动收到新的IP地址。</p>
<p>DHCP使用了租约的概念，或称为计算机IP地址的有效期。租用时间是不定的，主要取决于用户在某地连接Internet需要多久，这对于教育行业和其它用户频繁改变的环境是很实用的。透过较短的租期，DHCP能够在一个计算机比可用IP地址多的环境中动态地重新配置网络。DHCP支持为计算机分配静态地址，如需要永久性IP地址的Web服务器。</p>
<p>DHCP和另一个网络IP管理协议BOOTP类似。当前两种配置管理协议都得到了普遍使用，其中DHCP更为先进。某些操作系统，如Windows NT/2000，都带有DHCP服务器。DHCP或BOOTP客户端是装在计算机中的一个程序，这样就可以对其进行配置操作。</p>
<h4 id="分配IP地址方式"><a href="#分配IP地址方式" class="headerlink" title="分配IP地址方式"></a>分配IP地址方式</h4><p>（1）手工配置方式：通过网络管理员手工配置某台客户端特定的IP地址，当客户端请求分配时，DHCP服务器就将手动配置的IP地址分配给客户端。。</p>
<p>（2）自动配置方式：当DHCP客户端第一次想服务端租用到第一个IP地址后，就将这个IP地址永久分配给客户端使用。</p>
<p>（3）动态配置方式：服务器暂时分配一个IP地址给客户端，根据租约到期或者续约租期的方式来管理分配的IP地址。</p>
<h3 id="DHCP优点"><a href="#DHCP优点" class="headerlink" title="DHCP优点"></a>DHCP优点</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/DHCP%E4%BC%98%E7%82%B9.png"></p>
<h3 id="DHCP工作原理"><a href="#DHCP工作原理" class="headerlink" title="DHCP工作原理"></a>DHCP工作原理</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/DHCP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png"></p>
<h3 id="DHCP租期更新"><a href="#DHCP租期更新" class="headerlink" title="DHCP租期更新"></a>DHCP租期更新</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/DHCP%E7%A7%9F%E6%9C%9F%E6%9B%B4%E6%96%B0.png"></p>
<p>如果在50%租期时客户端未得到原服务器端的回应，则客户端在87.5%租期时会广播发送DHCP Request，任意一台DHCP服务器端都可回应，该过程称为重绑定。</p>
<h3 id="DHCP配置命令"><a href="#DHCP配置命令" class="headerlink" title="DHCP配置命令"></a>DHCP配置命令</h3><p>1.开启DHCP功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] dhcp enable</span><br></pre></td></tr></table></figure>
<p>2.开启接口采用接口地址池的DHCP服务器端功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Gigabitthernet0&#x2F;0&#x2F;0]dhcp select interface</span><br></pre></td></tr></table></figure>
<p>3.指定接口地址池下的DNS服务器地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Gigabitthernet0&#x2F;0&#x2F;0]dhcp server dns-list ip-address</span><br></pre></td></tr></table></figure>
<p>4.配置接口地址池中不参与自动分配的IP地址范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Gigabitthernet0&#x2F;0&#x2F;0]dhcp server excluded-ip-address start-ip-address [ end-ip-address ]</span><br></pre></td></tr></table></figure>
<p>5.配置DHCP服务器接口地址池中IP地址的租用有效期限功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Gigabitthernet0&#x2F;0&#x2F;0]dhcp server lease &#123; day day [ hour hour [ minute minute] ] | unlimited &#125;</span><br></pre></td></tr></table></figure>
<p>缺省情况下，IP地址的租期为1天。<br>6.创建全局地址池</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]ip pool ip-pool-name</span><br></pre></td></tr></table></figure>
<p>7.配置全局地址池可动态分配的IP地址范围</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ip-pool-2]network ip-address [ mask &#123; mask | mask-length &#125; ]</span><br></pre></td></tr></table></figure>
<p>8.配置DHCP客户端的网关地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ip-pool-2]gateway-list ip-address</span><br></pre></td></tr></table></figure>
<p>9.配置DHCP客户端使用的DNS服务器的IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ip-pool-2]dns-list ip-address</span><br></pre></td></tr></table></figure>
<p>10.配置IP地址租期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ip-pool-2] lease &#123; day day [ hour hour [ minute minute ] ] | unlimited &#125;</span><br></pre></td></tr></table></figure>
<p>11.使能接口的DHCP服务器功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Gigabitthernet0&#x2F;0&#x2F;0]dhcp select global</span><br></pre></td></tr></table></figure>

<p>12.被分配的IP地址与请求端的MAC地址绑定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ip-pool-2]static-bind ip-address 200.1.1.100 mac-address 0000-0000-0000</span><br></pre></td></tr></table></figure>

<h3 id="DHCP配置示例"><a href="#DHCP配置示例" class="headerlink" title="DHCP配置示例"></a>DHCP配置示例</h3><h4 id="接口地址池配置"><a href="#接口地址池配置" class="headerlink" title="接口地址池配置"></a>接口地址池配置</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E6%B1%A0%E9%85%8D%E7%BD%AE.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E6%8E%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E6%B1%A0%E9%85%8D%E7%BD%AE1.png"></p>
<h4 id="全局地址池配置"><a href="#全局地址池配置" class="headerlink" title="全局地址池配置"></a>全局地址池配置</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E5%85%A8%E5%B1%80%E5%9C%B0%E5%9D%80%E6%B1%A0%E9%85%8D%E7%BD%AE1.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E5%85%A8%E5%B1%80%E5%9C%B0%E5%9D%80%E6%B1%A0%E9%85%8D%E7%BD%AE2.png"></p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><h3 id="使用浏览器访问网页"><a href="#使用浏览器访问网页" class="headerlink" title="使用浏览器访问网页"></a>使用浏览器访问网页</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/HTTP.png"></p>
<p>当我们在浏览器中输入URL ( Uniform Resource Locator，统一资源定位符）时，浏览器就可以从某处获取内容，并将页面内容显示在浏览器中。</p>
<p>HTTP ( Hypertext Transfer Protocol，超文本传输协议)∶客户端浏览器或其他程序与Web服务器之间的应用层通信协议。HTTP是典型的C/S构架应用，作为应用层协议使用TCP进行传输。</p>
<h3 id="诞生背景"><a href="#诞生背景" class="headerlink" title="诞生背景"></a>诞生背景</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/HTTP%E8%AF%9E%E7%94%9F%E8%83%8C%E6%99%AF.png"></p>
<p>在互联网早期，为了进行文档之间的共享，人们提出了WWW ( World Wide Web，万维网）。</p>
<p>WWW由三部分组成∶在浏览器中显示文档内容的页面标记语言HTML ( Hypertext Markup Language，超文本标记语言）、在网络上传输文档的协议HTTP、在网络上表明文档位置的URL。</p>
<p>WWW早期其实是浏览HTML的客户端应用程序的名称，现在则代表三项技术的合集也可以简称为Web。</p>
<h3 id="传输示例"><a href="#传输示例" class="headerlink" title="传输示例"></a>传输示例</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E4%BC%A0%E8%BE%93%E7%A4%BA%E4%BE%8B1.png"></p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E4%BC%A0%E8%BE%93%E7%A4%BA%E4%BE%8B2.png"></p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><h3 id="DNS的诞生"><a href="#DNS的诞生" class="headerlink" title="DNS的诞生"></a>DNS的诞生</h3><p>当我们在浏览器中输入一个域名访问某个网站时，这个域名最终会被解析为一个IP地址，我们的浏览器实际是在和这个IP地址进行通信。</p>
<p>负责将域名解析到IP地址的协议为DNS ( Domain Name System，域名解析系统）。</p>
<p>网络中每个节点都有自己唯一的IP地址，通过IP地址可以实现节点之间的相互访问，但是如果和所有的节点进行通信都使用IP地址的方式，人们很难记住这么多IP地址，为此提出了DNS，将难以记忆的IP地址映射为字符类型的地址。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/DNS%E7%9A%84%E8%AF%9E%E7%94%9F.png"></p>
<h3 id="域名系统组成"><a href="#域名系统组成" class="headerlink" title="域名系统组成"></a>域名系统组成</h3><p>域名∶主机的字符标识方式。大部分情况下，我们访问网站时在浏览器内输入的URL就是该网站的域名。</p>
<p>域名解析服务器（DNS Server )︰负责维护域名与IP地址对应关系的数据库，并对解析者的请求进行响应。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90.png"></p>
<h3 id="域名的表示方法"><a href="#域名的表示方法" class="headerlink" title="域名的表示方法"></a>域名的表示方法</h3><p>域名的表示方法为:主机名.次顶级域名.顶级域名.根域，根域为 “.” ，一般最后的根域不表示。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/%E5%9F%9F%E5%90%8D%E7%9A%84%E8%A1%A8%E7%A4%BA%E6%96%B9%E6%B3%95.png"></p>
<h3 id="DNS查询方式"><a href="#DNS查询方式" class="headerlink" title="DNS查询方式"></a>DNS查询方式</h3><p>DNS是一个分布式系统，绝大多数的DNS服务器端的数据库不会拥有所有的域名记录，当客户端向一个DNS服务器端查询域名但该DNS服务器端上却没有该域名的记录时，此时会有两种继续查询的方式:</p>
<ul>
<li>递归查询:由DNS服务器向其他DNS服务器进行查询，将最终查询结果返回给DNS客户端</li>
<li>迭代查询:DNS服务器告知DNS客户端其他DNS服务器地址，客户端自行向其他DNS服务器进行查询。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/DNS%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F.png"></p>
<h2 id="NTP"><a href="#NTP" class="headerlink" title="NTP"></a>NTP</h2><h3 id="时间同步需求"><a href="#时间同步需求" class="headerlink" title="时间同步需求"></a>时间同步需求</h3><p>当今企业园区网络中很多场景都需要所有设备保持时钟一致:</p>
<ul>
<li>网络管理:对从不同路由器采集来的日志信息、调试信息进行分析时，需要以时间作为参照依据。</li>
<li>计费系统:要求所有设备的时钟保持一致。</li>
<li>多个系统协同处理同一个复杂事件:为保证正确的执行顺序，多个系统必须参考同一时钟。</li>
<li>备份服务器和客户机之间进行增量备份:要求备份服务器和所有客户机之间的时钟同步。</li>
<li>系统时间:某些应用程序需要知道用户登录系统的时间以及文件修改的时间。</li>
</ul>
<h3 id="NTP简介"><a href="#NTP简介" class="headerlink" title="NTP简介"></a>NTP简介</h3><p>如果采用管理员手工输入命令修改系统时间来进行时间同步，不但工作量巨大，而且也不能保证适中的精确性.为此可以使用NTP(Network Time Protocol)技术来同步设备的时钟。</p>
<p>网络时间协议NTP( Network Time Protocol)是TCP/IP协议族里面的一个应用层协议。NTP用于在一系列分布式时间服务器与客户端之间同步时钟。NTP的实现基于IP和UDP。NTP报文通过UDP传输，端口号是123。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/NPT%E7%AE%80%E4%BB%8B.png"></p>
<h3 id="NTP网络结构"><a href="#NTP网络结构" class="headerlink" title="NTP网络结构"></a>NTP网络结构</h3><p>主时间服务器:通过线缆或无线电直接同步到标准参考时钟，标准参考时钟通常是Radio Clock或卫星定位系统等。</p>
<p>二级时间服务器:通过网络中的主时间服务器或者其他二级服务器取得同步。二级时间服务器通过NTP将时间信息传送到局域网内部的其它主机。</p>
<p>层数（stratum )︰层数是对时钟同步情况的一个分级标准，代表了一个时钟的精确度，取值范围1~15，数值越小，精确度越高。1表示时钟精确度最高，15表示未同步。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1%E5%92%8C%E5%BA%94%E7%94%A8/NTP%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84.png"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/" itemprop="url">网络参考模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-28T08:47:04+08:00">
                2021-04-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="应用和数据"><a href="#应用和数据" class="headerlink" title="应用和数据"></a>应用和数据</h2><h3 id="故事的起源-应用"><a href="#故事的起源-应用" class="headerlink" title="故事的起源 - 应用"></a>故事的起源 - 应用</h3><p>应用的存在，是为了满足人们的各种需求，比如访问网页，在线游戏，在线视频等。伴随着应用会有信息的产生。比如文本，图片，视频等都是信息的不同呈现方式。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%BA%94%E7%94%A8.png" alt="应用"></p>
<h3 id="应用的实现-数据"><a href="#应用的实现-数据" class="headerlink" title="应用的实现 - 数据"></a>应用的实现 - 数据</h3><p><strong>数据的产生</strong>：在计算机领域，数据是各种信息的载体。</p>
<p><strong>数据传输</strong>：大部分应用程序所产生的数据需要在不同的设备之间传递。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E6%95%B0%E6%8D%AE.png" alt="数据"></p>
<h2 id="网络参考模型与标准协议"><a href="#网络参考模型与标准协议" class="headerlink" title="网络参考模型与标准协议"></a>网络参考模型与标准协议</h2><h3 id="OSI参考模型"><a href="#OSI参考模型" class="headerlink" title="OSI参考模型"></a>OSI参考模型</h3><table>
<thead>
<tr>
<th>层级</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>7.应用层</td>
<td>对应用程序提供接口。</td>
</tr>
<tr>
<td>6.表示层</td>
<td>进行数据格式的转换，以确保一个系统生成的应用层数据能够被另外一个系统的应用层所识别和理解。</td>
</tr>
<tr>
<td>5.会话层</td>
<td>在通信双方之间建立、管理和终止会话。</td>
</tr>
<tr>
<td>4.传输层</td>
<td>建立、维护和取消一次端到端的数据传输过程。控制传输节奏的快慢，调整数据的排序等等。</td>
</tr>
<tr>
<td>3.网络层</td>
<td>定义逻辑地址;实现数据从源到目的地的转发。</td>
</tr>
<tr>
<td>2.数据链路层</td>
<td>将分组数据封装成帧;在数据链路上实现数据的点到点、或点到多点方式的直接通信;差错检测。</td>
</tr>
<tr>
<td>1.物理层</td>
<td>在媒介上传输比特流;提供机械的和电气的规约。</td>
</tr>
</tbody></table>
<h3 id="TCP-IP参考模型"><a href="#TCP-IP参考模型" class="headerlink" title="TCP/IP参考模型"></a>TCP/IP参考模型</h3><p>因为OSI协议栈比较复杂，且TCP和IP两大协议在业界被广泛使用，所以TCP/IP参考模型成为了互联网的主流参考模型。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/TCPIP.png" alt="TCP IP"></p>
<h3 id="TCP-IP常见协议"><a href="#TCP-IP常见协议" class="headerlink" title="TCP/IP常见协议"></a>TCP/IP常见协议</h3><p>TCP/IP协议栈定义了一系列的标准协议。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/TCPIP%E5%B8%B8%E8%A7%81%E5%8D%8F%E8%AE%AE.png" alt="TCP IP常见协议"></p>
<h3 id="常见协议标准化组织"><a href="#常见协议标准化组织" class="headerlink" title="常见协议标准化组织"></a>常见协议标准化组织</h3><h4 id="IETF"><a href="#IETF" class="headerlink" title="IETF"></a>IETF</h4><p>Internet Engineering Task Force，负责开发和推广互联网协议（特别是构成TCP/IP协议族的协议）的志愿组织，通过RFC发布新的或者取代老的协议标准。</p>
<h4 id="IEEE"><a href="#IEEE" class="headerlink" title="IEEE"></a>IEEE</h4><p>Institute of Electrical and Electronics Engineers，IEEE制定了全世界电子、电气和计算机科学领域30%左右的标准，比较知名的有IEEE802.3(Ethernet)、IEEE802.11 (WIFI)等。</p>
<h4 id="ISO"><a href="#ISO" class="headerlink" title="ISO"></a>ISO</h4><p>International Organization for Standardization，在制定计算机网络标准方面，ISO是起着重大作用的国际组织，如OSI模型，定义于ISO/IEC 7498-1。</p>
<h2 id="TCP-IP对等模型5层"><a href="#TCP-IP对等模型5层" class="headerlink" title="TCP/IP对等模型5层"></a>TCP/IP对等模型5层</h2><h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p>应用层为应用软件提供接口，使应用程序能够使用网络服务。应用层协议会指定使用相应的传输层协议，以及传输层所使用的端口等。</p>
<p>应用层的PDU被称为Data（数据）。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%BA%94%E7%94%A8%E5%B1%82.png" alt="应用层"></p>
<h4 id="常见的应用层协议-FTP"><a href="#常见的应用层协议-FTP" class="headerlink" title="常见的应用层协议 - FTP"></a>常见的应用层协议 - FTP</h4><p>FTP File Transfer Protocol<br>一个用于从一台主机传送文件到另一台主机的协议，用于文件的“下载”和“上传”，它采用C/S( Client/Server)结构。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/FTP.png" alt="应用层"></p>
<h4 id="常见的应用层协议-Telnet"><a href="#常见的应用层协议-Telnet" class="headerlink" title="常见的应用层协议 - Telnet"></a>常见的应用层协议 - Telnet</h4><p>Telnet数据网络中提供远程登录服务的标准协议。<br>Telnet为用户提供了在本地计算机上完成远程设备工作的能力</p>
<p>用户通过Telnet客户端程序连接到Telnet服务器。用户在Telnet客户端中输入命令这些命令会在服务器端运行，就像直接在服务端的控制台上输入一样。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/Telnet.png" alt="应用层"></p>
<h4 id="常见的应用层协议-HTTP"><a href="#常见的应用层协议-HTTP" class="headerlink" title="常见的应用层协议 - HTTP"></a>常见的应用层协议 - HTTP</h4><p>HTTP HyperText Transfer Protocol<br>互联网上应用最为广泛的一种网络协议。设计HTTP最初的目的是为了提供一种发布和接收HTML页面的方法。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/HTTP.png" alt="应用层"></p>
<h3 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h3><p>传输层协议接收来自应用层协议的数据，封装上相应的传输层头部，帮助其建立“端到端”( Port to Port)的连接。</p>
<p>传输层的PDU被称为Segment（段）。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E4%BC%A0%E8%BE%93%E5%B1%82.png" alt="传输层"></p>
<h4 id="TCP和UDP报文格式"><a href="#TCP和UDP报文格式" class="headerlink" title="TCP和UDP报文格式"></a>TCP和UDP报文格式</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/TCP%E5%92%8CUDP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F.png" alt="TCP和UDP报文格式"></p>
<h4 id="TCP和UDP-端口号"><a href="#TCP和UDP-端口号" class="headerlink" title="TCP和UDP - 端口号"></a>TCP和UDP - 端口号</h4><p>客户端使用的源端口一般随机分配，目标端口则由服务器的应用指定;源端口号一般为系统中未使用的，且大于1023;<br>目的端口号为服务端开启的应用（服务）所侦听的端口，如HTTP缺省使用80。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E7%AB%AF%E5%8F%A3%E5%8F%B7.png" alt="端口号"></p>
<h4 id="TCP的建立-三次握手"><a href="#TCP的建立-三次握手" class="headerlink" title="TCP的建立-三次握手"></a>TCP的建立-三次握手</h4><p>任何基于TCP的应用，在发送数据之前，都需要由TCP进行“三次握手”建立连接。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png" alt="三次握手"></p>
<h4 id="TCP的序列号与确认序列号"><a href="#TCP的序列号与确认序列号" class="headerlink" title="TCP的序列号与确认序列号"></a>TCP的序列号与确认序列号</h4><p>TCP使用序列号和确认序列号字段实现数据的可靠和有序传输。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B.png" alt="传输过程"></p>
<h4 id="TCP的窗口滑动机制"><a href="#TCP的窗口滑动机制" class="headerlink" title="TCP的窗口滑动机制"></a>TCP的窗口滑动机制</h4><p>TCP通过滑动窗口机制来控制数据的传输速率。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.png" alt="滑动窗口"></p>
<h4 id="TCP的关闭-四次挥手"><a href="#TCP的关闭-四次挥手" class="headerlink" title="TCP的关闭-四次挥手"></a>TCP的关闭-四次挥手</h4><p>当数据传输完成，TCP需要通过“四次挥手”机制断开TCP连接，释放系统资源。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png" alt="四次挥手"></p>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>传输层负责建立主机之间进程与进程之间的连接，而网络层则负责数据从一台主机到另外一台主机之间的传递。</p>
<p>网络层的PDU被称为Packet(包)。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.png" alt="网络层"></p>
<h4 id="数据包的封装过程"><a href="#数据包的封装过程" class="headerlink" title="数据包的封装过程"></a>数据包的封装过程</h4><p>将上层提交的数据加上网络层头部。</p>
<h3 id><a href="#" class="headerlink" title></a></h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E7%BD%91%E7%BB%9C%E5%8C%85%E5%B0%81%E8%A3%85%E8%BF%87%E7%A8%8B.png" alt="网络包封装过程"></p>
<h4 id="基于网络层地址的报文转发过程"><a href="#基于网络层地址的报文转发过程" class="headerlink" title="基于网络层地址的报文转发过程"></a>基于网络层地址的报文转发过程</h4><ul>
<li>源设备发出的报文会在其网络层头部携带该报文的源及目的设备的网络层地址;</li>
<li>具备路由功能的网络设备（例如路由器等）会维护路由表（相当于它的地图) ;</li>
<li>当这些网络设备收到报文时，会读取其网络层携带的目的地址，并在其路由表中查询该地址，找到匹配项后，按照该表项的指示转发数据。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E7%BD%91%E7%BB%9C%E5%B1%82%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B.png" alt="网络层转发过程"></p>
<blockquote>
<p>Router1路由表中指导报文从G0/0/1转发出去，没有出接口为G0/0/0的路由</p>
</blockquote>
<h3 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h3><p>数据链路层位于网络层和物理层之间，负责<strong>段内通信</strong>，可以向网络层的IP、IPv6等协议提供服务。</p>
<p>数据链路层的PDU被称为Frame (帧)。<br>以太网(Ethernet)是最常见的数据链路层协议。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82.png" alt="数据链路层"></p>
<h4 id="以太网与MAC地址"><a href="#以太网与MAC地址" class="headerlink" title="以太网与MAC地址"></a>以太网与MAC地址</h4><h5 id="以太网定义"><a href="#以太网定义" class="headerlink" title="以太网定义"></a>以太网定义</h5><ul>
<li>以太网是一种广播式数据链路层协议，支持多点接入。</li>
<li>个人电脑的网络接口遵循的就是以太网标准。</li>
<li>一般情况下，一个广播域对应着一个IP网段。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E4%BB%A5%E5%A4%AA%E7%BD%91.png" alt="以太网"></p>
<h5 id="以太网MAC地址"><a href="#以太网MAC地址" class="headerlink" title="以太网MAC地址"></a>以太网MAC地址</h5><ul>
<li>MAC (Media Access Control)地址在网络中唯一标识一个网卡，每个网卡都需要且会有唯一的一个MAC地址。</li>
<li><strong>MAC用于在一个IP网段内，寻址找到具体的物理设备</strong>。</li>
<li>工作在<strong>数据链路层的设备</strong>。例如以太网交换机，会维护一张MAC地址表，用于指导数据帧转发。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/MAC%E5%9C%B0%E5%9D%80.png" alt="MAC地址"></p>
<h4 id="地址解析协议（ARP）"><a href="#地址解析协议（ARP）" class="headerlink" title="地址解析协议（ARP）"></a>地址解析协议（ARP）</h4><p>ARP （Address Resolution Protocol）地址解析协议</p>
<p>根据已知的IP地址解析获得其对应的MAC地址。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP.png" alt="ARP"></p>
<h5 id="ARP工作原理"><a href="#ARP工作原理" class="headerlink" title="ARP工作原理"></a>ARP工作原理</h5><p>工作过程分为5步，如下示例展示工作原理。</p>
<h6 id="发送方查看自己ARP缓存表"><a href="#发送方查看自己ARP缓存表" class="headerlink" title="发送方查看自己ARP缓存表"></a>发送方查看自己ARP缓存表</h6><ul>
<li>在发送数据前，设备会先查找ARP缓存表。</li>
<li>如果缓存表中存在对方设备的MAC地址，则直接采用该MAC地址来封装帧，然后将帧发送出去。如果缓存表中不存在相应信息，则通过ARP来获取。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP1.png" alt="ARP"></p>
<h6 id="发送方发送ARP请求"><a href="#发送方发送ARP请求" class="headerlink" title="发送方发送ARP请求"></a>发送方发送ARP请求</h6><ul>
<li><p>主机1通过发送ARP Request报文来获取主机2的MAC地址。</p>
</li>
<li><p>由于不知道目的MAC地址，因此ARP Request报文内的目的端MAC地址为0。</p>
</li>
<li><p>ARP Request是广播数据帧，因此交换机收到后，会对该帧执行泛洪操作。</p>
</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP2.png" alt="ARP"></p>
<h6 id="接受方更新ARP缓存表"><a href="#接受方更新ARP缓存表" class="headerlink" title="接受方更新ARP缓存表"></a>接受方更新ARP缓存表</h6><ul>
<li>所有的主机接收到该ARP Request报文后，都会检查它的目的端IP地址字段与自身的IP地址是否匹配</li>
<li>主机2发现IP地址匹配，则会将ARP报文中的发送端MAC地址和发送端IP地址信息记录到自己的ARP缓存表中。</li>
<li>收到ARP Request报文的主机都会更新自己ARP缓存表，将发送来的IP地址和其对应MAC地址加入ARP缓存表中。</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP3.png" alt="ARP"></p>
<h6 id="接收方接受ARP请求并且发送ARP响应"><a href="#接收方接受ARP请求并且发送ARP响应" class="headerlink" title="接收方接受ARP请求并且发送ARP响应"></a>接收方接受ARP请求并且发送ARP响应</h6><ul>
<li><p>主机2通过发送ARP Reply报文来响应主机1的请求。</p>
</li>
<li><p>此时主机2已知主机1的MAC地址，因此ARP Reply是单播数据帧。</p>
</li>
<li><p>交换机收到该单播数据帧后，会对该帧执行转发操作。</p>
</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP4.png" alt="ARP"></p>
<h6 id="接收方接受ARP响应并更新ARP缓存表"><a href="#接收方接受ARP响应并更新ARP缓存表" class="headerlink" title="接收方接受ARP响应并更新ARP缓存表"></a>接收方接受ARP响应并更新ARP缓存表</h6><ul>
<li>主机1收到ARP Reply以后，会检查ARP报文中目的端lP地址字段是否与自己的IP地址匹配。</li>
<li>如果匹配，会将ARP报文中的发送端MAC地址和发送端IP地址信息记录到自己的ARP缓存表中</li>
</ul>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/ARP5.png" alt="ARP"></p>
<h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><p>数据到达物理层之后，物理层会根据物理介质的不同，将数字信号转换成光信号、电信号或者是电磁波信号。</p>
<p>物理层的PDU被称为比特流(Bitstream ) 。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E7%89%A9%E7%90%86%E5%B1%82.png" alt="物理层"></p>
<h4 id="常见的传输介质"><a href="#常见的传输介质" class="headerlink" title="常见的传输介质"></a>常见的传输介质</h4><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BC%A0%E8%BE%93%E4%BB%8B%E8%B4%A8.png" alt="常见的传输介质"></p>
<h2 id="数据的封装过程"><a href="#数据的封装过程" class="headerlink" title="数据的封装过程"></a>数据的封装过程</h2><h3 id="发送方数据封装"><a href="#发送方数据封装" class="headerlink" title="发送方数据封装"></a>发送方数据封装</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%B0%81%E8%A3%851.png" alt="封装"></p>
<h3 id="中间网络数据传输"><a href="#中间网络数据传输" class="headerlink" title="中间网络数据传输"></a>中间网络数据传输</h3><p>封装好的完整数据，将会在网络中被传递。</p>
<p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%B0%81%E8%A3%852.png" alt="封装"></p>
<h3 id="接收方数据解封装"><a href="#接收方数据解封装" class="headerlink" title="接收方数据解封装"></a>接收方数据解封装</h3><p><img src="/2021/04/28/%E7%BD%91%E7%BB%9C%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/%E5%B0%81%E8%A3%853.png" alt="封装"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/27/VRP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/27/VRP/" itemprop="url">华为VRP系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-27T17:14:57+08:00">
                2021-04-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="VRP"><a href="#VRP" class="headerlink" title="VRP"></a>VRP</h2><h3 id="什么是VRP？"><a href="#什么是VRP？" class="headerlink" title="什么是VRP？"></a>什么是VRP？</h3><p>VRP是华为公司具有完全自主知识产权的网络操作系统，可以运行在多种硬件平台之上。</p>
<p>VRP拥有一致的网络界面、用户界面和管理界面，熟悉VRP命令行并且熟练掌握VRP配置是高效管理华为网络设备的必备基础。</p>
<h3 id="VRP的功能"><a href="#VRP的功能" class="headerlink" title="VRP的功能"></a>VRP的功能</h3><ul>
<li>实现统一的用户界面和管理界面</li>
<li>实现控制平面功能，并定义转发平面接口规范。</li>
<li>实现各产品转发平面与VRP控制平面之间的交互</li>
<li>屏蔽各产品链路层对于网络层的差异</li>
</ul>
<h3 id="VRP发展史"><a href="#VRP发展史" class="headerlink" title="VRP发展史"></a>VRP发展史</h3><p><img src="/2021/04/27/VRP/VRP%E5%8F%91%E5%B1%95%E5%8F%B2.png" alt="VRP发展史"></p>
<h3 id="VRP文件系统"><a href="#VRP文件系统" class="headerlink" title="VRP文件系统"></a>VRP文件系统</h3><p>文件系统是指对存储器中文件、目录的管理。</p>
<ul>
<li>系统软件是设备启动、运行的必备软件。常见文件后缀名为: ( .cc )。</li>
<li>配置文件是用户将配置命令保存的文件。常见文件后缀名为:(.cfg, .zip , .dat)。</li>
<li>补丁是一种与设备系统软件兼容的软件。常见文件后缀名为:(.pat).</li>
<li>PAF文件是根据用户对产品需要提供了一个简单有效的方式来裁剪产品的资源占用和功能特性。常见文件后缀名为:(.bin)。</li>
</ul>
<p><img src="/2021/04/27/VRP/VRP%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png" alt="VRP文件系统"></p>
<h3 id="VRP存储设备"><a href="#VRP存储设备" class="headerlink" title="VRP存储设备"></a>VRP存储设备</h3><ul>
<li><p>Flash：属于非易失存储器。</p>
</li>
<li><p>SDRAM：同步动态随机存储器。</p>
</li>
<li><p>NVRAM：非易失随机读写存储器。</p>
</li>
<li><p>SD Card：断电后，不会丢失数据。存储容量较大，—般出现在主控板上。</p>
</li>
<li><p>USB：接口，用于外接大容量存储设备。</p>
</li>
</ul>
<h3 id="设备初始化过程"><a href="#设备初始化过程" class="headerlink" title="设备初始化过程"></a>设备初始化过程</h3><p>设备上电后，首先运行BootROM软件，初始化硬件并显示设备的硬件参数，然后运行系统软件，最后从默认存储路径中读取配置文件进行设备的初始化操作。</p>
<p><img src="/2021/04/27/VRP/%E8%AE%BE%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B.png" alt="设备初始化过程"></p>
<h3 id="设备管理方式"><a href="#设备管理方式" class="headerlink" title="设备管理方式"></a>设备管理方式</h3><p>命令行和Web网管是常见管理方式。</p>
<h4 id="命名行"><a href="#命名行" class="headerlink" title="命名行"></a>命名行</h4><p>命令行方式需要用户使用设备提供的命令行对设备进行管理与维护，此方式可实现对设备的精细化管理，但是要求用户熟悉命令行。命令行方式可以通过Console口、Telnet或SSH方式登录设备。</p>
<p>登录成功后即进入命令行界面CLl ( Command Line Interface ) 。命令行界面是工程师与网络设备进行交互的常用工具。</p>
<p><img src="/2021/04/27/VRP/CLI.png" alt="CLI"></p>
<p>设备登录的两种方式分为两种:本地登录(Console)和远程登录(Telnet或SSH)。</p>
<h5 id="本地登录"><a href="#本地登录" class="headerlink" title="本地登录"></a>本地登录</h5><ul>
<li>当用户需为第一次上电的设备进行配置时,可通过Console口本地登录设备。</li>
<li>控制口( Console Port )是一种通信串行端口，由设备的主控板提供。</li>
<li>用户终端的串行端口可以与设备Console口直接连接，然后通过PuTTY工具本地登录实现对设备的本地配置。</li>
</ul>
<p><img src="/2021/04/27/VRP/%E6%9C%AC%E5%9C%B0%E7%99%BB%E5%BD%95.png" alt="本地登录"></p>
<ul>
<li>PuTTY工具是一个Telnet、sSH、串行接口等的连接软件。<br>本地登录时，终端设备采用串口与华为设备Console口连接，所以采用“Serial”连接类型，COM端口根据终端设备实际端口选取，速率固定为9600。</li>
</ul>
<p><img src="/2021/04/27/VRP/PuTTY.png" alt="PuTTY"></p>
<h5 id="远程登录"><a href="#远程登录" class="headerlink" title="远程登录"></a>远程登录</h5><p>远程登录指终端远程登录到网络设备上，并且可以集中管理维护网络设备。<br>远程登录包括SSH和Telnet两种方式。</p>
<p><img src="/2021/04/27/VRP/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95.png" alt="远程登录"></p>
<h4 id="Web网管"><a href="#Web网管" class="headerlink" title="Web网管"></a>Web网管</h4><p>Web网管方式通过图形化的操作界面，实现对设备直观方便地管理与维护，但是此方式仅可实现对设备部分功能的管理与维护。Web网管方式可以通过HTTP和HTTPS方式登录设备。</p>
<ul>
<li>以华为AR系列路由器为例，PC终端打开浏览昌软件，在地址栏中输入“<a target="_blank" rel="noopener" href="https://192.168.1.1”按下回车键,显示ar/">https://192.168.1.1”按下回车键，显示AR</a> Web管理平台登录界面。</li>
</ul>
<p><img src="/2021/04/27/VRP/WEB.png" alt="WEB"></p>
<h3 id="VRP用户界面"><a href="#VRP用户界面" class="headerlink" title="VRP用户界面"></a>VRP用户界面</h3><p>系统通过用户界面用来管理、监控设备和用户间的当前会话。</p>
<h4 id="Console用户界面"><a href="#Console用户界面" class="headerlink" title="Console用户界面"></a>Console用户界面</h4><p>Console用户界面用来管理和监控通过Console口登录的用户。<br>用户终端的串行口可以与设备Console口直接连接，实现对设备的本地访问。</p>
<h4 id="VTY-用户界面"><a href="#VTY-用户界面" class="headerlink" title="VTY 用户界面"></a>VTY 用户界面</h4><p>VTY用户界面用来管理和监控通过VTY方式登录的用户。<br>用户通过终端与设备建立Telnet或STelnet连接后，即建立了一条VTY通道，通过VTY通道实现对设备的远程访问。</p>
<h3 id="VRP用户级别"><a href="#VRP用户级别" class="headerlink" title="VRP用户级别"></a>VRP用户级别</h3><p>VRP可以实现不同级别的用户能够执行不同级别的命令，限制不同用户对设备的操作。</p>
<table>
<thead>
<tr>
<th>用户等级</th>
<th>命令等级</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>参观级</td>
<td>可使用网络诊断工具命令( ping、tracert ) 、从本设备出发访问外部设备的命令( Telnet客户端命令)、部分display命令等。</td>
</tr>
<tr>
<td>1</td>
<td>0 and 1</td>
<td>监控级</td>
<td>用于系统维护，可使用display等命令。</td>
</tr>
<tr>
<td>2</td>
<td>0,1 and 2</td>
<td>配置级</td>
<td>可使用业务配置命令，包括路由、各个网络层次的命令，向用户提供直接网络服务。</td>
</tr>
<tr>
<td>3-15</td>
<td>0,1,2 and 3</td>
<td>管理级</td>
<td>可使用用于系统基本运行的命令，对业务提供支撑作用，包括文件系统、FTP、TFTP下载、命令级别设置命令以及用于业务故障诊断的debugging命令等。</td>
</tr>
</tbody></table>
<h2 id="命令行基础"><a href="#命令行基础" class="headerlink" title="命令行基础"></a>命令行基础</h2><h3 id="基础命名结构"><a href="#基础命名结构" class="headerlink" title="基础命名结构"></a>基础命名结构</h3><p><img src="/2021/04/27/VRP/%E5%91%BD%E4%BB%A4%E7%BB%93%E6%9E%84.png" alt="命令结构"></p>
<h3 id="命令行视图"><a href="#命令行视图" class="headerlink" title="命令行视图"></a>命令行视图</h3><p>设备提供了多样的配置和查询命令，为便于用户使用这些命令，VRP系统按功能分类将命令分别注册在不同的命令行视图下。</p>
<p><img src="/2021/04/27/VRP/%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%86%E5%9B%BE.png" alt="命令行视图"></p>
<p><img src="/2021/04/27/VRP/%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%A7%86%E5%9B%BE2.png" alt="命令行视图"></p>
<h3 id="编辑命名行"><a href="#编辑命名行" class="headerlink" title="编辑命名行"></a>编辑命名行</h3><p>设备的命令行界面提供基本的命令行编辑功能，以下为常用的编辑功能:</p>
<ol>
<li>功能键</li>
</ol>
<ul>
<li>退格键Backspace</li>
<li>左光标键←或&lt;Ctrl+B&gt;</li>
<li>右光标键→或&lt;Ctrl+F&gt;</li>
</ul>
<ol start="2">
<li>不完整关键字输入</li>
</ol>
<p><img src="/2021/04/27/VRP/%E4%B8%8D%E5%AE%8C%E6%95%B4%E5%85%B3%E9%94%AE%E5%AD%97%E8%BE%93%E5%85%A5.png" alt="不完整关键字输入"></p>
<ol start="3">
<li>Tab键的使用:</li>
</ol>
<ul>
<li>如果与之匹配的关键字唯一，按下<Tab>键，系统自动补全关键字，补全后，反复按<Tab>关键字不变。</Tab></Tab></li>
</ul>
<p><img src="/2021/04/27/VRP/Tab%E9%94%AE%E7%9A%84%E4%BD%BF%E7%94%A81.png" alt="Tab键的使用"></p>
<ul>
<li>如果与之匹配的关键字不唯一，反复按<Tab>键可循环显示所有以输入字符串开头的关键字。</Tab></li>
</ul>
<p><img src="/2021/04/27/VRP/Tab%E9%94%AE%E7%9A%84%E4%BD%BF%E7%94%A82.png" alt="Tab键的使用"></p>
<ul>
<li>如果没有与之匹配的关键字，按Tab键后，关键字不变。</li>
</ul>
<p><img src="/2021/04/27/VRP/Tab%E9%94%AE%E7%9A%84%E4%BD%BF%E7%94%A83.png" alt="Tab键的使用"></p>
<h3 id="使用命令行在线帮助"><a href="#使用命令行在线帮助" class="headerlink" title="使用命令行在线帮助"></a>使用命令行在线帮助</h3><h4 id="完全帮助"><a href="#完全帮助" class="headerlink" title="完全帮助"></a>完全帮助</h4><p>当用户输入命令时，可以使用命令行的完全帮助获取全部关键字和参数的提示。</p>
<p><img src="/2021/04/27/VRP/%E5%B8%AE%E5%8A%A91.png" alt="帮助"></p>
<h4 id="部分帮助"><a href="#部分帮助" class="headerlink" title="部分帮助"></a>部分帮助</h4><p>当用户输入命令时，如果只记得此命令关键字的开头一个或几个字符，可以使用命令行的部分帮助获取以该字符串开头的所有关键字的提示。</p>
<p><img src="/2021/04/27/VRP/%E5%B8%AE%E5%8A%A92.png" alt="帮助"></p>
<h4 id="解读命令行的错误信息"><a href="#解读命令行的错误信息" class="headerlink" title="解读命令行的错误信息"></a>解读命令行的错误信息</h4><p>用户键入的命令，如果通过语法检查，则正确执行，否则系统将会向用户报告错误信息。</p>
<p><img src="/2021/04/27/VRP/%E9%94%99%E8%AF%AF.png" alt="错误"></p>
<h3 id="使用undo命令行"><a href="#使用undo命令行" class="headerlink" title="使用undo命令行"></a>使用undo命令行</h3><p>在命令前加undo关键字，即为undo命令行。undo命令行一般用来恢复缺省情况、禁用某个功能或者删除某项配置。以下为参考案例:</p>
<ul>
<li>使用undo命令行恢复缺省情况</li>
</ul>
<p><img src="/2021/04/27/VRP/UNDO1.png" alt="UNDO"></p>
<ul>
<li>使用undo命令禁用某个功能</li>
</ul>
<p><img src="/2021/04/27/VRP/UNDO2.png" alt="UNDO"></p>
<ul>
<li>使用undo命令删除某项设置</li>
</ul>
<p><img src="/2021/04/27/VRP/UNDO3.png" alt="UNDO"></p>
<h3 id="使用命令行的快捷键"><a href="#使用命令行的快捷键" class="headerlink" title="使用命令行的快捷键"></a>使用命令行的快捷键</h3><p>用户可以使用设备中的快捷键，完成对命令的快速输入，从而简化操作。</p>
<p>系统中的快捷键分类：自定义快捷键和系统快捷键。</p>
<h4 id="自定义快捷键"><a href="#自定义快捷键" class="headerlink" title="自定义快捷键"></a>自定义快捷键</h4><ul>
<li>自定义快捷键∶共有4个，&lt;Ctrl+G&gt;、&lt;Ctrl+L&gt;、&lt;Ctrl+O&gt;和&lt;Ctrl+U&gt;。</li>
<li>用户可以根据自己的需要将这4个快捷键与任意命令进行关联，当使用快捷键时，系统自动执行它所对应的命令。</li>
</ul>
<p><img src="/2021/04/27/VRP/%E8%87%AA%E5%AE%9A%E4%B9%89.png" alt="自定义"></p>
<h4 id="系统快捷键"><a href="#系统快捷键" class="headerlink" title="系统快捷键"></a>系统快捷键</h4><ul>
<li>CTRL_A:将光标移动到当前行的开头</li>
<li>CTRL_B:将光标向左移动一个字符</li>
<li>CTRL_C:停止当前命令的运行</li>
<li>CTRL_E:将光标移动到当前行的末尾</li>
<li>CTRL_X:删除光标左侧所有的字符</li>
<li>CTRL_Y:删除光标所在位置及其右侧所有的字符</li>
<li>CTRL_Z:返回到用户视图</li>
<li>CTRL+]∶终止当前连接或切换连接</li>
</ul>
<h2 id="常见文件系统配置命令"><a href="#常见文件系统配置命令" class="headerlink" title="常见文件系统配置命令"></a>常见文件系统配置命令</h2><p>1.查看当前目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;pwd</span><br></pre></td></tr></table></figure>

<p>2.显示当前目录下的文件信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;dir</span><br></pre></td></tr></table></figure>

<p>3.查看文本文件的具体内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;more</span><br></pre></td></tr></table></figure>
<p>4.修改用户当前界面的工作目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;cd</span><br></pre></td></tr></table></figure>
<p>5.创建新的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;mkdir</span><br></pre></td></tr></table></figure>
<p>6.删除目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;rmdir</span><br></pre></td></tr></table></figure>
<p>7.复制文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;copy</span><br></pre></td></tr></table></figure>
<p>8.移动文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;move</span><br></pre></td></tr></table></figure>
<p>9.重命名文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;rename</span><br></pre></td></tr></table></figure>
<p>10.删除文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;delete</span><br></pre></td></tr></table></figure>
<p>11.恢复删除的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;undelete</span><br></pre></td></tr></table></figure>
<p>12.彻底删除回收站中的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;reset recycle-bin</span><br></pre></td></tr></table></figure>
<h2 id="基本配置命令"><a href="#基本配置命令" class="headerlink" title="基本配置命令"></a>基本配置命令</h2><p>1 .配置设备名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] sysname name</span><br></pre></td></tr></table></figure>

<p>⒉设置系统时钟</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; clock timezone time-zone-name &#123; add | minus &#125; offset</span><br></pre></td></tr></table></figure>
<p>用来对本地时区信息进行设置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; clock datetime [ utc ] HH.:MM:Ss YYYY-MM-DD</span><br></pre></td></tr></table></figure>
<p>用来设置设备当前或UTC日期和时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; clock daylight-saving-time</span><br></pre></td></tr></table></figure>
<p>用来设置设备的夏令时。</p>
<p>3.配置命令等级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] command-privilege level level view view-name command-key</span><br></pre></td></tr></table></figure>
<p>用来设置指定视图内的命令的级别。命令级别分为参观、监控、配置、管理4个级别，分别对应标识0、1、2、3。</p>
<p>4.配置用户通过Password方式登录设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]user-interface vty 0 4</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-ui-vty0-4]set authentication password cipher information</span><br></pre></td></tr></table></figure>
<p>用来进入指定的用户视图并配置用户认证方式为password。系统支持的用户界面包括Console用户界面和VTY用户界面，Console界面用于本地登录，VTY界面用于远程登录。默认情况下，设备一般最多支持15个用户同时通过VTY方式访问。</p>
<p>5.配置用户界面参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] idle-timeout minutes [ seconds ]</span><br></pre></td></tr></table></figure>
<p>用来设置用户界面断开连接的超时时间。如果用户在一段时间内没有输入命令，系统将断开连接。缺省情况下，超时时间是10分钟。</p>
<p>6.配置接口IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]interface interface-number</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-interface-number]ip address ip address</span><br></pre></td></tr></table></figure>
<p>用来给设备上的物理或逻辑接口配置IP地址。</p>
<p>7.查看当前运行的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;display current-configuration</span><br></pre></td></tr></table></figure>
<p>8.配置文件保存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;save</span><br></pre></td></tr></table></figure>
<p>9.查看保存的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;display saved-configuration</span><br></pre></td></tr></table></figure>
<p>10.清除已保存的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;reset saved-configuration</span><br></pre></td></tr></table></figure>
<p>11.查看系统启动配置参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt; display startup</span><br></pre></td></tr></table></figure>
<p>用来查看设备本次及下次启动相关的系统软件、备份系统软件、配置文件、License文件、补丁文件以及语音文件。</p>
<p>12.配置系统下次启动时使用的配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;startup saved-configuration configuration-file</span><br></pre></td></tr></table></figure>
<p>设备升级时，可以通过此命令让设备下次启动时加载指定的配置文件</p>
<p>13.配置设备重启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Huawei&gt;reboot</span><br></pre></td></tr></table></figure>

<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p><img src="/2021/04/27/VRP/VRP8.png" alt="VRP8"></p>
<p>VRP5操作系统只有运行配置库和启动配置库，配置命令后直接生效无需提交，而VRP8操作系统配置命令后需要提交才能生效。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/26/IPv6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/26/IPv6/" itemprop="url">IPv6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-26T15:06:24+08:00">
                2021-04-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="产生背景"><a href="#产生背景" class="headerlink" title="产生背景"></a>产生背景</h2><h3 id="IPv4现状"><a href="#IPv4现状" class="headerlink" title="IPv4现状"></a>IPv4现状</h3><p>2011年2月3日，IANA ( Internet Assigned Numbers Authority，因特网地址分配组织）宣布将其最后的468万个IPv4地址平均分配到全球5个RIR ( Regional Internet Registry，区域互联网注册管理机构），此后IANA再没有可分配的IPv4地址。<br><img src="/2021/04/26/IPv6/IPv4%E7%8E%B0%E7%8A%B6.png" alt="IPv4现状"></p>
<h3 id="IPv6优势"><a href="#IPv6优势" class="headerlink" title="IPv6优势"></a>IPv6优势</h3><table>
<thead>
<tr>
<th>优势</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td>“无限”地址空间</td>
<td align="left">地址长度为128 bit，海量的地址空间，满足物联网等新兴业务、有利于业务演进及扩展。</td>
</tr>
<tr>
<td>层次化的地址结构</td>
<td align="left">相较于IPv4地址，IPv6地址的分配更加规范，利于路由聚合（缩减IPv6路由表规模)、路由快速查询。</td>
</tr>
<tr>
<td>即插即用</td>
<td align="left">IPv6支持无状态地址自动配置( SLAAC)，终端接入更简单。</td>
</tr>
<tr>
<td>简化的报文头部</td>
<td align="left">简化报文头，提高效率;通过扩展包头支持新应用，利于路由器等网络设备的转发处理，降低投资成本。</td>
</tr>
<tr>
<td>安全特性</td>
<td align="left">lPsec、真实源地址认证等保证端到端安全;避免NAT破坏端到端通信的完整性。</td>
</tr>
<tr>
<td>移动性</td>
<td align="left">对移动网络实时通信有较大改进，整个移动网络性能有比较大的提升。</td>
</tr>
<tr>
<td>增强的QoS特性</td>
<td align="left">额外定义了流标签字段，可为应用程序或者终端所用，针对特殊的服务和数据流，分配特定的资源。</td>
</tr>
</tbody></table>
<h2 id="IPv6包头格式"><a href="#IPv6包头格式" class="headerlink" title="IPv6包头格式"></a>IPv6包头格式</h2><h3 id="基本包头"><a href="#基本包头" class="headerlink" title="基本包头"></a>基本包头</h3><ul>
<li>IPv6包头由一个IPv6基本包头（必须存在)和多个扩展包头(可能不存在)组成。</li>
<li>基本包头提供报文转发的基本信息，会被转发路径上的所有设备解析。</li>
</ul>
<p><img src="/2021/04/26/IPv6/IPv6%E5%9F%BA%E6%9C%AC%E5%8C%85%E5%A4%B4.png" alt="基本包头"></p>
<h3 id="扩展包头"><a href="#扩展包头" class="headerlink" title="扩展包头"></a>扩展包头</h3><ul>
<li><p>Extension Header Length:扩展包头长度，长度为8 bit。表示扩展包头的长度（不包含Next Header字段)。</p>
</li>
<li><p>Extension Header Data:扩展包头数据，长度可变。扩展包头的内容，为一系列选项字段和填充字段的组合。</p>
</li>
</ul>
<p><img src="/2021/04/26/IPv6/IPv6%E6%89%A9%E5%B1%95%E5%8C%85%E5%A4%B4.png" alt="扩展包头"></p>
<h3 id="报文处理机制"><a href="#报文处理机制" class="headerlink" title="报文处理机制"></a>报文处理机制</h3><p><img src="/2021/04/26/IPv6/IPv6%E6%8A%A5%E6%96%87%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6.png" alt="IPv6报文处理机制"></p>
<h2 id="IPv6地址"><a href="#IPv6地址" class="headerlink" title="IPv6地址"></a>IPv6地址</h2><h3 id="IPv6地址结构"><a href="#IPv6地址结构" class="headerlink" title="IPv6地址结构"></a>IPv6地址结构</h3><ul>
<li><p>IPv6地址的长度为128 bit。一般用冒号分割为8段，每一段16 bit，每一段内用十六进制表示。</p>
</li>
<li><p>与IPv4地址类似，IPv6也用“IPv6地址/掩码长度”的方式来表示IPv6地址。</p>
<p>例如2001:0DB8:2345:CD30:1230:4567:89AB:CDEF/64<br><strong>IPv6地址</strong>: 2001:0DB8:2345:CD30:1230:4567:89AB:CDEF<br><strong>子网号</strong>: 2001:ODB8:2345:CD30::/64</p>
</li>
</ul>
<h3 id="IPv6地址缩写规范"><a href="#IPv6地址缩写规范" class="headerlink" title="IPv6地址缩写规范"></a>IPv6地址缩写规范</h3><ol>
<li>每组16 bit的单元中的前导0可以省略，但是如果16 bit单元的所有比特都为0，那么至少要保留一个“0”字符;拖尾的O不能被省略。</li>
<li>一个或多个连续的16 bit字符为0时，可用“:”表示，但整个IPv6地址缩写中只允许有一个“::”。</li>
</ol>
<blockquote>
<p>若缩写后的IPv6地址出现两个“::”，会导致无法还原为原始IPv6地址。</p>
</blockquote>
<p><img src="/2021/04/26/IPv6/IPv6%E7%BC%A9%E5%86%99%E7%A4%BA%E4%BE%8B.png" alt="IPv6缩写示例"></p>
<h3 id="IPv6地址分类"><a href="#IPv6地址分类" class="headerlink" title="IPv6地址分类"></a>IPv6地址分类</h3><p>根据IPv6地址前缀，可将IPv6地址分为为单播地址、组播地址和任播地址。</p>
<p>单播地址又分为全球单播地址（2000::/3）、唯—本地地址(FD00::/8)、链路本地地址(FE80::/10)、特殊地址、其他单播地址。</p>
<h3 id="IPv6单播地址"><a href="#IPv6单播地址" class="headerlink" title="IPv6单播地址"></a>IPv6单播地址</h3><h4 id="IPv6单播地址结构"><a href="#IPv6单播地址结构" class="headerlink" title="IPv6单播地址结构"></a>IPv6单播地址结构</h4><ul>
<li><p>一个IPv6单播地址可以分为如下两部分:</p>
<p>1.网络前缀(Network Prefix ) : n bit，相当于IPv4地址中的网络ID。</p>
<p>2.接口标识( Interface identify ) : ( 128-n ) bit ，相当于IPv4地址中的主机ID。</p>
</li>
<li><p>常见的IPv6单播地址如全球单播地址、链路本地地址等，要求网络前缀和接口标识必须为64 bit。</p>
</li>
</ul>
<h4 id="IPv6单播地址接口标识"><a href="#IPv6单播地址接口标识" class="headerlink" title="IPv6单播地址接口标识"></a>IPv6单播地址接口标识</h4><p>接口标识可通过三种方法生成：手工配置、系统自动生成或通过IEEE EUI-64规范生成</p>
<p>其中EUl-64规范最为常用，此规范将MAC地址从中间劈开插入FFFE且第7bit取反得到IPv6接口标识。</p>
<p><img src="/2021/04/26/IPv6/EUI-64%E8%A7%84%E8%8C%83.png" alt="EUI-64规范"></p>
<h4 id="IPv6单播地址-GUA"><a href="#IPv6单播地址-GUA" class="headerlink" title="IPv6单播地址-GUA"></a>IPv6单播地址-GUA</h4><p>GUA ( Global Unicast Address，全球单播地址)，也被称为可聚合全球单播地址。该类地址全球唯一，用于需要有互联网访问需求的主机，相当于IPv4的公网地址。</p>
<p><img src="/2021/04/26/IPv6/GUI.png" alt="GUI"></p>
<ul>
<li>通常GUA的网络部分长度为64 bit，接口标识也为64 bit。</li>
<li>全局路由前缀:由提供商指定给一个组织机构，一般至少为45 bit。</li>
<li>子网ID:组织机构根据自身网络需求划分子网。·接口标识:用来标识一个设备（的接口)。</li>
</ul>
<h4 id="IPv6常见单播地址-ULA"><a href="#IPv6常见单播地址-ULA" class="headerlink" title="IPv6常见单播地址-ULA"></a>IPv6常见单播地址-ULA</h4><p>ULA ( Unique Local Address，唯一本地地址）是IPv6私网地址，只能够在内网中使用。该地址空间在IPv6公网中不可被路由，因此不能直接访问公网。</p>
<p><img src="/2021/04/26/IPv6/ULA.png" alt="ULA"></p>
<ul>
<li>唯一本地地址使用FCOO::/7地址块，目前仅使用了FDO0:/8地址段。FCOO::/8预留为以后拓展用。 </li>
<li>ULA虽然只在有限范围内有效，但也具有全球唯一的前缀（虽然随机方式产生，但是冲突概率很低）。</li>
</ul>
<h4 id="lPv6常见单播地址-LLA"><a href="#lPv6常见单播地址-LLA" class="headerlink" title="lPv6常见单播地址-LLA"></a>lPv6常见单播地址-LLA</h4><p>LLA ( Link-Local Address，链路本地地址）是IPv6中另一种应用范围受限制的地址类型。LLA的有效范围是本地链路，前缀为FE80::/10。</p>
<p><img src="/2021/04/26/IPv6/LLA.png" alt="LLA"></p>
<ul>
<li>LLA用于一条单一链路层面的通信，例如IPv6地址无状态自动配置、IPv6邻居发现等。</li>
<li>源或目的IPv6地址为链路本地地址的数据包将不会被转发到始发的链路之外，换句话说，链路本地地址的有效范围为本地链路。</li>
<li>每一个IPv6接口都必须具备一个链路本地地址。华为设备支持自动生成和手工指定两种配置方式。</li>
</ul>
<h3 id="IPv6组播地址"><a href="#IPv6组播地址" class="headerlink" title="IPv6组播地址"></a>IPv6组播地址</h3><ul>
<li><p>IPv6组播地址标识多个接口，一般用于“一对多”的通信场景。</p>
</li>
<li><p>IPv6组播地址只可以作为IPv6报文的目的地址。</p>
</li>
</ul>
<p><img src="/2021/04/26/IPv6/IPv6%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80.png" alt="IPv6组播地址"></p>
<pre><code>Flags:用来表示永久或临时组播组。
Scope:表示组播组的范围。
Group ID:组播组ID。
</code></pre>
<p><img src="/2021/04/26/IPv6/%E7%BB%84%E6%92%AD.png" alt="组播"></p>
<h4 id="被请求节点组播地址"><a href="#被请求节点组播地址" class="headerlink" title="被请求节点组播地址"></a>被请求节点组播地址</h4><p>当一个节点具有了单播或任播地址，就会对应生成一个被请求节点组播地址，并且加入这个组播组。该地址主要用于邻居发现机制和地址重复检测功能。被请求节点组播地址的有效范围为本地链路范围。</p>
<p><img src="/2021/04/26/IPv6/%E8%A2%AB%E8%AF%B7%E6%B1%82%E8%8A%82%E7%82%B9%E7%9A%84%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80.png" alt="被请求节点的组播地址"></p>
<h3 id="任播地址"><a href="#任播地址" class="headerlink" title="任播地址"></a>任播地址</h3><ul>
<li>任播地址标识一组网络接口（通常属于不同的节点)。</li>
<li>任播地址可以作为IPv6报文的源地址，也可以作为目的地址。</li>
</ul>
<p><img src="/2021/04/26/IPv6/%E4%BB%BB%E6%92%AD.png" alt="任播"></p>
<h2 id="IPv6地址配置"><a href="#IPv6地址配置" class="headerlink" title="IPv6地址配置"></a>IPv6地址配置</h2><h3 id="主机和路由器的IPv6地址"><a href="#主机和路由器的IPv6地址" class="headerlink" title="主机和路由器的IPv6地址"></a>主机和路由器的IPv6地址</h3><p>一般情况下，主机和路由器的单播IPv6地址以及加入的组播地址如下所示:</p>
<p><img src="/2021/04/26/IPv6/%E5%9C%B0%E5%9D%80%E7%A4%BA%E4%BE%8B.png"></p>
<h3 id="lPv6单播地址业务流程"><a href="#lPv6单播地址业务流程" class="headerlink" title="lPv6单播地址业务流程"></a>lPv6单播地址业务流程</h3><p>一个接口在发送IPv6报文之前要经历地址配置、DAD、地址解析这三个阶段，NDP ( Neighbor Discovery Protocol，邻居发现协议)扮演了重要角色。</p>
<p><img src="/2021/04/26/IPv6/%E6%B5%81%E7%A8%8B.png" alt="流程"></p>
<h3 id="NDP"><a href="#NDP" class="headerlink" title="NDP"></a>NDP</h3><ul>
<li>RFC2461定义了NDP，该RFC后来被RFC4861替代。</li>
<li>NDP使用ICMPv6报文实现其功能。</li>
</ul>
<p><img src="/2021/04/26/IPv6/NDP.png" alt="NDP"></p>
<h3 id="IPv6动态配置地址"><a href="#IPv6动态配置地址" class="headerlink" title="IPv6动态配置地址"></a>IPv6动态配置地址</h3><h4 id="有状态地址配置"><a href="#有状态地址配置" class="headerlink" title="有状态地址配置"></a>有状态地址配置</h4><p><img src="/2021/04/26/IPv6/%E6%9C%89%E7%8A%B6%E6%80%81%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE.png" alt="有状态地址配置"></p>
<ul>
<li>通过DHCPv6报文交互，DHCPv6服务器端自动配置IPv6地址/前缀及其他网络配置参数(DNS、NIS.SNTP服务器地址等参数)。</li>
</ul>
<h4 id="无状态地址配置"><a href="#无状态地址配置" class="headerlink" title="无状态地址配置"></a>无状态地址配置</h4><p><img src="/2021/04/26/IPv6/%E6%97%A0%E7%8A%B6%E6%80%81%E5%9C%B0%E5%9D%80%E9%85%8D%E7%BD%AE.png" alt="无状态地址配置"></p>
<ul>
<li>主机根据RA中的地址前缀，并结合本地生成的64 bit接口标识（例如EUI-64 )，生成单播地址。</li>
<li>仅可以获得IPv6地址信息，无法获得NIS、SNTP服务器等参数，需要配合DHCPv6或者手工配置来获取其他配置信息。</li>
</ul>
<h3 id="DAD"><a href="#DAD" class="headerlink" title="DAD"></a>DAD</h3><p>DAD ( Duplicate Address Detection，重复地址检测）类似于IPv4中的免费ARP检测,用于检测当前地址是否与其他接口冲突。</p>
<p>无论通过何种方式配置了IPv6单播地址，主机或路由器都会:</p>
<ul>
<li>通过ICMPv6报文进行DAD</li>
<li>仅当DAD通过之后才会使用该单播地址</li>
</ul>
<p><img src="/2021/04/26/IPv6/DAD.png" alt="DAD"></p>
<h3 id="地址解析"><a href="#地址解析" class="headerlink" title="地址解析"></a>地址解析</h3><p>lPv6使用ICMPv6的NS和NA报文来取代ARP在IPv4中的地址解析功能。</p>
<p><img src="/2021/04/26/IPv6/%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90.png" alt="地址解析"></p>
<h2 id="IPv6地址配置基础命令"><a href="#IPv6地址配置基础命令" class="headerlink" title="IPv6地址配置基础命令"></a>IPv6地址配置基础命令</h2><p>1.使能lPv6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] ipv6</span><br></pre></td></tr></table></figure>
<p>使能设备转发IPv6单播报文，包括本地IPv6报文的发送与接收。[Huawei-GigabitEtherneto/o/0] ipv6 enable<br>在接口视图下，在接口上使能该接口的IPv6功能。</p>
<p>2.配置接口的链路本地地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] ipv6 address ipv6-address link-local</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] ipv6 address auto link-local</span><br></pre></td></tr></table></figure>
<p>在接口视图下，通过手工或者自动的方式，配置接口的链路本地地址。</p>
<p>3.配置接口的全球单播地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] ipv6 address &#123; ipv6-address prefix-length l ipv6-address&#x2F; prefix-length &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0] ipv6 address auto &#123; global | dhcp &#125;</span><br></pre></td></tr></table></figure>

<p>在接口视图下，通过手工或者自动（有状态或无状态）的方式，配置接口的全球单播地址。<br>4.配置lPv6静态路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] ipv6 route-static dest-ipv6-address prefix-length &#123; interface-type interface-number [ nexthop-ipv6-address ] | nexthop-ipv6-address &#125; [ preference preference j</span><br></pre></td></tr></table></figure>
<p>5.查看接口的IPv6信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] display ipv6 interface [ interface-type interface-number | brief ]</span><br></pre></td></tr></table></figure>
<p>6.查看邻居表项信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] display ipv6 neighbors</span><br></pre></td></tr></table></figure>
<p>7.使能系统发布RA报文功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;0]undo ipv6 nd ra halt</span><br></pre></td></tr></table></figure>
<p>默认情况下，华为路由器接口不发送ICMPv6 RA报文，则该接口所连链路上的其他设备无法进行无状态地址自动配置。若想进行IPv6无状态地址配置，需要手工开启发送RA报文。</p>
<h2 id="IPv6配置案例-配置一个小型IPv6网络"><a href="#IPv6配置案例-配置一个小型IPv6网络" class="headerlink" title="IPv6配置案例-配置一个小型IPv6网络"></a>IPv6配置案例-配置一个小型IPv6网络</h2><p><img src="/2021/04/26/IPv6/IPv6%E6%8B%93%E6%89%91.png" alt="IPv6拓扑"></p>
<h3 id="R1和R2之间使用静态IPv6地址互联。"><a href="#R1和R2之间使用静态IPv6地址互联。" class="headerlink" title="R1和R2之间使用静态IPv6地址互联。"></a>R1和R2之间使用静态IPv6地址互联。</h3><p>1.在R1、R2、R3、R4全局和相关接口使能IPv6功能，同时自动生成链路本地地址（以R1配置为例)</p>
<p>[R1]ipv6<br>[R1]interface GigabitEthernet 0/0/0</p>
<p>[R1-GigabitEthernet0/0/0]ipv6 enable</p>
<p>[R1-GigabitEthernet0/0/0]ipv6 address auto link-local</p>
<p>2.在R1、R2相应接口配置静态IPv6全球单播地址</p>
<p>[R1]interface GigabitEthernet 0/0/0</p>
<p>[R1-GigabitEthernet0/0/0]ipv6 address 2001::1 64    </p>
<p>[R2]interface GigabitEthernet 1/0/0</p>
<p>[R2-GigabitEthernet1/0/0]ipv6 address 2001:2 64</p>
<p>[R2-GigabitEthernet1/0/0]interface GigabitEthernet 0/0/0</p>
<p>[R2-GigabitEtherneto/0/0]ipv6 address 2002::1 64</p>
<p>[R2-GigabitEtherneto/0/0]interface GigabitEthernet 0/0/1</p>
<p>[R2-GigabitEtherneto/0/1]ipv6 address 2003:1 64</p>
<h3 id="R2作为DHCPv6服务器给R3的GE0-0-0分配全球单播地址。"><a href="#R2作为DHCPv6服务器给R3的GE0-0-0分配全球单播地址。" class="headerlink" title="R2作为DHCPv6服务器给R3的GE0/0/0分配全球单播地址。"></a>R2作为DHCPv6服务器给R3的GE0/0/0分配全球单播地址。</h3><p>3.在R2上配置DHCPv6服务器功能，R3接口通过DHCPv6方式获取全球单播地址</p>
<p>[R2]dhcp enable[R2]dhcpv6 pool pool1</p>
<p>[R2-dhcpv6-pool-pool1]address prefix 2002::/64    </p>
<p>[R2]interface GigabitEthernet 0/0/0</p>
<p>[R2-GigabitEtherneto/0/0]dhcpv6 server pool1</p>
<p>[R3]dhcp enable</p>
<p>[R3]interface GigabitEthernet 0/0/0</p>
<p>[R3-GigabitEthernetO/0/0]ipv6 address auto dhcp</p>
<h3 id="R4的GE0-0-0接口通过R2的RA进行无状态地址自动配置。"><a href="#R4的GE0-0-0接口通过R2的RA进行无状态地址自动配置。" class="headerlink" title="R4的GE0/0/0接口通过R2的RA进行无状态地址自动配置。"></a>R4的GE0/0/0接口通过R2的RA进行无状态地址自动配置。</h3><p>4.在R2使能发布RA报文的功能，R4通过无状态地址配置的方式获取地址</p>
<p>[R2]interface GigabitEthernet 0/0/1</p>
<p>[R2-GigabitEthernet0/0/1]undo ipv6 nd ra halt</p>
<p>[R4]interface GigabitEthernet 0/0/0</p>
<p>[R4-GigabitEtherneto/0/0]ipv6 address auto global</p>
<h3 id="配置静态路由-实现各设备之间互访。"><a href="#配置静态路由-实现各设备之间互访。" class="headerlink" title="配置静态路由,实现各设备之间互访。"></a>配置静态路由,实现各设备之间互访。</h3><p>5.在R4上配置静态路由</p>
<p>[R4]ipv6 route-static 2001:: 64 2003::1   </p>
<p>[R4]ipv6 route-static 2002:: 64 2003::1</p>
<p>6.在R1上配置聚合后的静态路由</p>
<p>[R1]ipv6 route-static 2002:: 15 2001::2</p>
<p>7.在R3上配置默认路由</p>
<p>[R3]ipv6 route-static :: 0 2002::1</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/" itemprop="url">以太网链路聚合与交换机堆叠、集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-25T19:02:07+08:00">
                2021-04-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络可靠性的需求"><a href="#网络可靠性的需求" class="headerlink" title="网络可靠性的需求"></a>网络可靠性的需求</h2><p>网络的可靠性指当设备或者链路出现单点或者多点故障时保证网络服务不间断的能力。</p>
<p>网络的可靠性可以从单板、设备、链路多个层面实现。</p>
<h3 id="单板可靠性"><a href="#单板可靠性" class="headerlink" title="单板可靠性"></a>单板可靠性</h3><ul>
<li>框式交换机由机框、电源模块、风扇模块、主控板(MPU)、交换网板( SFU)、线路板(LPU)构成。</li>
<li>以S1270OE-8为例，设备提供8个线路板槽位、4个交换网板槽位、2个主控板槽位、6个电源模块槽位、4个风扇模块槽位。</li>
<li>框式交换机配置多个主控板、交换网板可保证设备自身的可靠性，单个槽位的交换网板、主控板损坏不影响设备的正常运行。</li>
<li>框式交换机的线路板损坏后，该板卡上的接口无法正常转发数据。</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%8D%95%E6%9D%BF%E5%8F%AF%E9%9D%A0%E6%80%A7.png" alt="单板可靠性"></p>
<h3 id="设备可靠性"><a href="#设备可靠性" class="headerlink" title="设备可靠性"></a>设备可靠性</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E8%AE%BE%E5%A4%87%E5%8F%AF%E9%9D%A0%E6%80%A7.png" alt="设备可靠性"></p>
<h3 id="链路可靠性"><a href="#链路可靠性" class="headerlink" title="链路可靠性"></a>链路可靠性</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E9%93%BE%E8%B7%AF%E5%8F%AF%E9%9D%A0%E6%80%A7.png" alt="链路可靠性"></p>
<h2 id="链路聚合技术"><a href="#链路聚合技术" class="headerlink" title="链路聚合技术"></a>链路聚合技术</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul>
<li><p>设备之间存在多条链路时，由于STP的存在，实际只会有一条链路转发流量，设备间链路带宽无法得到提升。</p>
</li>
<li><p>以太网链路聚合Eth-Trunk:简称链路聚合，通过将多个物理接口捆绑成为一个逻辑接口，可以在不进行硬件升级的条件下，达到增加链路带宽的目的。</p>
</li>
<li><p>链路聚合模式分为手工模式和LACP模式。</p>
</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/Eth-Trunk.png" alt="Eth-Trunk"></p>
<h3 id="链路聚合基本术语"><a href="#链路聚合基本术语" class="headerlink" title="链路聚合基本术语"></a>链路聚合基本术语</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%9F%BA%E6%9C%AC%E6%9C%AF%E8%AF%AD.png" alt="基本术语"></p>
<h3 id="链路聚合手工模式"><a href="#链路聚合手工模式" class="headerlink" title="链路聚合手工模式"></a>链路聚合手工模式</h3><h4 id="手工模式概述"><a href="#手工模式概述" class="headerlink" title="手工模式概述"></a>手工模式概述</h4><ul>
<li>手工模式: Eth-Trunk的建立、成员接口的加入均由手动配置，双方系统之间不使用LACP进行协商。</li>
<li>正常情况下所有链路都是活动链路，该模式下所有活动链路都参与数据的转发，平均分担流量，如果某条活动链路故障，<br>链路聚合组自动在剩余的活动链路中平均分担流量。</li>
<li>有些低端、老旧设备不支持LACP协议。当聚合的两端设备中存在一个不支持LACP协议时，可以使用手工模式。设备两端使用的链路聚合模式必须相同。</li>
</ul>
<h4 id="手工模式缺陷"><a href="#手工模式缺陷" class="headerlink" title="手工模式缺陷"></a>手工模式缺陷</h4><ol>
<li><p>为了使链路聚合接口正常工作，必须保证本端链路聚合接口中所有成员接口的对端接口：</p>
<ul>
<li>属于同一设备</li>
<li>加入同一链路聚合接口</li>
</ul>
<p>手工模式下，设备间没有报文交互，因此只能通过管理员人工确认。</p>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E6%89%8B%E5%B7%A5%E6%A8%A1%E5%BC%8F%E7%BC%BA%E9%99%B71.png" alt="手工模式缺陷1"></p>
<blockquote>
<p>如图，若不满足条件导致数据转发错误</p>
</blockquote>
</li>
<li><p>手动模式下，因为设备间没有报文交互，因此只能通过管理员人工通过物理层状态判断对端接口是否正常工作。</p>
</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E6%89%8B%E5%B7%A5%E6%A8%A1%E5%BC%8F%E7%BC%BA%E9%99%B72.png" alt="手工模式缺陷2"></p>
<h3 id="链路聚合LACP模式"><a href="#链路聚合LACP模式" class="headerlink" title="链路聚合LACP模式"></a>链路聚合LACP模式</h3><h4 id="LACP模式概述"><a href="#LACP模式概述" class="headerlink" title="LACP模式概述"></a>LACP模式概述</h4><ul>
<li>LACP模式:采用LACP协议的一种链路聚合模式。设备间通过链路聚合控制协议数据单元( Link Aggregation ControlProtocol Data Unit，LACPDU )进行交互，通过协议协商确保对端是同一台设备、同一个聚合接口的成员接口。</li>
<li>LACPDU报文中包含设备优先级、MAC地址、接口优先级、接口号等。</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/LACPDU.png" alt="LACPDU"></p>
<h4 id="LACPDU报文字段含义"><a href="#LACPDU报文字段含义" class="headerlink" title="LACPDU报文字段含义"></a>LACPDU报文字段含义</h4><h5 id="系统优先级"><a href="#系统优先级" class="headerlink" title="系统优先级"></a>系统优先级</h5><ul>
<li><p>LACP模式下，两端设备所选择的活动接口数目必须保持一致，否则链路聚合组就无法建立。此时可以通过设备优先级使其中一端成为主动端，另一端（被动端）根据主动端选择活动接口。</p>
</li>
<li><p>系统LACP优先级默认32768，越小越优，通常保持默认。当优先级—致时LACP会通过比较MAC地址选择主动端MAC地址越小越优。</p>
</li>
</ul>
<h5 id="接口优先级"><a href="#接口优先级" class="headerlink" title="接口优先级"></a>接口优先级</h5><ul>
<li><p>选出主动端后，两端都会以主动端的接口优先级来选择活动接口，优先级高的接口将优先被选为活动接口。接口LACP优先级值越小，优先级越高。</p>
</li>
<li><p>接口LACP优先级默认为32768，越小越优，通常保持默认，当优先级一致时LACP会通过接口编号选择活动接口,越小越优。</p>
</li>
</ul>
<h3 id="最大活动接口数"><a href="#最大活动接口数" class="headerlink" title="最大活动接口数"></a>最大活动接口数</h3><ul>
<li>LACP模式支持配置最大活动接口数目，当成员接口数目超过最大活动接口数目时会通过比较接口优先级、接口号选举出较优的接口成为活动接口，其余的则成为备份端口（非活动接口)，同时对应的链路分别成为活动链路、非活动链路。交换机只会从活动接口中发送、接收报文。</li>
<li>当活动链路中出现链路故障时，可以从非活动链路中找出一条优先级最高（接口优先级、接口编号比较）的链路替换故障链路，实现总体带宽不发生变化、业务的不间断转发。</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E6%95%85%E9%9A%9C%E9%80%89%E5%8F%96%E8%A7%84%E5%88%99.png" alt="故障选取规则"></p>
<h3 id="链路聚合活动链路的选取过程"><a href="#链路聚合活动链路的选取过程" class="headerlink" title="链路聚合活动链路的选取过程"></a>链路聚合活动链路的选取过程</h3><ol>
<li>sw1、sw2配置LACP模式的链路聚合。两端都设置最大活跃接口数为2。</li>
<li>通过LACPDU选举出优先级较高的交换机SW1，作为LACP协商过程的主动端。</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E9%80%89%E5%8F%96%E8%BF%87%E7%A8%8B1.png" alt="选取过程1"></p>
<ol start="3">
<li>sW1在本端通过比较接口优先级、接口编号选举出活动接口，其中1、2号接口在相同的接口优先级下拥有更小的接口编号，成为活动接口。</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E9%80%89%E5%8F%96%E6%B5%81%E7%A8%8B2.png" alt="选取流程2"></p>
<ol start="4">
<li>SW1通过LACPDU将本端活动端口选举结果告知对端。</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E9%80%89%E5%8F%96%E6%B5%81%E7%A8%8B3.png" alt="选取流程3"></p>
<ol start="5">
<li>SW2依据SW1的选举结果，明确本端的活动接口，同时对应的链路成为活动链路。</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E9%80%89%E5%8F%96%E6%B5%81%E7%A8%8B4.png" alt="选取流程4"></p>
<ol start="6">
<li>至此，Eth-Trunk的活动链路选举过程完成。</li>
</ol>
<h3 id="负载分担"><a href="#负载分担" class="headerlink" title="负载分担"></a>负载分担</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85.png" alt="负载分担"></p>
<h4 id="负载分担模式"><a href="#负载分担模式" class="headerlink" title="负载分担模式"></a>负载分担模式</h4><ul>
<li><p>Eth-trunk支持基于报文的IP地址或MAC地址来进行负载分担，可以配置不同的模式（本地有效，对出方向报文生效)将数据流分担到不同的成员接口上。</p>
</li>
<li><p>常见的模式有:源IP、源MAC、目的IP、目的MAC、源目IP、源目MAC。</p>
</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85%E6%A8%A1%E5%BC%8F.png" alt="负载分担模式"></p>
<h3 id="链路聚合使用场景"><a href="#链路聚合使用场景" class="headerlink" title="链路聚合使用场景"></a>链路聚合使用场景</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF1.png" alt="使用场景"></p>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF2.png" alt="使用场景"></p>
<h3 id="链路聚合配置命令"><a href="#链路聚合配置命令" class="headerlink" title="链路聚合配置命令"></a>链路聚合配置命令</h3><p>1.创建链路聚合组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] interface eth-trunk trunk-id</span><br></pre></td></tr></table></figure>
<p>创建Eth-Trunk接口，并进入Eth-Trunk接口视图。</p>
<p>2.配置链路聚合模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Eth-Trunk1] mode &#123;lacp &#x2F; manual load-balance &#125;</span><br></pre></td></tr></table></figure>
<p>Mode lacp配置链路聚合模式为lacp模式，mode manual load-balance配置链路聚合模式为手工模式。注意:需要保持两端链路聚合模式一致。</p>
<p>3.将接口加入链路聚合组中（以太网接口视图)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] eth-trunk trunk-id</span><br></pre></td></tr></table></figure>
<p>在接口视图下，把接口加入到Eth-Trunk中。</p>
<p>4.将接口加入链路聚合组中（ Eth-Trunk视图)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Eth-Trunk1] trunkport interface-type &#123; interface-number&#125;</span><br></pre></td></tr></table></figure>
<p>在Eth-Trunk视图中将接口加入到链路聚合组中。3、4两种方式都可以将接口加入到链路聚合组中。</p>
<p>5．使能允许不同速率端口加入同一Eth-Trunk接口的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Eth-Trunk1] mixed-rate link enable</span><br></pre></td></tr></table></figure>
<p>缺省情况下，设备未使能允许不同速率端口加入同一Eth-Trunk接口的功能，只能相同速率的接口加入到同一个Eth-Trunk接口中。</p>
<p>6.配置系统LACP优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] lacp priority priority</span><br></pre></td></tr></table></figure>
<p>系统LACP优先级值越小优先级越高，缺省情况下，系统LACP优先级为32768。</p>
<p>7.配置接口LACP优先级</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEthernet0&#x2F;0&#x2F;1] lacp priority priority</span><br></pre></td></tr></table></figure>
<p>在接口视图下配置接口LACP优先级。缺省情况下，接口的LACP优先级是32768。接口优先级取值越小，接口的LACP优先级越高。<br>只有在接口已经加入到链路聚合中才可以配置该命令。</p>
<p>8.配置最大活动接口数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Eth-Trunk1] max active-linknumber inumber&#125;</span><br></pre></td></tr></table></figure>
<p>配置时需注意保持本端和对端的最大活动接口数一致，只有LACP模式支持配置最大活动接口数。</p>
<p>9.配置最小活动接口数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-Eth-Trunk1] least active-linknumber inumber&#125;</span><br></pre></td></tr></table></figure>
<p>本端和对端设备的活动接口数下限阈值可以不同，手动模式、LACP模式都支持配置最小活动接口数。<br>配置最小活动接口数目的是为了保证最小带宽，当前活动链路数目小于下限阈值时，Eth-Trunk接口的状态转为Down。</p>
<h3 id="链路聚合配置案例"><a href="#链路聚合配置案例" class="headerlink" title="链路聚合配置案例"></a>链路聚合配置案例</h3><ol>
<li><p>手工模式</p>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E6%89%8B%E5%B7%A5%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B.png" alt="手工模式配置案例"></p>
</li>
<li><p>LACP模式</p>
</li>
</ol>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/LACP%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B1.png" alt="LACP模式配置案例1"></p>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/LACP%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B2.png" alt="LACP模式配置案例2"></p>
<h2 id="堆叠、集群"><a href="#堆叠、集群" class="headerlink" title="堆叠、集群"></a>堆叠、集群</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ul>
<li>堆叠（iStack )︰多台支持堆叠特性的交换机通过堆叠线缆连接在一起，从逻辑上变成一台交换设备，作为一个整体参与数据转发。</li>
<li>集群(Cluster Switch System，CSS )∶将两台支持集群特性的交换机设备组合在一起，从逻辑上组合成一台交换设备。</li>
<li>集群只支持两台设备，一般框式交换机支持CSS，盒式设备支持iStack。</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4.png" alt="堆叠、集群"></p>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4%E7%9A%84%E4%BC%98%E5%8A%BF.png" alt="堆叠、集群的优势"></p>
<h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A81.png" alt="堆叠、集群的实际应用"></p>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A82.png" alt="堆叠、集群的实际应用"></p>
<ul>
<li>两台设备组成集群，虚拟成单一的逻辑设备。简化后的组网不再需要使用MSTP、VRRP等协议，简化了网络配置，同时依靠跨设备的链路聚合，实现快速收敛，提高了可靠性。</li>
</ul>
<h2 id="三种技术结合的推荐架构"><a href="#三种技术结合的推荐架构" class="headerlink" title="三种技术结合的推荐架构"></a>三种技术结合的推荐架构</h2><p>核心层</p>
<ul>
<li>核心使用CSS集群组网，上下行采用Eth-Trunk，构建高可靠、无环的网络。</li>
</ul>
<p>汇聚层</p>
<ul>
<li>汇聚交换机采用iStack，上下行采用Eth-Trunk，构建高可靠、无环的网络。</li>
</ul>
<p>接入层</p>
<ul>
<li>地理位置接近的接入设备（如一个楼宇内的接入交换机）使用iStack虚拟化成为一台逻辑上的设备，端口数量充足，简化了管理。</li>
<li>使用Eth-Trunk和汇聚层互联，逻辑上网络结构简单，不再需要使用STP、VRRP。具有高可靠性、高上行带宽、快速收敛的优势。</li>
</ul>
<p><img src="/2021/04/25/%E4%BB%A5%E5%A4%AA%E7%BD%91%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E4%B8%8E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%A0%86%E5%8F%A0%E3%80%81%E9%9B%86%E7%BE%A4/%E6%8E%A8%E8%8D%90%E6%9E%B6%E6%9E%84.png" alt="推荐架构"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/25/ACL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/25/ACL/" itemprop="url">ACL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-25T12:18:52+08:00">
                2021-04-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ACL产生背景"><a href="#ACL产生背景" class="headerlink" title="ACL产生背景"></a>ACL产生背景</h2><p>提供一个工具，实现浏览的过滤。</p>
<p><img src="/2021/04/25/ACL/ACL%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF.png" alt="ACL产生背景"></p>
<h2 id="ACL概述"><a href="#ACL概述" class="headerlink" title="ACL概述"></a>ACL概述</h2><p>访问控制列表ACL（Access Control List）是由一条或多条规则组成的集合。所谓规则，是指描述报文匹配条件的判断语句，这些条件可以是报文的源地址、目的地址、端口号等。</p>
<p> ACL本质上是一种报文过滤器，规则是过滤器的滤芯。设备基于这些规则进行报文匹配，可以过滤出特定的报文，并根据应用ACL的业务模块的处理策略来允许或阻止该报文通过。</p>
<p>ACL技术总是与防火墙、路由策略、QoS、流量过滤、NAT等其他技术结合使用。</p>
<h2 id="ACL的基本概念及其工作原理"><a href="#ACL的基本概念及其工作原理" class="headerlink" title="ACL的基本概念及其工作原理"></a>ACL的基本概念及其工作原理</h2><h3 id="ACL组成"><a href="#ACL组成" class="headerlink" title="ACL组成"></a>ACL组成</h3><p>ACL由若千条permit或deny语句组成。每条语句就是该ACL的一条规则，每条语句中的permit或deny就是与这条规则相对应的处理动作。</p>
<p><img src="/2021/04/25/ACL/ACL%E7%BB%84%E6%88%90.png" alt="ACL组成"></p>
<h3 id="规则编号"><a href="#规则编号" class="headerlink" title="规则编号"></a>规则编号</h3><ul>
<li>规则编号(Rule ID ) :<br>一个ACL中的每一条规则都有一个相应的编号。</li>
<li>步长( Step ) :<br>步长是系统自动为ACL规则分配编号时，每个相邻规则编号之间的差值，缺省值为5。步长的作用是为了方便后续在旧规则之间，插入新的规则。</li>
<li>Rule ID分配规则:<br>系统为ACL中首条未手工指定编号的规则分配编号时，使用步长值（例如步长=5，首条规则编号为5)作为该规则的起始编号;为后续规则分配编号时(若无指定规则编号)，则使用大于当前ACL内最大规则编号且是步长整数倍的最小整数作为规则编号。</li>
</ul>
<p><img src="/2021/04/25/ACL/ACL%E8%A7%84%E5%88%99%E7%BC%96%E5%8F%B7.png" alt="ACL规则编号"></p>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><ul>
<li><p>通配符（Wildcard）是一个32比特长度的数值，用于指示IP地址中，哪些比特位需要严格匹配，哪些比特位无需匹配。</p>
</li>
<li><p>匹配规则为：“0”表示“匹配”；“1”表示“随机分配”</p>
<p>特殊的通配符</p>
<ul>
<li><p>精确匹配192.168.1.1这个IP地址</p>
<p>192.168.1.1 0.0.0.0 = 192.168.1.1 0</p>
</li>
<li><p>匹配所有IP地址<br>0.0.0.0 255.255.255 = any</p>
</li>
</ul>
</li>
<li><p>通配符通常采用类似网络掩码的点分十进制形式表示，但是含义却与网络掩码完全不同。</p>
</li>
</ul>
<p><img src="/2021/04/25/ACL/ACL%E9%80%9A%E9%85%8D%E7%AC%A6.png" alt="ACL通配符"></p>
<h3 id="ACL分类与标识"><a href="#ACL分类与标识" class="headerlink" title="ACL分类与标识"></a>ACL分类与标识</h3><ul>
<li>基于ACL规则定义方式的分类</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>编号范围</th>
<th>规则定义描述</th>
</tr>
</thead>
<tbody><tr>
<td>基本ACL</td>
<td>2000~2999</td>
<td>仅使用报文的源IP地址、分片信息和生效时间段信息来定义规则。</td>
</tr>
<tr>
<td>高级ACL</td>
<td>3000~3999</td>
<td>可使用IPv4报文的源IP地址、目的IP地址、IP协议类型、ICMP类型、TCP源/目的端口号、UDP源/目的端口号、生效时间段等来定义规则。</td>
</tr>
<tr>
<td>二层ACL</td>
<td>4000~4999</td>
<td>使用报文的以太网帧头信息来定义规则，如根据源MAC地址、目的MAC地址、二层协议类型等。</td>
</tr>
<tr>
<td>用户自定义ACL</td>
<td>5000~5999</td>
<td>使用报文头、偏移位置、字符串掩码和用户自定义字符串来定义规则。</td>
</tr>
<tr>
<td>用户ACL</td>
<td>6000~6999</td>
<td>既可使用IPv4报文的源IP地址或源UCL ( User Control List )组，也可使用目的IP地址或目的UCL组、IP协议类型、ICMP类型、TCP源端口/目的端口、UDP源端口/目的端口号等来定义规则。</td>
</tr>
</tbody></table>
<ul>
<li>基于ACL标识方法的分类</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>规则定义描述</th>
</tr>
</thead>
<tbody><tr>
<td>数字型ACL</td>
<td>传统的ACL标识方法。创建ACL时，指定一个唯一的数字标识该ACL。</td>
</tr>
<tr>
<td>命名型ACL</td>
<td>通过名称代替编号来标识ACL。</td>
</tr>
</tbody></table>
<h3 id="基本ACL与高级ACL"><a href="#基本ACL与高级ACL" class="headerlink" title="基本ACL与高级ACL"></a>基本ACL与高级ACL</h3><ul>
<li>基本ACL</li>
</ul>
<p><img src="/2021/04/25/ACL/%E5%9F%BA%E6%9C%ACACL.png" alt="基本ACL"></p>
<ul>
<li>高级ACL</li>
</ul>
<p><img src="/2021/04/25/ACL/%E9%AB%98%E7%BA%A7ACL.png" alt="高级ACL"></p>
<h3 id="ACL的匹配机制"><a href="#ACL的匹配机制" class="headerlink" title="ACL的匹配机制"></a>ACL的匹配机制</h3><p><img src="/2021/04/25/ACL/ACL%E5%8C%B9%E9%85%8D%E6%9C%BA%E5%88%B6.png" alt="ACL匹配机制"></p>
<h3 id="ACL匹配位置"><a href="#ACL匹配位置" class="headerlink" title="ACL匹配位置"></a>ACL匹配位置</h3><p>入站(Inbound)及出站(Outbound)方向</p>
<p><img src="/2021/04/25/ACL/ACL%E5%8C%B9%E9%85%8D%E6%96%B9%E5%90%91.png" alt="ACL匹配方向"></p>
<h2 id="ACL应用规则"><a href="#ACL应用规则" class="headerlink" title="ACL应用规则"></a>ACL应用规则</h2><ol>
<li><p>“3P”原则</p>
<p>在路由器上应用ACL时，可以为每种协议（Per Protocol）、每个方向（Per Direction）</p>
<p>和每个接口（Per Interface）配置一个ACL，一般称为“3P原则”。</p>
<p>（1）一个ACL只能基于一种协议，因此每种协议都需要配置单独的ACL。</p>
<p>（2）经过路由器接口的数据有进（ln）和出（Out）两个方向，因此在接口上配置访问控制列表也有进（In）和出（Out）两个方向。每个接口可以配置进方向的ACL，也可以配置出方向的ACL，或者两者都配置，但是一个ACL只能控制一个方向。</p>
<p>（3）一个ACL只能控制一个接口上的数据流量，无法同时控制多个接口上的数据流量。</p>
</li>
<li><p>语句顺序决定了对数据的控制顺序</p>
<p>ACL的语句是一种自上而下的逻辑排列关系。数据匹配过程中是依次对语句进行比较，一旦匹配成功则按照当前语句控制策略处理，不再与之后的语句进行比较。因此，正确的语句顺序才能得到所需的控制效果。</p>
</li>
<li><p>至少有一条允许（Permit）语句</p>
<p>所有ACL的最后一条语句都是隐式拒绝语句，表示当所有语句都无法匹配时，将拒绝数据通过并自动丢弃数据，以防数据意外进入网络。因此，在写“拒绝（deny）”的ACL时，一定至少要有一条允许（Permit）语句，否则配置ACL的接口将拒绝任何数据通过，影响正常的网络通信。</p>
</li>
<li><p>最有限制性的语句应该放在ACL的靠前位置</p>
<p>最有限制性的语句放在ACL的靠前位置，可以首先过滤掉很多不符合条件的数据，节省后面语句的比较时间，从而提高路由器的工作效率。 </p>
</li>
</ol>
<h2 id="ACL基础配置命名"><a href="#ACL基础配置命名" class="headerlink" title="ACL基础配置命名"></a>ACL基础配置命名</h2><p>1.创建基本ACL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] acl [ number ] acl-number [ match-order config ]</span><br></pre></td></tr></table></figure>
<p>使用编号(2000~2999）创建一个数字型的基本ACL，并进入基本ACL视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] acl name acl-name &#123; basic | acl-number &#125; [ match-order config]</span><br></pre></td></tr></table></figure>
<p>使用名称创建一个命名型的基本ACL，并进入基本ACL视图。</p>
<p>2.配置基本ACL的规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-acl-basic-2000] rule [ rule-id ] &#123; deny | permit &#125; [ source &#123; source-address source-wildcard| any &#125; time-range time-name ]</span><br></pre></td></tr></table></figure>
<p>在基本ACL视图下，通过此命令来配置基本ACL的规则。</p>
<p>3.创建高级ACL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] acl [ number ] acl-number [ match-order config ]</span><br></pre></td></tr></table></figure>
<p>使用编号（ 3000~3999 )创建一个数字型的高级ACL，并进入高级ACL视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] acl name acl-name &#123; advance | acl-number &#125; [ match-order config ]</span><br></pre></td></tr></table></figure>
<p>使用名称创建一个命名型的高级ACL，进入高级ACL视图。</p>
<p>4.配置高级ACL的规则</p>
<p>根据IP承载的协议类型不同，在设备上配置不同的高级ACL规则。对于不同的协议类型，有不同的参数组合。<br>当参数protocol为lP时，高级ACL的命令格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule [ rule-id ] &#123; deny | permit &#125; ip [ destination &#123; destination-address destination-wildcard| any &#125; &#x2F; source &#123; source-addresssource-wildcard | any &#125; &#x2F; time-range time-name| [ dscp dscp | [ tos tos | precedence precedence]]]</span><br></pre></td></tr></table></figure>
<p>在高级ACL视图下，通过此命令来配置高级ACL的规则。<br>当参数protocol为TCP时，高级ACL的命令格式为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule [ rule-id] &#123; deny | permit &#125; &#123; protocol-number| tcp &#125; [ destination &#123; destination-address destination-wildcard l any &#125;ldestination-port &#123; eq port | gt port | t port | range port-start port-end &#125; | source &#123; source-address source-wildcard| any &#125; lsource-port &#123; eq port | gt port | lt port | range port-start port-end &#125; | tcp-flag &#123; ack l fin &#x2F; syn &#125; * &#x2F; time-range time-name ]*</span><br></pre></td></tr></table></figure>
<p>在高级ACL视图下，通过此命令来配置高级ACL的规则。</p>
<p>5.接口视图下应用ACL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-GigabitEtherneto&#x2F;0&#x2F;1] traffic-filter &#123; inbound | outbound &#125; acl acl-number</span><br></pre></td></tr></table></figure>

<p>在设备接口的入方向或出方向配置ACL</p>
<h2 id="ACL配置案例"><a href="#ACL配置案例" class="headerlink" title="ACL配置案例"></a>ACL配置案例</h2><p>案例1——-拒绝某台机器访问<br>按照下图所示拓扑结构，禁止主机pc2与pc1通信，而允许所有其他流量</p>
<p> <img src="/2021/04/25/ACL/ACL%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B.png" alt="ACL配置案例"></p>
<p>配置思路:<br>    ①在路由器上配置两个端口,设置好ip地址<br>    ②配置好主机的ip/子网掩码/网关<br>    ③在路由器上添加一条访问控制权限,基本acl 2000<br>    ④把这条acl限制规则应用到g0/0/1的端口上(可以称作监听端口)</p>
<p>R1配置:</p>
<p>[Huawei]interface GigabitEthernet 0/0/0                      //为0端口配置ip<br>[Huawei-GigabitEthernet0/0/0] ip address 192.168.1.254 24<br>[Huawei]acl 2000               //进入acl 2000 列表<br>[Huawei-acl-basic-2000]rule deny source 192.168.2.1 0      //定义一条规则 deny代表拒绝 source代表来源 0代表仅此一台<br>[Huawei]interface GigabitEthernet 0/0/1<br>[Huawei-GigabitEthernet0/0/1]ip address 192.168.2.254 24<br>[Huawei-GigabitEthernet0/0/1]traffic-filter inbound acl 2000               //用端口1来监听这条规则</p>
<p>测试:</p>
<ol>
<li>pc1 ping pc3 ,    通信成功</li>
<li>pc1 ping pc2,     通信失败</li>
<li>pc2 ping pc3,     通信成功</li>
</ol>
<hr>
<p>案例2——拒绝所有机器访问<br>还是刚才的案例,将</p>
<p>[Huawei-acl-basic-2000]rule deny source 192.168.2.1 0</p>
<p>更改为</p>
<p>[Huawei-acl-basic-2000]rule deny any 即可</p>
<hr>
<p>案例3——-仅允许某台机器访问<br>实验要求:仅允许pc2访问pc1</p>
<blockquote>
<p>根据acl规则4:最有限制性的语句应该放在ACL的靠前位置 和规则3: 至少有一条允许（Permit）语句</p>
</blockquote>
<p>配置如下:<br>[Huawei]interface GigabitEthernet 0/0/0                      //为0端口配置ip<br>[Huawei-GigabitEthernet0/0/0] ip address 192.168.1.254 24<br>[Huawei]acl 2000               //进入acl 2000 列表<br>[Huawei-acl-basic-2000]rule permit source 192.168.2.1 0      //定义一条规则 permit代表拒绝 source代表来源 0代表仅此一台<br>[Huawei-acl-basic-2000]rule deny any             // 拒绝所有访问<br>[Huawei]interface GigabitEthernet 0/0/1<br>[Huawei-GigabitEthernet0/0/1]ip address 192.168.2.254 24<br>[Huawei-GigabitEthernet0/0/1]traffic-filter inbound acl 2000               //用端口1来监听这条规则</p>
<hr>
<p>案例4———-拒绝访问ftp或者http服务<br>实验要求: 禁止pc2访问pc1的ftp服务，禁止pc3访问pc1的www服务，所有主机的其他服务不受限制</p>
<blockquote>
<p>ftp与http都是基于tcp协议的,所以我们可以拒绝tcp协议来限制</p>
</blockquote>
<p>R1配置:<br>[Huawei]acl 3000            //拒绝tcp为高级控制,所以3000起<br>[Huawei-acl-adv-3000]rule deny tcp source 192.168.2.1 0 destination 192.168.1.1     //destination代表目的地地址<br>[Huawei-acl-adv-3000]rule deny tcp source 192.168.2.2 0 destination 192.168.1.1<br>[Huawei]interface g0/0/1<br>[Huawei-GigabitEthernet0/0/1]traffic-filter inbound acl 3000 //在接口中应用acl</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/24/AAA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mydog.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zsy's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/04/24/AAA/" itemprop="url">AAA</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-24T19:11:49+08:00">
                2021-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="AAA概述"><a href="#AAA概述" class="headerlink" title="AAA概述"></a>AAA概述</h2><p>AAA是Authentication (认证)、Authorization(授权）和Accounting(计费）的简称，是网络安全的一种管理机制，提供了认证、授权、计费三种安全功能。</p>
<p><img src="/2021/04/24/AAA/AAA%E6%A6%82%E8%BF%B0.png" alt="AAA概述"></p>
<h2 id="AAA基本架构"><a href="#AAA基本架构" class="headerlink" title="AAA基本架构"></a>AAA基本架构</h2><p>AAA常见网络架构中包括用户、NAS ( Network Access Server )、AAA服务器(AAA Server ) 。</p>
<ul>
<li>NAS负责集中收集和管理用户的访问请求。</li>
<li>在NAS上会创建多个域来管理用户。不同的域可以关联不同的AAA方案。AAA方案包含认证方案，授权方案，计费方案。</li>
<li>当收到用户接入网络的请求时，NAS会根据用户名来判断用户所在的域，根据该域对应的AAA方案对用户进行管控。</li>
</ul>
<p><img src="/2021/04/24/AAA/AAA%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84.png" alt="AAA基本架构"></p>
<h2 id="Authentication-认证"><a href="#Authentication-认证" class="headerlink" title="Authentication (认证)"></a>Authentication (认证)</h2><p>AAA支持的认证方式有:不认证，本地认证，远端认证。</p>
<ul>
<li>不认证：对用户非常信任，不对其进行合法检查，一般情况下不采用这种方式。 </li>
<li>本地认证：将用户信息配置在网络接入服务器上。本地认证的优点是速度快，可以为运营降低成本，缺点是存储信息量受设备硬件条件限制。 </li>
<li>远端认证：将用户信息配置在认证服务器上。支持通过 RADIUS（Remote Authentication Dial In User Service）协议或 HWTACACS（HuaWei Terminal Access Controller Access Control System）协议进行远端认证。 </li>
</ul>
<p><img src="/2021/04/24/AAA/%E8%AE%A4%E8%AF%81.png" alt="认证"></p>
<h2 id="Authorization-授权）"><a href="#Authorization-授权）" class="headerlink" title="Authorization(授权）"></a>Authorization(授权）</h2><p>AAA支持的授权方式有:不授权，本地授权，远端授权。</p>
<ul>
<li><p>不授权：不对用户进行授权处理。 </p>
</li>
<li><p>本地授权：根据网络接入服务器为本地用户账号配置的相关属性进行授权。 </p>
</li>
<li><p>HWTACACS 授权：由 HWTACACS 服务器对用户进行授权。 </p>
</li>
<li><p>if-authenticated 授权：如果用户通过了认证，而且使用的认证</p>
<p>模式是本地或远端认证，则用户授权通过。 </p>
</li>
<li><p>RADIUS 认证成功后授权：RADIUS 协议的认证和授权是绑定在一起的，不能单独使用 RADIUS 进行授权。 </p>
</li>
</ul>
<p>授权信息包括:所属用户组、所属VLAN、ACL编号等。</p>
<p><img src="/2021/04/24/AAA/%E6%8E%88%E6%9D%83.png" alt="授权"></p>
<h2 id="Accounting-计费）"><a href="#Accounting-计费）" class="headerlink" title="Accounting(计费）"></a>Accounting(计费）</h2><p>计费功能用于<strong>监控授权用户的网络行为和网络资源的使用情况</strong></p>
<p>AAA支持的计费方式有:不计费，远端计费。</p>
<ul>
<li> 不计费：不对用户计费。 </li>
<li>远端计费：支持通过 RADIUS 服务器或 HWTACACS 服务器进行远端计费。 </li>
</ul>
<h2 id="AAA实现-RADIUS-协议"><a href="#AAA实现-RADIUS-协议" class="headerlink" title="AAA实现-RADIUS 协议"></a>AAA实现-RADIUS 协议</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>远程认证拨号用户服务 RADIUS（Remote Authentication Dial-In User Service）是一种分布式的、客 户端/服务器结构的信息交互协议，能保护网络不受未授权访问的干扰，常应用在既要求较高安全 性、又允许远程用户访问的各种网络环境中。该协议定义了基于 UDP 的 RADIUS 帧格式及其消息 传输机制，并规定 UDP 端口 1812、1813 分别作为认证、计费端口。<br>RADIUS 最初仅是针对拨号用户的 AAA 协议，后来随着用户接入方式的多样化发展，RADIUS 也 适应多种用户接入方式，如以太网接入、ADSL 接入。它通过认证授权来提供接入服务，通过计费 来收集、记录用户对网络资源的使用。 </p>
<h3 id="RADIUS服务器"><a href="#RADIUS服务器" class="headerlink" title="RADIUS服务器"></a>RADIUS服务器</h3><p>RADIUS 服务器一般运行在中心计算机或工作站上，维护相关的用户认证和网络服务访问信息，负 责接收用户连接请求并认证用户，然后给客户端返回所有需要的信息（如接受/拒绝认证请求）。</p>
<p>RADIUS 服务器通常要维护三个数据库：</p>
<p><img src="/2021/04/24/AAA/RADIUS%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="RADIUS数据库"></p>
<p>“Users”：用于存储用户信息（如用户名、口令以及使用的协议、IP 地址等配置信息）。<br>“Clients”：用于存储 RADIUS 客户端的信息（如接入设备的共享密钥、IP 地址等）。<br>“Dictionary”：用于存储 RADIUS 协议中的属性和属性值含义的信息。 </p>
<h3 id="RADIUS客户端"><a href="#RADIUS客户端" class="headerlink" title="RADIUS客户端"></a>RADIUS客户端</h3><p>RADIUS 客户端一般位于网络接入服务器 NAS（Network Access Server）设备上，可以遍布整个网 络，负责传输用户信息到指定的 RADIUS 服务器，然后根据从服务器返回的信息进行相应处理（如 接受/拒绝用户接入）。<br>网络接入服务器作为 RADIUS 协议的客户端，实现以下功能：<br>      标准 RADIUS 协议及扩充属性，包括 RFC2865、RFC2866。<br>      华为扩展的私有属性。<br>      对 RADIUS 服务器状态的主动探测功能。<br>      计费结束报文的本地缓存重传功能。</p>
<p>​      RADIUS 服务器的自动切换功能。 </p>
<h3 id="安全机制"><a href="#安全机制" class="headerlink" title="安全机制"></a>安全机制</h3><p>RADIUS 客户端和 RADIUS 服务器之间认证消息的交互是通过共享密钥的参与来完成的，并且共 享密钥不能通过网络来传输，增强了信息交互的安全性。另外，为防止用户密码在不安全的网络上 传递时被窃取，在传输过程中对密码进行了加密。 </p>
<h3 id="认证和计费消息流程"><a href="#认证和计费消息流程" class="headerlink" title="认证和计费消息流程"></a>认证和计费消息流程</h3><ul>
<li>用户登录网络接入服务器时，会将用户名和密码发送给该网络接入服务器； </li>
<li>该网络接入服务器中的 RADIUS 客户端接收用户名和密码，并向 RADIUS 服务器发送认证请求； </li>
<li>RADIUS 服务器接收到合法的请求后，完成认证，并把所需的用户授权信息返回给客户端； 对于非法的请求，RADIUS 服务器返回认证失败的信息给客户端。 </li>
<li>计费的消息流程和认证/授权的消息流程类似。 </li>
</ul>
<p><img src="/2021/04/24/AAA/RADIUS%E6%B5%81%E7%A8%8B.png" alt="RADIUS流程"></p>
<h2 id="AAA实现-HWTACACS-协议"><a href="#AAA实现-HWTACACS-协议" class="headerlink" title="AAA实现-HWTACACS 协议"></a>AAA实现-HWTACACS 协议</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>HW 终端访问控制器控制系统协议 HWTACACS（Huawei Terminal Access Controller Access Control System）是在 TACACS（RFC 1492）基础上进行了功能增强的安全协议。该协议与 RADIUS 协议 类似，采用客户端/服务器模式实现 NAS 与 HWTACACS 服务器之间的通信。<br>HWTACACS 协议主要用于点对点协议 PPP（Point-to-Point Protocol）和虚拟私有拨号网络 VPDN （Virtual Private Dial-up Network）接入用户及终端用户的认证、授权和计费。其典型应用是对需要 登录到设备上进行操作的终端用户进行认证、授权、计费。设备作为 HWTACACS 的客户端，将 用户名和密码发给 HWTACACS 服务器进行验证。用户验证通过并得到授权之后可以登录到设备 上进行操作。 </p>
<h3 id="HWTACACS-协议和-RADIUS-协议的比较"><a href="#HWTACACS-协议和-RADIUS-协议的比较" class="headerlink" title="HWTACACS 协议和 RADIUS 协议的比较"></a>HWTACACS 协议和 RADIUS 协议的比较</h3><table>
<thead>
<tr>
<th>HWTACACS</th>
<th>RADIUS</th>
</tr>
</thead>
<tbody><tr>
<td>使用TCP，网络传输更可靠</td>
<td>使用UDP</td>
</tr>
<tr>
<td>除了标准的HWTACACS报文头,对报文主体全部进行加密</td>
<td>只是对认证报文中的密码字段进行加密</td>
</tr>
<tr>
<td>认证与授权分离</td>
<td>认证与授权一起处理</td>
</tr>
<tr>
<td>适于进行安全控制</td>
<td>适于进行计费</td>
</tr>
<tr>
<td>支持对设备上的配置命令进行授权使用</td>
<td>不支持</td>
</tr>
</tbody></table>
<h3 id="HWTACACS-的基本消息交互流程"><a href="#HWTACACS-的基本消息交互流程" class="headerlink" title="HWTACACS 的基本消息交互流程"></a>HWTACACS 的基本消息交互流程</h3><p>下面以 Telnet 用户为例，说明使用 HWTACACS 对用户进行认证、授权和计费的过程。</p>
<p><img src="/2021/04/24/AAA/HWTACACS%E8%BF%87%E7%A8%8B.png" alt="HWTACACS过程"></p>
<blockquote>
<p>HWTACACS 协议与其他厂商支持的 TACACS+协议都实现了认证、授权、计费的功能。HWTACACS 和 TACACS+的认证流程与实现方式是一致的，HWTACACS 协议能够完全兼容 TACACS+协议。 </p>
</blockquote>
<h2 id="AAA基于域的用户管理"><a href="#AAA基于域的用户管理" class="headerlink" title="AAA基于域的用户管理"></a>AAA基于域的用户管理</h2><p>一个域是由属于同一个域的用户构成的群体。<br>NAS 设备对用户的管理是基于域的，每个接入用户都属于一个域。用户所属的域是由用户登录时提供的用户名决定的。</p>
<p><img src="/2021/04/24/AAA/AAA%E5%9F%9F.png" alt="AAA域"></p>
<blockquote>
<p>用户的认证、授权、计费都是在相应的域视图下应用预先配置的认证、授权、计费方案来实现的。 AAA 有缺省的认证、授权、计费方案，分别为本地认证、本地授权、本地计费。如果用户所属的 域下未应用任何认证、授权、计费方案，系统将使用缺省的认证、授权、计费方案。 </p>
</blockquote>
<h2 id="AAA配置命令"><a href="#AAA配置命令" class="headerlink" title="AAA配置命令"></a>AAA配置命令</h2><p>1．进入AAA视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei] aaa</span><br></pre></td></tr></table></figure>
<p>从系统视图进入AAA视图进行配置<br>2. 创建认证方案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] authentication-scheme authentication-scheme-name</span><br></pre></td></tr></table></figure>
<p>创建认证方案并进入相应的认证方案视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa-authentication-scheme-name] authentication-mode &#123; hwtacacs &#x2F; local | radius &#125;</span><br></pre></td></tr></table></figure>
<p>配置认证方式，local指定认证方式为本地认证。缺省情况下，认证方式为本地认证。<br>3. 创建domain并绑定认证方案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] domain domain-name</span><br></pre></td></tr></table></figure>
<p>创建domain并进入相应的domain视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa-domain-name] authentication-scheme authentication-scheme-name</span><br></pre></td></tr></table></figure>
<p>在相应的domain视图下绑定认证方案<br>4. 创建用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name password cipher password</span><br></pre></td></tr></table></figure>
<p>创建本地用户，并配置本地用户的密码:<br>如果用户名中带域名分隔符，如@，则认为@前面的部分是用户名，后面部分是域名·如果没有@，则整个字符串为用户名，域为默认域。<br>5. 配置用户接入类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name service-type &#123; &#123; terminal | telnet | ftp | ssh &#x2F; snmp | http ]&#x2F; ppp | none &#125;</span><br></pre></td></tr></table></figure>
<p>设置本地用户的接入类型。缺省情况下，本地用户关闭所有的接入类型。<br>6. 配置用户级别</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei-aaa] local-user user-name privilege level level</span><br></pre></td></tr></table></figure>
<p>指定本地用户的权限级别。</p>
<ol start="7">
<li>显示历史用户登录记录</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Huawei]display aaa offline-record all</span><br></pre></td></tr></table></figure>

<h2 id="AAA配置案例"><a href="#AAA配置案例" class="headerlink" title="AAA配置案例"></a>AAA配置案例</h2><h3 id="AAA-Radius进行认证、授权、计费（使用UDP端口1812和1813）"><a href="#AAA-Radius进行认证、授权、计费（使用UDP端口1812和1813）" class="headerlink" title="AAA+Radius进行认证、授权、计费（使用UDP端口1812和1813）"></a>AAA+Radius进行认证、授权、计费（使用UDP端口1812和1813）</h3><p>下述拓扑中用户处于huawei域中，通过出口设备LSW1去访问Internet，LSW2作为运营商边界设备负责对用户访问internet的权限进行控制，执行AAA认证，认证模式采用Radius服务器认证和计费，现在需要实现ISP对huawei域内的企业用户进行Radius认证，必须在LSW2上配置AAA认证和Radius模板来完成对接入用户的控制。</p>
<p><img src="/2021/04/24/AAA/RADIUS%E6%A1%88%E4%BE%8B.png" alt="RADIUS案例"></p>
<p>在LSW2上的配置如下：</p>
<p>一、配置AAA认证方案</p>
<p>[Huawei]aaa</p>
<p>[Huawei-aaa]authentication-scheme ren_zheng                          配置AAA认证方案名为ren_zheng</p>
<p>[Huawei-aaa-authen-aaa]authentication-mode radius local        配置AAA认证模式为先Radius，如无响应则本地认证</p>
<p>[Huawei-aaa-authen-aaa]quit</p>
<p>[Huawei-aaa]accounting-scheme ji_fei                                       配置AAA计费方案名为ji_fei</p>
<p>[Huawei-aaa-accounting-ji_fei]accounting-mode radius             配置AAA计费模式为Radius服务器计费</p>
<p>[Huawei-aaa-accounting-ji_fei]accounting start-fail offline         配置当开始计费失败时，将用户离线</p>
<p>[Huawei-aaa-accounting-ji_fei]quit</p>
<p>二、配置Radius模板</p>
<p>[Huawei]radius-server template huawei_use                              配置Raduis模板名为huawei_use</p>
<p>[Huawei-radius-huawei_use]radius-server authentication 192.168.1.254 1812    主radius认证服务地址和端口</p>
<p>[Huawei-radius-huawei_use]radius-server authentication 192.168.1.253 1812 secondary  备用认证服务器</p>
<p>[Huawei-radius-huawei_use]radius-server accounting 192.168.1.253 1812         主radius计费服务地址和端口</p>
<p>[Huawei-radius-huawei_use]radius-server accounting 192.168.1.253 1813 secondary       备用计费服务器</p>
<p>[Huawei-radius-huawei_use]radius-server shared-key cipher hello      配置设备与Radius通信的共享秘钥为hello</p>
<p>[Huawei-radius-huawei_use]radius-server retransmit 2 timeout 5       配置设备向Radius服务器发送请求报文的超时重传次数为2s，间隔为5s</p>
<p>[Huawei-radius-huawei_use]quit</p>
<p>三、在AAA用户域绑定要使用的AAA认证和Radius模板</p>
<p>[Huawei]aaa</p>
<p>[Huawei-aaa]domain huawei                   配置AAA域，名称huawei</p>
<p>[Huawei-aaa-domain-huawei]authentication-scheme ren_zheng     在域中绑定AAA认证方案</p>
<p>[Huawei-aaa-domain-huawei]accounting-scheme ji_fei                   在域中绑定AAA计费方案</p>
<p>[Huawei-aaa-domain-huawei]radius-server huawei_use                   在域中绑定Radius模板</p>
<p>[Huawei-aaa-domain-huawei]quit</p>
<p>四、检查命令：</p>
<p><strong>[Huawei]display radius-server configuration template huawei_use</strong></p>
<hr>
<p>  Server-template-name             :  huawei_use<br>  Protocol-version                 :  standard<br>  Traffic-unit                     :  B<br>  Shared-secret-key                :  aaYOZ$V^P35NZPO3JBXBHA!!<br>  Timeout-interval(in second)      :  5<br>  Primary-authentication-server    :  192.168.1.254  :1812 :-LoopBack:NULL   Source-IP:0.0.0.0<br>  Primary-accounting-server        :  192.168.1.254  :1813 :-LoopBack:NULL   Source-IP:0.0.0.0<br>  Secondary-authentication-server  :  192.168.1.253  :1812 :-LoopBack:NULL   Source-IP:0.0.0.0<br>  Secondary-accounting-server      :  192.168.1.253  :1813 :-LoopBack:NULL   Source-IP:0.0.0.0<br>  Retransmission                   :  2<br>  Domain-included                  :  YES<br>  NAS-IP-Address                   :  0.0.0.0</p>
<p>Calling-station-id MAC-format    :  xxxx-xxxx-xxxx</p>
<hr>
<p>[Huawei]</p>
<p><strong>[Huawei]display domain name huawei</strong></p>
<hr>
<p>  Domain-name                     : huawei<br>  Domain-state                      : Active<br>  Authentication-scheme-name      : ren_zheng<br>  Accounting-scheme-name           : ji_fei<br>  Authorization-scheme-name       : -<br>  Service-scheme-name              : -<br>  RADIUS-server-template          : huawei_use<br>  HWTACACS-server-template        : -</p>
<hr>
<p>[Huawei]</p>
<h3 id="AAA-HWTACACS进行认证、授权、计费（默认所有使用TCP端口49）"><a href="#AAA-HWTACACS进行认证、授权、计费（默认所有使用TCP端口49）" class="headerlink" title="AAA+HWTACACS进行认证、授权、计费（默认所有使用TCP端口49）"></a>AAA+HWTACACS进行认证、授权、计费（默认所有使用TCP端口49）</h3><p>拓扑图如下:</p>
<p><img src="/2021/04/24/AAA/RADIUS%E6%A1%88%E4%BE%8B.png" alt="RADIUS案例"></p>
<p>在LSW2上的配置如下：</p>
<p>一、配置AAA认证方案</p>
<p>[Huawei]aaa<br>[Huawei-aaa]authentication-scheme ren_zheng                              配置AAA认证方案名为ren_zheng<br>[Huawei-aaa-authen-aaa]authentication-mode hwtacacs local        配置AAA认证模式为先hwtacacs，如无响应则本地认证<br>[Huawei-aaa-authen-aaa]authentication-super hwtacacs super       接入用户进行提权时，先进行hwtacacs认证，如无响应再本地认证<br>[Huawei-aaa-authen-aaa]quit<br>[Huawei]aaa<br>[Huawei-aaa]authorization-scheme shou_quan                             配置AAA授权方案名为ren_zheng<br>[Huawei-aaa-author-aaa]authorization-mode hwtacacs local        配置AAA授权模式为先hwtacacs，如无响应则本地授权</p>
<p>[Huawei-aaa-author-aaa]quit</p>
<p>[Huawei-aaa]accounting-scheme ji_fei                                    配置AAA计费方案名为ji_fei<br>[Huawei-aaa-accounting-ji_fei]accounting-mode hwtacacs     配置AAA计费模式为hwtacacs服务器计费<br>[Huawei-aaa-accounting-ji_fei]accounting start-fail offline      配置当开始计费失败时，将用户离线<br>[Huawei-aaa-accounting-ji_fei]accounting relaltime 3              配置对用户进行实时计费，计费间隔为3min<br>[Huawei-aaa-accounting-ji_fei]quit</p>
<p>二、配置hwtacacs模板</p>
<p>[Huawei]hwtacacs-server template huawei_use                       配置hwtacacs模板名为huawei_use<br>[Huawei-hwtacacs-huawei_use]hwtacacs-server authentication 192.168.1.254 49    主hwtacacs认证服务地址和端口<br>[Huawei-hwtacacs-huawei_use]hwtacacs-server authentication 192.168.1.253 49 secondary     备用认证服务器<br>[Huawei-hwtacacs-huawei_use]hwtacacs-server authorization 192.168.1.253 49      主hwtacacs授权服务地址和端口<br>[Huawei-hwtacacs-huawei_use]hwtacacs-server authorization 192.168.1.253 49 secondary       备用授权服务器</p>
<p>[Huawei-hwtacacs-huawei_use]hwtacacs-server accounting 192.168.1.253 49         主hwtacacs计费服务地址和端口<br>[Huawei-hwtacacs-huawei_use]hwtacacs-server accounting 192.168.1.253 49 secondary          备用计费服务器</p>
<p>[Huawei-hwtacacs-huawei_use]hwtacacs-server shared-key cipher hello      配置设备与hwtacacs通信的共享秘钥为hello</p>
<p>[Huawei-hwtacacs-huawei_use]quit<br>三、在AAA用户域绑定要使用的AAA认证和hwtacacs模板</p>
<p>[Huawei]aaa<br>[Huawei-aaa]domain huawei                   配置AAA域，名称huawei<br>[Huawei-aaa-domain-huawei]authentication-scheme ren_zheng    在域中绑定AAA认证方案<br>[Huawei-aaa-domain-huawei]authorization-scheme shou_quan     在域中绑定AAA认证方案<br>[Huawei-aaa-domain-huawei]accounting-scheme ji_fei                   在域中绑定AAA计费方案<br>[Huawei-aaa-domain-huawei]hwtacacs-server huawei_use              在域中绑定hwtacacs模板</p>
<p>[Huawei-aaa-domain-huawei]quit</p>
<p>四、检查命令：</p>
<p><strong>[Huawei]display hwtacacs-server template huawei_use</strong></p>
<hr>
<p> HWTACACS-server template name   : huawei_use<br>  Primary-authentication-server  : 192.168.1.254:49:-<br>  Primary-authorization-server    : 192.168.1.254:49-<br>  Primary-accounting-server       : 192.168.1.254:49:-<br>  Secondary-authentication-server : 192.168.1.253:49:-<br>  Secondary-authorization-server   : 192.168.1.253:49:-<br>  Secondary-accounting-server      : 192.168.1.253:49:-<br>  Current-authentication-server   : 192.168.1.254:49:-<br>  Current-authorization-server     : 192.168.1.254:49:-<br>  Current-accounting-server        : 192.168.1.254:49:-<br>  Source-IP-address               : 0.0.0.0<br>  Shared-key                      : hello<br>  Quiet-interval(min)             : 5<br>  Response-timeout-Interval(sec)  : 5<br>  Domain-included                 : Yes<br>  Traffic-unit                    : B</p>
<p>  Total 1,1 printed</p>
<hr>
<p>[Huawei]</p>
<p><strong>[Huawei]display domain name huawei</strong></p>
<hr>
<p>  Domain-name                     : huawei<br>  Domain-state                      : Active<br>  Authentication-scheme-name     : ren_zheng<br>  Accounting-scheme-name          : ji_fei<br>  Authorization-scheme-name       : shou_quan<br>  Service-scheme-name              : -<br>  RADIUS-server-template          : -<br>  HWTACACS-server-template        : huawei_use</p>
<hr>
<p>[Huawei]</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/mydog.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zsy9959" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zsy9959@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张思宇</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
